(self.webpackChunkdapengdouyu=self.webpackChunkdapengdouyu||[]).push([[218],{3905:function(e,t,a){"use strict";a.d(t,{Zo:function(){return u},kt:function(){return c}});var n=a(7294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function l(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function p(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?l(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):l(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function i(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},l=Object.keys(e);for(n=0;n<l.length;n++)a=l[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(n=0;n<l.length;n++)a=l[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var o=n.createContext({}),s=function(e){var t=n.useContext(o),a=t;return e&&(a="function"==typeof e?e(t):p(p({},t),e)),a},u=function(e){var t=s(e.components);return n.createElement(o.Provider,{value:t},e.children)},b={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},m=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,l=e.originalType,o=e.parentName,u=i(e,["components","mdxType","originalType","parentName"]),m=s(a),c=r,k=m["".concat(o,".").concat(c)]||m[c]||b[c]||l;return a?n.createElement(k,p(p({ref:t},u),{},{components:a})):n.createElement(k,p({ref:t},u))}));function c(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var l=a.length,p=new Array(l);p[0]=m;var i={};for(var o in t)hasOwnProperty.call(t,o)&&(i[o]=t[o]);i.originalType=e,i.mdxType="string"==typeof e?e:r,p[1]=i;for(var s=2;s<l;s++)p[s]=a[s];return n.createElement.apply(null,p)}return n.createElement.apply(null,a)}m.displayName="MDXCreateElement"},3001:function(e,t,a){"use strict";a.r(t),a.d(t,{frontMatter:function(){return i},contentTitle:function(){return o},metadata:function(){return s},toc:function(){return u},default:function(){return m}});var n=a(4034),r=a(9973),l=(a(7294),a(3905)),p=["components"],i={},o=void 0,s={unversionedId:"books/babel/4\u3001Babel \u7684 api",id:"books/babel/4\u3001Babel \u7684 api",isDocsHomePage:!1,title:"4\u3001Babel \u7684 api",description:"\u5b66\u4e60\u4e86 babel \u7684\u7f16\u8bd1\u6d41\u7a0b\u548c AST \u4e4b\u540e\uff0c\u6211\u4eec\u6765\u5b66\u4e60\u4e0b babel \u7684 api\uff0c\u901a\u8fc7\u8fd9\u4e9b api \u6765\u64cd\u4f5c AST\uff0c\u5b8c\u6210\u4ee3\u7801\u7684\u8f6c\u6362\u3002",source:"@site/docs/books/babel/4\u3001Babel \u7684 api.md",sourceDirName:"books/babel",slug:"/books/babel/4\u3001Babel \u7684 api",permalink:"/docs/books/babel/4\u3001Babel \u7684 api",editUrl:"https://github.com/dapengdouyu/docs/tree/master/docs/books/babel/4\u3001Babel \u7684 api.md",version:"current",lastUpdatedAt:1633773412,formattedLastUpdatedAt:"10/9/2021",frontMatter:{}},u=[{value:"babel \u7684 api \u6709\u54ea\u4e9b",id:"babel-\u7684-api-\u6709\u54ea\u4e9b",children:[]},{value:"@babel/parser",id:"babelparser",children:[]},{value:"@babel/traverse",id:"babeltraverse",children:[]},{value:"@babel/types",id:"babeltypes",children:[]},{value:"@babel/template",id:"babeltemplate",children:[]},{value:"@babel/generator",id:"babelgenerator",children:[]},{value:"@babel/code-frame",id:"babelcode-frame",children:[]},{value:"@babel/core",id:"babelcore",children:[]},{value:"\u603b\u7ed3",id:"\u603b\u7ed3",children:[]}],b={toc:u};function m(e){var t=e.components,a=(0,r.Z)(e,p);return(0,l.kt)("wrapper",(0,n.Z)({},b,a,{components:t,mdxType:"MDXLayout"}),(0,l.kt)("p",null,"\u5b66\u4e60\u4e86 babel \u7684\u7f16\u8bd1\u6d41\u7a0b\u548c AST \u4e4b\u540e\uff0c\u6211\u4eec\u6765\u5b66\u4e60\u4e0b babel \u7684 api\uff0c\u901a\u8fc7\u8fd9\u4e9b api \u6765\u64cd\u4f5c AST\uff0c\u5b8c\u6210\u4ee3\u7801\u7684\u8f6c\u6362\u3002"),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},"\u6ce8\u610f\uff0c\u6211\u4eec\u5b66\u4e60\u7684 api \u662f babel 7.x \u7684\uff0cbabel 6 \u7684 api \u8fd8\u6ca1\u6709\u6309\u7167 scope \u6765\u5212\u5206\uff0c\u662f babel-parser \u8fd9\u79cd\uff0c\u800c babel 7 \u53d8\u6210\u4e86\\@babel/parser \u8fd9\u79cd\u3002\u4f46\u5177\u4f53 api \u5dee\u4e0d\u591a\uff0c\u6211\u4eec\u5b66\u7684\u662f\u4e00\u4e9b\u539f\u7406\u6027\u7684\u4e1c\u897f\uff0c\u8fd9\u4e9b\u4e1c\u897f\u5728\u7248\u672c\u8fed\u4ee3\u4e2d\u662f\u4e0d\u4f1a\u53d8\u7684\u3002")),(0,l.kt)("h2",{id:"babel-\u7684-api-\u6709\u54ea\u4e9b"},"babel \u7684 api \u6709\u54ea\u4e9b"),(0,l.kt)("p",null,"\u6211\u4eec\u77e5\u9053 babel \u7684\u7f16\u8bd1\u6d41\u7a0b\u5206\u4e3a\u4e09\u6b65\uff1aparse\u3001transform\u3001generate\uff0c\u6bcf\u4e00\u6b65\u90fd\u66b4\u9732\u4e86\u4e00\u4e9b api \u51fa\u6765\u3002"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"parse \u9636\u6bb5\u6709",(0,l.kt)("inlineCode",{parentName:"li"},"@babel/parser"),"\uff0c\u529f\u80fd\u662f\u628a\u6e90\u7801\u8f6c\u6210 AST"),(0,l.kt)("li",{parentName:"ul"},"transform \u9636\u6bb5\u6709 ",(0,l.kt)("inlineCode",{parentName:"li"},"@babel/traverse"),"\uff0c\u53ef\u4ee5\u904d\u5386 AST\uff0c\u5e76\u8c03\u7528 visitor \u51fd\u6570\u4fee\u6539 AST\uff0c\u4fee\u6539 AST \u81ea\u7136\u6d89\u53ca\u5230 AST \u7684\u5224\u65ad\u3001\u521b\u5efa\u3001\u4fee\u6539\u7b49\uff0c\u8fd9\u65f6\u5019\u5c31\u9700\u8981 ",(0,l.kt)("inlineCode",{parentName:"li"},"@babel/types")," \u4e86\uff0c\u5f53\u9700\u8981\u6279\u91cf\u521b\u5efa AST \u7684\u65f6\u5019\u53ef\u4ee5\u4f7f\u7528 ",(0,l.kt)("inlineCode",{parentName:"li"},"@babel/template")," \u6765\u7b80\u5316 AST \u521b\u5efa\u903b\u8f91\u3002"),(0,l.kt)("li",{parentName:"ul"},"generate \u9636\u6bb5\u4f1a\u628a AST \u6253\u5370\u4e3a\u76ee\u6807\u4ee3\u7801\u5b57\u7b26\u4e32\uff0c\u540c\u65f6\u751f\u6210 sourcemap\uff0c\u9700\u8981 ",(0,l.kt)("inlineCode",{parentName:"li"},"@babel/generate")," \u5305"),(0,l.kt)("li",{parentName:"ul"},"\u4e2d\u9014\u9047\u5230\u9519\u8bef\u60f3\u6253\u5370\u4ee3\u7801\u4f4d\u7f6e\u7684\u65f6\u5019\uff0c\u4f7f\u7528 ",(0,l.kt)("inlineCode",{parentName:"li"},"@babel/code-frame")," \u5305"),(0,l.kt)("li",{parentName:"ul"},"babel \u7684\u6574\u4f53\u529f\u80fd\u901a\u8fc7 ",(0,l.kt)("inlineCode",{parentName:"li"},"@babel/core")," \u63d0\u4f9b\uff0c\u57fa\u4e8e\u4e0a\u9762\u7684\u5305\u5b8c\u6210 babel \u6574\u4f53\u7684\u7f16\u8bd1\u6d41\u7a0b\uff0c\u5e76\u5b9e\u73b0\u63d2\u4ef6\u529f\u80fd\u3002")),(0,l.kt)("p",null,"\u6211\u4eec\u4e3b\u8981\u5b66\u4e60\u7684\u5c31\u662f ",(0,l.kt)("inlineCode",{parentName:"p"},"@babel/parser"),"\uff0c",(0,l.kt)("inlineCode",{parentName:"p"},"@babel/traverse"),"\uff0c",(0,l.kt)("inlineCode",{parentName:"p"},"@babel/generator"),"\uff0c",(0,l.kt)("inlineCode",{parentName:"p"},"@babel/types"),"\uff0c",(0,l.kt)("inlineCode",{parentName:"p"},"@babel/template")," \u8fd9\u4e94\u4e2a\u5305\u7684 api \u7684\u4f7f\u7528\u3002"),(0,l.kt)("h2",{id:"babelparser"},"\\@babel/parser"),(0,l.kt)("p",null,"babel parser \u53eb babylon\uff0c\u662f\u57fa\u4e8e acorn \u5b9e\u73b0\u7684\uff0c\u6269\u5c55\u4e86\u5f88\u591a\u8bed\u6cd5\uff0c\u53ef\u4ee5\u652f\u6301 es next\uff08\u73b0\u5728\u652f\u6301\u5230 es2020\uff09\u3001jsx\u3001flow\u3001typescript \u7b49\u8bed\u6cd5\u7684\u89e3\u6790\uff0c\u5176\u4e2d jsx\u3001flow\u3001typescript \u8fd9\u4e9b\u975e\u6807\u51c6\u7684\u8bed\u6cd5\u7684\u89e3\u6790\u9700\u8981\u6307\u5b9a\u8bed\u6cd5\u63d2\u4ef6\u3002"),(0,l.kt)("p",null,"\u5b83\u63d0\u4f9b\u4e86\u6709\u4e24\u4e2a api\uff1aparse \u548c parseExpression\u3002\u4e24\u8005\u90fd\u662f\u628a\u6e90\u7801\u8f6c\u6210 AST\uff0c\u4e0d\u8fc7 parse \u8fd4\u56de\u7684 AST \u6839\u8282\u70b9\u662f File\uff08\u6574\u4e2a AST\uff09\uff0cparseExpression \u8fd4\u56de\u7684 AST \u6839\u8282\u70b9\u662f\u662f Expression\uff08\u8868\u8fbe\u5f0f\u7684 AST\uff09\uff0c\u7c92\u5ea6\u4e0d\u540c\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"function parse(input: string, options?: ParserOptions): File\nfunction parseExpression(input: string, options?: ParserOptions): Expression\n")),(0,l.kt)("p",null,"\u8be6\u7ec6\u7684 options \u53ef\u4ee5\u67e5\u770b",(0,l.kt)("a",{parentName:"p",href:"https://babeljs.io/docs/en/babel-parser#options"},"\u6587\u6863"),"\u3002\u5176\u5b9e\u4e3b\u8981\u5206\u4e3a\u4e24\u7c7b\uff0c\u4e00\u662f parse \u7684\u5185\u5bb9\u662f\u4ec0\u4e48\uff0c\u4e8c\u662f\u4ee5\u4ec0\u4e48\u65b9\u5f0f\u53bb parse"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"parse \u7684\u5185\u5bb9\u662f\u4ec0\u4e48\uff1a")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"plugins"),"\uff1a \u6307\u5b9ajsx\u3001typescript\u3001flow \u7b49\u63d2\u4ef6\u6765\u89e3\u6790\u5bf9\u5e94\u7684\u8bed\u6cd5"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"allowXxx"),"\uff1a \u6307\u5b9a\u4e00\u4e9b\u8bed\u6cd5\u662f\u5426\u5141\u8bb8\uff0c\u6bd4\u5982\u51fd\u6570\u5916\u7684 await\u3001\u6ca1\u58f0\u660e\u7684 export\u7b49"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"sourceType"),"\uff1a \u6307\u5b9a\u662f\u5426\u652f\u6301\u89e3\u6790\u6a21\u5757\u8bed\u6cd5\uff0c\u6709 module\u3001script\u3001unambiguous 3\u4e2a\u53d6\u503c\uff0cmodule \u662f\u89e3\u6790 es module \u8bed\u6cd5\uff0cscript \u5219\u4e0d\u89e3\u6790 es module \u8bed\u6cd5\uff0c\u5f53\u4f5c\u811a\u672c\u6267\u884c\uff0cunambiguous \u5219\u662f\u6839\u636e\u5185\u5bb9\u662f\u5426\u6709 import \u548c export \u6765\u786e\u5b9a\u662f\u5426\u89e3\u6790 es module \u8bed\u6cd5\u3002")),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u4ee5\u4ec0\u4e48\u65b9\u5f0f parse")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"strictMode")," \u662f\u5426\u662f\u4e25\u683c\u6a21\u5f0f"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"startLine")," \u4ece\u6e90\u7801\u54ea\u4e00\u884c\u5f00\u59cb parse"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"errorRecovery")," \u51fa\u9519\u65f6\u662f\u5426\u8bb0\u5f55\u9519\u8bef\u5e76\u7ee7\u7eed\u5f80\u4e0b parse"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"tokens")," parse \u7684\u65f6\u5019\u662f\u5426\u4fdd\u7559 token \u4fe1\u606f"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"ranges")," \u662f\u5426\u5728 ast \u8282\u70b9\u4e2d\u6dfb\u52a0 ranges \u5c5e\u6027")),(0,l.kt)("p",null,"\u5176\u5b9e\u6700\u5e38\u7528\u7684 option \u5c31\u662f plugins\u3001sourceType \u8fd9\u4e24\u4e2a\uff0c\u6bd4\u5982\u8981 parse tsx \u6a21\u5757\uff0c\u90a3\u4e48\u5c31\u53ef\u4ee5\u8fd9\u6837\u6765\u5199"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},'require("@babel/parser").parse("code", {\n  sourceType: "module",\n  plugins: [\n    "jsx",\n    "typescript"\n  ]\n});\n')),(0,l.kt)("h2",{id:"babeltraverse"},"\\@babel/traverse"),(0,l.kt)("p",null,"parse \u51fa\u7684 AST \u7531 ",(0,l.kt)("inlineCode",{parentName:"p"},"@babel/traverse")," \u6765\u904d\u5386\u548c\u4fee\u6539\uff0cbabel traverse \u5305\u63d0\u4f9b\u4e86 traverse \u65b9\u6cd5\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"function traverse(parent, opts)\n")),(0,l.kt)("p",null,"\u5e38\u7528\u7684\u5c31\u524d\u9762\u4e24\u4e2a\u53c2\u6570\uff0cparent \u6307\u5b9a\u8981\u904d\u5386\u7684 AST \u8282\u70b9\uff0copts \u6307\u5b9a visitor \u51fd\u6570\u3002babel \u4f1a\u5728\u904d\u5386 parent \u5bf9\u5e94\u7684 AST \u65f6\u8c03\u7528\u76f8\u5e94\u7684 visitor \u51fd\u6570\u3002"),(0,l.kt)("h4",{id:"\u904d\u5386\u8fc7\u7a0b"},"\u904d\u5386\u8fc7\u7a0b"),(0,l.kt)("p",null,"visitor \u5bf9\u8c61\u7684 value \u662f\u5bf9\u8c61\u6216\u8005\u51fd\u6570\uff1a"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u5982\u679c value \u4e3a\u51fd\u6570\uff0c\u90a3\u4e48\u5c31\u76f8\u5f53\u4e8e\u662f enter \u65f6\u8c03\u7528\u7684\u51fd\u6570\u3002"),(0,l.kt)("li",{parentName:"ul"},"\u5982\u679c value \u4e3a\u5bf9\u8c61\uff0c\u5219\u53ef\u4ee5\u660e\u786e\u6307\u5b9a enter \u6216\u8005 exit \u65f6\u7684\u5904\u7406\u51fd\u6570\u3002")),(0,l.kt)("p",null,"\u51fd\u6570\u4f1a\u63a5\u6536\u4e24\u4e2a\u53c2\u6570 path \u548c state\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"visitor: {\n    Identifier (path, state) {},\n    StringLiteral: {\n        enter (path, state) {},\n        exit (path, state) {}\n    }\n}\n")),(0,l.kt)("p",null,"enter \u65f6\u8c03\u7528\u662f\u5728\u904d\u5386\u5f53\u524d\u8282\u70b9\u7684\u5b50\u8282\u70b9\u524d\u8c03\u7528\uff0cexit \u65f6\u8c03\u7528\u662f\u904d\u5386\u5b8c\u5f53\u524d\u8282\u70b9\u7684\u5b50\u8282\u70b9\u540e\u8c03\u7528\u3002"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5768a7c151914586ab2a5b09b698b4d7~tplv-k3u1fbpfcp-watermark.image",alt:null})),(0,l.kt)("p",null,"\u53ef\u4ee5\u4e3a\u5355\u4e2a\u8282\u70b9\u7684\u7c7b\u578b\uff0c\u4e5f\u53ef\u4ee5\u662f\u591a\u4e2a\u8282\u70b9\u7c7b\u578b\u901a\u8fc7 ",(0,l.kt)("inlineCode",{parentName:"p"},"|")," \u8fde\u63a5\uff0c\u8fd8\u53ef\u4ee5\u901a\u8fc7\u522b\u540d\u6307\u5b9a\u4e00\u7cfb\u5217\u8282\u70b9\u7c7b\u578b\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"// \u8fdb\u5165 FunctionDeclaration \u8282\u70b9\u65f6\u8c03\u7528\ntraverse(ast, {\n  FunctionDeclaration: {\n      enter(path, state) {}\n  }\n})\n\n// \u9ed8\u8ba4\u662f\u8fdb\u5165\u8282\u70b9\u65f6\u8c03\u7528\uff0c\u548c\u4e0a\u9762\u7b49\u4ef7\ntraverse(ast, {\n  FunctionDeclaration(path, state) {}\n})\n\n// \u8fdb\u5165 FunctionDeclaration \u548c VariableDeclaration \u8282\u70b9\u65f6\u8c03\u7528\ntraverse(ast, {\n  'FunctionDeclaration|VariableDeclaration'(path, state) {}\n})\n\n// \u901a\u8fc7\u522b\u540d\u6307\u5b9a\u79bb\u5f00\u5404\u79cd Declaration \u8282\u70b9\u65f6\u8c03\u7528\ntraverse(ast, {\n  Declaration: {\n      exit(path, state) {}\n  }\n})\n")),(0,l.kt)("p",null,"\u5177\u4f53\u7684\u522b\u540d\u6709\u54ea\u4e9b\u5728",(0,l.kt)("a",{parentName:"p",href:"https://github.com/babel/babel/blob/main/packages/babel-types/src/ast-types/generated/index.ts#L2489-L2535"},"babel-types \u7684\u7c7b\u578b\u5b9a\u4e49"),"\u53ef\u4ee5\u67e5\u3002"),(0,l.kt)("h4",{id:"path"},"path"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/538aefbdff92426c98c7f1da1feeb246~tplv-k3u1fbpfcp-watermark.image",alt:null})),(0,l.kt)("p",null,"path \u662f\u904d\u5386\u8fc7\u7a0b\u4e2d\u7684\u8def\u5f84\uff0c\u4f1a\u4fdd\u7559\u4e0a\u4e0b\u6587\u4fe1\u606f\uff0c\u6709\u5f88\u591a\u5c5e\u6027\u548c\u65b9\u6cd5\uff0c\u6bd4\u5982:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"path.node \u6307\u5411\u5f53\u524d AST \u8282\u70b9"),(0,l.kt)("li",{parentName:"ul"},"path.get\u3001path.set \u83b7\u53d6\u548c\u8bbe\u7f6e\u5f53\u524d\u8282\u70b9\u5c5e\u6027\u7684 path"),(0,l.kt)("li",{parentName:"ul"},"path.parent \u6307\u5411\u7236\u7ea7 AST \u8282\u70b9"),(0,l.kt)("li",{parentName:"ul"},"path.getSibling\u3001path.getNextSibling\u3001path.getPrevSibling \u83b7\u53d6\u5144\u5f1f\u8282\u70b9"),(0,l.kt)("li",{parentName:"ul"},"path.find \u4ece\u5f53\u524d\u8282\u70b9\u5411\u4e0a\u67e5\u627e\u8282\u70b9")),(0,l.kt)("p",null,"\u8fd9\u4e9b\u5c5e\u6027\u548c\u65b9\u6cd5\u662f\u83b7\u53d6\u5f53\u524d\u8282\u70b9\u4ee5\u53ca\u5b83\u7684\u5173\u8054\u8282\u70b9\u7684"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"path.scope \u83b7\u53d6\u5f53\u524d\u8282\u70b9\u7684\u4f5c\u7528\u57df\u4fe1\u606f")),(0,l.kt)("p",null,"\u8fd9\u4e2a\u5c5e\u6027\u53ef\u4ee5\u83b7\u53d6\u4f5c\u7528\u57df\u7684\u4fe1\u606f"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"path.isXxx \u5224\u65ad\u5f53\u524d\u8282\u70b9\u662f\u4e0d\u662f xx \u7c7b\u578b"),(0,l.kt)("li",{parentName:"ul"},"path.assertXxx \u5224\u65ad\u5f53\u524d\u8282\u70b9\u662f\u4e0d\u662f xx \u7c7b\u578b\uff0c\u4e0d\u662f\u5219\u629b\u51fa\u5f02\u5e38")),(0,l.kt)("p",null,"isXxx\u3001assertXxx \u7cfb\u5217\u65b9\u6cd5\u53ef\u4ee5\u7528\u4e8e\u5224\u65ad AST \u7c7b\u578b"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"path.insertBefore\u3001path.insertAfter \u63d2\u5165\u8282\u70b9"),(0,l.kt)("li",{parentName:"ul"},"path.replaceWith\u3001path.replaceWithMultiple\u3001replaceWithSourceString \u66ff\u6362\u8282\u70b9"),(0,l.kt)("li",{parentName:"ul"},"path.remove \u5220\u9664\u8282\u70b9")),(0,l.kt)("p",null,"\u8fd9\u4e9b\u65b9\u6cd5\u53ef\u4ee5\u5bf9 AST \u8fdb\u884c\u589e\u5220\u6539"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"path.skip \u8df3\u8fc7\u5f53\u524d\u8282\u70b9\u7684\u5b50\u8282\u70b9\u7684\u904d\u5386"),(0,l.kt)("li",{parentName:"ul"},"path.stop \u7ed3\u675f\u540e\u7eed\u904d\u5386")),(0,l.kt)("p",null,"\u8fd9\u4fe9\u65b9\u6cd5\u53ef\u4ee5\u8df3\u8fc7\u4e00\u4e9b\u904d\u5386"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/96ed2f4589d341de9b407ef7e58e58a0~tplv-k3u1fbpfcp-watermark.image",alt:null})),(0,l.kt)("p",null,"\u4e0a\u9762\u7f57\u5217\u4e86\u51e0\u4e2a\u5e38\u7528\u7684 api\uff0c\u53ef\u4ee5\u901a\u8fc7\u8fd9\u4e9b api \u5b8c\u6210\u5bf9 AST \u7684\u64cd\u4f5c\u3002\u5f53\u7136\uff0cpath \u7684 api \u4e0d\u662f\u53ea\u6709\u8fd9\u4e9b\uff0c\u540e\u9762\u5b9e\u6218\u6848\u4f8b\u7528\u5230\u4e86\u518d\u4ecb\u7ecd\u3002"),(0,l.kt)("h4",{id:"state"},"state"),(0,l.kt)("p",null,"\u7b2c\u4e8c\u4e2a\u53c2\u6570 state \u5219\u662f\u904d\u5386\u8fc7\u7a0b\u4e2d\u5728\u4e0d\u540c\u8282\u70b9\u4e4b\u95f4\u4f20\u9012\u6570\u636e\u7684\u673a\u5236\uff0c\u63d2\u4ef6\u4f1a\u901a\u8fc7 state \u4f20\u9012 options \u548c file \u4fe1\u606f\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u901a\u8fc7 state \u5b58\u50a8\u4e00\u4e9b\u904d\u5386\u8fc7\u7a0b\u4e2d\u7684\u5171\u4eab\u6570\u636e\u3002"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ee26748e8dd54dcca660e593271411be~tplv-k3u1fbpfcp-watermark.image",alt:null})),(0,l.kt)("h2",{id:"babeltypes"},"\\@babel/types"),(0,l.kt)("p",null,"\u904d\u5386 AST \u7684\u8fc7\u7a0b\u4e2d\u9700\u8981\u521b\u5efa\u4e00\u4e9b AST \u548c\u5224\u65ad AST \u7684\u7c7b\u578b\uff0c\u8fd9\u65f6\u5019\u5c31\u9700\u8981 ",(0,l.kt)("inlineCode",{parentName:"p"},"@babel/types")," \u5305\u3002"),(0,l.kt)("p",null,"\u4e3e\u4f8b\u6765\u8bf4\uff0c\u5982\u679c\u8981\u521b\u5efaIfStatement\u5c31\u53ef\u4ee5\u8c03\u7528"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"t.ifStatement(test, consequent, alternate);\n")),(0,l.kt)("p",null,"\u800c\u5224\u65ad\u8282\u70b9\u662f\u5426\u662f IfStatement \u5c31\u53ef\u4ee5\u8c03\u7528 isIfStatement \u6216\u8005 assertIfStatement"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"t.isIfStatement(node, opts);\nt.assertIfStatement(node, opts);\n")),(0,l.kt)("p",null,"opts \u53ef\u4ee5\u6307\u5b9a\u4e00\u4e9b\u5c5e\u6027\u662f\u4ec0\u4e48\u503c\uff0c\u589e\u52a0\u66f4\u591a\u9650\u5236\u6761\u4ef6\uff0c\u505a\u66f4\u7cbe\u786e\u7684\u5224\u65ad\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},'t.isIdentifier(node, { name: "paths" })\n')),(0,l.kt)("p",null,"isXxx \u4f1a\u8fd4\u56de boolean \u8868\u793a\u7ed3\u679c\uff0c\u800c assertXxx \u5219\u4f1a\u5728\u7c7b\u578b\u4e0d\u4e00\u81f4\u65f6\u629b\u5f02\u5e38\u3002"),(0,l.kt)("p",null,"\u6240\u6709\u7684 AST \u7684 build\u3001assert \u7684 api \u53ef\u4ee5\u5728 ",(0,l.kt)("a",{parentName:"p",href:"https://babeljs.io/docs/en/babel-types#api"},"babel types \u6587\u6863"),"\u4e2d\u67e5\u3002"),(0,l.kt)("h2",{id:"babeltemplate"},"\\@babel/template"),(0,l.kt)("p",null,"\u901a\u8fc7 \\@babel/types \u521b\u5efa AST \u8fd8\u662f\u6bd4\u8f83\u9ebb\u70e6\u7684\uff0c\u8981\u4e00\u4e2a\u4e2a\u7684\u521b\u5efa\u7136\u540e\u7ec4\u88c5\uff0c\u5982\u679c AST \u8282\u70b9\u6bd4\u8f83\u591a\u7684\u8bdd\u9700\u8981\u5199\u5f88\u591a\u4ee3\u7801\uff0c\u8fd9\u65f6\u5019\u5c31\u53ef\u4ee5\u4f7f\u7528 ",(0,l.kt)("inlineCode",{parentName:"p"},"@babel/template")," \u5305\u6765\u6279\u91cf\u521b\u5efa\u3002"),(0,l.kt)("p",null,"\u8fd9\u4e2a\u5305\u6709\u8fd9\u4e9b api\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"const ast = template(code, [opts])(args);\nconst ast = template.ast(code, [opts]);\nconst ast = template.program(code, [opts]);\n")),(0,l.kt)("p",null,"\u5982\u679c\u662f\u6839\u636e\u6a21\u7248\u76f4\u63a5\u521b\u5efa AST\uff0c\u90a3\u4e48\u7528 template.ast \u6216\u8005 template.program \u65b9\u6cd5\uff0c\u8fd9\u4fe9\u90fd\u662f\u76f4\u63a5\u8fd4\u56de ast \u7684\uff0c\u4f46\u662f template.program \u8fd4\u56de\u7684 AST \u7684\u6839\u8282\u70b9\u662f Program\u3002"),(0,l.kt)("p",null,"\u5982\u679c\u77e5\u9053\u5177\u4f53\u521b\u5efa\u7684 AST \u7684\u7c7b\u578b\uff0c\u53ef\u4ee5\u4f7f\u7528 template.expression\u3001template.statement\u3001template.statements \u7b49\u65b9\u6cd5\uff0c\u5f53\u660e\u786e\u521b\u5efa\u7684AST\u7684\u7c7b\u578b\u65f6\u53ef\u4ee5\u4f7f\u7528\u3002"),(0,l.kt)("p",null,"\u9ed8\u8ba4 template.ast \u521b\u5efa\u7684 Expression \u4f1a\u88ab\u5305\u88f9\u4e00\u5c42 ExpressionStatement \u8282\u70b9\uff08\u4f1a\u88ab\u5f53\u6210\u8868\u8fbe\u5f0f\u8bed\u53e5\u6765 parse\uff09\uff0c\u4f46\u5f53 template.expression \u65b9\u6cd5\u521b\u5efa\u7684 AST \u5c31\u4e0d\u4f1a\u3002"),(0,l.kt)("p",null,"\u5982\u679c\u6a21\u7248\u4e2d\u6709\u5360\u4f4d\u7b26\uff0c\u90a3\u4e48\u5c31\u7528 template \u7684 api\uff0c\u5728\u6a21\u7248\u4e2d\u5199\u4e00\u4e9b\u5360\u4f4d\u7684\u53c2\u6570\uff0c\u8c03\u7528\u65f6\u4f20\u5165\u8fd9\u4e9b\u5360\u4f4d\u7b26\u53c2\u6570\u5bf9\u5e94\u7684 AST \u8282\u70b9\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},'const fn = template(`console.log(NAME)`);\n\nconst ast = fn({\n  NAME: t.stringLiteral("guang"),\n});\n')),(0,l.kt)("p",null,"\u6216\u8005"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},'const fn = template(`console.log(%%NAME%%)`);\n\nconst ast = fn({\n  NAME: t.stringLiteral("guang"),\n});\n')),(0,l.kt)("p",null,"\u8fd9\u4e24\u79cd\u5360\u4f4d\u7b26\u7684\u5199\u6cd5\u90fd\u53ef\u4ee5\uff0c\u5f53\u5360\u4f4d\u7b26\u548c\u5176\u4ed6\u53d8\u91cf\u540d\u51b2\u7a81\u65f6\u53ef\u4ee5\u7528\u7b2c\u4e8c\u79cd\u3002"),(0,l.kt)("h2",{id:"babelgenerator"},"\\@babel/generator"),(0,l.kt)("p",null,"AST \u8f6c\u6362\u5b8c\u4e4b\u540e\u5c31\u8981\u6253\u5370\u6210\u76ee\u6807\u4ee3\u7801\u5b57\u7b26\u4e32\uff0c\u901a\u8fc7 ",(0,l.kt)("inlineCode",{parentName:"p"},"@babel/generator")," \u5305\u7684 generate api"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"function (ast: Object, opts: Object, code: string): {code, map} \n")),(0,l.kt)("p",null,"\u7b2c\u4e00\u4e2a\u53c2\u6570\u662f\u8981\u6253\u5370\u7684 AST"),(0,l.kt)("p",null,"\u7b2c\u4e8c\u4e2a\u53c2\u6570\u662f options\uff0c\u6307\u5b9a\u6253\u5370\u7684\u4e00\u4e9b\u7ec6\u8282\uff0c\u6bd4\u5982\u901a\u8fc7 comments \u6307\u5b9a\u662f\u5426\u5305\u542b\u6ce8\u91ca\uff0c\u901a\u8fc7 minified \u6307\u5b9a\u662f\u5426\u5305\u542b\u7a7a\u767d\u5b57\u7b26"),(0,l.kt)("p",null,"\u7b2c\u4e09\u4e2a\u53c2\u6570\u5f53",(0,l.kt)("a",{parentName:"p",href:"null"},"\u591a\u4e2a\u6587\u4ef6\u5408\u5e76\u6253\u5370"),"\u7684\u65f6\u5019\u9700\u8981\u7528\u5230"),(0,l.kt)("p",null,"options \u4e2d\u5e38\u7528\u7684\u662f sourceMaps\uff0c\u5f00\u542f\u4e86\u8fd9\u4e2a\u9009\u9879\u624d\u4f1a\u751f\u6210 sourcemap"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"const { code, map } = generate(ast, { sourceMaps: true })\n")),(0,l.kt)("h2",{id:"babelcode-frame"},"\\@babel/code-frame"),(0,l.kt)("p",null,"\u5f53\u6709\u9519\u8bef\u4fe1\u606f\u8981\u6253\u5370\u7684\u65f6\u5019\uff0c\u9700\u8981\u6253\u5370\u9519\u8bef\u4f4d\u7f6e\u7684\u4ee3\u7801\uff0c\u53ef\u4ee5\u4f7f\u7528",(0,l.kt)("inlineCode",{parentName:"p"},"@babel/code-frame"),"\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"const result = codeFrameColumns(rawLines, location, {\n  /* options */\n});\n")),(0,l.kt)("p",null,"options \u53ef\u4ee5\u8bbe\u7f6e highlighted \uff08\u662f\u5426\u9ad8\u4eae\uff09\u3001message\uff08\u5c55\u793a\u5565\u9519\u8bef\u4fe1\u606f\uff09\u3002"),(0,l.kt)("p",null,"\u6bd4\u5982"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},'const { codeFrameColumns } = require("@babel/code-frame");\n\ntry {\n throw new Error("xxx \u9519\u8bef");\n} catch (err) {\n  console.error(codeFrameColumns(`const name = guang`, {\n      start: { line: 1, column: 14 }\n  }, {\n    highlightCode: true,\n    message: err.message\n  }));\n}\n')),(0,l.kt)("p",null,"\u4f1a\u6709\u6bd4\u8f83\u53cb\u597d\u7684\u6253\u5370\u4fe1\u606f"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e31ce65fd2f644439f2848b0e0e94c1b~tplv-k3u1fbpfcp-watermark.image",alt:"image.png"})),(0,l.kt)("h2",{id:"babelcore"},"\\@babel/core"),(0,l.kt)("p",null,"\u524d\u9762\u7684\u5305\u662f\u5b8c\u6210\u67d0\u4e00\u90e8\u5206\u7684\u529f\u80fd\u7684\uff0c\u800c ",(0,l.kt)("inlineCode",{parentName:"p"},"@babel/core")," \u5305\u5219\u662f\u57fa\u4e8e\u5b83\u4eec\u5b8c\u6210\u6574\u4e2a\u7f16\u8bd1\u6d41\u7a0b\uff0c\u4ece\u6e90\u7801\u5230\u76ee\u6807\u4ee3\u7801\uff0c\u751f\u6210 sourcemap\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"transformSync(code, options); // => { code, map, ast }\ntransformFileSync(filename, options); // => { code, map, ast }\ntransformFromAstSync(\n  parsedAst,\n  sourceCode,\n  options\n); // => { code, map, ast }\n")),(0,l.kt)("p",null,"\u524d\u4e09\u4e2a transformXxx \u7684 api \u5206\u522b\u662f\u4ece\u6e90\u4ee3\u7801\u3001\u6e90\u4ee3\u7801\u6587\u4ef6\u3001\u6e90\u4ee3\u7801 AST \u8fd9\u5f00\u59cb\u5904\u7406\uff0c\u6700\u7ec8\u751f\u6210\u76ee\u6807\u4ee3\u7801\u548c sourcemap\u3002"),(0,l.kt)("p",null,"options \u4e3b\u8981\u914d\u7f6e plugins \u548c presets\uff0c\u6307\u5b9a\u5177\u4f53\u8981\u505a\u4ec0\u4e48\u8f6c\u6362\u3002"),(0,l.kt)("p",null,"\u8fd9\u4e9b api \u4e5f\u540c\u6837\u63d0\u4f9b\u4e86\u5f02\u6b65\u7684\u7248\u672c\uff0c\u5f02\u6b65\u5730\u8fdb\u884c\u7f16\u8bd1\uff0c\u8fd4\u56de\u4e00\u4e2a promise"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},'transformAsync("code();", options).then(result => {})\ntransformFileAsync("filename.js", options).then(result => {})\ntransformFromAstAsync(parsedAst, sourceCode, options).then(result => {})\n')),(0,l.kt)("p",null,"\u6ce8\u610f\uff1atransformXxx \u7684 api\uff0c\u5df2\u7ecf\u88ab\u6807\u8bb0\u4e3a\u8fc7\u65f6\u4e86\uff0c\u540e\u7eed\u4f1a\u5220\u6389\uff0c\u4e0d\u5efa\u8bae\u7528\uff0c\u76f4\u63a5\u7528 transformXxxSync \u548c transformXxxAsync\u3002"),(0,l.kt)("p",null,"\\@babel/core \u5305\u8fd8\u6709\u4e00\u4e2a createConfigItem \u7684 api\uff0c\u7528\u4e8e plugin \u548c preset \u7684\u5c01\u88c5\uff0c\u540e\u9762\u7ae0\u8282\u4f1a\u6d89\u53ca\u5230\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"createConfigItem(value, options) // configItem\n")),(0,l.kt)("h2",{id:"\u603b\u7ed3"},"\u603b\u7ed3"),(0,l.kt)("p",null,"\u8fd9\u4e00\u8282\u6211\u4eec\u4e86\u89e3\u4e86\u7f16\u8bd1\u8fc7\u7a0b\u4e2d\u5404\u9636\u6bb5\u7684 api\uff1a"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"@babel/parser")," \u5bf9\u6e90\u7801\u8fdb\u884c parse\uff0c\u53ef\u4ee5\u901a\u8fc7 plugins\u3001sourceType \u7b49\u6765\u6307\u5b9a parse \u8bed\u6cd5"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"@babel/traverse")," \u901a\u8fc7 visitor \u51fd\u6570\u5bf9\u904d\u5386\u5230\u7684 ast \u8fdb\u884c\u5904\u7406\uff0c\u5206\u4e3a enter \u548c exit \u4e24\u4e2a\u9636\u6bb5\uff0c\u5177\u4f53\u64cd\u4f5c AST \u4f7f\u7528 path \u7684 api\uff0c\u8fd8\u53ef\u4ee5\u901a\u8fc7 state \u6765\u5728\u904d\u5386\u8fc7\u7a0b\u4e2d\u4f20\u9012\u4e00\u4e9b\u6570\u636e"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"@babel/types")," \u7528\u4e8e\u521b\u5efa\u3001\u5224\u65ad AST \u8282\u70b9\uff0c\u63d0\u4f9b\u4e86 xxx\u3001isXxx\u3001assertXxx \u7684 api"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"@babel/template")," \u7528\u4e8e\u6279\u91cf\u521b\u5efa\u8282\u70b9"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"@babel/code-frame")," \u53ef\u4ee5\u521b\u5efa\u53cb\u597d\u7684\u62a5\u9519\u4fe1\u606f"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"@babel/generator")," \u6253\u5370 AST \u6210\u76ee\u6807\u4ee3\u7801\u5b57\u7b26\u4e32\uff0c\u652f\u6301 comments\u3001minified\u3001sourceMaps \u7b49\u9009\u9879\u3002"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"@babel/core")," \u57fa\u4e8e\u4e0a\u9762\u7684\u5305\u6765\u5b8c\u6210 babel \u7684\u7f16\u8bd1\u6d41\u7a0b\uff0c\u53ef\u4ee5\u4ece\u6e90\u7801\u5b57\u7b26\u4e32\u3001\u6e90\u7801\u6587\u4ef6\u3001AST \u5f00\u59cb\u3002")),(0,l.kt)("p",null,"\u5b66\u5b8c\u8fd9\u4e00\u8282\uff0c\u6211\u4eec\u53ef\u4ee5\u7528 babel \u7684 api \u6765\u5b9e\u73b0\u4e00\u4e9b\u529f\u80fd\u4e86\uff0c\u4e0b\u4e00\u8282\u5f00\u59cb\u7b2c\u4e00\u4e2a\u5b9e\u6218\u6848\u4f8b\u3002"))}m.isMDXComponent=!0}}]);