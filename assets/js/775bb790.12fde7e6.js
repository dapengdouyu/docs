"use strict";(self.webpackChunkdapengdouyu=self.webpackChunkdapengdouyu||[]).push([[9621],{3905:function(e,n,t){t.d(n,{Zo:function(){return p},kt:function(){return d}});var r=t(67294);function l(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function a(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function o(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?a(Object(t),!0).forEach((function(n){l(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):a(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function i(e,n){if(null==e)return{};var t,r,l=function(e,n){if(null==e)return{};var t,r,l={},a=Object.keys(e);for(r=0;r<a.length;r++)t=a[r],n.indexOf(t)>=0||(l[t]=e[t]);return l}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)t=a[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(l[t]=e[t])}return l}var s=r.createContext({}),c=function(e){var n=r.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):o(o({},n),e)),t},p=function(e){var n=c(e.components);return r.createElement(s.Provider,{value:n},e.children)},u={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},m=r.forwardRef((function(e,n){var t=e.components,l=e.mdxType,a=e.originalType,s=e.parentName,p=i(e,["components","mdxType","originalType","parentName"]),m=c(t),d=l,h=m["".concat(s,".").concat(d)]||m[d]||u[d]||a;return t?r.createElement(h,o(o({ref:n},p),{},{components:t})):r.createElement(h,o({ref:n},p))}));function d(e,n){var t=arguments,l=n&&n.mdxType;if("string"==typeof e||l){var a=t.length,o=new Array(a);o[0]=m;var i={};for(var s in n)hasOwnProperty.call(n,s)&&(i[s]=n[s]);i.originalType=e,i.mdxType="string"==typeof e?e:l,o[1]=i;for(var c=2;c<a;c++)o[c]=t[c];return r.createElement.apply(null,o)}return r.createElement.apply(null,t)}m.displayName="MDXCreateElement"},7041:function(e,n,t){t.r(n),t.d(n,{frontMatter:function(){return i},contentTitle:function(){return s},metadata:function(){return c},toc:function(){return p},default:function(){return m}});var r=t(83117),l=t(80102),a=(t(67294),t(3905)),o=["components"],i={},s=void 0,c={unversionedId:"program/es6/es6-5-promise",id:"program/es6/es6-5-promise",title:"es6-5-promise",description:"\u4e94.ES6 \u4e2d\u7684 Pomise",source:"@site/docs/program/es6/es6-5-promise.md",sourceDirName:"program/es6",slug:"/program/es6/es6-5-promise",permalink:"/docs/program/es6/es6-5-promise",editUrl:"https://github.com/dapengdouyu/docs/tree/master/docs/program/es6/es6-5-promise.md",tags:[],version:"current",lastUpdatedAt:1639985762,formattedLastUpdatedAt:"12/20/2021",frontMatter:{},sidebar:"program",previous:{title:"es6-4-proxy",permalink:"/docs/program/es6/es6-4-proxy"},next:{title:"\u6df1\u5165\u6d45\u51fa Commonjs \u548c Es Module",permalink:"/docs/program/es6/es6-module"}},p=[{value:"\u4e94.ES6 \u4e2d\u7684 Pomise",id:"\u4e94es6-\u4e2d\u7684-pomise",children:[],level:2},{value:"\u638c\u63e1\u77e5\u8bc6",id:"\u638c\u63e1\u77e5\u8bc6",children:[],level:2},{value:"\u5173\u4e8e\u51fd\u6570",id:"\u5173\u4e8e\u51fd\u6570",children:[{value:"before \u51fd\u6570",id:"before-\u51fd\u6570",children:[],level:3},{value:"react \u4e8b\u52a1",id:"react-\u4e8b\u52a1",children:[],level:3},{value:"\u7c7b\u578b\u68c0\u6d4b",id:"\u7c7b\u578b\u68c0\u6d4b",children:[],level:3},{value:"\u67ef\u91cc\u5316\u51fd\u6570",id:"\u67ef\u91cc\u5316\u51fd\u6570",children:[],level:3},{value:"after",id:"after",children:[],level:3},{value:"\u53d1\u5e03\u8ba2\u9605\u6a21\u5f0f",id:"\u53d1\u5e03\u8ba2\u9605\u6a21\u5f0f",children:[],level:3},{value:"\u89c2\u5bdf\u8005\u6a21\u5f0f",id:"\u89c2\u5bdf\u8005\u6a21\u5f0f",children:[],level:3},{value:"Promise \u7684\u4f18\u70b9",id:"promise-\u7684\u4f18\u70b9",children:[],level:3},{value:"Promise \u7684\u7279\u70b9",id:"promise-\u7684\u7279\u70b9",children:[],level:3},{value:"Promise \u7684\u5b9e\u73b0",id:"promise-\u7684\u5b9e\u73b0",children:[{value:"promise \u53ea<code>\u517c\u5bb9</code>\u540c\u6b65\u4ee3\u7801",id:"promise-\u53ea\u517c\u5bb9\u540c\u6b65\u4ee3\u7801",children:[],level:4}],level:3},{value:"Promise<code>\u517c\u5bb9</code>\u5f02\u6b65\u4ee3\u7801",id:"promise\u517c\u5bb9\u5f02\u6b65\u4ee3\u7801",children:[],level:3},{value:"then \u7684\u94fe\u5f0f\u8c03\u7528",id:"then-\u7684\u94fe\u5f0f\u8c03\u7528",children:[],level:3},{value:"\u6d4b\u8bd5\u5199\u7684 Promise \u662f\u5426\u7b26\u5408\u89c4\u8303",id:"\u6d4b\u8bd5\u5199\u7684-promise-\u662f\u5426\u7b26\u5408\u89c4\u8303",children:[],level:3},{value:"catch \u5b9e\u73b0",id:"catch-\u5b9e\u73b0",children:[],level:3},{value:"resolve \u7684\u5b9e\u73b0",id:"resolve-\u7684\u5b9e\u73b0",children:[],level:3},{value:"reject \u7684\u5b9e\u73b0",id:"reject-\u7684\u5b9e\u73b0",children:[],level:3},{value:"finally \u65b9\u6cd5",id:"finally-\u65b9\u6cd5",children:[],level:3},{value:"all",id:"all",children:[],level:3},{value:"reject",id:"reject",children:[],level:3},{value:"\u4e2d\u65ad promise \u94fe \u5c31\u662f\u8fd4\u56de\u4e00\u4e2a\u7b49\u5f85\u7684 promise",id:"\u4e2d\u65ad-promise-\u94fe-\u5c31\u662f\u8fd4\u56de\u4e00\u4e2a\u7b49\u5f85\u7684-promise",children:[],level:3},{value:"\u5982\u4f55\u653e\u5f03\u67d0\u4e2a promise \u7684\u6267\u884c\u7ed3\u679c",id:"\u5982\u4f55\u653e\u5f03\u67d0\u4e2a-promise-\u7684\u6267\u884c\u7ed3\u679c",children:[],level:3},{value:"\u65e2\u80fd\u6355\u83b7\u540c\u6b65\u6709\u80fd\u6355\u83b7\u5f02\u6b65",id:"\u65e2\u80fd\u6355\u83b7\u540c\u6b65\u6709\u80fd\u6355\u83b7\u5f02\u6b65",children:[],level:3}],level:2},{value:"generator",id:"generator",children:[{value:"\u5c06\u7c7b\u6570\u7ec4\u8f6c\u5316\u6210\u6570\u7ec4",id:"\u5c06\u7c7b\u6570\u7ec4\u8f6c\u5316\u6210\u6570\u7ec4",children:[],level:4},{value:"generator \u95ee\u9898",id:"generator-\u95ee\u9898",children:[],level:3},{value:"co \u7684\u5b9e\u73b0",id:"co-\u7684\u5b9e\u73b0",children:[],level:3},{value:"async+await",id:"asyncawait",children:[],level:3},{value:"\u8fd4\u56de Promise \u5bf9\u8c61",id:"\u8fd4\u56de-promise-\u5bf9\u8c61",children:[],level:3}],level:2},{value:"promise \u9762\u8bd5\u9898\u76ee",id:"promise-\u9762\u8bd5\u9898\u76ee",children:[{value:"\u9898\u76ee 1",id:"\u9898\u76ee-1",children:[],level:3},{value:"\u9898\u76ee 2",id:"\u9898\u76ee-2",children:[],level:3},{value:"Promise \u7684\u4f18\u7f3a\u70b9",id:"promise-\u7684\u4f18\u7f3a\u70b9",children:[],level:3}],level:2}],u={toc:p};function m(e){var n=e.components,i=(0,l.Z)(e,o);return(0,a.kt)("wrapper",(0,r.Z)({},u,i,{components:n,mdxType:"MDXLayout"}),(0,a.kt)("h2",{id:"\u4e94es6-\u4e2d\u7684-pomise"},"\u4e94.ES6 \u4e2d\u7684 Pomise"),(0,a.kt)("p",null,"\u5b9e\u73b0",(0,a.kt)("strong",{parentName:"p"},"promise"),":"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://promisesaplus.com"},"PromiseA+\u82f1\u6587")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://www.ituring.com.cn/article/66566"},"promiseA+\u4e2d\u6587\u53c2\u8003"))),(0,a.kt)("h2",{id:"\u638c\u63e1\u77e5\u8bc6"},"\u638c\u63e1\u77e5\u8bc6"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"\u638c\u63e1\u9ad8\u9636\u51fd\u6570\u7684\u4f7f\u7528,\u4f7f\u7528\u9ad8\u9636\u51fd\u6570\u89e3\u51b3\u5f02\u6b65\u95ee\u9898"),(0,a.kt)("li",{parentName:"ul"},"\u638c\u63e1\u53d1\u5e03\u8ba2\u9605\u6a21\u5f0f\u548c\u89c2\u5bdf\u8005\u6a21\u5f0f"),(0,a.kt)("li",{parentName:"ul"},"\u638c\u63e1 promise \u6838\u5fc3\u5e94\u7528,\u4f7f\u7528 promise \u89e3\u51b3\u5f02\u6b65\u7f16\u7a0b\u95ee\u9898"),(0,a.kt)("li",{parentName:"ul"},"\u5b9e\u73b0\u4e00\u4e2a\u5b8c\u6574\u7684 promise \u5e93"),(0,a.kt)("li",{parentName:"ul"},"\u6269\u5c55 promise \u4e2d\u5e38\u89c1\u65b9\u6cd5,all,race,finally..."),(0,a.kt)("li",{parentName:"ul"},"\u638c\u63e1 generator \u7684\u4f7f\u7528\u4ee5\u53ca co \u5e93\u7684\u5e94\u7528"),(0,a.kt)("li",{parentName:"ul"},"\u5f02\u6b65\u7ec8\u6781\u89e3\u51b3\u65b9\u6848 async+await")),(0,a.kt)("h2",{id:"\u5173\u4e8e\u51fd\u6570"},"\u5173\u4e8e\u51fd\u6570"),(0,a.kt)("p",null,"\u4ec0\u4e48\u662f\u9ad8\u9636\u51fd\u6570\uff1a\u628a\u51fd\u6570\u4f5c\u4e3a",(0,a.kt)("inlineCode",{parentName:"p"},"\u53c2\u6570"),"\u6216\u8005",(0,a.kt)("inlineCode",{parentName:"p"},"\u8fd4\u56de\u503c"),"\u7684\u4e00\u7c7b\u51fd\u6570"),(0,a.kt)("h3",{id:"before-\u51fd\u6570"},"before \u51fd\u6570"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},'//  \u51fd\u6570\u7684before\n// \u5e0c\u671b\u5c06\u6838\u5fc3\u7684\u903b\u8f91\u63d0\u53d6\u51fa\u6765\uff0c\u5728\u5916\u9762\u589e\u52a0\u529f\u80fd\n\n// \u91cd\u5199\u539f\u578b\u4e0a\u7684\u65b9\u6cd5\nconst say = () => {\n  console.log("\u8bf4\u8bdd");\n};\n\n// js\u7684\u6838\u5fc3 \u662f\u56de\u8c03\nFunction.prototype.before = function(fn) {\n  return (...args) => {\n    //\u5269\u4f59\u8fd0\u7b97\u7b26\n    //\u7bad\u5934\u51fd\u6570\u4e2d\u6ca1\u6709this\u6307\u5411\uff0c\u4e5f\u6ca1\u6709arguments,\u6240\u4ee5\u4f1a\u5411\u4e0a\u7ea7\u4f5c\u7528\u57df\u4e2d\u67e5\u627e\n    fn();\n    this(...args); //\u5c55\u5f00\u8fd0\u7b97\u7b26\n  };\n};\n//AOP \u5207\u7247 \u88c5\u9970  \u628a\u6838\u5fc3\u62bd\u79bb\u51fa\u6765\uff0c\u5728\u6838\u5fc3\u7684\u57fa\u7840\u4e0a\u589e\u52a0\u529f\u80fd\nlet newSay = say.before(() => {\n  console.log("\u4f60\u597d");\n});\nlet newSay1 = say.before(() => {\n  console.log("\u5929\u6c14\u5f88\u597d");\n});\nnewSay();\nnewSay1();\n')),(0,a.kt)("h3",{id:"react-\u4e8b\u52a1"},"react \u4e8b\u52a1"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},'// \u4e8b\u52a1 \u5f00\u59cb\u7684\u65f6\u5019 \u505a\u67d0\u4ef6\u4e8b \u7ed3\u675f\u7684\u65f6\u5019\u5728\u505a\u67d0\u4ef6\u4e8b\nperform(() => {\n  console.log("\u8bf4\u8bdd");\n}, [\n  {\n    //wrapper\n    initlizae() {\n      console.log("\u4f60\u597d");\n    },\n    close() {\n      console.log("\u518d\u89c1");\n    },\n  },\n  {\n    //wrapper\n    initlizae() {\n      console.log("\u4f60\u597d2");\n    },\n    close() {\n      console.log("\u518d\u89c12");\n    },\n  },\n]);\n')),(0,a.kt)("p",null,"\u5b9e\u73b0"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"function perform(fn, wrappers) {\n  wrappers.forEach((wrapper) => {\n    wrapper.initialize();\n  });\n  fn();\n  wrappers.forEach((wrapper) => {\n    wrapper.close();\n  });\n}\n")),(0,a.kt)("p",null,"AOP(\u9762\u5411\u5207\u9762\u7f16\u7a0b)\u7684\u4e3b\u8981\u4f5c\u7528\u662f\u628a\u4e00\u4e9b\u8ddf\u6838\u5fc3\u4e1a\u52a1\u903b\u8f91\u6a21\u5757\u65e0\u5173\u7684\u529f\u80fd\u62bd\u79bb\u51fa\u6765\uff0c\u5176\u5b9e\u5c31\u662f\u7ed9\u539f\u51fd\u6570\u589e\u52a0\u4e00\u8f66\uff0c\u4e0d\u7528\u7ba1\u539f\u51fd\u6570\u5185\u90e8\u5b9e\u73b0"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"/**\n * <pre>\n *                       wrappers (injected at creation time)\n *                                      +        +\n *                                      |        |\n *                    +-----------------|--------|--------------+\n *                    |                 v        |              |\n *                    |      +---------------+   |              |\n *                    |   +--|    wrapper1   |---|----+         |\n *                    |   |  +---------------+   v    |         |\n *                    |   |          +-------------+  |         |\n *                    |   |     +----|   wrapper2  |--------+   |\n *                    |   |     |    +-------------+  |     |   |\n *                    |   |     |                     |     |   |\n *                    |   v     v                     v     v   | wrapper\n *                    | +---+ +---+   +---------+   +---+ +---+ | invariants\n * perform(anyMethod) | |   | |   |   |         |   |   | |   | | maintained\n * +-----------------\x3e|-|---|-|---|--\x3e|anyMethod|---|---|-|---|-|--------\x3e\n *                    | |   | |   |   |         |   |   | |   | |\n *                    | |   | |   |   |         |   |   | |   | |\n *                    | |   | |   |   |         |   |   | |   | |\n *                    | +---+ +---+   +---------+   +---+ +---+ |\n *                    |  initialize                    close    |\n *                    +-----------------------------------------+\n * </pre>\n */\n")),(0,a.kt)("h3",{id:"\u7c7b\u578b\u68c0\u6d4b"},"\u7c7b\u578b\u68c0\u6d4b"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},'const checkType = (content, type) => {\n  return Object.prototype.toString.call(content) === `[object ${type}]`;\n};\nconst flag = checkType("hello", "String");\n//---------------------------------------\nconst checkType = (type) => {\n  return (content) =>\n    Object.prototype.toString.call(content) === `[object ${type}]`;\n};\nconst b = checkType(123, "Number");\nconst types = ["Number", "String", "Boolean"];\nlet utils = {};\ntypes.forEach((type) => {\n  utils["is" + type] = curring(checkType)(type); //\u5148\u4f20\u5165\u4e00\u4e2a\u53c2\u6570\n});\nconsole.log(utils.isString("hello"));\n')),(0,a.kt)("p",null,"\u51fd\u6570\u5206\u6b65\u4f20\u9012\u53c2\u6570\uff0c\u5c06\u51fd\u6570\u62c6\u5206\u6210\u529f\u80fd\u66f4\u52a0\u5177\u4f53\u5316\u7684\u51fd\u6570"),(0,a.kt)("h3",{id:"\u67ef\u91cc\u5316\u51fd\u6570"},"\u67ef\u91cc\u5316\u51fd\u6570"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},'const curring = (fn, arr = []) => {\n  let len = fn.length; //\u53c2\u6570\u7684\u957f\u5ea6\n  return (...args) => {\n    arr = arr.concat(args);\n    if (arr.length < len) {\n      return curring(fn, arr);\n    }\n    return fn(...arr);\n  };\n};\nlet r = curring(add)(1, 2)(3, 4)(5); //[]\nconsole.log(r);\nconst types = ["Number", "String", "Boolean"];\nlet utils = {};\ntypes.forEach((type) => {\n  utils["is" + type] = curring(checkType)(type); //\u5148\u4f20\u5165\u4e00\u4e2a\u53c2\u6570\n});\nconsole.log(utils.isString("hello"));\n')),(0,a.kt)("p",null,"\u67ef\u91cc\u5316 \u6211\u4eec\u53ef\u4ee5\u628a\u4e00\u4e2a\u5927\u51fd\u6570\u62c6\u5206\u6210\u5177\u4f53\u7684\u529f\u80fd \u5c06\u4e00\u4e2a\u51fd\u6570\u62c6\u5206\u6210\u591a\u4e2a\u51fd\u6570"),(0,a.kt)("h3",{id:"after"},"after"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},'// after\u53ef\u4ee5\u751f\u6210\u65b0\u7684\u51fd\u6570 \u7b49\u5f85\u51fd\u6570\u6267\u884c\u6b21\u6570\u8fbe\u5230\u6211\u7684\u9884\u671f\u65f6\u6267\u884c\nconst after = (times, fn) => {\n  return () => {\n    if (--times === 0) {\n      fn();\n    }\n  };\n};\nlet newAfter = after(3, () => {\n  console.log("\u4e09\u6b21\u4e4b\u540e\u8c03\u7528");\n});\nnewAfter();\nnewAfter();\nnewAfter();\n')),(0,a.kt)("h3",{id:"\u53d1\u5e03\u8ba2\u9605\u6a21\u5f0f"},"\u53d1\u5e03\u8ba2\u9605\u6a21\u5f0f"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"\u628a\u8ba2\u9605\u7684\u4e8b\u4ef6\u5b58\u50a8\u5230\u6570\u7ec4\u4e2d\u53ef\u4ee5\u8ba2\u9605\u591a\u4e2a\u4e8b\u4ef6,\u53ea\u8981\u53d1\u5e03\u8005\u89e6\u53d1\u4e8b\u4ef6,\u6267\u884c\u51fd\u6570,\u8ba2\u9605\u8005\u5c31\u4f1a\u63a5\u6536\u5230"),(0,a.kt)("li",{parentName:"ul"},"\u53d1\u5e03\u548c\u8ba2\u9605\u76f4\u63a5\u662f\u6ca1\u6709",(0,a.kt)("inlineCode",{parentName:"li"},"\u5173\u7cfb"),"\u7684,\u8ba2\u9605\u5c06\u8981\u8ba2\u9605\u7684\u4e8b\u4ef6\u5b58\u50a8\u5728\u4e00\u4e2a\u7a7a\u95f4\u4e2d(",(0,a.kt)("inlineCode",{parentName:"li"},"\u6570\u7ec4"),"),\u53d1\u5e03\u8005\u5728\u5b58\u50a8\u7a7a\u95f4\u4e2d\u53d1\u5e03\u4e8b\u4ef6")),(0,a.kt)("h3",{id:"\u89c2\u5bdf\u8005\u6a21\u5f0f"},"\u89c2\u5bdf\u8005\u6a21\u5f0f"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"\u89c2\u5bdf\u8005\u6a21\u5f0f \u57fa\u4e8e \u53d1\u5e03\u8ba2\u9605 \u6a21\u5f0f"),(0,a.kt)("li",{parentName:"ul"},"\u4f8b\u5982:\u6211\u8981\u89c2\u5bdf\u8001\u677f\u7684\u60c5\u7eea,\u8001\u677f\u4e00\u53d1\u751f\u60c5\u7eea\u53d8\u5316\u5c31\u4f1a\u7acb\u5373\u901a\u77e5\u7ed9\u6211\u4ed6\u6709\u60c5\u7eea\u4e86")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},'class Sbuject {\n  // 1.\u88ab\u89c2\u5bdf\u8005  \u8001\u677f\n  constructor() {\n    this.arr = []; // \u5b58\u50a8\u7a7a\u95f4  [o1,o2]\n    this.state = "\u6211\u5f88\u5f00\u5fc3"; // \u88ab\u89c2\u5bdf\u8005\u7684\u4e00\u4e2a\u72b6\u6001\n  }\n  attach(o) {\n    // 3.\u63a5\u6536\u89c2\u5bdf\u8005,\u5b58\u50a8\u5728\u4e00\u4e2a\u6570\u7ec4\u7a7a\u95f4\n    this.arr.push(o);\n  }\n  setState(newState) {\n    // 4.\u4fee\u6539\u88ab\u89c2\u5bdf\u8005\u72b6\u6001,\u901a\u77e5\u6240\u6709\u89c2\u5bdf\u8005\u66f4\u65b0\u72b6\u6001\n    this.state = newState;\n    this.arr.forEach((o) => o.updata(newState));\n  }\n}\n\nclass Observer {\n  // 1.\u89c2\u5bdf\u8005   \u6211 \u540c\u4e8b\n  constructor(name) {\n    this.name = name;\n  }\n  updata(newState) {\n    // 5.\u89c2\u5bdf\u8005\u8ba2\u9605\u66f4\u65b0\u72b6\u6001\n    console.log(this.name + "\u8001\u677f" + newState);\n  }\n}\n\n// 2. \u5b9e\u4f8b\u5316\nlet s = new Sbuject("\u8001\u677f"); //\u8001\u677f\nlet o1 = new Observer("\u6211");\nlet o2 = new Observer("\u540c\u4e8b");\n\ns.attach(o1); // 3.\u88ab\u89c2\u5bdf\u8005\u4e2d\u6dfb\u52a0\u89c2\u5bdf\u8005\u5bf9\u8c61\ns.attach(o2);\ns.setState("\u4e0d\u5f00\u5fc3\u4e86"); // 4.\u88ab\u89c2\u5bdf\u8005\u4fee\u6539\u72b6\u6001\n')),(0,a.kt)("h3",{id:"promise-\u7684\u4f18\u70b9"},"Promise \u7684\u4f18\u70b9"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"\u89e3\u51b3\u5e76\u53d1\u95ee\u9898 (\u540c\u6b65\u591a\u4e2a\u5f02\u6b65\u65b9\u6cd5\u7684\u6267\u884c\u7ed3\u679c)"),(0,a.kt)("li",{parentName:"ul"},"\u94fe\u5f0f\u8c03\u7528\u95ee\u9898 \u89e3\u51b3\u591a\u4e2a\u56de\u8c03\u5d4c\u5957\u7684\u95ee\u9898")),(0,a.kt)("h3",{id:"promise-\u7684\u7279\u70b9"},"Promise \u7684\u7279\u70b9"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"promise \u662f\u4e00\u4e2a\u7c7b"),(0,a.kt)("li",{parentName:"ol"},"\u6bcf\u6b21 new \u4e00\u4e2a Promise \u90fd\u9700\u8981\u4f20\u9012\u4e00\u4e2a",(0,a.kt)("inlineCode",{parentName:"li"},"\u6267\u884c\u5668"),"\uff0c\u6267\u884c\u5668\u662f\u7acb\u5373\u6267\u884c\u7684"),(0,a.kt)("li",{parentName:"ol"},"\u6267\u884c\u5668\u51fd\u6570\u4e2d\u6709\u4e24\u4e2a\u53c2\u6570 resolve, reject"),(0,a.kt)("li",{parentName:"ol"},"\u9ed8\u8ba4 promise \u6709\u4e09\u4e2a\u72b6\u6001 pending ==> resolve \u8868\u793a\u6210\u529f fulfilled reject \u8868\u793a\u62d2\u7edd===\u300brejected"),(0,a.kt)("li",{parentName:"ol"},"\u5982\u679c\u4e00\u65e6\u6210\u529f\u4e86\uff0c\u4e0d\u80fd\u53d8\u6210\u5931\u8d25\u4e86 \u4e00\u65e6\u5931\u8d25 \u4e0d\u80fd\u518d\u6210\u529f\u4e86 \u53ea\u6709\u5f53\u524d\u72b6\u6001\u662f pending \u7684\u65f6\u5019\u624d\u80fd\u66f4\u6539\u72b6\u6001"),(0,a.kt)("li",{parentName:"ol"},"\u6bcf\u4e2a promise \u90fd\u6709\u4e00\u4e2a then \u65b9\u6cd5")),(0,a.kt)("h3",{id:"promise-\u7684\u5b9e\u73b0"},"Promise \u7684\u5b9e\u73b0"),(0,a.kt)("h4",{id:"promise-\u53ea\u517c\u5bb9\u540c\u6b65\u4ee3\u7801"},"promise \u53ea",(0,a.kt)("inlineCode",{parentName:"h4"},"\u517c\u5bb9"),"\u540c\u6b65\u4ee3\u7801"),(0,a.kt)("p",null,"\u6267\u884c\u903b\u8f91"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},'const p = new Promise((resolve, reject) => {\n  resolve("222");\n});\np.then(\n  (data) => {\n    console.log(data);\n  },\n  (err) => {}\n);\n')),(0,a.kt)("p",null,"\u5b9e\u73b0\u903b\u8f91"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},'const PENDING = Symbol("PENDING");\nconst FULFILLED = Symbol("FULFILLED");\nconst REJECTED = Symbol("REJECTED");\nclass Prmoise {\n  constructor(executor) {\n    this.status = PENDING; //\u72b6\u6001\n    this.value = undefined; //\u5b58\u50a8\u6210\u529f\u7684\u503c\n    this.reason = undefined; //\u5b58\u50a8\u5931\u8d25\u7684\u539f\u56e0\n    const resolve = (val) => {\n      if (this.status === PENDING) {\n        this.value = val;\n        this.status = FULFILLED;\n      }\n    }; //\u6210\u529f\u8c03\u7528\u7684\u51fd\u6570\n    const reject = (reason) => {\n      if (this.status === REJECTED) {\n        this.reason = reason;\n        this.status = REJECTED;\n      }\n    }; //\u5931\u8d25\u8c03\u7528\u7684\u51fd\u6570\n    try {\n      executor(resolve, reject);\n    } catch (e) {\n      reject(e);\n    }\n  }\n  then(onFulFilled, onRejected) {\n    if (this.status === FULFILLED) {\n      onFulFilled(this.value);\n    }\n    if (this.status === REJECTED) {\n      onRejected(this.reason);\n    }\n  }\n}\n')),(0,a.kt)("h3",{id:"promise\u517c\u5bb9\u5f02\u6b65\u4ee3\u7801"},"Promise",(0,a.kt)("inlineCode",{parentName:"h3"},"\u517c\u5bb9"),"\u5f02\u6b65\u4ee3\u7801"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"new Promise")," \u4e2d\u5982\u679c\u6709\u5f02\u6b65\u4ee3\u7801,\u6267\u884c then \u7684\u65f6\u5019",(0,a.kt)("inlineCode",{parentName:"li"},"this.status"),"\u7684\u72b6\u6001\u4e3a",(0,a.kt)("inlineCode",{parentName:"li"},"PENDING")),(0,a.kt)("li",{parentName:"ul"},"\u6240\u4ee5\u9700\u8981\u7528\u4e00\u4e2a\u6570\u7ec4\u6765\u5206\u522b\u5b58\u653e",(0,a.kt)("inlineCode",{parentName:"li"},"onFulFilled"),"\u548c",(0,a.kt)("inlineCode",{parentName:"li"},"onRejected"),",\u5f53\u6267\u884c",(0,a.kt)("inlineCode",{parentName:"li"},"resolve"),"\u6216\u8005",(0,a.kt)("inlineCode",{parentName:"li"},"reject"),"\u65b9\u6cd5\u7684\u65f6\u5019\u6765\u904d\u5386\u8fd9\u4e9b\u65b9\u6cd5")),(0,a.kt)("p",null,"\u5b9e\u73b0\u903b\u8f91"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},'const PENDING = Symbol("PENDING");\nconst FULFILLED = Symbol("FULFILLED");\nconst REJECTED = Symbol("REJECTED");\nclass Prmoise {\n  constructor(executor) {\n    this.status = PENDING; //\u72b6\u6001\n    this.value = undefined; //\u5b58\u50a8\u6210\u529f\u7684\u503c\n    this.reason = undefined; //\u5b58\u50a8\u5931\u8d25\u7684\u539f\u56e0\n    this.onFulFilledCallbacks = []; //\u5b58\u653e\u6210\u529f\u7684\u56de\u8c03\n    this.onRejectedCallbacks = []; //\u5b58\u653e\u5931\u8d25\u7684\u56de\u8c03\n    const resolve = (val) => {\n      if (this.status === PENDING) {\n        this.value = val;\n        this.status = FULFILLED;\n        this.onFulFilledCallbacks.forEach((fn) => fn());\n      }\n    }; //\u6210\u529f\u8c03\u7528\u7684\u51fd\u6570\n    const reject = (reason) => {\n      if (this.status === REJECTED) {\n        this.reason = reason;\n        this.status = REJECTED;\n        this.onRejectedCallbacks.forEach((fn) => fn());\n      }\n    }; //\u5931\u8d25\u8c03\u7528\u7684\u51fd\u6570\n    try {\n      executor(resolve, reject);\n    } catch (e) {\n      reject(e);\n    }\n  }\n  then(onFulFilled, onRejected) {\n    if (this.status === FULFILLED) {\n      onFulFilled(this.value);\n    }\n    if (this.status === REJECTED) {\n      onRejected(this.reason);\n    }\n    if (this.status === PENFING) {\n      this.onFulFilledCallbacks.push(() => {\n        onFulFilled(this.value);\n      });\n\n      this.onRejectedCallbacks.push(() => {\n        onRejected(this.reason);\n      });\n    }\n  }\n}\n')),(0,a.kt)("p",null,"\u8c03\u7528\u903b\u8f91"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"const p = new Promise((resolve, reject) => {\n  setTimeout(() => {\n    resolve(100);\n  });\n});\np.then(\n  (data) => {\n    console.log(data);\n  },\n  (err) => {}\n);\n")),(0,a.kt)("h3",{id:"then-\u7684\u94fe\u5f0f\u8c03\u7528"},"then \u7684\u94fe\u5f0f\u8c03\u7528"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"\u5f53 then \u4e2d\u8fd4\u56de promise \u7684\u8bdd,\u4f1a\u7b49\u5f85 promise \u6267\u884c\uff0c\u5c06 promise \u7684\u8fd4\u56de\u503c\u8fd4\u56de\u5230\u540e\u7eed\u7684 then \u4e2d"),(0,a.kt)("li",{parentName:"ul"},"\u56e0\u4e3a promise \u5982\u679c\u6210\u529f\u4e86\uff0c\u5c31\u4e0d\u80fd\u5728\u53d8\u6210\u5931\u8d25\u72b6\u6001\uff0cpromise \u94fe\u5f0f\u8c03\u7528\u7684\u65f6\u5019\u540e\u7eed",(0,a.kt)("inlineCode",{parentName:"li"},"\u6210\u529f"),"\uff0c\u4e5f\u4f1a\u53d8\u6210",(0,a.kt)("inlineCode",{parentName:"li"},"\u5931\u8d25\u72b6\u6001"),",\u6240\u4ee5\u65ad\u5b9a then \u8fd4\u56de\u7684\u662f\u4e00\u4e2a\u65b0\u7684",(0,a.kt)("inlineCode",{parentName:"li"},"promise"),",\u6765\u5b9e\u73b0\u94fe\u5f0f\u8c03\u7528"),(0,a.kt)("li",{parentName:"ul"},"onFulFilled, onRejected \u4f1a\u7ee7\u7eed\u5411\u4e0b\u4f20\u9012")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},'function resolvePromise(p1, x, resolve, reject) {\n  if (p1 === x) {\n    //\u6839\u636e\u89c4\u5219\u8fd9\u91cc\u5982\u679c\u4e0d\u5904\u7406\u7684\u8bdd\u4f1a\u6b7b\u5faa\u73af\uff0c\u62a5\u4e00\u4e2a\u7c7b\u578b\u9519\u8bef\n    reject(new TypeError("Chaining cycle detected for promise #<Promise>"));\n  }\n  //\u5224\u65ad\u662f\u5426\u662fpromise\n  let called = true; //\u5982\u679c\u8fd4\u56de\u7684\u662f\u522b\u4eba\u7684promise\u5c31\u4e0d\u80fd\u4fdd\u8bc1promise\u88ab\u8c03\u7528\u6210\u529f\u6001\u540e\u5c31\u4e0d\u80fd\u5728\u53d8\u6210\u5931\u8d25\u6001\uff0c\u6240\u4ee5\u8981\u517c\u5bb9\n  if ((typeof x === "object" && x !== null) || typeof x === "function") {\n    try {\n      // x.then\u53ef\u80fd\u662fObject.defineProperty\u6a21\u62df\u7684\uff0c\u53ef\u80fd\u4f1a\u62a5\u9519\n      let then = x.then;\n      if (typeof then === "function") {\n        //\u4e3a\u5565\u4e0dthen\u76f4\u63a5\u8c03\u7528\uff0c\u5982\u679cx.then\u4e8c\u6b21\u8c03\u7528\u540e\u4e0d\u662f\u51fd\u6570\n        then.call(\n          x,\n          (y) => {\n            //y\u662fresolve\u4e2d\u4f20\u9012\u7684\u503c\n            //y\u53ef\u80fd\u4e5f\u662f\u4e00\u4e2apromise\n            if (called) return;\n            called = true;\n            resolvePromise(p1, y, resolve, reject);\n          },\n          (r) => {\n            if (called) return;\n            called = true;\n            reject(r);\n          }\n        );\n      } else {\n        resolve(x);\n      }\n    } catch (error) {\n      if (called) return;\n      called = true;\n      reject(error);\n    }\n  } else {\n    resolve(x);\n  }\n}\nfunction isPromise(val){\n  if(typeof val===\'function\' || (typeof val===\'object\' && typeof!==null)){\n    return typeof x.then===\'function\'\n  }\n  return false\n}\nconst PENDING = Symbol("PENDING");\nconst FULFILLED = Symbol("FULFILLED");\nconst REJECTED = Symbol("REJECTED");\nclass Prmoise {\n  constructor(executor) {\n    this.status = PENDING; //\u72b6\u6001\n    this.value = undefined; //\u5b58\u50a8\u6210\u529f\u7684\u503c\n    this.reason = undefined; //\u5b58\u50a8\u5931\u8d25\u7684\u539f\u56e0\n    this.onFulFilledCallbacks = []; //\u5b58\u653e\u6210\u529f\u7684\u56de\u8c03\n    this.onRejectedCallbacks = []; //\u5b58\u653e\u5931\u8d25\u7684\u56de\u8c03\n    const resolve = (val) => {\n      if (this.status === PENDING) {\n        //\u5982\u679cval\u8fd8\u662fpromise\u7684\u8bdd\uff0c\u4f1a\u7b49\u5f85promise\u6267\u884c\u5b8c\u6bd5\u540e\u5c06\u7ed3\u679c\u8fd4\u56de\n        if(isPromise(val)){\n          // return val.then((data)=>resolve(data),(err)=>reject(err))\n          return val.then(resolve,reject)\n        }\n        this.value = val;\n        this.status = FULFILLED;\n        this.onFulFilledCallbacks.forEach((fn) => fn());\n      }\n    }; //\u6210\u529f\u8c03\u7528\u7684\u51fd\u6570\n    const reject = (reason) => {\n      if (this.status === REJECTED) {\n        this.reason = reason;\n        this.status = REJECTED;\n        this.onRejectedCallbacks.forEach((fn) => fn());\n      }\n    }; //\u5931\u8d25\u8c03\u7528\u7684\u51fd\u6570\n    try {\n      executor(resolve, reject);\n    } catch (e) {\n      reject(e);\n    }\n  }\n  then(onFulFilled, onRejected) {\n    onFulFilled=typeof onFulFilled===\'function\'?onFulFilled:(val)=>{return val }\n    onRejected=typeof onRejected===\'function\'?onRejected:(err)=>{throw error }\n    let p1 = new Prmoise((resolve, reject) => {\n      if (this.status === FULFILLED) {\n        setTimeout(() => {\n          try {\n            let x = onFulFilled(this.value);\n            resolvePromise(p1, x, resolve, reject); //\u8fd9\u91cc\u4e3a\u4e86\u83b7\u53d6p1\u7684\u503c\u53ea\u80fd\u5f02\u6b65\u5904\u7406\u4e00\u4e0b\uff0c\u6211\u4eec\u53ef\u4ee5\u7528settimeout\u6a21\u62df\n          } catch (error) {\n            reject(error);\n          }\n        });\n      }\n      if (this.status === REJECTED) {\n        setTimeout(() => {\n          try {\n            let x = onRejected(this.reason);\n            resolvePromise(p1, x, resolve, reject);\n          } catch (error) {\n            reject(error);\n          }\n        });\n      }\n      if (this.status === PENFING) {\n        // setTimeout(()=>{ //\u4e3a\u4ec0\u4e48\u4e0d\u80fd\u628asettimeout\u653e\u5230\u8fd9\u91cc,\u4f1a\u5bfc\u81f4\u5982\u679cnew promise\u4e2d\u6267\u884c\u5f02\u6b65\u7684\u65f6\u5019 resolve\u65f6\uff0c this.onFulFilledCallbacks\u4e3a[]\n        this.onFulFilledCallbacks.push(() => {\n          setTimeout(() => {\n            try {\n              let x = onFulFilled(this.value);\n              resolvePromise(p1, x, resolve, reject);\n            } catch (error) {\n              reject(error);\n            }\n          });\n        });\n\n        this.onRejectedCallbacks.push(() => {\n          setTimeout(() => {\n            try {\n              let x = onRejected(this.reason);\n              resolvePromise(p1, x, resolve, reject);\n            } catch (error) {\n              reject(error);\n            }\n          });\n        });\n        // })\n      }\n    });\n    return p1;\n  }\n}\n')),(0,a.kt)("h3",{id:"\u6d4b\u8bd5\u5199\u7684-promise-\u662f\u5426\u7b26\u5408\u89c4\u8303"},"\u6d4b\u8bd5\u5199\u7684 Promise \u662f\u5426\u7b26\u5408\u89c4\u8303"),(0,a.kt)("p",null,"\u5168\u5c40\u5b89\u88c5\u6d4b\u8bd5\u63d2\u4ef6"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sh"},"npm i promises-aplus-tests -g\n")),(0,a.kt)("p",null,"\u5728\u8981\u6d4b\u8bd5\u7684\u4ee3\u7801\u4e2d\u52a0\u5165\u5982\u4e0b\u4ee3\u7801:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"//! \u6d4b\u8bd5Promise\u662f\u5426\u7b26\u5408\u89c4\u8303\nPromise.deferred = function() {\n  let dfd = {};\n  dfd.promise = new Promise((resolve, reject) => {\n    dfd.resolve = resolve;\n    dfd.reject = reject;\n  });\n  return dfd;\n};\n")),(0,a.kt)("h3",{id:"catch-\u5b9e\u73b0"},"catch \u5b9e\u73b0"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"Promise.prototype.catch(e){\n      return this.then(null,(err)=>{\n          throw err\n      })\n}\n")),(0,a.kt)("h3",{id:"resolve-\u7684\u5b9e\u73b0"},"resolve \u7684\u5b9e\u73b0"),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"Promise.resolve"),"\u7528\u6765\u751f\u6210\u4e00\u4e2a\u76f4\u63a5\u5904\u4e8e",(0,a.kt)("inlineCode",{parentName:"p"},"FULFILLED"),"\u72b6\u6001\u7684",(0,a.kt)("inlineCode",{parentName:"p"},"Promise"),"\u3002"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"Promise.resolve(e){\n      return new Promise((resolve,reject)=>{\n        resolve(data)\n      })\n}\n")),(0,a.kt)("h3",{id:"reject-\u7684\u5b9e\u73b0"},"reject \u7684\u5b9e\u73b0"),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"Promise.reject"),"\u7528\u6765\u751f\u6210\u4e00\u4e2a\u76f4\u63a5\u5904\u4e8e",(0,a.kt)("inlineCode",{parentName:"p"},"REJECTED"),"\u72b6\u6001\u7684 Promise\u3002"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"Promise.reject(e){\n      return new Promise((resolve,reject)=>{\n        reject(e)\n      })\n}\n")),(0,a.kt)("h3",{id:"finally-\u65b9\u6cd5"},"finally \u65b9\u6cd5"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"\u4e0d\u7ba1\u662f",(0,a.kt)("inlineCode",{parentName:"li"},"resolve"),"\u8fd8\u662f",(0,a.kt)("inlineCode",{parentName:"li"},"reject"),"\u90fd\u4f1a\u8c03\u7528",(0,a.kt)("inlineCode",{parentName:"li"},"finally"),"\u3002")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u7528\u6cd5")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"Promise.reject()\n  .finally(() => {\n    console.log(1);\n    return new Promise((resovle, reject) => {\n      setTimeout(() => {\n        resovle(); //\u4f1a\u7b49\u5f85promise\u6267\u884c\u5b8c\u6267\u884c\n      }, 1000);\n    });\n  })\n  .catch((e) => {\n    console.log(e);\n  });\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u5b9e\u73b0")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"// Promise.prototype.finally=function(callback){\n//   return this.then((data)=>{callback() return data},(err)=>{callback() throw err})\n// }\nPromise.prototype.finally = function(callback) {\n  // callback \u76f4\u63a5\u653e\u5230\u5931\u8d25\u91cc \u4f1a\u5bfc\u81f4\u65e0\u6cd5\u7ee7\u627f\u4e0a\u4e00\u6b21\u7684\u5931\u8d25\n  // return this.then(callback,callback);\n  return this.then(\n    (val) => {\n      // \u7b49\u5f85finally\u4e2d\u7684\u51fd\u6570\u6267\u884c\u5b8c\u6bd5 \u7ee7\u7eed\u6267\u884c finally\u51fd\u6570\u53ef\u80fd\u8fd4\u8fd8\u4e00\u4e2apromise \u7528Promise.resolve\u7b49\u5f85\u8fd4\u56de\u7684promise\u6267\u884c\u5b8c\n      return Promise.resolve(callback()).then(() => val);\n      //return val; // \u5982\u679c\u4e0a\u4e00\u4e2athen\u662f\u6210\u529f\u5c31\u5c06\u8fd9\u4e2a\u6210\u529f\u5411\u4e0b\u4f20\u9012\n    },\n    (err) => {\n      return Promise.resolve(callback()).then(() => {\n        throw err;\n      });\n      //throw err; // \u5982\u679c\u4e0a\u4e00\u4e2athen\u662f\u5931\u8d25\u5c31\u5c06\u8fd9\u4e2a\u5931\u8d25\u7ee7\u7eed\u5411\u4e0b\u629b\n    }\n  );\n};\n")),(0,a.kt)("h3",{id:"all"},"all"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"Promise.all = function(promises) {\n  return new Promise((resolve, reject) => {\n    let index = 0,\n      arr = [];\n    function resolvePromiseValue(i, val) {\n      if (isPromise(val)) {\n        val.then(resolvePromiseValue, reject);\n      } else {\n        processData(i, val);\n      }\n    }\n    function processData(i, val) {\n      arr[i] = val;\n      if (++index === promises.length) {\n        resolve(arr);\n      }\n    }\n    for (let i = 0; i < promises[i]; i++) {\n      const item = promises[i];\n      resolvePromiseValue(i, item);\n    }\n  });\n};\n")),(0,a.kt)("h3",{id:"reject"},"reject"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"Promise.reject = function(promises) {\n  return new Promise((resolve, reject) => {\n    function resolvePromiseValue(val) {\n      if (isPromise(val)) {\n        val.then(resolvePromiseValue, reject);\n      } else {\n        processData(val);\n      }\n    }\n    function processData(val) {\n      resolve(val);\n    }\n    for (let i = 0; i < promises[i]; i++) {\n      const item = promises[i];\n      resolvePromiseValue(item);\n    }\n  });\n};\n")),(0,a.kt)("h3",{id:"\u4e2d\u65ad-promise-\u94fe-\u5c31\u662f\u8fd4\u56de\u4e00\u4e2a\u7b49\u5f85\u7684-promise"},"\u4e2d\u65ad promise \u94fe \u5c31\u662f\u8fd4\u56de\u4e00\u4e2a\u7b49\u5f85\u7684 promise"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},'let p1 = p\n  .then(() => {\n    console.log("ok");\n    return new Promise(() => {});\n  })\n  .then(() => {\n    console.log(1);\n  });\n')),(0,a.kt)("h3",{id:"\u5982\u4f55\u653e\u5f03\u67d0\u4e2a-promise-\u7684\u6267\u884c\u7ed3\u679c"},"\u5982\u4f55\u653e\u5f03\u67d0\u4e2a promise \u7684\u6267\u884c\u7ed3\u679c"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},'function wrap(p1) {\n  let fail = null;\n  let p2 = new Promise((resolve, reject) => {\n    fail = reject; // \u5148\u5c06p2\u5931\u8d25\u7684\u65b9\u6cd5\u66b4\u9732\u51fa\u6765\n  });\n  let p = Promise.race([p2, p1]); // race\u65b9\u6cd5\u8fd4\u56de\u7684\u4e5f\u662f\u4e00\u4e2apromise\n  p.abort = fail;\n  return p;\n}\nlet p = wrap(\n  new Promise((resolve, reject) => {\n    setTimeout(() => {\n      resolve("ok");\n    }, 3000);\n  })\n);\np.abort("error");\np.then((data) => {\n  console.log(data);\n}).catch((err) => {\n  console.log(err);\n});\n')),(0,a.kt)("h3",{id:"\u65e2\u80fd\u6355\u83b7\u540c\u6b65\u6709\u80fd\u6355\u83b7\u5f02\u6b65"},"\u65e2\u80fd\u6355\u83b7\u540c\u6b65\u6709\u80fd\u6355\u83b7\u5f02\u6b65"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},'function fn() {\n  //\u53ef\u80fd\u51fd\u6570\u4e2d\u629b\u51fa\u4e86 \u540c\u6b65\u9519\u8bef \u8981\u901a\u8fc7try-catch \u6355\u83b7\u5f02\u5e38\n  throw new Error("err");\n  return new Promise((resolve, reject) => {\n    setTimeout(() => {\n      reject("xxx");\n    }, 3000);\n  });\n}\nPromise.try(fn).then(\n  (data) => {\n    console.log(data, "---");\n  },\n  (err) => {\n    console.log("err:" + err);\n  }\n);\n')),(0,a.kt)("p",null,"\u5b9e\u73b0"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"Promise.try = function(callback) {\n  return new Promise((resolve, reject) => {\n    // Promise.resolve \u53ea\u80fd\u8fd4\u56de\u4e00\u4e2a\u6210\u529f\u7684promise\n    return Promise.resolve(callback()).then(resolve, reject);\n  });\n};\n")),(0,a.kt)("h2",{id:"generator"},"generator"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"\u751f\u6210\u5668\u51fd\u6570"),(0,a.kt)("li",{parentName:"ul"},"\u8fd4\u56de\u503c\u662f\u8fed\u4ee3\u5668")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"function* read() {\n  yield 1; //\u4ea7\u51fa \u4f1a\u4e2d\u65ad\u6267\u884c\n  yield 2;\n  yield 3;\n}\n// iterator \u8fed\u4ee3\u5668\nlet it = read();\nconsole.log(it.next()); //{ value: 1, done: false }\n\nconsole.log(it.next()); //{ value: 2, done: false }\nconsole.log(it.next()); //{ value: 3, done: false }\nconsole.log(it.next()); //{ value: undefined, done: true }\n")),(0,a.kt)("h4",{id:"\u5c06\u7c7b\u6570\u7ec4\u8f6c\u5316\u6210\u6570\u7ec4"},"\u5c06\u7c7b\u6570\u7ec4\u8f6c\u5316\u6210\u6570\u7ec4"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"\u7c7b\u6570\u7ec4\u7684\u5b9a\u4e49",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"\u7d22\u5f15"),(0,a.kt)("li",{parentName:"ul"},"\u957f\u5ea6")))),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"function add() {\n  //   console.log([...arguments]);\n  // 1. ...([Symbol.iterator])  for of \u5fc5\u987b\u7ed9\u5f53\u524d\u5bf9\u8c61\u63d0\u4f9b\u4e00\u4e2a `\u751f\u6210\u5668` \u65b9\u6cd5\n  // 2.Array.from(\u5faa\u73af)\n  console.log([\n    ...{\n      0: 1,\n      1: 2,\n      2: 3,\n      3: 4,\n      4: 5,\n      5: 6,\n      length: 6,\n      //   [Symbol.iterator]() {\n      //     let len = this.length;\n      //     let index = 0;\n      //     // \u8fed\u4ee3\u5668\u6709next\u65b9\u6cd5 \u800c\u4e14\u65b9\u6cd5\u6267\u884c\u540e\uff0c\u9700\u8981\u8fd4\u56devalue\u548cdone\n      //     return {\n      //       next: () => {\n      //         return { value: this[index++], done: index === len + 1 };\n      //       },\n      //     };\n      //   },\n      [Symbol.iterator]: function*() {\n        let index = 0;\n        while (index !== this.length) {\n          yield this[index++];\n        }\n      },\n    },\n  ]);\n}\n")),(0,a.kt)("h3",{id:"generator-\u95ee\u9898"},"generator \u95ee\u9898"),(0,a.kt)("p",null,"\u4e0b\u9762\u95ee\u9898\u7684\u6267\u884c\u7ed3\u679c"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},'function* read() {\n  try {\n    let a = yield 1;\n    console.log(a);\n    let b = yield 2;\n    console.log(b);\n    let c = yield 3;\n    console.log(c);\n  } catch (e) {\n    console.log(error);\n  }\n}\nlet it = read();\nit.next(100);\nit.next(200);\nit.next(300);\nit.throw("error"); //\u4f1a\u6267\u884ccatch\u4e2d\u9519\u8bef\u7684\n')),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"generator\u6267\u884c",src:t(43424).Z})),(0,a.kt)("h3",{id:"co-\u7684\u5b9e\u73b0"},"co \u7684\u5b9e\u73b0"),(0,a.kt)("p",null,"\u7528\u6cd5"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},'const fs = require("fs").promises;\nfunction* read() {\n  let content = yield fs.readFile("./name.txt", "utf8"); // age.txt\n  let age = yield fs.readFile(content, "utf8"); // 10\n  let xx = yield { age: age + 10 };\n  return xx;\n}\nlet co = require("co");\nco(read()).then((data) => {\n  console.log(data);\n});\n')),(0,a.kt)("p",null,"\u5b9e\u73b0"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"function co(it) {\n  return new Promise((resolve, reject) => {\n    function next(arg) {\n      const { value, done } = it.next(arg);\n      if (!done) {\n        Promise.resolve(value).then(next, reject);\n      } else {\n        resolve(value);\n      }\n    }\n    next(undefined);\n  });\n}\n")),(0,a.kt)("h3",{id:"asyncawait"},"async+await"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"async \u51fd\u6570\u7684 await \u547d\u4ee4\u540e\u9762\uff0c\u53ef\u4ee5\u662f ",(0,a.kt)("inlineCode",{parentName:"li"},"Promise \u5bf9\u8c61"),"\u548c",(0,a.kt)("inlineCode",{parentName:"li"},"\u539f\u59cb\u7c7b\u578b\u7684\u503c"),"\uff08\u6570\u503c\u3001\u5b57\u7b26\u4e32\u548c\u5e03\u5c14\u503c\uff0c\u4f46\u8fd9\u65f6\u4f1a\u81ea\u52a8\u8f6c\u6210\u7acb\u5373 ",(0,a.kt)("inlineCode",{parentName:"li"},"resolved")," \u7684 ",(0,a.kt)("inlineCode",{parentName:"li"},"Promise \u5bf9\u8c61"),"\uff09")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},'const fs = require("fs").promises;\n// async + await \u5176\u5b9e\u662f generator + co\u7684\u8bed\u6cd5\u7cd6\nasync function read() {\n  // async\u51fd\u6570\u8fd4\u56de\u7684\u662fpromise\n  let r = await Promise.all([p1, p2]);\n  try {\n    let content = await fs.readFile("./name1.txt", "utf8"); // age.txt\n    let age = await fs.readFile(content, "utf8"); // 10\n    let xx = await { age: age + 10 };\n    return xx;\n  } catch (e) {\n    console.log(e);\n  }\n}\nread().then(\n  (data) => {\n    console.log(data);\n  },\n  (err) => {\n    console.log(err);\n  }\n);\n')),(0,a.kt)("h3",{id:"\u8fd4\u56de-promise-\u5bf9\u8c61"},"\u8fd4\u56de Promise \u5bf9\u8c61"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"async \u51fd\u6570\u8fd4\u56de\u4e00\u4e2a Promise \u5bf9\u8c61\u3002")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"async \u51fd\u6570\u5185\u90e8 return \u8bed\u53e5\u8fd4\u56de\u7684\u503c\uff0c\u4f1a\u6210\u4e3a then \u65b9\u6cd5\u56de\u8c03\u51fd\u6570\u7684\u53c2\u6570\u3002"))),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},'async function f() {\n  return "hello world";\n}\n\nf().then((v) => console.log(v));\n// "hello world"\n')),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"\u4e0a\u9762\u4ee3\u7801\u4e2d\uff0c\u51fd\u6570 f \u5185\u90e8 return \u547d\u4ee4\u8fd4\u56de\u7684\u503c\uff0c\u4f1a\u88ab then \u65b9\u6cd5\u56de\u8c03\u51fd\u6570\u63a5\u6536\u5230\u3002")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"async \u51fd\u6570\u5185\u90e8\u629b\u51fa\u9519\u8bef\uff0c\u4f1a\u5bfc\u81f4\u8fd4\u56de\u7684 Promise \u5bf9\u8c61\u53d8\u4e3a reject \u72b6\u6001\u3002\u629b\u51fa\u7684\u9519\u8bef\u5bf9\u8c61\u4f1a\u88ab catch \u65b9\u6cd5\u56de\u8c03\u51fd\u6570\u63a5\u6536\u5230\u3002"))),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},'async function f() {\n  throw new Error("\u51fa\u9519\u4e86");\n}\n\nf().then(\n  (v) => console.log(v),\n  (e) => console.log(e)\n);\n// Error: \u51fa\u9519\u4e86\n')),(0,a.kt)("h2",{id:"promise-\u9762\u8bd5\u9898\u76ee"},"promise \u9762\u8bd5\u9898\u76ee"),(0,a.kt)("h3",{id:"\u9898\u76ee-1"},"\u9898\u76ee 1"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"Promise.resolve(1)\n  .then(2)\n  .then(Promise.resolve(3))\n  .then(console.log);\n")),(0,a.kt)("p",null,"then \u7684\u5982\u679c\u4f20\u5165\u7684\u4e0d\u662f\u51fd\u6570\u5c31\u4f1a\u88ab\u51fd\u6570\u5305\u88f9\u4e00\u4e0b\u5192\u6ce1\u5230\u4e4b\u540e\u7684 then \u4e2d ,\u6240\u4ee5\u7b54\u6848\u662f 1"),(0,a.kt)("h3",{id:"\u9898\u76ee-2"},"\u9898\u76ee 2"),(0,a.kt)("p",null,"\u7ea2\u706f\u4e09\u79d2\u4eae\u4e00\u6b21\uff0c\u7eff\u706f\u4e00\u79d2\u4eae\u4e00\u6b21\uff0c\u9ec4\u706f 2 \u79d2\u4eae\u4e00\u6b21\uff1b\u5982\u4f55\u8ba9\u4e09\u4e2a\u706f\u4e0d\u65ad\u4ea4\u66ff\u91cd\u590d\u4eae\u706f\uff1f\uff08\u7528 Promse \u5b9e\u73b0\uff09\u4e09\u4e2a\u4eae\u706f\u51fd\u6570\u5df2\u7ecf\u5b58\u5728\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"function red(){\n  console.log('red')\n}\nfunction yellow(){\n  console.log('yellow')\n}\nfunction green(){\n  console.log('green')\n}\nvar light = function (timmer, cb) {\n    return new Promise(function (resolve, reject) {\n        setTimeout(function () {\n            cb();\n            resolve();\n        }, timmer);\n    });\n};\n\nfunction next(){\n  return Promise.resolve(light(3000,red)).then(()=light(1000,green)).then(()=>light(2000,yellow)).then(next)\n}\n")),(0,a.kt)("h3",{id:"promise-\u7684\u4f18\u7f3a\u70b9"},"Promise \u7684\u4f18\u7f3a\u70b9"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"\u4f18\u70b9:",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"\u53ef\u4ee5\u89e3\u51b3\u5f02\u6b65\u5e76\u53d1\u95ee\u9898 Promise.all"),(0,a.kt)("li",{parentName:"ul"},"\u94fe\u5f0f\u8c03\u7528"))),(0,a.kt)("li",{parentName:"ul"},"\u7f3a\u70b9:",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"\u8fd8\u662f\u57fa\u4e8e\u56de\u8c03 promise"),(0,a.kt)("li",{parentName:"ul"},"\u65e0\u6cd5\u7ec8\u6b62 new Promise \u53ea\u80fd\u8bf4\u629b\u5f03\u8fd9\u6b21\u7684\u7ed3\u679c\u800c\u5df2 fetch \u65e0\u6cd5\u4e2d\u65ad\u7684 xhr.abort()")))))}m.isMDXComponent=!0},43424:function(e,n,t){n.Z=t.p+"assets/images/generator-636f558a1b64a7e2d690a3ff5c2cdb9d.png"}}]);