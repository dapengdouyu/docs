"use strict";(self.webpackChunkdapengdouyu=self.webpackChunkdapengdouyu||[]).push([[4403],{3905:function(n,e,t){t.d(e,{Zo:function(){return c},kt:function(){return m}});var l=t(67294);function o(n,e,t){return e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function r(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(n);e&&(l=l.filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),t.push.apply(t,l)}return t}function a(n){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{};e%2?r(Object(t),!0).forEach((function(e){o(n,e,t[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(t,e))}))}return n}function i(n,e){if(null==n)return{};var t,l,o=function(n,e){if(null==n)return{};var t,l,o={},r=Object.keys(n);for(l=0;l<r.length;l++)t=r[l],e.indexOf(t)>=0||(o[t]=n[t]);return o}(n,e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);for(l=0;l<r.length;l++)t=r[l],e.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(n,t)&&(o[t]=n[t])}return o}var p=l.createContext({}),u=function(n){var e=l.useContext(p),t=e;return n&&(t="function"==typeof n?n(e):a(a({},e),n)),t},c=function(n){var e=u(n.components);return l.createElement(p.Provider,{value:e},n.children)},d={inlineCode:"code",wrapper:function(n){var e=n.children;return l.createElement(l.Fragment,{},e)}},s=l.forwardRef((function(n,e){var t=n.components,o=n.mdxType,r=n.originalType,p=n.parentName,c=i(n,["components","mdxType","originalType","parentName"]),s=u(t),m=o,g=s["".concat(p,".").concat(m)]||s[m]||d[m]||r;return t?l.createElement(g,a(a({ref:e},c),{},{components:t})):l.createElement(g,a({ref:e},c))}));function m(n,e){var t=arguments,o=e&&e.mdxType;if("string"==typeof n||o){var r=t.length,a=new Array(r);a[0]=s;var i={};for(var p in e)hasOwnProperty.call(e,p)&&(i[p]=e[p]);i.originalType=n,i.mdxType="string"==typeof n?n:o,a[1]=i;for(var u=2;u<r;u++)a[u]=t[u];return l.createElement.apply(null,a)}return l.createElement.apply(null,t)}s.displayName="MDXCreateElement"},97292:function(n,e,t){t.r(e),t.d(e,{frontMatter:function(){return i},contentTitle:function(){return p},metadata:function(){return u},toc:function(){return c},default:function(){return s}});var l=t(83117),o=t(80102),r=(t(67294),t(3905)),a=["components"],i={},p=void 0,u={unversionedId:"books/React Hooks \u4e0e Immutable \u6570\u636e\u6d41\u5b9e\u6218/12\u3001\u6b4c\u624b\u5217\u88683 \u4e0a\u62c9 \u4e0b\u62c9\u52a0\u8f7d\u53ca\u4f18\u5316\uff0c\u5168\u9762\u52a9\u529b\u79fb\u52a8web\u5f00\u53d1",id:"books/React Hooks \u4e0e Immutable \u6570\u636e\u6d41\u5b9e\u6218/12\u3001\u6b4c\u624b\u5217\u88683 \u4e0a\u62c9 \u4e0b\u62c9\u52a0\u8f7d\u53ca\u4f18\u5316\uff0c\u5168\u9762\u52a9\u529b\u79fb\u52a8web\u5f00\u53d1",title:"12\u3001\u6b4c\u624b\u5217\u88683 \u4e0a\u62c9 \u4e0b\u62c9\u52a0\u8f7d\u53ca\u4f18\u5316\uff0c\u5168\u9762\u52a9\u529b\u79fb\u52a8web\u5f00\u53d1",description:"\u672c\u8282\u4ee3\u7801\u5bf9\u5e94 GitHub \u5206\u652f: chapter4",source:"@site/docs/books/React Hooks \u4e0e Immutable \u6570\u636e\u6d41\u5b9e\u6218/12\u3001\u6b4c\u624b\u5217\u88683 \u4e0a\u62c9 \u4e0b\u62c9\u52a0\u8f7d\u53ca\u4f18\u5316\uff0c\u5168\u9762\u52a9\u529b\u79fb\u52a8web\u5f00\u53d1.md",sourceDirName:"books/React Hooks \u4e0e Immutable \u6570\u636e\u6d41\u5b9e\u6218",slug:"/books/React Hooks \u4e0e Immutable \u6570\u636e\u6d41\u5b9e\u6218/12\u3001\u6b4c\u624b\u5217\u88683 \u4e0a\u62c9 \u4e0b\u62c9\u52a0\u8f7d\u53ca\u4f18\u5316\uff0c\u5168\u9762\u52a9\u529b\u79fb\u52a8web\u5f00\u53d1",permalink:"/docs/books/React Hooks \u4e0e Immutable \u6570\u636e\u6d41\u5b9e\u6218/12\u3001\u6b4c\u624b\u5217\u88683 \u4e0a\u62c9 \u4e0b\u62c9\u52a0\u8f7d\u53ca\u4f18\u5316\uff0c\u5168\u9762\u52a9\u529b\u79fb\u52a8web\u5f00\u53d1",editUrl:"https://github.com/dapengdouyu/docs/tree/master/docs/books/React Hooks \u4e0e Immutable \u6570\u636e\u6d41\u5b9e\u6218/12\u3001\u6b4c\u624b\u5217\u88683 \u4e0a\u62c9 \u4e0b\u62c9\u52a0\u8f7d\u53ca\u4f18\u5316\uff0c\u5168\u9762\u52a9\u529b\u79fb\u52a8web\u5f00\u53d1.md",tags:[],version:"current",frontMatter:{},sidebar:"books",previous:{title:"11\u3001\u6b4c\u624b\u5217\u88682  \u6b4c\u624b List \u5f00\u53d1\uff0c\u4e3a\u540e\u9762\u8d77\u98de\u505a\u94fa\u57ab",permalink:"/docs/books/React Hooks \u4e0e Immutable \u6570\u636e\u6d41\u5b9e\u6218/11\u3001\u6b4c\u624b\u5217\u88682  \u6b4c\u624b List \u5f00\u53d1\uff0c\u4e3a\u540e\u9762\u8d77\u98de\u505a\u94fa\u57ab"},next:{title:"13\u3001\u5982\u4f55\u7528 hooks \u5b9e\u73b0\u4e00\u4e2a Redux \u3010\u4e2d\u9014\u6765\u6ce2\u9a9a\u64cd\u4f5c\u3011",permalink:"/docs/books/React Hooks \u4e0e Immutable \u6570\u636e\u6d41\u5b9e\u6218/13\u3001\u5982\u4f55\u7528 hooks \u5b9e\u73b0\u4e00\u4e2a Redux \u3010\u4e2d\u9014\u6765\u6ce2\u9a9a\u64cd\u4f5c\u3011"}},c=[{value:"\u4e0a\u62c9 / \u4e0b\u62c9\u52a0\u8f7d\u66f4\u591a\u5b9e\u73b0",id:"\u4e0a\u62c9--\u4e0b\u62c9\u52a0\u8f7d\u66f4\u591a\u5b9e\u73b0",children:[],level:2},{value:"\u76f8\u5173\u4f18\u5316",id:"\u76f8\u5173\u4f18\u5316",children:[{value:"\u56fe\u7247\u61d2\u52a0\u8f7d",id:"\u56fe\u7247\u61d2\u52a0\u8f7d",children:[],level:3},{value:"\u9632\u6296\u5904\u7406",id:"\u9632\u6296\u5904\u7406",children:[],level:3}],level:2}],d={toc:c};function s(n){var e=n.components,t=(0,o.Z)(n,a);return(0,r.kt)("wrapper",(0,l.Z)({},d,t,{components:e,mdxType:"MDXLayout"}),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"\u672c\u8282\u4ee3\u7801\u5bf9\u5e94 GitHub \u5206\u652f: chapter4")),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/sanyuan0704/react-cloud-music/tree/chapter4"},"\u4ed3\u5e93\u4f20\u9001\u95e8")),(0,r.kt)("h2",{id:"\u4e0a\u62c9--\u4e0b\u62c9\u52a0\u8f7d\u66f4\u591a\u5b9e\u73b0"},"\u4e0a\u62c9 / \u4e0b\u62c9\u52a0\u8f7d\u66f4\u591a\u5b9e\u73b0"),(0,r.kt)("p",null,"\u5728\u8fd9\u91cc Scroll \u57fa\u7840\u7ec4\u4ef6\u7684\u4f5c\u7528\u5c31\u5c55\u73b0\u51fa\u6765\u4e86\u3002\u4e4b\u524d\u6211\u4eec\u5c01\u88c5\u4e86 Scroll \u7ec4\u4ef6\uff0c\u76d1\u542c\u4e0a\u62c9 / \u4e0b\u62c9\u5237\u65b0\u7684\u529f\u80fd\u5df2\u7f16\u5199\u5b8c\u6210\uff0c\u4f46\u662f\u76f8\u5e94\u7684 loading \u6548\u679c\u5e76\u6ca1\u6709\u8003\u8651\u3002\u73b0\u5728\uff0c\u6211\u4eec\u5c31\u6765\u5148\u5b8c\u5584 loading \u6548\u679c\u3002"),(0,r.kt)("p",null,"\u9996\u5148\u5f15\u5165 loading \u7ec4\u4ef6\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"import Loading from '../loading/index';\n\n")),(0,r.kt)("p",null,"\u5c06 return \u90e8\u5206\u7684\u4ee3\u7801\u4fee\u6539\u4e3a:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'const PullUpdisplayStyle = pullUpLoading ? {display: ""} : { display:"none" };\nconst PullDowndisplayStyle = pullDownLoading ? { display: ""} : { display:"none" };\nreturn (\n  <ScrollContainer ref={scrollContaninerRef}>\n    {props.children}\n    {/* \u6ed1\u5230\u5e95\u90e8\u52a0\u8f7d\u52a8\u753b */}\n    <PullUpLoading style={ PullUpdisplayStyle }><Loading></Loading></PullUpLoading>\n    {/* \u9876\u90e8\u4e0b\u62c9\u5237\u65b0\u52a8\u753b */}\n    <PullDownLoading style={ PullDowndisplayStyle }><LoadingV2></LoadingV2></PullDownLoading>\n  </ScrollContainer>\n);\n\n')),(0,r.kt)("p",null,"\u6ce8\u610f PullUpdisplayStyle \u548c PullDowndisplayStyle \u90fd\u662f\u5916\u90e8\u4f20\u5165\u7684\uff0c\u8fd9\u5c31\u65b9\u4fbf\u4e86\u6211\u4eec\u63a7\u5236 loading \u7684\u663e\u793a\u548c\u9690\u85cf\u3002"),(0,r.kt)("p",null,"\u5176\u4e2d Loading \u7ec4\u4ef6\u5373\u4e4b\u524d\u7f16\u5199\u7684\u4e24\u5706\u4ea4\u9519\u7684\u6d9f\u6f2a\u6548\u679c\u7ec4\u4ef6\uff0c\u4f46 LoadingV2 \u5e76\u6ca1\u6709\u7f16\u5199\uff0c\u73b0\u5728\u5c31\u82b1\u4e00\u70b9\u65f6\u95f4\u6765\u5f00\u53d1\u7b2c\u4e8c\u4e2a Loading \u6548\u679c\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"//baseUI/loading-v2/index.js\nimport React from 'react';\nimport styled, {keyframes} from'styled-components';\nimport style from '../../assets/global-style'\n\nconst dance = keyframes`\n    0%, 40%, 100%{\n      transform: scaleY (0.4);\n      transform-origin: center 100%;\n    }\n    20%{\n      transform: scaleY (1);\n    }\n`\nconst Loading = styled.div`\n    height: 10px;\n    width: 100%;\n    margin: auto;\n    text-align: center;\n    font-size: 10px;\n    >div {\n      display: inline-block;\n      background-color: ${style [\"theme-color\"]};\n      height: 100%;\n      width: 1px;\n      margin-right:2px;\n      animation: ${dance} 1s infinite;\n    }\n    >div:nth-child (2) {\n      animation-delay: -0.4s;\n    }\n    >div:nth-child (3) {\n      animation-delay: -0.6s;\n    }\n    >div:nth-child (4) {\n      animation-delay: -0.5s;\n    }\n    >div:nth-child (5) {\n      animation-delay: -0.2s;\n    } \n\n`\n\nfunction LoadingV2 () {\n  return (\n    <Loading>\n      <div></div>\n      <div></div>\n      <div></div>\n      <div></div>\n      <div></div>\n      <span > \u62fc\u547d\u52a0\u8f7d\u4e2d...</span>\n    </Loading>\n  );\n}\n \nexport default React.memo (LoadingV2);\n\n")),(0,r.kt)("p",null,"OK, \u73b0\u5728\u5728 scroll \u7ec4\u4ef6\u4e2d\u5f15\u5165\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"//scroll/index.js\nimport Loading2 from '../loading-v2/index';\n\n")),(0,r.kt)("p",null,"\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u5728 Singers/index.js \u4e2d\uff0c\u4f20\u5165\u76f8\u5e94\u7684\u53c2\u6570\u5373\u53ef\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"<Scroll\n  pullUp={ handlePullUp }\n  pullDown = { handlePullDown }\n  pullUpLoading = { pullUpLoading }\n  pullDownLoading = { pullDownLoading }\n>\n  { renderSingerList () }\n</Scroll>\n\n")),(0,r.kt)("p",null,"\u73b0\u5728 handlePullUp \u548c handlePullDown \u4e24\u4e2a\u65b9\u6cd5\u8fd8\u6ca1\u6709\u5b9a\u4e49\uff0c\u6dfb\u52a0\u5982\u4e0b:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"const handlePullUp = () => {\n  pullUpRefreshDispatch (category, alpha, category === '', pageCount);\n};\n\nconst handlePullDown = () => {\n  pullDownRefreshDispatch (category, alpha);\n};\n\n")),(0,r.kt)("p",null,"\u73b0\u5728\u8bd5\u4e00\u8bd5\u4e0a\u62c9\u4e0b\u62c9\uff0c\u76f8\u5e94\u7684 loading \u52a8\u753b\u80fd\u591f\u51fa\u73b0\u4e86\uff0c\u540c\u65f6\u6570\u636e\u4e5f\u80fd\u6b63\u5e38\u52a0\u8f7d\u3002 \u5bf9\u4e86\uff0c\u73b0\u5728\u8fdb\u573a\u7684 loading \u6548\u679c\u8fd8\u6ca1\u6709\u5b9e\u73b0\uff0c\u6211\u4eec\u5728 Singers/index.js \u4e2d\u52a0\u5165:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"import Loading from '../../baseUI/loading';\n//...\n//ListContainer \u6807\u7b7e\u4e2d\n<Loading show={enterLoading}></Loading>\n\n")),(0,r.kt)("p",null,"\u8fd9\u6837\uff0c\u5f53\u4f60\u7b2c\u4e00\u6b21\u6253\u5f00\u5217\u8868\u9875\u6216\u8005\u5207\u6362\u4e0d\u540c\u5206\u7c7b\u7684\u65f6\u5019\uff0c\u4f1a\u6709 loading \u6548\u679c\u51fa\u73b0\uff0c\u548c\u6211\u4eec\u7684\u9884\u671f\u4e00\u81f4\u3002"),(0,r.kt)("h2",{id:"\u76f8\u5173\u4f18\u5316"},"\u76f8\u5173\u4f18\u5316"),(0,r.kt)("h3",{id:"\u56fe\u7247\u61d2\u52a0\u8f7d"},"\u56fe\u7247\u61d2\u52a0\u8f7d"),(0,r.kt)("p",null,"\u540c\u6837\u662f\u5f15\u5165 react-lazyload, \u5728 Singers/index.js \u4f5c\u5982\u4e0b\u4fee\u6539:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'// \u9996\u5148\u5f15\u5165\nimport  LazyLoad, {forceCheck} from \'react-lazyload\';\n\n// \u5305\u88f9 img \u6807\u7b7e\n<LazyLoad placeholder={<img width="100%" height="100%" src={require (\'./singer.png\')} alt="music"/>}>\n  <img src={`${item.picUrl}?param=300x300`} width="100%" height="100%" alt="music"/>\n</LazyLoad>\n\n<Scroll\n  //...\n  onScroll={forceCheck}\n>\n</Scroll>\n\n')),(0,r.kt)("p",null,"\u73b0\u5728\u61d2\u52a0\u8f7d\u7684\u6548\u679c\u5c31\u5b8c\u6210\u4e86\u3002"),(0,r.kt)("h3",{id:"\u9632\u6296\u5904\u7406"},"\u9632\u6296\u5904\u7406"),(0,r.kt)("p",null,"\u5f53\u4f60\u9891\u7e41\u5730\u4e0b\u62c9\u65f6\uff0c\u4e8b\u5b9e\u4e0a\u4e8b\u4ef6\u56de\u8c03\u51fd\u6570\u4e5f\u4f1a\u88ab\u9891\u7e41\u89e6\u53d1\uff0c\u5bfc\u81f4\u53d1\u9001\u5f88\u591a\u65e0\u610f\u4e49\u7684\u8bf7\u6c42\u3002\u56e0\u6b64\u8fd9\u91cc\u5bf9 Scroll \u57fa\u7840\u7ec4\u4ef6\u505a\u4e00\u4e0b\u9632\u6296\u5904\u7406\u3002"),(0,r.kt)("p",null,"\u9632\u6296\u51fd\u6570\u5199\u5728 api/utils.js \u4e2d\uff0c"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"\n// \u9632\u6296\u51fd\u6570\nexport const debounce = (func, delay) => {\n  let timer;\n  return function (...args) {\n    if (timer) {\n      clearTimeout (timer);\n    }\n    timer = setTimeout (() => {\n      func.apply (this, args);\n      clearTimeout (timer);\n    }, delay);\n  }\n}\n\n")),(0,r.kt)("p",null,"\u7136\u540e\u5728 scroll/index.js \u4e2d:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'import { debounce } from "../../api/utils";\n\n//...\n\nlet pullUpDebounce = useMemo (() => {\n  return debounce (pullUp, 300)\n}, [pullUp]);\n// \u5343\u4e07\u6ce8\u610f\uff0c\u8fd9\u91cc\u4e0d\u80fd\u7701\u7565\u4f9d\u8d56\uff0c\n// \u4e0d\u7136\u62ff\u5230\u7684\u59cb\u7ec8\u662f\u7b2c\u4e00\u6b21 pullUp \u51fd\u6570\u7684\u5f15\u7528\uff0c\u76f8\u5e94\u7684\u95ed\u5305\u4f5c\u7528\u57df\u53d8\u91cf\u90fd\u662f\u7b2c\u4e00\u6b21\u7684\uff0c\u4ea7\u751f\u95ed\u5305\u9677\u9631\u3002\u4e0b\u540c\u3002\n\nlet pullDownDebounce = useMemo (() => {\n  return debounce (pullDown, 300)\n}, [pullDown]);\n//...\n// \u4e4b\u540e\u76f4\u63a5\u8c03\u7528 useMemo \u8fd4\u56de\u7684\u51fd\u6570\n// \u6ed1\u52a8\u5230\u5e95\u90e8\nif (bScroll.y <= bScroll.maxScrollY + 100){\n  pullUpDebounce ();\n}\n\n// \u5224\u65ad\u7528\u6237\u7684\u4e0b\u62c9\u52a8\u4f5c\nif (pos.y > 50) {\n  pullDownDebounce ();\n}\n\n')),(0,r.kt)("p",null,"\u8fd9\u6837\u5f53\u4f60\u9891\u7e41\u4e0a\u62c9\u4e0b\u62c9\u7684\u65f6\u5019\u5c31\u4e0d\u4f1a\u9891\u7e41\u89e6\u53d1\u56de\u8c03\u4e86\u3002"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"\u601d\u8003\u9898\uff1a\u5f53\u6211\u4eec\u5207\u6362\u7ec4\u4ef6\u7684\u65f6\u5019\uff0c\u4e8b\u5b9e\u4e0a\u73b0\u5728\u7684 category \u548c alpha \u4f1a\u4e22\u5931\uff0c\u5982\u679c\u60f3\u8981\u5207\u6362\u7ec4\u4ef6\u540e\u4ecd\u7136\u80fd\u591f\u7f13\u5b58 category \u548c alpha \u7684\u503c\u5e94\u8be5\u600e\u4e48\u505a\uff1f\u53ef\u4ee5\u81ea\u5df1\u52a8\u624b\u8bd5\u8bd5\u770b\u3002")))}s.isMDXComponent=!0}}]);