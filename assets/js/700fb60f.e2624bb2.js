(self.webpackChunkdapengdouyu=self.webpackChunkdapengdouyu||[]).push([[3816],{3905:function(e,n,t){"use strict";t.d(n,{Zo:function(){return u},kt:function(){return m}});var r=t(7294);function o(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function a(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function l(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?a(Object(t),!0).forEach((function(n){o(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):a(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function p(e,n){if(null==e)return{};var t,r,o=function(e,n){if(null==e)return{};var t,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)t=a[r],n.indexOf(t)>=0||(o[t]=e[t]);return o}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)t=a[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}var s=r.createContext({}),c=function(e){var n=r.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):l(l({},n),e)),t},u=function(e){var n=c(e.components);return r.createElement(s.Provider,{value:n},e.children)},i={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},d=r.forwardRef((function(e,n){var t=e.components,o=e.mdxType,a=e.originalType,s=e.parentName,u=p(e,["components","mdxType","originalType","parentName"]),d=c(t),m=o,b=d["".concat(s,".").concat(m)]||d[m]||i[m]||a;return t?r.createElement(b,l(l({ref:n},u),{},{components:t})):r.createElement(b,l({ref:n},u))}));function m(e,n){var t=arguments,o=n&&n.mdxType;if("string"==typeof e||o){var a=t.length,l=new Array(a);l[0]=d;var p={};for(var s in n)hasOwnProperty.call(n,s)&&(p[s]=n[s]);p.originalType=e,p.mdxType="string"==typeof e?e:o,l[1]=p;for(var c=2;c<a;c++)l[c]=t[c];return r.createElement.apply(null,l)}return r.createElement.apply(null,t)}d.displayName="MDXCreateElement"},5727:function(e,n,t){"use strict";t.r(n),t.d(n,{frontMatter:function(){return p},contentTitle:function(){return s},metadata:function(){return c},toc:function(){return u},default:function(){return d}});var r=t(4034),o=t(9973),a=(t(7294),t(3905)),l=["components"],p={},s=void 0,c={unversionedId:"books/babel/21\u3001\u5b9e\u6218\u6848\u4f8b: \u6a21\u5757\u904d\u5386\u5668",id:"books/babel/21\u3001\u5b9e\u6218\u6848\u4f8b: \u6a21\u5757\u904d\u5386\u5668",isDocsHomePage:!1,title:"21\u3001\u5b9e\u6218\u6848\u4f8b: \u6a21\u5757\u904d\u5386\u5668",description:"babel \u80fd\u591f\u505a\u9759\u6001\u5206\u6790\uff0c\u5206\u6790\u4ee3\u7801\u7136\u540e\u5f97\u51fa\u4e00\u4e9b\u4fe1\u606f\u3002\u6211\u4eec\u7ecf\u5e38\u7528\u7684\u6253\u5305\u5de5\u5177\u5c31\u9700\u8981\u901a\u8fc7\u9759\u6001\u5206\u6790\u7684\u65b9\u5f0f\u5f97\u51fa\u6a21\u5757\u95f4\u7684\u4f9d\u8d56\u5173\u7cfb\uff0c\u7136\u540e\u6784\u9020\u6210\u4f9d\u8d56\u56fe\uff0c\u4e4b\u540e\u5bf9\u8fd9\u4e2a\u4f9d\u8d56\u56fe\u505a\u5404\u79cd\u5904\u7406\uff0c\u6700\u540e\u8f93\u51fa\u6210\u6587\u4ef6\u3002",source:"@site/docs/books/babel/21\u3001\u5b9e\u6218\u6848\u4f8b: \u6a21\u5757\u904d\u5386\u5668.md",sourceDirName:"books/babel",slug:"/books/babel/21\u3001\u5b9e\u6218\u6848\u4f8b: \u6a21\u5757\u904d\u5386\u5668",permalink:"/docs/books/babel/21\u3001\u5b9e\u6218\u6848\u4f8b: \u6a21\u5757\u904d\u5386\u5668",editUrl:"https://github.com/dapengdouyu/docs/tree/master/docs/books/babel/21\u3001\u5b9e\u6218\u6848\u4f8b: \u6a21\u5757\u904d\u5386\u5668.md",version:"current",lastUpdatedAt:1633773412,formattedLastUpdatedAt:"10/9/2021",frontMatter:{},sidebar:"books",previous:{title:"20\u3001\u5b9e\u6218\u6848\u4f8b: js \u89e3\u91ca\u5668",permalink:"/docs/books/babel/20\u3001\u5b9e\u6218\u6848\u4f8b: js \u89e3\u91ca\u5668"},next:{title:"22\u3001Babel Macros",permalink:"/docs/books/babel/22\u3001Babel Macros"}},u=[{value:"\u601d\u8def\u5206\u6790",id:"\u601d\u8def\u5206\u6790",children:[]},{value:"\u4ee3\u7801\u5b9e\u73b0",id:"\u4ee3\u7801\u5b9e\u73b0",children:[]},{value:"\u6548\u679c\u6f14\u793a",id:"\u6548\u679c\u6f14\u793a",children:[]},{value:"\u603b\u7ed3",id:"\u603b\u7ed3",children:[]}],i={toc:u};function d(e){var n=e.components,t=(0,o.Z)(e,l);return(0,a.kt)("wrapper",(0,r.Z)({},i,t,{components:n,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"babel \u80fd\u591f\u505a\u9759\u6001\u5206\u6790\uff0c\u5206\u6790\u4ee3\u7801\u7136\u540e\u5f97\u51fa\u4e00\u4e9b\u4fe1\u606f\u3002\u6211\u4eec\u7ecf\u5e38\u7528\u7684\u6253\u5305\u5de5\u5177\u5c31\u9700\u8981\u901a\u8fc7\u9759\u6001\u5206\u6790\u7684\u65b9\u5f0f\u5f97\u51fa\u6a21\u5757\u95f4\u7684\u4f9d\u8d56\u5173\u7cfb\uff0c\u7136\u540e\u6784\u9020\u6210\u4f9d\u8d56\u56fe\uff0c\u4e4b\u540e\u5bf9\u8fd9\u4e2a\u4f9d\u8d56\u56fe\u505a\u5404\u79cd\u5904\u7406\uff0c\u6700\u540e\u8f93\u51fa\u6210\u6587\u4ef6\u3002"),(0,a.kt)("p",null,"\u6bd4\u5982 webpack \u7684\u6253\u5305\u8fc7\u7a0b\uff1a\u4ece\u5165\u53e3\u6a21\u5757\u5206\u6790\u4f9d\u8d56\uff0c\u6784\u9020\u6a21\u5757\u4f9d\u8d56\u56fe\uff0c\u7136\u540e\u628a\u4e00\u4e9b\u6a21\u5757\u5408\u5e76\u5230\u540c\u4e2a\u5206\u7ec4\uff08chunk\uff09\u91cc\uff0c\u751f\u6210 chunk \u4f9d\u8d56\u56fe\uff0c\u6700\u540e\u628a chunk \u901a\u8fc7\u6a21\u7248\u6253\u5370\u4e3a assets\uff0c\u8f93\u51fa\u4e3a\u6587\u4ef6\u3002"),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2ad6cc6cb7e84f3da779adf1f79a773d~tplv-k3u1fbpfcp-watermark.image",alt:null})),(0,a.kt)("p",null,"\u4ece\u5165\u53e3\u6a21\u5757\u5f00\u59cb\uff0c\u5bf9\u6bcf\u4e2a\u6a21\u5757\u7684\u4f9d\u8d56\u5173\u7cfb\u7684\u5206\u6790\u5c31\u662f\u57fa\u4e8e AST\uff0c\u8fd9\u79cd\u5c31\u53ef\u4ee5\u7528 babel parser \uff08\u6216\u8005\u76f4\u63a5\u7528 acorn\uff09\u6765\u5904\u7406\u3002"),(0,a.kt)("p",null,"\u8fd9\u4e00\u8282\u6211\u4eec\u5c31\u6765\u5b9e\u73b0\u4e0b\u4f9d\u8d56\u5206\u6790\u7684\u529f\u80fd\uff0c\u4e5f\u5c31\u662f\u904d\u5386\u6240\u6709\u7684\u6a21\u5757\u3002"),(0,a.kt)("p",null,"\u5199\u8fd9\u4e2a\u7684\u597d\u5904\u4e00\u4e2a\u662f\u80fd\u591f\u52a0\u6df1\u6211\u4eec\u5bf9\u6253\u5305\u5de5\u5177\u7684\u8ba4\u8bc6\uff0c\u4e8c\u662f\u5f53\u505a\u4e00\u4e9b\u72ec\u7acb\u7684\u5de5\u5177\u7684\u65f6\u5019\uff0c\u53ef\u80fd\u4e5f\u9700\u8981\u5206\u6790\u6a21\u5757\u4f9d\u8d56\u5173\u7cfb\u3002"),(0,a.kt)("h2",{id:"\u601d\u8def\u5206\u6790"},"\u601d\u8def\u5206\u6790"),(0,a.kt)("p",null,"\u6a21\u5757\u4f9d\u8d56\u5206\u6790\u4e5f\u5c31\u662f\u8981\u5206\u6790 import \u548c export\uff0c\u4ece\u5165\u53e3\u6a21\u5757\u5f00\u59cb\uff0c\u8bfb\u53d6\u6587\u4ef6\u5185\u5bb9\uff0c\u901a\u8fc7 babel parser \u628a\u5185\u5bb9 parse \u6210 ast\uff0c\u4e4b\u540e\u901a\u8fc7 babel traverse \u6765\u5bf9 AST \u8fdb\u884c\u904d\u5386\u3002\u5206\u522b\u5bf9 ImportDeclaration\u3001ExportDeclaration \u505a\u5904\u7406\uff1a"),(0,a.kt)("p",null,"ImportDeclaration\uff1a\u6536\u96c6 import \u4fe1\u606f\uff0c\u786e\u5b9a\u4f9d\u8d56\u7684\u6a21\u5757\u548c\u5f15\u5165\u7684\u53d8\u91cf\uff0c\u4e4b\u540e\u518d\u9012\u5f52\u5904\u7406\u8be5\u6a21\u5757 ExportDeclaration\uff1a\u6536\u96c6 export \u4fe1\u606f\uff0c\u786e\u5b9a\u5bfc\u51fa\u7684\u53d8\u91cf"),(0,a.kt)("p",null,"\u6211\u4eec\u53ef\u4ee5\u8bbe\u8ba1\u8fd9\u6837\u4e00\u4e2a\u7ed3\u6784\u6765\u8868\u793a\u6bcf\u4e2a\u6a21\u5757\u7684\u4fe1\u606f\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"class DependencyNode {\n    constructor(path = '', imports = {}, exports = []) {\n        this.path = path;\n        this.imports = imports;\n        this.exports = exports;\n        this.subModules = {};\n    }\n}\n")),(0,a.kt)("p",null,"path \u8868\u793a\u5f53\u524d\u6a21\u5757\u8def\u5f84\uff0c imports \u8868\u793a\u4ece\u4ec0\u4e48\u6a21\u5757\u5f15\u5165\u4e86\u4ec0\u4e48\u53d8\u91cf\uff0cexports \u8868\u793a\u5bfc\u51fa\u4e86\u4ec0\u4e48\u53d8\u91cf\u3002"),(0,a.kt)("p",null,"\u63a5\u4e0b\u6765\u6211\u4eec\u8981\u5b8c\u6210 traverseModule \u8fd9\u4e2a\u65b9\u6cd5\uff0c\u4e5f\u5c31\u662f\u5bf9\u6bcf\u4e2a\u6a21\u5757\u7684\u5904\u7406"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"const dependencyGraph = traverseModule(\u5165\u53e3\u6a21\u5757\u8def\u5f84);\n")),(0,a.kt)("p",null,"\u5177\u4f53\u5904\u7406\u7684\u8fc7\u7a0b\u5c31\u662f\uff1a"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"\u8bfb\u53d6\u6587\u4ef6\u5185\u5bb9"),(0,a.kt)("li",{parentName:"ul"},"\u901a\u8fc7 babel parser \u628a\u6587\u4ef6\u5185\u5bb9 parse \u6210 ast"),(0,a.kt)("li",{parentName:"ul"},"\u904d\u5386 AST\uff0c\u5bf9 ImportDeclaration\u3001ExportDeclaration \u5206\u522b\u505a\u5904\u7406"),(0,a.kt)("li",{parentName:"ul"},"\u5bf9\u5206\u6790\u51fa\u7684\u4f9d\u8d56\u8def\u5f84\u8fdb\u884c\u5904\u7406\uff0c\u53d8\u6210\u7edd\u5bf9\u8def\u5f84\uff0c\u5e76\u5c1d\u8bd5\u8865\u5168"),(0,a.kt)("li",{parentName:"ul"},"\u9012\u5f52\u5904\u7406\u5206\u6790\u51fa\u6765\u7684\u4f9d\u8d56\u8def\u5f84")),(0,a.kt)("p",null,"\u5982\u679c\u6ca1\u6709\u540e\u7f00\u540d\u7684\u4f9d\u8d56\u8def\u5f84\uff0c\u8981\u5206\u522b\u5c1d\u8bd5 .js\u3001.jsx\u3001.ts\u3001.tsx \u7684\u8def\u5f84\uff0c\u5982\u679c\u5b58\u5728\u5c31\u8865\u5168\u6210\u8be5\u8def\u5f84\uff0c\u5e76\u4e14\u76ee\u5f55\u8fd8\u8981\u8865\u5168 index \u6587\u4ef6\u540d\u3002"),(0,a.kt)("p",null,"\u901a\u8fc7\u9012\u5f52\u5904\u7406\u4f9d\u8d56\u6a21\u5757\uff0c\u5c31\u53ef\u4ee5\u5b8c\u6210\u4f9d\u8d56\u56fe\u7684\u6784\u5efa\uff0c\u6211\u4eec\u53ef\u4ee5\u4fdd\u5b58\u6839\u8282\u70b9\u548c\u6240\u6709\u6a21\u5757\u7684\u4fe1\u606f\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"const dependencyGraph = {\n    root: new DependencyNode(),\n    allModules: {}\n};\n")),(0,a.kt)("p",null,"\u5f53\u5904\u7406\u5b8c\u6240\u6709\u6a21\u5757\u540e\uff0c\u5c31\u5f97\u5230\u4e86\u5b8c\u6574\u7684 dependencyGraph\u3002"),(0,a.kt)("p",null,"\u63a5\u4e0b\u6765\u6211\u4eec\u6765\u5199\u4e0b\u4ee3\u7801\u3002"),(0,a.kt)("h2",{id:"\u4ee3\u7801\u5b9e\u73b0"},"\u4ee3\u7801\u5b9e\u73b0"),(0,a.kt)("p",null,"\u9996\u5148\u6211\u4eec\u5b9a\u4e49\u8981\u8fd4\u56de\u7684 dependencyGraph\uff0c"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"class DependencyNode {\n    constructor(path = '', imports = {}, exports = []) {\n        this.path = path;\n        this.imports = imports;\n        this.exports = exports;\n        this.subModules = {};\n    }\n}\n\nmodule.exports = function(curModulePath) {\n    const dependencyGraph = {\n        root: new DependencyNode(),\n        allModules: {}\n    };\n    traverseJsModule(curModulePath, dependencyGraph.root, dependencyGraph.allModules);\n    return dependencyGraph;\n}\n")),(0,a.kt)("p",null,"\u63a5\u4e0b\u6765\u5b9e\u73b0\u904d\u5386\u7684\u65b9\u6cd5\uff0c\u4e5f\u5c31\u662f\u4e4b\u524d\u5206\u6790\u7684 ",(0,a.kt)("strong",{parentName:"p"},"\u8bfb\u53d6\u6587\u4ef6\u5185\u5bb9\u3001parse \u6210 AST\u3001travese AST \u63d0\u53d6\u6a21\u5757\u4fe1\u606f\u548c\u4f9d\u8d56\u4fe1\u606f\u3001\u9012\u5f52\u904d\u5386\u4f9d\u8d56\uff08\u5148\u628a\u8def\u5f84\u5904\u7406\u6210\u7edd\u5bf9\u8def\u5f84\uff09")," \u7684\u8fc7\u7a0b\u3002"),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"\u8981\u6ce8\u610f\u7684\u662f\uff0cts\u3001jsx\u3001tsx \u7b49\u7528\u7684 babel \u63d2\u4ef6\u4e0d\u540c\uff0c\u8981\u6839\u636e extname \u6765\u505a\u4e0d\u540c\u7684\u63d2\u4ef6\u7684\u5f15\u5165\u3002")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"function resolveBabelSyntaxtPlugins(modulePath) {\n    const plugins = [];\n    if (['.tsx', '.jsx'].some(ext => modulePath.endsWith(ext))) {\n        plugins.push('jsx');\n    }\n    if (['.ts', '.tsx'].some(ext => modulePath.endsWith(ext))) {\n        plugins.push('typescript');\n    }\n    return plugins;\n}\n\nfunction traverseJsModule(curModulePath, dependencyGrapthNode, allModules) {\n    const moduleFileContent = fs.readFileSync(curModulePath, {\n        encoding: 'utf-8'\n    });\n    dependencyGrapthNode.path = curModulePath;\n\n    const ast = parser.parse(moduleFileContent, {\n        sourceType: 'unambiguous',\n        plugins: resolveBabelSyntaxtPlugins(curModulePath)\n    });\n\n    traverse(ast, {\n        ImportDeclaration(path) {\n            // \u6536\u96c6import \u4fe1\u606f\n            // \u9012\u5f52\u5904\u7406\u4f9d\u8d56\u6a21\u5757\n            traverseJsModule(subModulePath, subModule, allModules);\n            dependencyGrapthNode.subModules[subModule.path] = subModule;\n        },\n        ExportDeclaration(path) {\n            //\u6536\u96c6 export \u4fe1\u606f\n        }\n    });\n    allModules[curModulePath] = dependencyGrapthNode;\n}\n")),(0,a.kt)("p",null,"\u4e0a\u9762\u7701\u7565\u4e86\u5bf9 ImportDeclaration \u548c ExportDeclaration \u7684\u5904\u7406\uff0c\u63a5\u4e0b\u6765\u6211\u4eec\u6765\u5206\u522b\u5904\u7406\u4e0b\u8fd9\u4e24\u79cd\u8282\u70b9\uff1a"),(0,a.kt)("p",null,"ImportDeclaration \u5206\u4e3a\u4e09\u79cd\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"// \u8fd9\u79cd\u6211\u4eec\u53eb deconstruct import\uff08\u89e3\u6784\u5f15\u5165\uff09\nimport { a, b as bb} from 'aa';\n// \u8fd9\u79cd\u6211\u4eec\u53eb namespace import\uff08\u547d\u540d\u7a7a\u95f4\u5f15\u5165\uff09\nimport * as c from 'cc';\n// \u8fd9\u79cd\u6211\u4eec\u53eb default import\uff08\u9ed8\u8ba4\u5f15\u5165\uff09\nimport b from 'b';\n")),(0,a.kt)("p",null,"\u90a3\u4e48\u6211\u4eec\u5c31\u8981\u6839\u636e\u5177\u4f53\u7684\u7c7b\u578b\u6765\u63d0\u53d6\u4fe1\u606f\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"const IMPORT_TYPE = {\n    deconstruct: 'deconstruct',\n    default: 'default',\n    namespace: 'namespace'\n}\n\n\n ImportDeclaration(path) {\n    const subModulePath = moduleResolver(curModulePath, path.get('source.value').node);\n    if (!subModulePath) {\n        return;\n    }\n\n    const specifierPaths = path.get('specifiers');\n    dependencyGrapthNode.imports[subModulePath] = specifierPaths.map(specifierPath => {\n        if (specifierPath.isImportSpecifier()) {\n            return {\n                type: IMPORT_TYPE.deconstruct,\n                imported: specifierPath.get('imported').node.name,\n                local: specifierPath.get('local').node.name\n            }\n        } else if (specifierPath.isImportDefaultSpecifier()) {\n            return {\n                type: IMPORT_TYPE.default,\n                local: specifierPath.get('local').node.name\n            }\n        } else {\n            return {\n                type: IMPORT_TYPE.namespace,\n                local: specifierPath.get('local').node.name\n            }\n        }\n    });\n\n    const subModule = new DependencyNode();\n    traverseJsModule(subModulePath, subModule, allModules);\n    dependencyGrapthNode.subModules[subModule.path] = subModule;\n}\n")),(0,a.kt)("p",null,"\u4e0a\u9762\u6211\u4eec\u901a\u8fc7\u8bb0\u5f55\u4e86 import \u4fe1\u606f\u5230 dependencyGrapthNode.imports \u4e2d\uff0c\u5e76\u4e14\u9012\u5f52\u5904\u7406\u4e86\u4f9d\u8d56\u6a21\u5757\u3002\u800c\u4e14\u5728\u5904\u7406\u4f9d\u8d56\u6a21\u5757\u4e4b\u524d\uff0c\u6211\u4eec\u505a\u4e86\u628a\u8def\u5f84\u8f6c\u6210\u7edd\u5bf9\u8def\u5f84\u548c\u8def\u5f84\u8865\u5168\u7684\u5904\u7406\u3002"),(0,a.kt)("p",null,"\u8def\u5f84\u8865\u5168\u7684\u5904\u7406\u5c31\u662f\u5206\u522b\u5c1d\u8bd5 .tsx,.ts,.jsx,.js\u7684\u8def\u5f84\u662f\u5426\u5b58\u5728\uff0c\u5982\u679c\u662f\u76ee\u5f55\u7684\u8bdd\uff0c\u8fd8\u8981\u8fde\u540c index \u4e00\u8d77\u8865\u5168\uff0c\u4e5f\u5c31\u662f index.tsx\u3001index.ts\u3001index.jsx\u3001index.js"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"function completeModulePath (modulePath) {\n    const EXTS = ['.tsx','.ts','.jsx','.js'];\n    if (modulePath.match(/\\.[a-zA-Z]+$/)) {\n        return modulePath;\n    }\n\n    function tryCompletePath (resolvePath) {\n        for (let i = 0; i < EXTS.length; i ++) {\n            let tryPath = resolvePath(EXTS[i]);\n            if (fs.existsSync(tryPath)) {\n                return tryPath;\n            }\n        }\n    }\n\n    function reportModuleNotFoundError (modulePath) {\n        throw 'module not found: ' + modulePath;\n    }\n\n    if (isDirectory(modulePath)) {//\u5982\u679c\u662f\u76ee\u5f55\n        const tryModulePath = tryCompletePath((ext) => path.join(modulePath, 'index' + ext));\n        if (!tryModulePath) {\n            reportModuleNotFoundError(modulePath);\n        } else {\n            return tryModulePath;\n        }\n    } else if (!EXTS.some(ext => modulePath.endsWith(ext))) {//\u5982\u679c\u8865\u5168\u540e\u7684\u8def\u5f84\u5b58\u5728\n        const tryModulePath = tryCompletePath((ext) => modulePath + ext);\n        if (!tryModulePath) {\n            reportModuleNotFoundError(modulePath);\n        } else {\n            return tryModulePath;\n        }\n    }\n    return modulePath;\n}\n")),(0,a.kt)("p",null,"\u5f53\u7136\uff0c\u6211\u4eec\u8fd8\u8981\u6536\u96c6\u4e0b export \u7684\u4fe1\u606f\uff0c\u4e5f\u662f\u5206\u4e3a\u4e09\u79cd\u7c7b\u578b\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"// \u5168\u90e8\u5bfc\u51fa(all export)\nexport * from 'a';\n// \u9ed8\u8ba4\u5bfc\u51fa (default export)\nexport default b;\n// \u547d\u540d\u5bfc\u51fa (named export)\nexport { c as cc };\n")),(0,a.kt)("p",null,"\u7136\u540e\u5206\u522b\u5bf9\u8fd9\u4e09\u79cd AST \u505a\u4e0d\u540c\u7684\u4fe1\u606f\u6536\u96c6\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"ExportDeclaration(path) {\n    if(path.isExportNamedDeclaration()) {\n        const specifiers = path.get('specifiers');\n        dependencyGrapthNode.exports = specifiers.map(specifierPath => ({\n            type: EXPORT_TYPE.named,\n            exported: specifierPath.get('exported').node.name,\n            local: specifierPath.get('local').node.name\n        }));\n    } else if (path.isExportDefaultDeclaration()) {\n        let exportName;\n        const declarationPath = path.get('declaration');\n        if(declarationPath.isAssignmentExpression()) {\n            exportName = declarationPath.get('left').toString();\n        } else {\n            exportName = declarationPath.toString()\n        }\n        dependencyGrapthNode.exports.push({\n            type: EXPORT_TYPE.default,\n            exported: exportName\n        });\n    } else {\n        dependencyGrapthNode.exports.push({\n            type: EXPORT_TYPE.all,\n            exported: path.get('exported').node.name,\n            source: path.get('source').node.value\n        });\n    }\n}\n")),(0,a.kt)("p",null,"\u9012\u5f52\u5904\u7406\u6bcf\u4e00\u4e2a\u6a21\u5757\u5c31\u5b8c\u6210\u4e86\u4f9d\u8d56\u56fe\u7684\u6784\u5efa\u3002"),(0,a.kt)("h2",{id:"\u6548\u679c\u6f14\u793a"},"\u6548\u679c\u6f14\u793a"),(0,a.kt)("p",null,"\u9996\u5148\u6211\u4eec\u5199\u4e00\u4e2a\u6d4b\u8bd5\u9879\u76ee\uff1a"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"index.js")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"import { aa1, aa2 } from './a';\n\nconsole.log(aa1);\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"a.js")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"import b from './b';\n\nconst aa1 = 1;\nconst aa2 = 2;\n\nconsole.log(b);\n\nexport {\n    aa1,\n    aa2\n}\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"b.js")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"import { cc  as renamedCc } from './c';\n \nexport default b = 4;\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"c/index.js")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"const cc = 5;\n\nexport {\n    cc\n};\n")),(0,a.kt)("p",null,"\u7136\u540e\u4f7f\u7528 traverseModule \u65b9\u6cd5\u5bf9\u5165\u53e3\u6a21\u5757 index \u8fdb\u884c\u5904\u7406\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"const traverseModule = require('./traverseModule');\nconst path = require('path');\n\nconst dependencyGraph = traverseModule(path.resolve(__dirname, '../test-project/index.js'));\nconsole.log(JSON.stringify(dependencyGraph, null, 4));\n")),(0,a.kt)("p",null,"\u7ed3\u679c\u5982\u4e0b\uff0c\u6211\u4eec\u6210\u529f\u6784\u5efa\u51fa\u4e86\u6574\u4e2a\u4f9d\u8d56\u56fe\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},'{\n    "root": {\n        "path": "/Users/guang/code/babel-plugin-exercize/exercize-module-iterator/test-project/index.js",\n        "imports": {\n            "/Users/guang/code/babel-plugin-exercize/exercize-module-iterator/test-project/a.js": [\n                {\n                    "type": "deconstruct",\n                    "imported": "aa1",\n                    "local": "aa1"\n                },\n                {\n                    "type": "deconstruct",\n                    "imported": "aa2",\n                    "local": "aa2"\n                }\n            ]\n        },\n        "exports": [],\n        "subModules": {\n            "/Users/guang/code/babel-plugin-exercize/exercize-module-iterator/test-project/a.js": {\n                "path": "/Users/guang/code/babel-plugin-exercize/exercize-module-iterator/test-project/a.js",\n                "imports": {\n                    "/Users/guang/code/babel-plugin-exercize/exercize-module-iterator/test-project/b.js": [\n                        {\n                            "type": "default",\n                            "local": "b"\n                        }\n                    ]\n                },\n                "exports": [\n                    {\n                        "type": "named",\n                        "exported": "aa1",\n                        "local": "aa1"\n                    },\n                    {\n                        "type": "named",\n                        "exported": "aa2",\n                        "local": "aa2"\n                    }\n                ],\n                "subModules": {\n                    "/Users/guang/code/babel-plugin-exercize/exercize-module-iterator/test-project/b.js": {\n                        "path": "/Users/guang/code/babel-plugin-exercize/exercize-module-iterator/test-project/b.js",\n                        "imports": {\n                            "/Users/guang/code/babel-plugin-exercize/exercize-module-iterator/test-project/c/index.js": [\n                                {\n                                    "type": "deconstruct",\n                                    "imported": "cc",\n                                    "local": "renamedCc"\n                                }\n                            ]\n                        },\n                        "exports": [\n                            {\n                                "type": "default",\n                                "exported": "b"\n                            }\n                        ],\n                        "subModules": {\n                            "/Users/guang/code/babel-plugin-exercize/exercize-module-iterator/test-project/c/index.js": {\n                                "path": "/Users/guang/code/babel-plugin-exercize/exercize-module-iterator/test-project/c/index.js",\n                                "imports": {},\n                                "exports": [\n                                    {\n                                        "type": "named",\n                                        "exported": "cc",\n                                        "local": "cc"\n                                    }\n                                ],\n                                "subModules": {}\n                            }\n                        }\n                    }\n                }\n            }\n        }\n    },\n    "allModules": {\n        "/Users/guang/code/babel-plugin-exercize/exercize-module-iterator/test-project/c/index.js": {\n            "path": "/Users/guang/code/babel-plugin-exercize/exercize-module-iterator/test-project/c/index.js",\n            "imports": {},\n            "exports": [\n                {\n                    "type": "named",\n                    "exported": "cc",\n                    "local": "cc"\n                }\n            ],\n            "subModules": {}\n        },\n        "/Users/guang/code/babel-plugin-exercize/exercize-module-iterator/test-project/b.js": {\n            "path": "/Users/guang/code/babel-plugin-exercize/exercize-module-iterator/test-project/b.js",\n            "imports": {\n                "/Users/guang/code/babel-plugin-exercize/exercize-module-iterator/test-project/c/index.js": [\n                    {\n                        "type": "deconstruct",\n                        "imported": "cc",\n                        "local": "renamedCc"\n                    }\n                ]\n            },\n            "exports": [\n                {\n                    "type": "default",\n                    "exported": "b"\n                }\n            ],\n            "subModules": {\n                "/Users/guang/code/babel-plugin-exercize/exercize-module-iterator/test-project/c/index.js": {\n                    "path": "/Users/guang/code/babel-plugin-exercize/exercize-module-iterator/test-project/c/index.js",\n                    "imports": {},\n                    "exports": [\n                        {\n                            "type": "named",\n                            "exported": "cc",\n                            "local": "cc"\n                        }\n                    ],\n                    "subModules": {}\n                }\n            }\n        },\n        "/Users/guang/code/babel-plugin-exercize/exercize-module-iterator/test-project/a.js": {\n            "path": "/Users/guang/code/babel-plugin-exercize/exercize-module-iterator/test-project/a.js",\n            "imports": {\n                "/Users/guang/code/babel-plugin-exercize/exercize-module-iterator/test-project/b.js": [\n                    {\n                        "type": "default",\n                        "local": "b"\n                    }\n                ]\n            },\n            "exports": [\n                {\n                    "type": "named",\n                    "exported": "aa1",\n                    "local": "aa1"\n                },\n                {\n                    "type": "named",\n                    "exported": "aa2",\n                    "local": "aa2"\n                }\n            ],\n            "subModules": {\n                "/Users/guang/code/babel-plugin-exercize/exercize-module-iterator/test-project/b.js": {\n                    "path": "/Users/guang/code/babel-plugin-exercize/exercize-module-iterator/test-project/b.js",\n                    "imports": {\n                        "/Users/guang/code/babel-plugin-exercize/exercize-module-iterator/test-project/c/index.js": [\n                            {\n                                "type": "deconstruct",\n                                "imported": "cc",\n                                "local": "renamedCc"\n                            }\n                        ]\n                    },\n                    "exports": [\n                        {\n                            "type": "default",\n                            "exported": "b"\n                        }\n                    ],\n                    "subModules": {\n                        "/Users/guang/code/babel-plugin-exercize/exercize-module-iterator/test-project/c/index.js": {\n                            "path": "/Users/guang/code/babel-plugin-exercize/exercize-module-iterator/test-project/c/index.js",\n                            "imports": {},\n                            "exports": [\n                                {\n                                    "type": "named",\n                                    "exported": "cc",\n                                    "local": "cc"\n                                }\n                            ],\n                            "subModules": {}\n                        }\n                    }\n                }\n            }\n        },\n        "/Users/guang/code/babel-plugin-exercize/exercize-module-iterator/test-project/index.js": {\n            "path": "/Users/guang/code/babel-plugin-exercize/exercize-module-iterator/test-project/index.js",\n            "imports": {\n                "/Users/guang/code/babel-plugin-exercize/exercize-module-iterator/test-project/a.js": [\n                    {\n                        "type": "deconstruct",\n                        "imported": "aa1",\n                        "local": "aa1"\n                    },\n                    {\n                        "type": "deconstruct",\n                        "imported": "aa2",\n                        "local": "aa2"\n                    }\n                ]\n            },\n            "exports": [],\n            "subModules": {\n                "/Users/guang/code/babel-plugin-exercize/exercize-module-iterator/test-project/a.js": {\n                    "path": "/Users/guang/code/babel-plugin-exercize/exercize-module-iterator/test-project/a.js",\n                    "imports": {\n                        "/Users/guang/code/babel-plugin-exercize/exercize-module-iterator/test-project/b.js": [\n                            {\n                                "type": "default",\n                                "local": "b"\n                            }\n                        ]\n                    },\n                    "exports": [\n                        {\n                            "type": "named",\n                            "exported": "aa1",\n                            "local": "aa1"\n                        },\n                        {\n                            "type": "named",\n                            "exported": "aa2",\n                            "local": "aa2"\n                        }\n                    ],\n                    "subModules": {\n                        "/Users/guang/code/babel-plugin-exercize/exercize-module-iterator/test-project/b.js": {\n                            "path": "/Users/guang/code/babel-plugin-exercize/exercize-module-iterator/test-project/b.js",\n                            "imports": {\n                                "/Users/guang/code/babel-plugin-exercize/exercize-module-iterator/test-project/c/index.js": [\n                                    {\n                                        "type": "deconstruct",\n                                        "imported": "cc",\n                                        "local": "renamedCc"\n                                    }\n                                ]\n                            },\n                            "exports": [\n                                {\n                                    "type": "default",\n                                    "exported": "b"\n                                }\n                            ],\n                            "subModules": {\n                                "/Users/guang/code/babel-plugin-exercize/exercize-module-iterator/test-project/c/index.js": {\n                                    "path": "/Users/guang/code/babel-plugin-exercize/exercize-module-iterator/test-project/c/index.js",\n                                    "imports": {},\n                                    "exports": [\n                                        {\n                                            "type": "named",\n                                            "exported": "cc",\n                                            "local": "cc"\n                                        }\n                                    ],\n                                    "subModules": {}\n                                }\n                            }\n                        }\n                    }\n                }\n            }\n        }\n    }\n}\n')),(0,a.kt)("p",null,"\u6709\u4e86\u4f9d\u8d56\u56fe\u4e4b\u540e\uff0c\u5c31\u53ef\u4ee5\u505a\u8fdb\u4e00\u6b65\u7684\u5904\u7406\uff0c\u6bd4\u5982\uff1a"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"\u5408\u5e76\u4e00\u4e9b\u6a21\u5757\u6210 chunk graph"),(0,a.kt)("li",{parentName:"ul"},"\u901a\u8fc7 export \u548c import \u7684\u5173\u7cfb\u7684\u5206\u6790\uff0c\u5b9e\u73b0 treeshking")),(0,a.kt)("h2",{id:"\u603b\u7ed3"},"\u603b\u7ed3"),(0,a.kt)("p",null,"\u6253\u5305\u5de5\u5177 webpack \u5c31\u662f\u57fa\u4e8e AST \u6765\u505a\u7684\u4f9d\u8d56\u5206\u6790\uff0c\u901a\u8fc7\u6784\u5efa\u6a21\u5757\u4f9d\u8d56\u56fe\uff0c\u4e4b\u540e\u8fdb\u4e00\u6b65\u7684\u5904\u7406\u3002\u8fd9\u8282\u6211\u4eec\u57fa\u4e8e babel parser \u548c babel traverse \u505a\u4e86\u6a21\u5757\u7684\u904d\u5386\u548c\u4f9d\u8d56\u56fe\u7684\u751f\u6210\u3002"),(0,a.kt)("p",null,"\u6bcf\u4e2a\u6a21\u5757\u7684\u5904\u7406\u90fd\u662f ",(0,a.kt)("strong",{parentName:"p"},"\u8bfb\u53d6\u5185\u5bb9\u3001parse\u3001\u904d\u5386 AST\u63d0\u53d6 import \u548c export \u4fe1\u606f\u3001\u9012\u5f52\u904d\u5386\u4f9d\u8d56")," \u7684\u8fc7\u7a0b\u3002"),(0,a.kt)("p",null,"\u5176\u4e2d\u8981\u6ce8\u610f\u7684\u662fparse \u7684\u63d2\u4ef6\u8981\u6839\u636e\u540e\u7f00\u540d\u6765\u51b3\u5b9a\uff0c\u8def\u5f84\u8981\u505a\u4e0b\u8865\u5168\u3002"),(0,a.kt)("p",null,"\u904d\u5386 AST \u662f\u8981\u786e\u5b9a\u4ec0\u4e48\u5c5e\u6027\uff0c\u904d\u5386\u6a21\u5757\u5219\u662f\u8981\u89e3\u6790 require\uff0c\u7136\u540e\u5904\u7406\u8def\u5f84\u3002"),(0,a.kt)("p",null,"\u4f9d\u8d56\u56fe\u5206\u6790\u5b8c\u4e4b\u540e\u5c31\u53ef\u4ee5\u505a\u8fdb\u4e00\u6b65\u7684\u5904\u7406\uff0c\u6bd4\u5982\u5408\u5e76 chunk\u3001treeshking \u7b49\uff0c\u7136\u540e\u8f93\u51fa\u6210\u6587\u4ef6\uff0c\u8fd9\u5c31\u662f\u6253\u5305\u5de5\u5177\u3002"),(0,a.kt)("p",null,"\uff08\u4ee3\u7801\u5728",(0,a.kt)("a",{parentName:"p",href:"https://github.com/QuarkGluonPlasma/babel-plugin-exercize"},"\u8fd9\u91cc"),"\uff0c\u5efa\u8bae git clone \u4e0b\u6765\u901a\u8fc7 node \u8dd1\u4e00\u4e0b\uff09"))}d.isMDXComponent=!0}}]);