"use strict";(self.webpackChunkdapengdouyu=self.webpackChunkdapengdouyu||[]).push([[2829],{3905:function(e,t,n){n.d(t,{Zo:function(){return c},kt:function(){return m}});var a=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var u=a.createContext({}),s=function(e){var t=a.useContext(u),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},c=function(e){var t=s(e.components);return a.createElement(u.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},p=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,u=e.parentName,c=i(e,["components","mdxType","originalType","parentName"]),p=s(n),m=r,k=p["".concat(u,".").concat(m)]||p[m]||d[m]||o;return n?a.createElement(k,l(l({ref:t},c),{},{components:n})):a.createElement(k,l({ref:t},c))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,l=new Array(o);l[0]=p;var i={};for(var u in t)hasOwnProperty.call(t,u)&&(i[u]=t[u]);i.originalType=e,i.mdxType="string"==typeof e?e:r,l[1]=i;for(var s=2;s<o;s++)l[s]=n[s];return a.createElement.apply(null,l)}return a.createElement.apply(null,n)}p.displayName="MDXCreateElement"},71462:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return i},contentTitle:function(){return u},metadata:function(){return s},toc:function(){return c},default:function(){return p}});var a=n(83117),r=n(80102),o=(n(67294),n(3905)),l=["components"],i={},u="useState",s={unversionedId:"program/react/3\u3001useState",id:"program/react/3\u3001useState",title:"useState",description:"- useState \u5c31\u662f\u4e00\u4e2a Hook",source:"@site/docs/program/react/3\u3001useState.md",sourceDirName:"program/react",slug:"/program/react/3\u3001useState",permalink:"/docs/program/react/3\u3001useState",editUrl:"https://github.com/dapengdouyu/docs/tree/master/docs/program/react/3\u3001useState.md",tags:[],version:"current",lastUpdatedAt:1639467634,formattedLastUpdatedAt:"12/14/2021",frontMatter:{},sidebar:"program",previous:{title:"React Hooks",permalink:"/docs/program/react/2\u3001react-hooks"},next:{title:"\u4ec0\u4e48\u662f React?",permalink:"/docs/program/react/"}},c=[{value:"useState \u521d\u8bd5",id:"usestate-\u521d\u8bd5",children:[],level:2},{value:"\u6bcf\u6b21\u6e32\u67d3\u90fd\u662f\u72ec\u7acb\u7684<code>\u95ed\u5305</code>",id:"\u6bcf\u6b21\u6e32\u67d3\u90fd\u662f\u72ec\u7acb\u7684\u95ed\u5305",children:[],level:2},{value:"\u60f0\u6027\u521d\u59cb <code>state</code>",id:"\u60f0\u6027\u521d\u59cb-state",children:[],level:2},{value:"\u6027\u80fd\u4f18\u5316",id:"\u6027\u80fd\u4f18\u5316",children:[{value:"\u8df3\u8fc7 <code>state</code> \u66f4\u65b0",id:"\u8df3\u8fc7-state-\u66f4\u65b0",children:[],level:3},{value:"\u51cf\u5c11\u6e32\u67d3\u6b21\u6570",id:"\u51cf\u5c11\u6e32\u67d3\u6b21\u6570",children:[],level:3}],level:2},{value:"<code>PureComponent</code>\u7684\u5b9e\u73b0",id:"purecomponent\u7684\u5b9e\u73b0",children:[],level:2},{value:"<code>memo</code> \u7684\u5b9e\u73b0",id:"memo-\u7684\u5b9e\u73b0",children:[],level:2},{value:"<code>useRef</code>\u7684\u5b9e\u73b0",id:"useref\u7684\u5b9e\u73b0",children:[],level:2},{value:"<code>render</code> \u7684\u5b9e\u73b0",id:"render-\u7684\u5b9e\u73b0",children:[],level:2},{value:"<code>useState</code>\u7684\u5b9e\u73b0",id:"usestate\u7684\u5b9e\u73b0",children:[{value:"<code>useMemo</code>\u7684\u5b9e\u73b0",id:"usememo\u7684\u5b9e\u73b0",children:[],level:3}],level:2},{value:"<code>useCallback</code>\u7684\u5b9e\u73b0",id:"usecallback\u7684\u5b9e\u73b0",children:[],level:2},{value:"useReducer",id:"usereducer",children:[],level:2},{value:"useReducer \u7684\u5b9e\u73b0",id:"usereducer-\u7684\u5b9e\u73b0",children:[],level:2},{value:"useContext",id:"usecontext",children:[],level:2}],d={toc:c};function p(e){var t=e.components,n=(0,r.Z)(e,l);return(0,o.kt)("wrapper",(0,a.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"usestate"},"useState"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"useState")," \u5c31\u662f\u4e00\u4e2a ",(0,o.kt)("inlineCode",{parentName:"li"},"Hook")),(0,o.kt)("li",{parentName:"ul"},"\u901a\u8fc7\u5728\u51fd\u6570\u7ec4\u4ef6\u91cc\u8c03\u7528\u5b83\u6765\u7ed9\u7ec4\u4ef6\u6dfb\u52a0\u4e00\u4e9b\u5185\u90e8",(0,o.kt)("inlineCode",{parentName:"li"},"state"),",",(0,o.kt)("inlineCode",{parentName:"li"},"React")," \u4f1a\u5728\u91cd\u590d\u6e32\u67d3\u65f6\u4fdd\u7559\u8fd9\u4e2a",(0,o.kt)("inlineCode",{parentName:"li"},"state")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"useState")," \u4f1a\u8fd4\u56de\u4e00\u5bf9\u503c\uff1a\u5f53\u524d\u72b6\u6001\u548c\u4e00\u4e2a\u8ba9\u4f60\u66f4\u65b0\u5b83\u7684\u51fd\u6570\uff0c\u4f60\u53ef\u4ee5\u5728\u4e8b\u4ef6\u5904\u7406\u51fd\u6570\u4e2d\u6216\u5176\u4ed6\u4e00\u4e9b\u5730\u65b9\u8c03\u7528\u8fd9\u4e2a\u51fd\u6570\u3002\u5b83\u7c7b\u4f3c class \u7ec4\u4ef6\u7684 this.setState\uff0c\u4f46\u662f\u5b83\u4e0d\u4f1a\u628a\u65b0\u7684 state \u548c\u65e7\u7684 state \u8fdb\u884c\u5408\u5e76"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"useState")," \u552f\u4e00\u7684\u53c2\u6570\u5c31\u662f",(0,o.kt)("inlineCode",{parentName:"li"},"\u521d\u59cb state")),(0,o.kt)("li",{parentName:"ul"},"\u8fd4\u56de\u4e00\u4e2a ",(0,o.kt)("inlineCode",{parentName:"li"},"state"),"\uff0c\u4ee5\u53ca\u66f4\u65b0 ",(0,o.kt)("inlineCode",{parentName:"li"},"state")," \u7684\u51fd\u6570",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},"\u5728\u521d\u59cb\u6e32\u67d3\u671f\u95f4\uff0c\u8fd4\u56de\u7684\u72b6\u6001 ",(0,o.kt)("inlineCode",{parentName:"li"},"(state)")," \u4e0e\u4f20\u5165\u7684\u7b2c\u4e00\u4e2a\u53c2\u6570 ",(0,o.kt)("inlineCode",{parentName:"li"},"(initialState)"),"\u503c\u76f8\u540c"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"setState")," \u51fd\u6570\u7528\u4e8e\u66f4\u65b0 ",(0,o.kt)("inlineCode",{parentName:"li"},"state"),"\u3002\u5b83\u63a5\u6536\u4e00\u4e2a\u65b0\u7684 ",(0,o.kt)("inlineCode",{parentName:"li"},"state")," \u503c\u5e76\u5c06\u7ec4\u4ef6\u7684\u4e00\u6b21",(0,o.kt)("inlineCode",{parentName:"li"},"\u91cd\u65b0\u6e32\u67d3"),"\u52a0\u5165\u961f\u5217")))),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"const [state, setState] = useState(initialState);\n")),(0,o.kt)("h2",{id:"usestate-\u521d\u8bd5"},"useState \u521d\u8bd5"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"function Counter() {\n  const [number, setNumber] = useState(0);\n  return (\n    <>\n      <h1 onClick={() => setNumber((x) => x + 1)}>{number}</h1>\n      <h1 onClick={() => setNumber(number + 1)}>{number}</h1>\n    </>\n  );\n}\n")),(0,o.kt)("h2",{id:"\u6bcf\u6b21\u6e32\u67d3\u90fd\u662f\u72ec\u7acb\u7684\u95ed\u5305"},"\u6bcf\u6b21\u6e32\u67d3\u90fd\u662f\u72ec\u7acb\u7684",(0,o.kt)("inlineCode",{parentName:"h2"},"\u95ed\u5305")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"\u6bcf\u4e00\u6b21\u6e32\u67d3\u90fd\u6709\u5b83\u81ea\u5df1\u7684 ",(0,o.kt)("inlineCode",{parentName:"li"},"Props")," and ",(0,o.kt)("inlineCode",{parentName:"li"},"State")),(0,o.kt)("li",{parentName:"ul"},"\u6bcf\u4e00\u6b21\u6e32\u67d3\u90fd\u6709\u5b83\u81ea\u5df1\u7684",(0,o.kt)("inlineCode",{parentName:"li"},"\u4e8b\u4ef6\u5904\u7406\u51fd\u6570")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"alert")," \u4f1a",(0,o.kt)("inlineCode",{parentName:"li"},"\u201c\u6355\u83b7\u201d"),"\u6211\u70b9\u51fb\u6309\u94ae\u65f6\u5019\u7684",(0,o.kt)("inlineCode",{parentName:"li"},"\u72b6\u6001"),"\u3002"),(0,o.kt)("li",{parentName:"ul"},"\u6211\u4eec\u7684\u7ec4\u4ef6\u51fd\u6570\u6bcf\u6b21\u6e32\u67d3\u90fd\u4f1a\u88ab\u8c03\u7528\uff0c\u4f46\u662f\u6bcf\u4e00\u6b21\u8c03\u7528\u4e2d",(0,o.kt)("inlineCode",{parentName:"li"},"number"),"\u503c\u90fd\u662f\u5e38\u91cf\uff0c\u5e76\u4e14\u5b83\u88ab\u8d4b\u4e88\u4e86\u5f53\u524d\u6e32\u67d3\u4e2d\u7684\u72b6\u6001\u503c"),(0,o.kt)("li",{parentName:"ul"},"\u5728\u5355\u6b21\u6e32\u67d3\u7684\u8303\u56f4\u5185\uff0c",(0,o.kt)("inlineCode",{parentName:"li"},"props")," \u548c ",(0,o.kt)("inlineCode",{parentName:"li"},"state")," \u59cb\u7ec8\u4fdd\u6301\u4e0d\u53d8"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://overreacted.io/zh-hans/making-setinterval-declarative-with-react-hooks/"},"making-setinterval-declarative-with-react-hooks"))),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"// \u5982\u4f55\u518d\u5f02\u6b65\u4e2d\u62ff\u5230\u6700\u65b0\u7684\u503c\nfunction Counter() {\n  const [number, setNumber] = useState(0);\n  const savedCallback = useRef();\n  function alertNumber() {\n    setTimeout(() => {\n      alert(savedCallback.current);\n    }, 3000);\n  }\n  return (\n    <>\n      <p>{number}</p>\n      <button\n        onClick={() => {\n          setNumber(number + 1);\n          savedCallback.current = number + 1;\n        }}\n      >\n        +\n      </button>\n      <button onClick={alertNumber}>alertNumber</button>\n    </>\n  );\n}\n")),(0,o.kt)("h2",{id:"\u60f0\u6027\u521d\u59cb-state"},"\u60f0\u6027\u521d\u59cb ",(0,o.kt)("inlineCode",{parentName:"h2"},"state")),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"initialState"),"\u53c2\u6570\u53ea\u4f1a\u5728\u7ec4\u4ef6\u7684",(0,o.kt)("inlineCode",{parentName:"p"},"\u521d\u59cb\u6e32\u67d3\u4e2d"),"\u8d77\u4f5c\u7528\uff0c\u540e\u7eed\u6e32\u67d3\u65f6\u4f1a\u88ab",(0,o.kt)("inlineCode",{parentName:"p"},"\u5ffd\u7565"),"\u3002\u5982\u679c\u521d\u59cb ",(0,o.kt)("inlineCode",{parentName:"p"},"state")," \u9700\u8981\u901a\u8fc7",(0,o.kt)("inlineCode",{parentName:"p"},"\u590d\u6742\u8ba1\u7b97"),"\u83b7\u5f97\uff0c\u5219\u53ef\u4ee5\u4f20\u5165\u4e00\u4e2a",(0,o.kt)("inlineCode",{parentName:"p"},"\u51fd\u6570"),"\uff0c\u5728\u51fd\u6570\u4e2d\u8ba1\u7b97\u5e76\u8fd4\u56de\u521d\u59cb\u7684 ",(0,o.kt)("inlineCode",{parentName:"p"},"state"),"\uff0c\u6b64\u51fd\u6570\u53ea\u5728",(0,o.kt)("inlineCode",{parentName:"p"},"\u521d\u59cb\u6e32\u67d3"),"\u65f6",(0,o.kt)("inlineCode",{parentName:"p"},"\u88ab\u8c03\u7528"),"\uff1a"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"const [state, setState] = useState(() => {\n  const initialState = someExpensiveComputation(props);\n  return initialState;\n});\n")),(0,o.kt)("h2",{id:"\u6027\u80fd\u4f18\u5316"},"\u6027\u80fd\u4f18\u5316"),(0,o.kt)("h3",{id:"\u8df3\u8fc7-state-\u66f4\u65b0"},"\u8df3\u8fc7 ",(0,o.kt)("inlineCode",{parentName:"h3"},"state")," \u66f4\u65b0"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"\u8c03\u7528 ",(0,o.kt)("inlineCode",{parentName:"p"},"State Hook")," \u7684\u66f4\u65b0\u51fd\u6570\u5e76\u4f20\u5165\u5f53\u524d\u7684 ",(0,o.kt)("inlineCode",{parentName:"p"},"state")," \u65f6\uff0c",(0,o.kt)("inlineCode",{parentName:"p"},"React")," \u5c06\u8df3\u8fc7",(0,o.kt)("inlineCode",{parentName:"p"},"\u5b50\u7ec4\u4ef6"),"\u7684\u6e32\u67d3\u53ca ",(0,o.kt)("inlineCode",{parentName:"p"},"effect")," \u7684\u6267\u884c\u3002")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"React \u4f7f\u7528 ",(0,o.kt)("inlineCode",{parentName:"p"},"[Object.is](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/is)"),"\u6bd4\u8f83\u7b97\u6cd5,\u6765\u6bd4\u8f83 ",(0,o.kt)("inlineCode",{parentName:"p"},"state"),"\u3002"))),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},'function Counter() {\n  const [counter, setCounter] = useState({ name: "\u8ba1\u6570\u5668", number: 0 });\n  console.log("render Counter");\n  return (\n    <>\n      <p>\n        {counter.name}:{counter.number}\n      </p>\n      <button\n        onClick={() => setCounter({ ...counter, number: counter.number + 1 })}\n      >\n        +\n      </button>\n      <button onClick={() => setCounter(counter)}>-</button>\n    </>\n  );\n}\n')),(0,o.kt)("h3",{id:"\u51cf\u5c11\u6e32\u67d3\u6b21\u6570"},"\u51cf\u5c11\u6e32\u67d3\u6b21\u6570"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"\u628a\u5185\u8054\u56de\u8c03\u51fd\u6570\u53ca\u4f9d\u8d56\u9879\u6570\u7ec4\u4f5c\u4e3a\u53c2\u6570\u4f20\u5165 ",(0,o.kt)("inlineCode",{parentName:"li"},"useCallback"),"\uff0c\u5b83\u5c06\u8fd4\u56de\u8be5\u56de\u8c03\u51fd\u6570\u7684 ",(0,o.kt)("inlineCode",{parentName:"li"},"memoized")," \u7248\u672c\uff0c\u8be5\u56de\u8c03\u51fd\u6570\u4ec5\u5728",(0,o.kt)("inlineCode",{parentName:"li"},"\u67d0\u4e2a\u4f9d\u8d56\u9879\u6539\u53d8"),"\u65f6\u624d\u4f1a\u66f4\u65b0"),(0,o.kt)("li",{parentName:"ul"},"\u628a\u521b\u5efa\u51fd\u6570\u548c\u4f9d\u8d56\u9879\u6570\u7ec4\u4f5c\u4e3a\u53c2\u6570\u4f20\u5165 ",(0,o.kt)("inlineCode",{parentName:"li"},"useMemo"),"\uff0c\u5b83\u4ec5\u4f1a\u5728\u67d0\u4e2a\u4f9d\u8d56\u9879\u6539\u53d8\u65f6\u624d\u91cd\u65b0\u8ba1\u7b97 ",(0,o.kt)("inlineCode",{parentName:"li"},"memoized")," \u503c\u3002\u8fd9\u79cd\u4f18\u5316\u6709\u52a9\u4e8e\u907f\u514d\u5728\u6bcf\u6b21\u6e32\u67d3\u65f6\u90fd\u8fdb\u884c",(0,o.kt)("inlineCode",{parentName:"li"},"\u9ad8\u5f00\u9500\u7684\u8ba1\u7b97")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"React.memo")," \u7b49\u6548\u4e8e",(0,o.kt)("inlineCode",{parentName:"li"},"PureComponent"),"\uff0c\u4f46\u5b83\u53ea\u6bd4\u8f83 ",(0,o.kt)("inlineCode",{parentName:"li"},"props"),"\u3002\uff08\u4f60\u4e5f\u53ef\u4ee5\u901a\u8fc7\u7b2c\u4e8c\u4e2a\u53c2\u6570\u6307\u5b9a\u4e00\u4e2a\u81ea\u5b9a\u4e49\u7684\u6bd4\u8f83\u51fd\u6570\u6765\u6bd4\u8f83\u65b0\u65e7 ",(0,o.kt)("inlineCode",{parentName:"li"},"props"),"\u3002\u5982\u679c\u51fd\u6570\u8fd4\u56de ",(0,o.kt)("inlineCode",{parentName:"li"},"true"),"\uff0c\u5c31\u4f1a\u8df3\u8fc7\u66f4\u65b0\u3002")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},'function Child({ onButtonClick, data }) {\n  console.log("Child render");\n  return <button onClick={onButtonClick}>{data.number}</button>;\n}\nChild = memo(Child);\nfunction App() {\n  const [number, setNumber] = useState(0);\n  const [name, setName] = useState("dapeng");\n  const addClick = useCallback(() => setNumber(number + 1), [number]);\n  const data = useMemo(() => ({ number }), [number]);\n  return (\n    <div>\n      <input\n        type="text"\n        value={name}\n        onChange={(e) => setName(e.target.value)}\n      />\n      <Child onButtonClick={addClick} data={data} />\n    </div>\n  );\n}\n')),(0,o.kt)("h2",{id:"purecomponent\u7684\u5b9e\u73b0"},(0,o.kt)("inlineCode",{parentName:"h2"},"PureComponent"),"\u7684\u5b9e\u73b0"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},'function shallowEqual(obj1, obj2) {\n  if (obj1 === obj2) {\n    return true;\n  }\n  if (\n    typeof obj1 != "object" ||\n    obj1 === null ||\n    typeof obj2 != "object" ||\n    obj2 === null\n  ) {\n    return false;\n  }\n  let keys1 = Object.keys(obj1);\n  let keys2 = Object.keys(obj2);\n  if (keys1.length !== keys2.length) {\n    return false;\n  }\n  for (let key of keys1) {\n    if (!obj2.hasOwnProperty(key) || obj1[key] !== obj2[key]) {\n      return false;\n    }\n  }\n  return true;\n}\nclass PureComponent extends React.Component {\n  shouldComponentUpdate(newProps, nextState) {\n    return (\n      !shallowEqual(this.props, newProps) ||\n      !shallowEqual(this.state, nextState)\n    );\n  }\n}\n')),(0,o.kt)("h2",{id:"memo-\u7684\u5b9e\u73b0"},(0,o.kt)("inlineCode",{parentName:"h2"},"memo")," \u7684\u5b9e\u73b0"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"function memo(Component, compare) {\n  return class extends React.PureCompoent {\n    shou;\n    render() {\n      return <Component />;\n    }\n  };\n}\n")),(0,o.kt)("h2",{id:"useref\u7684\u5b9e\u73b0"},(0,o.kt)("inlineCode",{parentName:"h2"},"useRef"),"\u7684\u5b9e\u73b0"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"let lastRef; //\u8fd9\u4e2a\u662f\u5168\u5c40\u552f\u4e00\u7684\nfunction useRef() {\n  lastRef = lastRef || { current: null }; // \u5b9e\u73b0\u4e0d\u5b8c\u7f8e \u4f1a\u6709\u66f4\u4f18\u96c5\u7684\u5b9e\u73b0\n  return lastRef;\n}\n")),(0,o.kt)("h2",{id:"render-\u7684\u5b9e\u73b0"},(0,o.kt)("inlineCode",{parentName:"h2"},"render")," \u7684\u5b9e\u73b0"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},'function render() {\n  hookIndex = 0;\n  ReactDOM.render(<App />, document.getElementById("root"));\n}\n')),(0,o.kt)("h2",{id:"usestate\u7684\u5b9e\u73b0"},(0,o.kt)("inlineCode",{parentName:"h2"},"useState"),"\u7684\u5b9e\u73b0"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},'let hookIndex = 0;\nlet hookState = [];\nfunction useState(initState) {\n  initState =\n    hookState[hookIndex] != null\n      ? hookState[hookIndex]\n      : typeof initState === "function"\n      ? initState(initState)\n      : initState;\n  let currentIndex = hookIndex; //\u4e3a\u4e86\u95ed\u5305\u4fdd\u5b58index\n  function setState(newState) {\n    hookState[currentIndex] = newState;\n    render();\n  }\n  return [hookState[currentIndex++], setState];\n}\n')),(0,o.kt)("h3",{id:"usememo\u7684\u5b9e\u73b0"},(0,o.kt)("inlineCode",{parentName:"h3"},"useMemo"),"\u7684\u5b9e\u73b0"),(0,o.kt)("blockquote",null,(0,o.kt)("ul",{parentName:"blockquote"},(0,o.kt)("li",{parentName:"ul"},"deps \u4e3a\u7a7a \u6bcf\u6b21\u90fd\u66f4\u65b0"),(0,o.kt)("li",{parentName:"ul"},"\u4e3a\u7a7a\u6570\u7ec4 \u53ea\u66f4\u65b0\u4e00\u6b21"),(0,o.kt)("li",{parentName:"ul"},"\u4e3a\u6570\u7ec4 \u6570\u7ec4\u53d8\u5316\u4e86\u624d\u66f4\u65b0"))),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"let hookIndex = 0;\nlet hookState = [];\n\nfunction useMemo(factory, deps) {\n  if (hookState[hookIndex]) {\n    const [lastMemo, lastDeps] = hookState[hookIndex];\n    let same =\n      deps != null && deps.every((item, index) => item === lastDeps[index]);\n    if (same) {\n      hookIndex++;\n      return lastMemo;\n    } else {\n      // deps\u548cmemo\n      let newMome = factory();\n      // \u4fdd\u5b58deps\u548cmemo\n      hookStates[hookIndex++] = [newMemo, deps];\n      return newMemo;\n    }\n  } else {\n    //\u53d6\u4e0d\u5230\u8bf4\u660e\u7b2c\u4e00\u6b21\u8c03\u7528\n    let newMome = factory();\n    // \u4fdd\u5b58deps\u548cmemo\n    hookStates[hookIndex++] = [newMemo, deps];\n    return newMemo;\n  }\n}\n")),(0,o.kt)("h2",{id:"usecallback\u7684\u5b9e\u73b0"},(0,o.kt)("inlineCode",{parentName:"h2"},"useCallback"),"\u7684\u5b9e\u73b0"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"let hookIndex = 0;\nlet hookState = [];\nfunction useCallbak(callback, deps) {\n  if (hookState[hookIndex]) {\n    const [lastCallback, lastDeps] = hookStates[hookIndex++];\n    let same =\n      deps != null && deps.every((item, index) => item === lastDeps[index]);\n    if (same) {\n      hookIndex++;\n      return lastCallback;\n    } else {\n      hookStates[hookIndex++] = [callback, deps];\n      return callback;\n    }\n  } else {\n    // \u4fdd\u5b58deps\u548ccallback\n    hookStates[hookIndex++] = [callback, deps];\n    return callback;\n  }\n}\n")),(0,o.kt)("h2",{id:"usereducer"},"useReducer"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"useState")," \u7684\u66ff\u4ee3\u65b9\u6848\u3002\u5b83\u63a5\u6536\u4e00\u4e2a\u5f62\u5982 ",(0,o.kt)("inlineCode",{parentName:"li"},"(state, action) => newState")," \u7684 ",(0,o.kt)("inlineCode",{parentName:"li"},"reducer"),"\uff0c\u5e76\u8fd4\u56de\u5f53\u524d\u7684 ",(0,o.kt)("inlineCode",{parentName:"li"},"state")," \u4ee5\u53ca\u4e0e\u5176\u914d\u5957\u7684 ",(0,o.kt)("inlineCode",{parentName:"li"},"dispatch")," \u65b9\u6cd5"),(0,o.kt)("li",{parentName:"ul"},"\u5728\u67d0\u4e9b\u573a\u666f\u4e0b\uff0c",(0,o.kt)("inlineCode",{parentName:"li"},"useReducer")," \u4f1a\u6bd4 ",(0,o.kt)("inlineCode",{parentName:"li"},"useState")," \u66f4\u9002\u7528\uff0c\u4f8b\u5982 ",(0,o.kt)("inlineCode",{parentName:"li"},"state")," \u903b\u8f91\u8f83\u590d\u6742\u4e14\u5305\u542b\u591a\u4e2a\u5b50\u503c\uff0c\u6216\u8005\u4e0b\u4e00\u4e2a",(0,o.kt)("inlineCode",{parentName:"li"},"state")," \u4f9d\u8d56\u4e8e\u4e4b\u524d\u7684 state \u7b49")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"const [state, dispatch] = useReducer(reducer, initialArg, init);\n")),(0,o.kt)("p",null,"\u793a\u4f8b"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},'const initialState = { count: 0 };\n\nfunction reducer(state, action) {\n  switch (action.type) {\n    case "increment":\n      return { count: state.count + 1 };\n    case "decrement":\n      return { count: state.count - 1 };\n    default:\n      throw new Error();\n  }\n}\n\nfunction Counter() {\n  const [state, dispatch] = useReducer(reducer, initialState);\n  return (\n    <>\n      Count: {state.count}\n      <button onClick={() => dispatch({ type: "decrement" })}>-</button>\n      <button onClick={() => dispatch({ type: "increment" })}>+</button>\n    </>\n  );\n}\n')),(0,o.kt)("h2",{id:"usereducer-\u7684\u5b9e\u73b0"},"useReducer \u7684\u5b9e\u73b0"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"let hookStates = [];\nlet hookIndex = 0;\nfunction useReducer(reducer, initialState, init) {\n  hookStates[hookIndex] =\n    hookStates[hookIndex] || (init ? init(initialState) : initialState);\n  let currentIndex = hookIndex;\n  function dispatch(action) {\n    hookStates[currentIndex] = reducer\n      ? reducer(hookStates[currentIndex], action)\n      : action;\n    render();\n  }\n  return [hookStates[hookIndex++], dispatch];\n}\n")),(0,o.kt)("h2",{id:"usecontext"},"useContext"))}p.isMDXComponent=!0}}]);