(self.webpackChunkdapengdouyu=self.webpackChunkdapengdouyu||[]).push([[7791],{3905:function(e,r,n){"use strict";n.d(r,{Zo:function(){return u},kt:function(){return k}});var t=n(7294);function a(e,r,n){return r in e?Object.defineProperty(e,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[r]=n,e}function s(e,r){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);r&&(t=t.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),n.push.apply(n,t)}return n}function o(e){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?s(Object(n),!0).forEach((function(r){a(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))}))}return e}function p(e,r){if(null==e)return{};var n,t,a=function(e,r){if(null==e)return{};var n,t,a={},s=Object.keys(e);for(t=0;t<s.length;t++)n=s[t],r.indexOf(n)>=0||(a[n]=e[n]);return a}(e,r);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(t=0;t<s.length;t++)n=s[t],r.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var l=t.createContext({}),i=function(e){var r=t.useContext(l),n=r;return e&&(n="function"==typeof e?e(r):o(o({},r),e)),n},u=function(e){var r=i(e.components);return t.createElement(l.Provider,{value:r},e.children)},c={inlineCode:"code",wrapper:function(e){var r=e.children;return t.createElement(t.Fragment,{},r)}},d=t.forwardRef((function(e,r){var n=e.components,a=e.mdxType,s=e.originalType,l=e.parentName,u=p(e,["components","mdxType","originalType","parentName"]),d=i(n),k=a,m=d["".concat(l,".").concat(k)]||d[k]||c[k]||s;return n?t.createElement(m,o(o({ref:r},u),{},{components:n})):t.createElement(m,o({ref:r},u))}));function k(e,r){var n=arguments,a=r&&r.mdxType;if("string"==typeof e||a){var s=n.length,o=new Array(s);o[0]=d;var p={};for(var l in r)hasOwnProperty.call(r,l)&&(p[l]=r[l]);p.originalType=e,p.mdxType="string"==typeof e?e:a,o[1]=p;for(var i=2;i<s;i++)o[i]=n[i];return t.createElement.apply(null,o)}return t.createElement.apply(null,n)}d.displayName="MDXCreateElement"},8825:function(e,r,n){"use strict";n.r(r),n.d(r,{frontMatter:function(){return p},contentTitle:function(){return l},metadata:function(){return i},toc:function(){return u},default:function(){return d}});var t=n(4034),a=n(9973),s=(n(7294),n(3905)),o=["components"],p={},l=void 0,i={unversionedId:"books/Babel \u63d2\u4ef6\u901a\u5173\u79d8\u7c4d/6\u3001js parser \u7684\u5386\u53f2",id:"books/Babel \u63d2\u4ef6\u901a\u5173\u79d8\u7c4d/6\u3001js parser \u7684\u5386\u53f2",isDocsHomePage:!1,title:"6\u3001js parser \u7684\u5386\u53f2",description:"\u524d\u9762\u6211\u4eec\u5b66\u4e60\u4e86 babel \u7684 parser \u548c AST\uff0cbabel \u7684 parser \u662f\u57fa\u4e8e acorn \u6269\u5c55\u800c\u6765\u7684\uff0c\u800c acorn \u4e5f\u4e0d\u662f\u6700\u65e9\u7684 js parser\uff0cjs parser \u7684\u5386\u53f2\u662f\u600e\u6837\u7684\uff1f \u5404\u79cd parser \u4e4b\u95f4\u7684\u5173\u7cfb\u662f\u4ec0\u4e48\u6837\u7684\u5462\uff1f\u8fd9\u8282\u6211\u4eec\u6765\u68b3\u7406\u4e00\u4e0b\u3002",source:"@site/docs/books/Babel \u63d2\u4ef6\u901a\u5173\u79d8\u7c4d/6\u3001js parser \u7684\u5386\u53f2.md",sourceDirName:"books/Babel \u63d2\u4ef6\u901a\u5173\u79d8\u7c4d",slug:"/books/Babel \u63d2\u4ef6\u901a\u5173\u79d8\u7c4d/6\u3001js parser \u7684\u5386\u53f2",permalink:"/docs/books/Babel \u63d2\u4ef6\u901a\u5173\u79d8\u7c4d/6\u3001js parser \u7684\u5386\u53f2",editUrl:"https://github.com/dapengdouyu/docs/tree/master/docs/books/Babel \u63d2\u4ef6\u901a\u5173\u79d8\u7c4d/6\u3001js parser \u7684\u5386\u53f2.md",tags:[],version:"current",lastUpdatedAt:1633933712,formattedLastUpdatedAt:"10/11/2021",frontMatter:{},sidebar:"books",previous:{title:"5\u3001\u5b9e\u6218\u6848\u4f8b\uff1a\u63d2\u5165\u51fd\u6570\u8c03\u7528\u53c2\u6570",permalink:"/docs/books/Babel \u63d2\u4ef6\u901a\u5173\u79d8\u7c4d/5\u3001\u5b9e\u6218\u6848\u4f8b\uff1a\u63d2\u5165\u51fd\u6570\u8c03\u7528\u53c2\u6570"},next:{title:"7\u3001traverse \u7684 visitor \u548c path",permalink:"/docs/books/Babel \u63d2\u4ef6\u901a\u5173\u79d8\u7c4d/7\u3001traverse \u7684 visitor \u548c path"}},u=[{value:"JS parser\u7684\u5386\u53f2",id:"js-parser\u7684\u5386\u53f2",children:[{value:"SpiderMonkey \u548c estree \u6807\u51c6",id:"spidermonkey-\u548c-estree-\u6807\u51c6",children:[],level:3},{value:"acorn",id:"acorn",children:[],level:3},{value:"js parser \u4e4b\u95f4\u7684\u5173\u7cfb",id:"js-parser-\u4e4b\u95f4\u7684\u5173\u7cfb",children:[{value:"babel parser \u5bf9 estree AST \u7684\u6269\u5c55",id:"babel-parser-\u5bf9-estree-ast-\u7684\u6269\u5c55",children:[],level:4}],level:3}],level:2},{value:"acorn\u63d2\u4ef6",id:"acorn\u63d2\u4ef6",children:[{value:"\u5206\u8bcd\uff08\u8bcd\u6cd5\u5206\u6790\uff09",id:"\u5206\u8bcd\u8bcd\u6cd5\u5206\u6790",children:[],level:4},{value:"\u7ec4\u88c5AST\uff08\u8bed\u6cd5\u5206\u6790\uff09",id:"\u7ec4\u88c5ast\u8bed\u6cd5\u5206\u6790",children:[],level:4}],level:2},{value:"\u603b\u7ed3",id:"\u603b\u7ed3",children:[],level:2}],c={toc:u};function d(e){var r=e.components,n=(0,a.Z)(e,o);return(0,s.kt)("wrapper",(0,t.Z)({},c,n,{components:r,mdxType:"MDXLayout"}),(0,s.kt)("p",null,"\u524d\u9762\u6211\u4eec\u5b66\u4e60\u4e86 babel \u7684 parser \u548c AST\uff0cbabel \u7684 parser \u662f\u57fa\u4e8e acorn \u6269\u5c55\u800c\u6765\u7684\uff0c\u800c acorn \u4e5f\u4e0d\u662f\u6700\u65e9\u7684 js parser\uff0cjs parser \u7684\u5386\u53f2\u662f\u600e\u6837\u7684\uff1f \u5404\u79cd parser \u4e4b\u95f4\u7684\u5173\u7cfb\u662f\u4ec0\u4e48\u6837\u7684\u5462\uff1f\u8fd9\u8282\u6211\u4eec\u6765\u68b3\u7406\u4e00\u4e0b\u3002"),(0,s.kt)("h2",{id:"js-parser\u7684\u5386\u53f2"},"JS parser\u7684\u5386\u53f2"),(0,s.kt)("h3",{id:"spidermonkey-\u548c-estree-\u6807\u51c6"},"SpiderMonkey \u548c estree \u6807\u51c6"),(0,s.kt)("p",null,"\u5728 nodejs \u51fa\u73b0\u4e4b\u540e\uff0c\u524d\u7aef\u53ef\u4ee5\u7528 nodejs \u6765\u505a\u4e00\u4e9b\u5de5\u7a0b\u5316\u7684\u4e8b\u60c5\uff0c\u4e5f\u5c31\u6709\u4e86\u5bf9 js parser \u7684\u9700\u6c42\uff0c\u5f53\u65f6 Mozilla \u5728 MDN \u4e0a\u516c\u5e03\u4e86 SpiderMonkey\uff08c++ \u5199\u7684 js \u5f15\u64ce\uff09\u7684 parser api \u548c AST \u6807\u51c6\uff0c\u6240\u4ee5\u5f53\u65f6\u6700\u65e9\u7684 JS parser ","-","--- ",(0,s.kt)("a",{parentName:"p",href:"https://github.com/jquery/esprima"},"esprima")," \u5c31\u662f\u57fa\u4e8e SpiderMonkey \u7684 AST \u6807\u51c6\u6765\u5b9e\u73b0\u7684\uff0c\u540e\u6765\u5f62\u6210\u4e86 ",(0,s.kt)("a",{parentName:"p",href:"https://github.com/estree/estree"},"estree \u6807\u51c6"),"\u3002 \u5f53\u65f6\u5f88\u591a\u7684\u524d\u7aef\u9886\u57df\u7684\u5de5\u5177\u90fd\u57fa\u4e8e esprima\u3002"),(0,s.kt)("p",null,"\u4f46\u662f\u5230\u4e86 2015 \u5e74\u4e4b\u540e\uff0ces \u6807\u51c6\u4e00\u5e74\u4e00\u4e2a\u7248\u672c\uff0c\u800c esprima \u7684\u66f4\u65b0\u901f\u5ea6\u8ddf\u4e0d\u4e0a\uff0c\u5b83\u8ddf\u4e0d\u4e0a\u4e5f\u5c31\u5bfc\u81f4\u4e86\u4f9d\u8d56\u5b83\u7684\u4e00\u7cfb\u5217\u5de5\u5177\u90fd\u8ddf\u4e0d\u4e0a\uff0c\u6240\u4ee5 eslint \u5c31 fork \u4e86\u4e00\u4efd esprima\uff0c\u505a\u4e86\u4e00\u4e9b\u6269\u5c55\uff0c\u6765\u81ea\u5df1\u5b9e\u73b0\u65b0\u8bed\u6cd5\u7684 parse\uff0c\u8fd9\u5c31\u662f espree\uff0c\u5b83\u4f9d\u7136\u662f estree \u6807\u51c6\u7684\u3002"),(0,s.kt)("h3",{id:"acorn"},"acorn"),(0,s.kt)("p",null,"\u540e\u9762\u51fa\u73b0\u4e86 ",(0,s.kt)("a",{parentName:"p",href:"https://github.com/acornjs/acorn"},"acorn"),"\uff0c\u4e5f\u662f estree \u6807\u51c6\u7684\u5b9e\u73b0\uff0c\u4f46\u662f\u4ed6\u7684\u901f\u5ea6\u6bd4 esprima \u5feb\uff0c\u800c\u4e14\u652f\u6301\u63d2\u4ef6\uff0c\u53ef\u4ee5\u901a\u8fc7\u63d2\u4ef6\u6269\u5c55\u8bed\u6cd5\u652f\u6301\u3002\u6b63\u662f\u901f\u5ea6\u5feb\u52a0\u4e0a\u652f\u6301\u63d2\u4ef6\u8ba9\u5f88\u591a\u5de5\u5177\u90fd\u8f6c\u800c\u4f7f\u7528 acorn\u3002"),(0,s.kt)("p",null,"eslint \u7684 parser ","-","--- ",(0,s.kt)("a",{parentName:"p",href:"https://github.com/eslint/espree"},"espree")," \u672c\u6765\u662f fork \u81ea esprima\uff0c\u4f46\u540e\u6765 espree 2.0 \u57fa\u4e8e acorn \u91cd\u65b0\u5b9e\u73b0\u4e86\uff0c\u4e5f\u4f7f\u7528 acorn \u7684\u63d2\u4ef6\u673a\u5236\u6765\u6269\u5c55\u8bed\u6cd5\u3002"),(0,s.kt)("p",null,"babel parser","(","babylon",")"," \u4e5f\u662f\u57fa\u4e8e acorn\uff0c\u5e76\u4e14\u5bf9 AST \u8282\u70b9\u548c\u5c5e\u6027\u90fd\u505a\u4e86\u6269\u5c55\uff0c\u4e5f\u63d0\u4f9b\u4e86\u4e00\u4e9b\u652f\u6301 typescript\u3001jsx\u3001flow \u7684\u63d2\u4ef6\uff08\u5c31\u662f\u6211\u4eec\u53ef\u4ee5\u5728 \\@babel/parser \u7684 plugins \u91cc\u9762\u6307\u5b9a\u7684\u90a3\u4e9b\uff09\u3002"),(0,s.kt)("h3",{id:"js-parser-\u4e4b\u95f4\u7684\u5173\u7cfb"},"js parser \u4e4b\u95f4\u7684\u5173\u7cfb"),(0,s.kt)("p",null,(0,s.kt)("img",{parentName:"p",src:"https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9f30072e7a774fbf85539daedb8813ad~tplv-k3u1fbpfcp-watermark.image",alt:null})),(0,s.kt)("p",null,"\u5b83\u4eec\u7684\u5173\u7cfb\u5982\u56fe\u6240\u793a\uff0cestree \u6807\u51c6\u662f\u57fa\u4e8e SpiderMonkey \u7684 AST \u6807\u51c6\u6269\u5c55\u7684\uff0c\u5b83\u7684\u5b9e\u73b0\u6709 esprima\u3001acorn \u7b49\uff0c\u73b0\u5728 espree\u3001babel parser \u90fd\u662f\u57fa\u4e8eacorn\u505a\u7684\u6269\u5c55\uff0c\u56e0\u4e3a acorn \u63d0\u4f9b\u4e86\u63d2\u4ef6\u673a\u5236\u3002"),(0,s.kt)("p",null,"\u5f53\u7136\u4e5f\u4e0d\u662f\u6240\u6709\u7684 js parser \u90fd\u662f estree \u6807\u51c6\u7684\uff0c\u6bd4\u5982 terser\u3001typescript \u7b49\u90fd\u6709\u81ea\u5df1\u7684 AST \u6807\u51c6\u3002"),(0,s.kt)("h4",{id:"babel-parser-\u5bf9-estree-ast-\u7684\u6269\u5c55"},"babel parser \u5bf9 estree AST \u7684\u6269\u5c55"),(0,s.kt)("p",null,"babel \u57fa\u4e8e acorn \u63d2\u4ef6\u5bf9 estree AST \u505a\u4e86\u5982\u4e0b\u6269\u5c55"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"\u628a Literal \u66ff\u6362\u6210\u4e86 StringLiteral\u3001NumericLiteral\u3001 BigIntLiteral\u3001 BooleanLiteral\u3001 NullLiteral\u3001 RegExpLiteral"),(0,s.kt)("li",{parentName:"ul"},"\u628a Property \u66ff\u6362\u6210\u4e86 ObjectProperty \u548c ObjectMethod"),(0,s.kt)("li",{parentName:"ul"},"\u628a MethodDefinition \u66ff\u6362\u6210\u4e86 ClassMethod"),(0,s.kt)("li",{parentName:"ul"},"Program \u548c BlockStatement \u652f\u6301\u4e86 directives \u5c5e\u6027\uff0c\u4e5f\u5c31\u662f 'use strict' \u7b49\u6307\u4ee4\u7684\u89e3\u6790\uff0c\u5bf9\u5e94\u7684 ast \u662f Directive \u548c DirectiveLiteral"),(0,s.kt)("li",{parentName:"ul"},"ChainExpression \u66ff\u6362\u4e3a\u4e86 ObjectMemberExpression \u548c OptionalCallExpression"),(0,s.kt)("li",{parentName:"ul"},"ImportExpression \u66ff\u6362\u4e3a\u4e86 CallExpression \u5e76\u4e14 callee \u5c5e\u6027\u8bbe\u7f6e\u4e3a Import")),(0,s.kt)("p",null,"\u8fd9\u4e9b\u53ef\u4ee5\u5728 ",(0,s.kt)("a",{parentName:"p",href:"https://babeljs.io/docs/en/babel-parser#output"},"babel parser \u7684\u6587\u6863"),"\u91cc\u770b\u5230\u3002"),(0,s.kt)("h2",{id:"acorn\u63d2\u4ef6"},"acorn\u63d2\u4ef6"),(0,s.kt)("p",null,"babel parser \u57fa\u4e8e acorn \u6269\u5c55\u4e86\u4e00\u4e9b\u8bed\u6cd5\uff0c\u90a3\u5b83\u662f\u600e\u4e48\u6269\u5c55\u7684\u5462\uff1f \u6211\u4eec\u5199\u4e00\u4e2a acorn \u63d2\u4ef6\u6765\u611f\u53d7\u4e00\u4e0b\u3002"),(0,s.kt)("p",null,"acorn \u4e3b\u8981\u662f\u4e00\u4e2a Parser \u7c7b\uff0c\u4e0d\u540c\u7684\u65b9\u6cd5\u5b9e\u73b0\u4e86\u4e0d\u540c\u7684\u903b\u8f91\uff0c\u63d2\u4ef6\u6269\u5c55\u5c31\u662f\u7ee7\u627f\u8fd9\u4e2a Parser\uff0c\u91cd\u5199\u4e00\u4e9b\u65b9\u6cd5\u3002"),(0,s.kt)("p",null,"acorn \u7684 api \u5982\u4e0b\uff0c\u5176\u4e2d acorn-jsx\u3001acorn-bigint \u5c31\u662f acorn \u63d2\u4ef6"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre"},'const { Parser } = require("acorn")\n\nconst MyParser = Parser.extend(\n  require("acorn-jsx")(),\n  require("acorn-bigint")\n)\nconsole.log(MyParser.parse("// Some bigint + JSX code"))\n')),(0,s.kt)("p",null,"\u63d2\u4ef6\u662f\u4e00\u4e2a\u51fd\u6570\uff0c\u63a5\u6536\u4e4b\u524d\u7684 Parser\uff0c\u8fd4\u56de\u6269\u5c55\u4ee5\u540e\u7684 Parser"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre"},'module.exports = function noisyReadToken(Parser) {\n  return class extends Parser {\n    readToken(code) {\n      console.log("Reading a token!")\n      super.readToken(code)\n    }\n  }\n}\n')),(0,s.kt)("p",null,"\u63a5\u4e0b\u6765\u6211\u4eec\u5199\u4e00\u4e2a acorn \u63d2\u4ef6\uff1a"),(0,s.kt)("blockquote",null,(0,s.kt)("p",{parentName:"blockquote"},"\u7ed9 javascript \u4e00\u4e2a\u5173\u952e\u5b57 guang\uff0c\u53ef\u4ee5\u4f5c\u4e3a statement \u5355\u72ec\u4f7f\u7528")),(0,s.kt)("p",null,"\u6211\u4eec\u77e5\u9053 parse \u7684\u8fc7\u7a0b\u5176\u5b9e\u5c31\u662f",(0,s.kt)("inlineCode",{parentName:"p"},"\u5206\u8bcd")," + ",(0,s.kt)("inlineCode",{parentName:"p"},"\u7ec4\u88c5 AST"),"\u8fd9\u4e24\u6b65\uff08\u4e00\u822c\u53eb\u8bcd\u6cd5\u5206\u6790\u548c\u8bed\u6cd5\u5206\u6790\uff09\uff0c\u6211\u4eec\u53ea\u8981\u5b9e\u73b0\u8fd9\u4e24\u6b65\u5c31\u53ef\u4ee5\u4e86\u3002"),(0,s.kt)("h4",{id:"\u5206\u8bcd\u8bcd\u6cd5\u5206\u6790"},"\u5206\u8bcd\uff08\u8bcd\u6cd5\u5206\u6790\uff09"),(0,s.kt)("p",null,"\u6211\u4eec\u662f\u60f3\u589e\u52a0\u4e00\u4e2a\u5173\u952e\u5b57\uff0cacorn \u6709 keywords \u5c5e\u6027\uff0c\u662f\u4e00\u4e2a\u6b63\u5219\u8868\u8fbe\u5f0f\uff0c\u7528\u6765\u505a\u5173\u952e\u5b57\u62c6\u5206\uff0c\u6240\u4ee5\u6211\u4eec\u91cd\u5199 keywords \u5c5e\u6027\u5c31\u53ef\u4ee5\u3002\u5e76\u4e14\u8fd8\u8981\u4e3a\u65b0\u7684\u5173\u952e\u5b57\u6ce8\u518c\u4e00\u4e2a token \u7c7b\u578b\u3002"),(0,s.kt)("p",null,"acorn Parser \u7684\u5165\u53e3\u65b9\u6cd5\u662f parse\uff0c\u6211\u4eec\u8981\u5728 parse \u65b9\u6cd5\u91cc\u9762\u8bbe\u7f6e keywords\u3002"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre"},'parse(program) {\n    var newKeywords = "break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this const class extends export import super";\n    newKeywords += " guang";// \u589e\u52a0\u4e00\u4e2a\u5173\u952e\u5b57\n    this.keywords = new RegExp("^(?:" + newKeywords.replace(/ /g, "|") + ")$")\n\n    return(super.parse(program));\n}\n')),(0,s.kt)("p",null,"\u7136\u540e\u6ce8\u518c\u4e00\u4e2a\u65b0\u7684 token \u7c7b\u578b\u6765\u6807\u8bc6\u5b83"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre"},'Parser.acorn.keywordTypes["guang"] = new TokenType("guang",{keyword: "guang"});\n')),(0,s.kt)("p",null,"\u8fd9\u6837 acorn \u5c31\u4f1a\u5728 parse \u7684\u65f6\u5019\u5206\u51fa ",(0,s.kt)("inlineCode",{parentName:"p"},"guang")," \u8fd9\u4e2a\u5173\u952e\u5b57"),(0,s.kt)("h4",{id:"\u7ec4\u88c5ast\u8bed\u6cd5\u5206\u6790"},"\u7ec4\u88c5AST\uff08\u8bed\u6cd5\u5206\u6790\uff09"),(0,s.kt)("p",null,"\u5149\u5206\u51fa token \u662f\u6ca1\u610f\u4e49\u7684\uff0c\u8981\u7ec4\u88c5\u5230 AST \u4e2d\u3002"),(0,s.kt)("p",null,"acorn \u5728 parse \u5230\u4e0d\u540c\u7c7b\u578b\u7684\u8282\u70b9\u4f1a\u8c03\u7528\u4e0d\u540c\u7684 parseXxx \u65b9\u6cd5\uff0c\u56e0\u4e3a\u6211\u4eec\u662f\u5728 statement \u91cc\u9762\u7528\uff0c\u90a3\u4e48\u5c31\u8981\u91cd\u5199 parseStatement \u65b9\u6cd5\uff0c\u5728\u91cc\u9762\u7ec4\u88c5\u65b0\u7684 statement \u8282\u70b9\u3002"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre"},"parseStatement(context, topLevel, exports) {\n  var tokenType = this.type;\n\n  if (tokenType == Parser.acorn.keywordTypes[\"guang\"]) {\n    var node = this.startNode();\n    this.next();\n    return this.finishNode({value: 'guang'},'GuangStatement');\n  }\n  else {\n    return(super.parseStatement(context, topLevel, exports));\n  }\n}\n")),(0,s.kt)("p",null,"this.type \u662f\u5f53\u524d\u5904\u7406\u5230\u7684 token \u7684\u7c7b\u578b\uff0c this.next \u662f\u6d88\u8d39\u8fd9\u4e2a token\uff0c\u6211\u4eec\u8bc6\u522b\u51fa token \u7684\u7c7b\u578b\u4e3a guang \u7684\u65f6\u5019\uff0c\u5c31\u7ec4\u88c5\u6210\u4e00\u4e2a AST\u3002"),(0,s.kt)("p",null,"\u901a\u8fc7 this.startNode","(",")"," \u521b\u5efa\u4e00\u4e2a\u65b0\u7684AST\u8282\u70b9\uff0c\u7136\u540e this.next","(",")"," \u6d88\u8d39\u6389\u8fd9\u4e2a token\uff0c\u4e4b\u540e\u8fd4\u56de\u65b0\u7684 AST \u8282\u70b9\u3002"),(0,s.kt)("p",null,"\u5982\u679c\u4e0d\u662f\u6211\u4eec\u6269\u5c55\u7684 token\uff0c\u5219\u8c03\u7528\u7236\u7c7b\u7684 parseStatement \u5904\u7406\u3002"),(0,s.kt)("p",null,"\u8fd9\u6837\u80fd\u6210\u529f\u5206\u51fatoken\uff0c\u4f46\u662f\u6700\u597d\u628a\u5b83\u72ec\u7acb\u6210\u4e00\u4e2a\u65b9\u6cd5\uff0c\u8fd9\u6837\u5b50\u7c7b\u53ef\u4ee5\u8986\u76d6\u8fd9\u4e2a\u65b9\u6cd5\u6765\u5bf9 parse \u903b\u8f91\u505a\u4fee\u6539\u3002"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre"},"parseStatement(context, topLevel, exports) {\n  var tokenType = this.type;\n\n  if (tokenType == Parser.acorn.keywordTypes[\"guang\"]) {\n    var node = this.startNode();\n    return this.parseGuangStatement(node);\n  }\n  else {\n    return(super.parseStatement(context, topLevel, exports));\n  }\n}\n\nparseGuangStatement(node) {\n    this.next();\n    return this.finishNode({value: 'guang'},'GuangStatement');\n}\n")),(0,s.kt)("p",null,"\u5b8c\u6574\u4ee3\u7801\u5982\u4e0b\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre"},'const acorn = require("acorn");\n\nconst Parser = acorn.Parser;\nconst TokenType = acorn.TokenType;\n\nParser.acorn.keywordTypes["guang"] = new TokenType("guang",{keyword: "guang"});\n\nfunction wordsRegexp(words) {\n  return new RegExp("^(?:" + words.replace(/ /g, "|") + ")$")\n}\n\nvar guangKeyword = function(Parser) {\n  return class extends Parser {\n    parse(program) {\n      let newKeywords = "break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this const class extends export import super";\n      newKeywords += " guang";\n      this.keywords = new RegExp("^(?:" + newKeywords.replace(/ /g, "|") + ")$")\n      return(super.parse(program));\n    }\n\n    parseStatement(context, topLevel, exports) {\n      var starttype = this.type;\n\n      if (starttype == Parser.acorn.keywordTypes["guang"]) {\n        var node = this.startNode();\n        return this.parseGuangStatement(node);\n      }\n      else {\n        return(super.parseStatement(context, topLevel, exports));\n      }\n    }\n\n    parseGuangStatement(node) {\n      this.next();\n      return this.finishNode({value: \'guang\'},\'GuangStatement\');//\u65b0\u589e\u52a0\u7684ssh\u8bed\u53e5\n    };\n  }\n}\nconst newParser = Parser.extend(guangKeyword);\n')),(0,s.kt)("p",null,"\u6211\u4eec\u6267\u884c\u4e0b\u8bd5\u4e0b\u6548\u679c"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre"},"const newParser = Parser.extend(guangKeywordPlugin);\n\nvar program = \n`\n    guang\n    const a = 1\n`;\n\nconst ast = newParser.parse(program);\nconsole.log(ast);\n")),(0,s.kt)("p",null,"\u4ea7\u751f\u7684AST\u5982\u4e0b\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre"},"Node {\n  type: 'Program',\n  start: 0,\n  end: 27,\n  body: [\n    { value: 'guang', type: 'GuangStatement', end: 10 },\n    Node {\n      type: 'VariableDeclaration',\n      start: 15,\n      end: 26,\n      declarations: [Array],\n      kind: 'const'\n    }\n  ],\n  sourceType: 'script'\n}\n")),(0,s.kt)("p",null,"\u5c31\u8fd9\u6837\u6211\u4eec\u5b9e\u73b0\u4e86\u65b0\u7684 AST \u8282\u70b9\u3002"),(0,s.kt)("p",null,"\u901a\u8fc7\u8fd9\u4e2a\u7b80\u5355\u7684\u4f8b\u5b50\uff0c\u6211\u4eec\u80fd\u5927\u6982\u7406\u89e3 babel \u662f\u600e\u4e48\u57fa\u4e8e acorn \u5b9e\u73b0 typescript\u3001jsx\u3001flow \u8bed\u6cd5\u89e3\u6790\u7684\u4e86\u3002"),(0,s.kt)("p",null,"\u6bd4\u5982 Literal \u6269\u5c55\u4e86 StringLiteral\u3001NumericLiteral \u7b49\u8fd9\u4e00\u70b9\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u81ea\u5df1\u5b9e\u73b0\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre"},"parseLiteral (...args) {\n    const node = super.parseLiteral(...args);\n    switch(typeof node.value) {\n        case 'number':\n            node.type = 'NumericLiteral';\n            break;\n        case 'string':\n            node.type = 'StringLiteral';\n            break;\n    }\n    return  node;\n}\n")),(0,s.kt)("h2",{id:"\u603b\u7ed3"},"\u603b\u7ed3"),(0,s.kt)("p",null,"\u8fd9\u4e00\u8282\u6211\u4eec\u4e86\u89e3\u4e86 js parser \u7684\u5386\u53f2\uff0c\u4ece SpiderMonkey \u7684 AST \u6807\u51c6\u5f00\u59cb\uff0c\u6269\u5c55\u5230 espree \u7684\u6807\u51c6\uff0c\u6700\u65e9\u7684 estree \u6807\u51c6\u7684\u5b9e\u73b0\u662f esprima\uff0c\u4f46\u662f\u968f\u7740 es2015 \u5f00\u59cb\u4e00\u5e74\u4e00\u4e2a\u7248\u672c\uff0cesprima \u7684\u8fed\u4ee3\u901f\u5ea6\u9010\u6e10\u8ddf\u4e0d\u4e0a\u4e86\uff0c\u8fd9\u65f6\u5019 acorn \u6d41\u884c\u8d77\u6765\uff0c\u56e0\u4e3a\u901f\u5ea6\u66f4\u5feb\uff0c\u800c\u4e14\u652f\u6301\u63d2\u4ef6\u6269\u5c55\uff0c\u4e8e\u662f espree\u3001babel parser","(","babylon",")"," \u7b49\u90fd\u57fa\u4e8e acorn \u6765\u5b9e\u73b0\u5404\u81ea\u7684 parser\u3002\u867d\u7136 estree \u7cfb\u5217\u7684 js parser \u633a\u591a\u7684\uff0c\u4f46\u4e5f\u4e0d\u662f\u5168\u90e8\uff0cterser\u3001typescript \u7b49\u90fd\u662f\u7528\u81ea\u5df1\u7684AST\u3002"),(0,s.kt)("p",null,"\u5b66\u5b8c\u8fd9\u4e00\u8282\uff0c\u6211\u4eec\u66f4\u5168\u9762\u7684\u4e86\u89e3\u4e86 js parser \u7684\u5386\u53f2\uff0c\u5bf9\u5404\u79cd\u5de5\u5177\u6240\u7528\u7684 parser \u4e4b\u95f4\u7684\u5173\u7cfb\u6709\u4e86\u4e00\u5b9a\u7684\u4e86\u89e3\uff0c\u5e76\u4e14\u8fd8\u77e5\u9053\u4e86 acorn \u7684\u8bed\u6cd5\u63d2\u4ef6\u8be5\u600e\u4e48\u5199\u3002"),(0,s.kt)("p",null,"\uff08\u4ee3\u7801\u5728",(0,s.kt)("a",{parentName:"p",href:"https://github.com/QuarkGluonPlasma/babel-plugin-exercize"},"\u8fd9\u91cc"),"\uff0c\u5efa\u8bae git clone \u4e0b\u6765\u901a\u8fc7 node \u8dd1\u4e00\u4e0b\uff09"))}d.isMDXComponent=!0}}]);