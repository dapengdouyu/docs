(self.webpackChunkdapengdouyu=self.webpackChunkdapengdouyu||[]).push([[7980],{3905:function(e,t,n){"use strict";n.d(t,{Zo:function(){return c},kt:function(){return k}});var r=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function p(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var i=r.createContext({}),s=function(e){var t=r.useContext(i),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},c=function(e){var t=s(e.components);return r.createElement(i.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},d=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,i=e.parentName,c=p(e,["components","mdxType","originalType","parentName"]),d=s(n),k=a,f=d["".concat(i,".").concat(k)]||d[k]||u[k]||o;return n?r.createElement(f,l(l({ref:t},c),{},{components:n})):r.createElement(f,l({ref:t},c))}));function k(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,l=new Array(o);l[0]=d;var p={};for(var i in t)hasOwnProperty.call(t,i)&&(p[i]=t[i]);p.originalType=e,p.mdxType="string"==typeof e?e:a,l[1]=p;for(var s=2;s<o;s++)l[s]=n[s];return r.createElement.apply(null,l)}return r.createElement.apply(null,n)}d.displayName="MDXCreateElement"},938:function(e,t,n){"use strict";n.r(t),n.d(t,{frontMatter:function(){return p},contentTitle:function(){return i},metadata:function(){return s},toc:function(){return c},default:function(){return d}});var r=n(4034),a=n(9973),o=(n(7294),n(3905)),l=["components"],p={},i=void 0,s={unversionedId:"books/Babel \u63d2\u4ef6\u901a\u5173\u79d8\u7c4d/17\u3001\u5b9e\u6218\u6848\u4f8b: linter",id:"books/Babel \u63d2\u4ef6\u901a\u5173\u79d8\u7c4d/17\u3001\u5b9e\u6218\u6848\u4f8b: linter",isDocsHomePage:!1,title:"17\u3001\u5b9e\u6218\u6848\u4f8b: linter",description:"lint \u662f\u4ec0\u4e48\uff1f \u7ef4\u57fa\u767e\u79d1\u4e2d\u662f\u8fd9\u6837\u8bf4\u7684",source:"@site/docs/books/Babel \u63d2\u4ef6\u901a\u5173\u79d8\u7c4d/17\u3001\u5b9e\u6218\u6848\u4f8b: linter.md",sourceDirName:"books/Babel \u63d2\u4ef6\u901a\u5173\u79d8\u7c4d",slug:"/books/Babel \u63d2\u4ef6\u901a\u5173\u79d8\u7c4d/17\u3001\u5b9e\u6218\u6848\u4f8b: linter",permalink:"/docs/books/Babel \u63d2\u4ef6\u901a\u5173\u79d8\u7c4d/17\u3001\u5b9e\u6218\u6848\u4f8b: linter",editUrl:"https://github.com/dapengdouyu/docs/tree/master/docs/books/Babel \u63d2\u4ef6\u901a\u5173\u79d8\u7c4d/17\u3001\u5b9e\u6218\u6848\u4f8b: linter.md",version:"current",lastUpdatedAt:1633933712,formattedLastUpdatedAt:"10/11/2021",frontMatter:{},sidebar:"books",previous:{title:"16\u3001\u5b9e\u6218\u6848\u4f8b:\u81ea\u52a8\u751f\u6210 api \u6587\u6863",permalink:"/docs/books/Babel \u63d2\u4ef6\u901a\u5173\u79d8\u7c4d/16\u3001\u5b9e\u6218\u6848\u4f8b:\u81ea\u52a8\u751f\u6210 api \u6587\u6863"},next:{title:"18\u3001\u5b9e\u6218\u6848\u4f8b: type checker",permalink:"/docs/books/Babel \u63d2\u4ef6\u901a\u5173\u79d8\u7c4d/18\u3001\u5b9e\u6218\u6848\u4f8b: type checker"}},c=[{value:"\u68c0\u67e5\u51fa\u9519\u8bef\u7684\u4ee3\u7801",id:"\u68c0\u67e5\u51fa\u9519\u8bef\u7684\u4ee3\u7801",children:[{value:"\u9519\u8bef\u7684 for direction",id:"\u9519\u8bef\u7684-for-direction",children:[]},{value:"\u51fd\u6570\u4e0d\u80fd\u91cd\u65b0\u8d4b\u503c",id:"\u51fd\u6570\u4e0d\u80fd\u91cd\u65b0\u8d4b\u503c",children:[]}]},{value:"\u68c0\u67e5\u51fa\u6ca1\u6709\u9519\u8bef\u4f46\u4e0d\u7b26\u5408\u89c4\u8303\u7684\u4ee3\u7801",id:"\u68c0\u67e5\u51fa\u6ca1\u6709\u9519\u8bef\u4f46\u4e0d\u7b26\u5408\u89c4\u8303\u7684\u4ee3\u7801",children:[{value:"\u7528 === \u4ee3\u66ff ==",id:"\u7528--\u4ee3\u66ff-",children:[]},{value:"\u601d\u8def\u5206\u6790",id:"\u601d\u8def\u5206\u6790-2",children:[]},{value:"\u4ee3\u7801\u5b9e\u73b0",id:"\u4ee3\u7801\u5b9e\u73b0-2",children:[]}]},{value:"\u68c0\u67e5\u51fa\u683c\u5f0f\u4e0d\u5bf9\u7684\u4ee3\u7801",id:"\u68c0\u67e5\u51fa\u683c\u5f0f\u4e0d\u5bf9\u7684\u4ee3\u7801",children:[]},{value:"\u603b\u7ed3",id:"\u603b\u7ed3",children:[]}],u={toc:c};function d(e){var t=e.components,n=(0,a.Z)(e,l);return(0,o.kt)("wrapper",(0,r.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"lint \u662f\u4ec0\u4e48\uff1f \u7ef4\u57fa\u767e\u79d1\u4e2d\u662f\u8fd9\u6837\u8bf4\u7684"),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"\u5728\u8ba1\u7b97\u673a\u79d1\u5b66\u4e2d\uff0clint\u662f\u4e00\u79cd\u5de5\u5177\u7a0b\u5e8f\u7684\u540d\u79f0\uff0c\u5b83\u7528\u6765\u6807\u8bb0\u6e90\u4ee3\u7801\u4e2d\uff0c\u67d0\u4e9b\u53ef\u7591\u7684\u3001\u4e0d\u5177\u7ed3\u6784\u6027\u7684\u6bb5\u843d\u3002\u5b83\u662f\u4e00\u79cd\u9759\u6001\u7a0b\u5e8f\u5206\u6790\u5de5\u5177\uff0c\u6700\u65e9\u9002\u7528\u4e8eC\u8bed\u8a00\uff0c\u5728UNIX\u5e73\u53f0\u4e0a\u5f00\u53d1\u51fa\u6765\u3002\u540e\u6765\u5b83\u6210\u4e3a\u901a\u7528\u672f\u8bed\uff0c\u53ef\u7528\u4e8e\u63cf\u8ff0\u5728\u4efb\u4f55\u4e00\u79cd\u8ba1\u7b97\u673a\u7a0b\u5e8f\u8bed\u8a00\u4e2d\uff0c\u7528\u6765\u6807\u8bb0\u6e90\u4ee3\u7801\u4e2d\u6709\u7591\u4e49\u6bb5\u843d\u7684\u5de5\u5177\u3002")),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/deb79b45fa8b4ffe858521418e32a2b6~tplv-k3u1fbpfcp-watermark.image",alt:null})),(0,o.kt)("p",null,"lint \u5176\u5b9e\u662f c \u8bed\u8a00\u4e2d\u7684\u4e00\u4e2a\u5de5\u5177\uff0c\u5728 1979 \u5e74\u7531\u8d1d\u5c14\u5b9e\u9a8c\u5ba4\u53d1\u5e03\u7684\u3002\u5b83\u662f\u901a\u8fc7\u9759\u6001\u5206\u6790\u4ee3\u7801\u6765\u68c0\u67e5\u9519\u8bef\u7684\u5de5\u5177\u3002\u540e\u6765\u5404\u9886\u57df\u7684\u7c7b\u4f3c\u5de5\u5177\u90fd\u53eb\u505a xx lint\u3002\u6bd4\u5982\u524d\u7aef\u9886\u57df\u7684 eslint\u3001stylelint \u7b49\u3002"),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/bcc263751e8e44b1a51b6db83c4debde~tplv-k3u1fbpfcp-watermark.image",alt:null})),(0,o.kt)("p",null,"lint \u901a\u8fc7\u9759\u6001\u5206\u6790\u6e90\u7801\uff0c\u5bf9 AST \u8fdb\u884c\u68c0\u67e5\uff0c\u53d1\u73b0\u5176\u4e2d\u7684\u4e00\u4e9b\u4ee3\u7801\u7ed3\u6784\u7684\u9519\u8bef\uff0c\u6216\u8005\u4ee3\u7801\u683c\u5f0f\u7684\u9519\u8bef\u3002"),(0,o.kt)("p",null,"\u4ee3\u7801\u7ed3\u6784\u7684\u9519\u8bef\u5305\u62ec\u4e24\u79cd\u60c5\u51b5\uff1a \u4ee3\u7801\u6709\u903b\u8f91\u6216\u8005\u8bed\u6cd5\u9519\u8bef\uff0c\u4ee3\u7801\u6ca1\u9519\u8bef\u4f46\u662f\u4e0d\u7b26\u5408\u4ee3\u7801\u89c4\u8303\uff1b"),(0,o.kt)("p",null,"\u4ee3\u7801\u683c\u5f0f\u7684\u9519\u8bef\u5219\u662f\uff1a\u4ee3\u7801\u7ed3\u6784\u662f\u5bf9\u7684\uff0c\u4f46\u662f\u7a7a\u683c\u3001\u6362\u884c\u7b49\u683c\u5f0f\u4e0d\u5bf9\u3002"),(0,o.kt)("p",null,"\u8fd9\u4e9b\u90fd\u9700\u8981\u8fdb\u884c lint\u3002"),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"\u9759\u6001\u5206\u6790\uff1a\u52a8\u6001\u6307\u7684\u662f\u4ee3\u7801\u8fd0\u884c\u7684\u65f6\u5019\uff0c\u800c\u9759\u6001\u5219\u4e0d\u4f1a\u8fd0\u884c\u4ee3\u7801\u3002\u9759\u6001\u662f\u901a\u8fc7\u7f16\u8bd1\u7684\u65b9\u5f0f\u6765\u5206\u6790\u6e90\u4ee3\u7801\u3002\u5b83\u7684\u76ee\u7684\u4e0d\u662f\u4e3a\u4e86\u751f\u6210\u76ee\u6807\u4ee3\u7801\uff0c\u800c\u662f\u4e3a\u4e86\u63d0\u53d6\u4e00\u4e9b\u60f3\u8981\u7684\u4fe1\u606f\uff0c\u8fd9\u662f\u548c\u7f16\u8bd1\u7684\u4e0d\u540c\u4e4b\u5904\u3002")),(0,o.kt)("p",null,"parse \u6210 AST\uff0c\u5bf9 AST \u8fdb\u884c\u68c0\u67e5\uff0c\u8fd9\u4e2a\u4e8b\u60c5\u7528 babel \u4e5f\u53ef\u4ee5\u505a\uff0c\u8fd9\u8282\u6211\u4eec\u5c31\u7528 babel \u5199\u4e00\u4e2a lint \u63d2\u4ef6\u3002"),(0,o.kt)("h2",{id:"\u68c0\u67e5\u51fa\u9519\u8bef\u7684\u4ee3\u7801"},"\u68c0\u67e5\u51fa\u9519\u8bef\u7684\u4ee3\u7801"),(0,o.kt)("p",null,"\u4ee3\u7801\u7684\u9519\u8bef\u5199\u6cd5\u53ef\u80fd\u5f88\u591a\uff0c\u5c31\u50cf eslint \u6709\u4e00\u7cfb\u5217\u7684 rule\uff0c\u6211\u4eec\u53ea\u6311\u4e24\u4e2a\u6765\u5b9e\u73b0\u3002"),(0,o.kt)("h3",{id:"\u9519\u8bef\u7684-for-direction"},"\u9519\u8bef\u7684 for direction"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"for (var i = 0; i < 10; i--) {\n}\n\nfor (var i = 10; i >= 0; i++) {\n}\n")),(0,o.kt)("p",null,"\u4e0a\u9762\u4e24\u79cd\u4ee3\u7801\u904d\u5386\u65b9\u5411\u662f\u9519\u8bef\u7684\uff0c\u4f1a\u5bfc\u81f4\u6b7b\u5faa\u73af\u3002\u800c\u5f00\u53d1\u8005\u5199\u4ee3\u7801\u7684\u65f6\u5019\u4e00\u4e2a\u4e0d\u6ce8\u610f\u5c31\u6709\u53ef\u80fd\u5199\u9519\u4e86\uff0c\u6211\u4eec\u5e0c\u671b\u9759\u6001\u5206\u6790\u51fa\u8fd9\u79cd\u9519\u8bef\u4ee3\u7801\uff0c\u5e76\u8fdb\u884c\u7f16\u8bd1\u65f6\u62a5\u9519\u3002"),(0,o.kt)("h4",{id:"\u601d\u8def\u5206\u6790"},"\u601d\u8def\u5206\u6790"),(0,o.kt)("p",null,"for \u8bed\u53e5\u7684 AST \u662f ForStatement\uff0c\u6211\u4eec\u5728 ",(0,o.kt)("a",{parentName:"p",href:"https://astexplorer.net/"},"astexplorer.net")," \u4e2d\u6765\u67e5\u770b\u4e00\u4e0b\u5b83\u7684\u7ed3\u6784"),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/aa528fd0b3af45f4a45b6180fb94cc06~tplv-k3u1fbpfcp-watermark.image",alt:null})),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/69571ea3186a42e492a40ae8ca0611e8~tplv-k3u1fbpfcp-watermark.image",alt:null})),(0,o.kt)("p",null,"init \u90e8\u5206\u662f\u4e00\u4e2a\u53d8\u91cf\u58f0\u660e\u8bed\u53e5 VariableDeclaration\u3002"),(0,o.kt)("p",null,"test \u90e8\u5206\u662f\u4e00\u4e2a\u4e8c\u5143\u8868\u8fbe\u5f0f BinaryExpression\uff0coperator \u5c5e\u6027\u4e3a \\<\u3002"),(0,o.kt)("p",null,"update \u90e8\u5206\u662f\u4e00\u4e2a\u4e00\u5143\u8868\u8fbe\u5f0f UpdateExpression\uff0coperator \u5c5e\u6027\u4e3a ","-","-\u3002"),(0,o.kt)("p",null,"body \u90e8\u5206\u662f\u5757\u8bed\u53e5 BlockStatement\u3002"),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"\u6211\u4eec\u7684\u76ee\u6807\u662f\u68c0\u67e5\u51fa\u904d\u5386\u65b9\u5411\u662f\u5426\u548c\u7ec8\u6b62\u6761\u4ef6\u7684\u5224\u65ad\u4e00\u81f4\uff0c\u4e5f\u5c31\u662f\u8bf4\u5f53 update \u4e3a ++ \u65f6\uff0ctest \u5e94\u4e3a\u4e3a \\<\u3001\\<=\uff1b\u5f53 update \u4e3a ","-","- \u65f6\uff0ctest \u5e94\u4e3a >\u3001>=\u3002\u5982\u679c\u4e0d\u4e00\u81f4\u5c31\u62a5\u9519\u3002")),(0,o.kt)("h4",{id:"\u4ee3\u7801\u5b9e\u73b0"},"\u4ee3\u7801\u5b9e\u73b0"),(0,o.kt)("p",null,"\u9996\u5148\uff0c\u5bf9 ForStatement \u7684 update \u548c test \u505a\u68c0\u67e5\uff0c\u5982\u679c\u4e0d\u4e00\u81f4\u5c31\u62a5\u9519\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"visitor: {\n    ForStatement(path, state) {\n        const testOperator = path.node.test.operator\n        const udpateOperator = path.node.update.operator;\n\n        let sholdUpdateOperator;\n        if (['<', '<='].includes(testOperator)) {\n            sholdUpdateOperator = '++';\n        } else if (['>', '>='].includes(testOperator)) {\n            sholdUpdateOperator = '--';\n        }\n\n        if (sholdUpdateOperator !== udpateOperator) {\n            // \u62a5\u9519\uff1a\u904d\u5386\u65b9\u5411\u9519\u8bef\n        }\n    }\n}\n")),(0,o.kt)("p",null,"\u62a5\u9519\u6211\u4eec\u4f7f\u7528 path \u7684 buildCodeFrameError \u65b9\u6cd5\uff0c\u4ed6\u4f1a\u6784\u9020\u4e00\u4e2a code frame\uff0c\u6807\u8bb0\u51fa\u5f53\u524d node \u7684\u4f4d\u7f6e\u3002\uff08\u7b2c\u4e00\u4e2a\u53c2\u6570\u662f\u9519\u8bef\u4fe1\u606f\uff0c\u7b2c\u4e8c\u4e2a\u53c2\u6570\u662f Error \u5bf9\u8c61\uff09"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"throw path.get('update').buildCodeFrameError(\"for direction error\", Error);\n")),(0,o.kt)("p",null,"\u8fd9\u6837\uff0c\u5f53\u53d1\u73b0 for \u7684\u904d\u5386\u65b9\u5411\u9519\u8bef\u7684\u65f6\u5019\u5c31\u4f1a\u62a5\u9519\uff1a"),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/61e25bc7d2d2483aa7239a29a830e870~tplv-k3u1fbpfcp-watermark.image",alt:null})),(0,o.kt)("p",null,"\u8fd9\u4e2a\u62a5\u9519\u6709\u70b9\u4e11\uff0c\u800c\u4e14\u4e5f\u4e0d\u5e94\u8be5\u76f4\u63a5 throw\uff0c\u6211\u4eec\u6539\u8fdb\u4e00\u4e0b\uff1a"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"\u8bbe\u7f6e Error.stackTraceLimit \u4e3a 0 \uff0c\u8fd9\u6837\u53ef\u4ee5\u53bb\u6389 stack \u7684\u4fe1\u606f")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"\u628a\u9519\u8bef\u4fe1\u606f\u6536\u96c6\u5728\u5168\u5c40 file \u5bf9\u8c61\u4e2d\uff0c\u5728 post \u9636\u6bb5\u53bb\u96c6\u4e2d\u6253\u5370\u9519\u8bef"),(0,o.kt)("p",{parentName:"li"},"const { declare } = require('@babel/helper-plugin-utils');"),(0,o.kt)("p",{parentName:"li"},"const forDirectionLint = declare((api, options, dirname) => {\napi.assertVersion(7);"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre"},"return {\n    pre(file) {\n        file.set('errors', []);\n    },\n    visitor: {\n        ForStatement(path, state) {\n            const errors = state.file.get('errors');\n            const testOperator = path.node.test.operator\n            const udpateOperator = path.node.update.operator;\n\n            let sholdUpdateOperator;\n            if (['<', '<='].includes(testOperator)) {\n                sholdUpdateOperator = '++';\n            } else if (['>', '>='].includes(testOperator)) {\n                sholdUpdateOperator = '--';\n            }\n\n            if (sholdUpdateOperator !== udpateOperator) {\n                const tmp = Error.stackTraceLimit;\n                Error.stackTraceLimit = 0;\n                errors.push(path.get('update').buildCodeFrameError(\"for direction error\", Error));\n                Error.stackTraceLimit = tmp;\n            }\n        }\n    },\n    post(file) {\n        console.log(file.get('errors'));\n    }\n}\n")),(0,o.kt)("p",{parentName:"li"},"});"))),(0,o.kt)("p",null,"\u8fd9\u6837\uff0c\u5f53\u8f93\u5165\u7684\u4ee3\u7801\u5982\u4e0b\u65f6\uff1a"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"for (var i = 0; i < 10; i++) {\n}\n\nfor (var i = 10; i >= 0; i--) {\n}\nfor (var i = 0; i < 10; i--) {\n}\n\nfor (var i = 10; i >= 0; i++) {\n}\n")),(0,o.kt)("p",null,"\u4f1a\u6253\u5370\u62a5\u9519\uff1a"),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/71adc8c7312545d0a1c91998551aeff0~tplv-k3u1fbpfcp-watermark.image",alt:null})),(0,o.kt)("p",null,"\u8fd9\u6837\uff0c\u6211\u4eec\u5c31\u5b8c\u6210\u4e86\u7b2c\u4e00\u4e2a lint \u63d2\u4ef6\uff0c\u5b83\u53ef\u4ee5\u68c0\u67e5\u51fa\u4ee3\u7801\u4e2d\u5faa\u73af\u8bed\u53e5\u904d\u5386\u65b9\u5411\u7684\u9519\u8bef\u3002"),(0,o.kt)("h3",{id:"\u51fd\u6570\u4e0d\u80fd\u91cd\u65b0\u8d4b\u503c"},"\u51fd\u6570\u4e0d\u80fd\u91cd\u65b0\u8d4b\u503c"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"function foo() {}\n// xxx\nfoo = 'guang';\n// xxx\nfoo();\n")),(0,o.kt)("p",null,"\u51fd\u6570\u58f0\u660e\u4e4b\u540e\u6709\u53ef\u80fd\u88ab\u91cd\u65b0\u8d4b\u503c\uff0c\u56e0\u4e3a\u51fd\u6570\u652f\u6301 FunctionDeclaration \u548c FunctionExpression \u4e24\u79cd\u65b9\u5f0f\u58f0\u660e\uff0c\u800c\u7b2c\u4e8c\u79cd\u58f0\u660e\u65b9\u5f0f\u5c31\u662f\u8d4b\u503c\u8bed\u53e5\u7684\u5f62\u5f0f\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"function guang(){}   // FunctionDeclaration\nconst ssh = function () {} // FunctionExpression\n")),(0,o.kt)("p",null,"\u4f46\u662f\u6211\u4eec\u901a\u5e38\u60c5\u51b5\u4e0b\u53ea\u5e0c\u671b\u58f0\u660e\u4e00\u6b21\uff0c\u4e0d\u5e0c\u671b\u4e4b\u540e\u88ab\u4fee\u6539\uff0c\u8fd9\u65f6\u5019\u5c31\u8981\u901a\u8fc7\u9759\u6001\u5206\u6790\u627e\u51fa\u4fee\u6539\u7684\u5730\u65b9\uff0c\u7136\u540e\u62a5\u9519\u3002"),(0,o.kt)("h4",{id:"\u601d\u8def\u5206\u6790-1"},"\u601d\u8def\u5206\u6790"),(0,o.kt)("p",null,"\u8981\u5904\u7406\u7684\u662f\u8d4b\u503c\u8868\u8fbe\u5f0f\uff0c\u5bf9\u5e94\u7684 AST \u662f AssignmentExpression\uff08\u8d4b\u503c\u8868\u8fbe\u5f0f\u53ef\u4ee5\u72ec\u7acb\u4f5c\u4e3a\u8bed\u53e5\uff0c\u6784\u6210\u8868\u8fbe\u5f0f\u8bed\u53e5 ExpressionStatement\uff09\uff0c\u8981\u5224\u65ad left \u5c5e\u6027\u662f\u5426\u5f15\u7528\u7684\u662f\u4e00\u4e2a\u51fd\u6570\u3002"),(0,o.kt)("p",null,"\u83b7\u53d6\u53d8\u91cf\u7684\u5f15\u7528\u9700\u8981\u7528 path.scope.getBinding \u7684 api\uff0c\u4ece\u4f5c\u7528\u57df\u4e2d\u67e5\u627e binding\uff0c\u7136\u540e\u5224\u65ad\u58f0\u660e\u7684\u8282\u70b9\u662f\u5426\u662f\u4e00\u4e2a FunctionDeclaration \u6216 FunctionExpression\u3002\u5982\u679c\u662f\uff0c\u8bf4\u660e\u5bf9\u51fd\u6570\u8fdb\u884c\u4e86\u91cd\u65b0\u8d4b\u503c\uff0c\u5c31\u62a5\u9519\u3002"),(0,o.kt)("h4",{id:"\u4ee3\u7801\u5b9e\u73b0-1"},"\u4ee3\u7801\u5b9e\u73b0"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"const { declare } = require('@babel/helper-plugin-utils');\n\nconst noFuncAssignLint = declare((api, options, dirname) => {\n    api.assertVersion(7);\n\n    return {\n        pre(file) {\n            file.set('errors', []);\n        },\n        visitor: {\n            AssignmentExpression(path, state) {\n                const errors = state.file.get('errors');\n \n                const assignTarget = path.get('left').toString()\uff1b\n                const binding = path.scope.getBinding(assignTarget);\n                if (binding) {\n                    // \u67e5\u627e\u5230\u4e86\u5de6\u503c\u5bf9\u5e94\u7684\u58f0\u660e\uff0c\u662f\u51fd\u6570\u58f0\u660e\n                    if (binding.path.isFunctionDeclaration() || binding.path.isFunctionExpression()) {\n                        const tmp = Error.stackTraceLimit;\n                        Error.stackTraceLimit = 0;\n                        errors.push(path.buildCodeFrameError('can not reassign to function', Error));\n                        Error.stackTraceLimit = tmp;\n                    }\n                }\n            }\n        },\n        post(file) {\n            console.log(file.get('errors'));\n        }\n    }\n});\n")),(0,o.kt)("p",null,"\u5f53\u8f93\u5165\u4e3a\uff1a"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"function foo() {\n    foo = bar;\n}\n\nvar a = function hello() {\n    hello = 123;\n};\n")),(0,o.kt)("p",null,"\u6548\u679c\u5982\u4e0b\uff1a"),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/01b397915b9341ac9326556c893e0bf8~tplv-k3u1fbpfcp-watermark.image",alt:null})),(0,o.kt)("p",null,"\u4f1a\u5bf9\u8d4b\u503c\u7ed9\u51fd\u6570\u7684\u8bed\u53e5\u62a5\u9519\uff0c\u800c\u5176\u4ed6\u8d4b\u503c\u8bed\u53e5\u4e0d\u4f1a\u62a5\u9519\u3002"),(0,o.kt)("h2",{id:"\u68c0\u67e5\u51fa\u6ca1\u6709\u9519\u8bef\u4f46\u4e0d\u7b26\u5408\u89c4\u8303\u7684\u4ee3\u7801"},"\u68c0\u67e5\u51fa\u6ca1\u6709\u9519\u8bef\u4f46\u4e0d\u7b26\u5408\u89c4\u8303\u7684\u4ee3\u7801"),(0,o.kt)("p",null,"\u9700\u8981 lint \u7684\u53ef\u80fd\u662f\u4ee3\u7801\u7684\u9519\u8bef\uff0c\u4f46\u6709\u7684\u65f6\u5019\u4ee3\u7801\u6ca1\u6709\u9519\u8bef\uff0c\u53ea\u662f\u4e0d\u7b26\u5408\u6211\u4eec\u7684\u89c4\u8303\uff0c\u8fd9\u79cd\u4e5f\u8981\u68c0\u67e5\u3002\u6bd4\u5982 == \u548c === \u7684\u4f7f\u7528\u3002"),(0,o.kt)("h3",{id:"\u7528--\u4ee3\u66ff-"},"\u7528 === \u4ee3\u66ff =="),(0,o.kt)("p",null,"\\== \u5219\u53ea\u6bd4\u8f83\u503c\uff0c\u5982\u679c\u7c7b\u578b\u4e0d\u4e00\u6837\u4f1a\u5c1d\u8bd5\u81ea\u52a8\u7c7b\u578b\u8f6c\u6362\uff0c \u800c === \u8fd0\u7b97\u7b26\u4f1a\u540c\u65f6\u6bd4\u8f83\u7c7b\u578b\u548c\u503c\uff0c\u4e0d\u4f1a\u8fdb\u884c\u7c7b\u578b\u8f6c\u6362\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"'' == false // true\n'' === false // false\n")),(0,o.kt)("p",null,"\u663e\u7136\uff0c\u7528 === \u8fd0\u7b97\u7b26\u66f4\u5b89\u5168\u4e00\u4e9b\uff0c\u6240\u4ee5\u6211\u4eec\u4f1a\u628a\u5b83\u4f5c\u4e3a\u4ee3\u7801\u89c4\u8303\uff0clint \u7684\u65f6\u5019\u505a\u68c0\u67e5\u3002"),(0,o.kt)("h3",{id:"\u601d\u8def\u5206\u6790-2"},"\u601d\u8def\u5206\u6790"),(0,o.kt)("p",null,"\u5904\u7406\u7684\u76ee\u6807\u662f BinaryExpression\uff0c\u5f53 operator \u4e3a == \u6216\u8005 ","!","= \u7684\u65f6\u5019\uff0c\u5c31\u8fdb\u884c\u62a5\u9519\u5e76\u81ea\u52a8\u4fee\u590d\uff08\u4fee\u6539 operator \u7684\u503c\u4e3a === \u6216 ","!","==\uff09\u3002\u4f46\u8981\u6392\u9664\u4e00\u79cd\u60c5\u51b5\uff1a\u5de6\u503c\u548c\u53f3\u503c\u7c7b\u578b\u90fd\u4e3a Literal\uff08\u5b57\u9762\u91cf\uff09\u4e14\u503c\u7684\u7c7b\u578b\u4e5f\u4e00\u6837\uff0c\u6bd4\u5982 ",(0,o.kt)("inlineCode",{parentName:"p"},"'guang' == 'ssh'"),"\uff0c\u4e24\u8fb9\u90fd\u662f\u5b57\u9762\u91cf\u7c7b\u578b\uff0c\u800c\u4e14\u7c7b\u578b\u662f\u4e00\u6837\u7684\uff0c\u5c31\u6ca1\u5fc5\u8981\u8f6c\u6210 === \u4e86\u3002"),(0,o.kt)("h3",{id:"\u4ee3\u7801\u5b9e\u73b0-2"},"\u4ee3\u7801\u5b9e\u73b0"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"const { declare } = require('@babel/helper-plugin-utils');\n\nconst forDirectionLint = declare((api, options, dirname) => {\n    api.assertVersion(7);\n\n    return {\n        pre(file) {\n            file.set('errors', []);\n        },\n        visitor: {\n            BinaryExpression(path, state) {\n                const errors = state.file.get('errors');\n                if (['==', '!='].includes(path.node.operator)) {\n                    const left = path.get('left');\n                    const right = path.get('right');\n                    // \u5982\u679c\u4e24\u8fb9\u90fd\u662f\u5b57\u9762\u91cf\u4e14\u503c\u7684\u7c7b\u578b\u4e00\u6837\n                    if (!(left.isLiteral() && right.isLiteral() \n                    && typeof left.node.value === typeof right.node.value)) {\n                        const tmp = Error.stackTraceLimit;\n                        Error.stackTraceLimit = 0;\n                        errors.push(path.buildCodeFrameError(`please replace ${path.node.operator} with ${path.node.operator + '='}`, Error));\n                        Error.stackTraceLimit = tmp;\n                        // \u81ea\u52a8\u4fee\u590d\n                        if (state.opts.fix) {\n                            path.node.operator = path.node.operator + '=';\n                        }\n                    }\n                }\n            }\n        },\n        post(file) {\n            console.log(file.get('errors'));\n        }\n    }\n});\n")),(0,o.kt)("p",null,"\u8fd9\u91cc\u7279\u6b8a\u7684\u5730\u65b9\u5c31\u662f\u652f\u6301\u81ea\u52a8 fix\u3002eslint \u53ef\u4ee5\u901a\u8fc7 ","-","-fix \u6765\u81ea\u52a8\u4fee\u590d\u4e00\u4e9b rule \u7684\u62a5\u9519\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u505a\u5230\uff0c\u56e0\u4e3a\u6211\u4eec\u77e5\u9053\u600e\u4e48\u4fee\u6539\u628a AST \u4fee\u6539\u6210\u6b63\u786e\u7684\uff0c\u5f53\u7528\u6237\u6307\u5b9a\u4e86 fix \u53c2\u6570\u7684\u65f6\u5019\uff0c\u5c31\u53ef\u4ee5\u81ea\u52a8\u8fdb\u884c\u4fee\u590d\u3002"),(0,o.kt)("p",null,"\u6211\u4eec\u6765\u6d4b\u8bd5\u4e00\u4e0b\u8fd9\u4e2a\u63d2\u4ef6\uff1a"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"const { transformFromAstSync } = require('@babel/core');\nconst  parser = require('@babel/parser');\nconst eqLintPlugin = require('./plugin/eq-lint');\n\nconst sourceCode = `\na == b\nfoo == true\nbananas != 1\nvalue == undefined\ntypeof foo == 'undefined'\n'hello' != 'world'\n0 == 0\ntrue == true\n`;\n\nconst ast = parser.parse(sourceCode, {\n    sourceType: 'unambiguous'\n});\n\nconst { code } = transformFromAstSync(ast, sourceCode, {\n    plugins: [[eqLintPlugin, {\n        fix: true\n    }]],\n});\n\nconsole.log(code);\n")),(0,o.kt)("p",null,"\u7ed3\u679c\u5982\u4e0b\uff1a"),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b858df6267ce4a5da8e9f188f0ab1f3d~tplv-k3u1fbpfcp-watermark.image",alt:null})),(0,o.kt)("p",null,"\u53ef\u4ee5\u770b\u5230\uff0c\u6b63\u786e\u8bc6\u522b\u51fa\u4e86 == \u548c ","!","= \u7684 BinaryExprssion\uff0c\u5e76\u4e14\u53ea\u5bf9\u9700\u8981\u8f6c\u6362\u7684\u8fdb\u884c\u4e86\u81ea\u52a8\u7684\u4fee\u590d\u3002"),(0,o.kt)("h2",{id:"\u68c0\u67e5\u51fa\u683c\u5f0f\u4e0d\u5bf9\u7684\u4ee3\u7801"},"\u68c0\u67e5\u51fa\u683c\u5f0f\u4e0d\u5bf9\u7684\u4ee3\u7801"),(0,o.kt)("p",null,"\u4e0a\u9762\u7684\u4e24\u79cd\u60c5\u51b5\u90fd\u662f\u4ee3\u7801\u7ed3\u6784\u6709\u9519\u8bef\uff0c\u800c\u5bf9\u4e8e\u4ee3\u7801\u683c\u5f0f\u7684\u9519\u8bef\u6211\u4eec\u540c\u6837\u9700\u8981 lint\u3002"),(0,o.kt)("p",null,"\u6bd4\u5982\u4e0b\u9762\u4e00\u6bb5\u4ee3\u7801"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"function foo() {return true;}\n")),(0,o.kt)("p",null,"\u5728\u51fd\u6570\u4f53\u7684\u5927\u62ec\u53f7\u5185\u4fa7\u6ca1\u6709\u7a7a\u683c\uff0c\u89c4\u8303\u7684\u683c\u5f0f\u5e94\u8be5\u662f\u8981\u6709\u7a7a\u683c\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"function foo() { return true; }\n")),(0,o.kt)("p",null,"\u6211\u4eec\u600e\u4e48\u6821\u9a8c\u8fd9\u79cd\u9519\u8bef\u5462\uff1f"),(0,o.kt)("p",null,"\u6211\u4eec\u53bb\u770b\u770b eslint \u662f\u600e\u4e48\u505a\u7684\uff1a"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"\u62ff\u5230\u51fd\u6570\u4f53\u7684\u5de6\u62ec\u53f7\u7684 token"),(0,o.kt)("li",{parentName:"ol"},"\u62ff\u5230\u5de6\u62ec\u53f7\u540e\u7684\u7b2c\u4e00\u4e2a token"),(0,o.kt)("li",{parentName:"ol"},"\u5bf9\u6bd4\u4e0b\u4e24\u4e2a token \u7684\u4f4d\u7f6e\uff0c\u5982\u679c\u4e0d\u5728\u540c\u4e00\u884c\uff0c\u6216\u8005\u4e4b\u95f4\u6709\u7a7a\u683c\u5c31\u662f\u7b26\u5408\u89c4\u8303\u7684\u3002")),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d41609875fa84747bf3021477cddcd80~tplv-k3u1fbpfcp-watermark.image",alt:null})),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/21ede0396a244dc5bfc0f78442215817~tplv-k3u1fbpfcp-watermark.image",alt:"image.png"})),(0,o.kt)("p",null,"\u4f46\u662f\uff0cbabel \u5e76\u6ca1\u6709\u83b7\u53d6 AST \u5173\u8054\u7684 token \u7684 api\uff0c\u53ea\u80fd\u83b7\u53d6\u5173\u8054\u7684 comments\uff0c\u901a\u8fc7 leadingComments\u3001tailingComments\u3001innerComments \u8fd9\u4e09\u4e2a\u5c5e\u6027\u3002"),(0,o.kt)("p",null,"\u6240\u4ee5\uff0cbabel \u65e0\u6cd5\u505a\u8fd9\u79cd\u6821\u9a8c\u3002\u6211\u4eec\u5728 js parser \u7684\u5386\u53f2\u90a3\u4e00\u8282\u8bb2\u8fc7 eslint \u6709\u81ea\u5df1\u7684 parser\uff1aespree\uff0cespree \u5c31\u505a\u4e86 AST \u548c\u5bf9\u5e94\u7684 comments\u3001token \u7684\u5173\u8054\uff0c\u5b83\u505a\u4ee3\u7801\u683c\u5f0f\u7684\u68c0\u67e5\u9700\u8981\u8fd9\u6837\u7684\u80fd\u529b\uff0c\u800c babel \u53ea\u63d0\u4f9b\u4e86\u5173\u8054 comments \u7684\u80fd\u529b\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 path.addComment","(","'leading', '\\@","_","_","PURE","_","_","', false",")"," \u6765\u5728\u8282\u70b9\u524d\u6dfb\u52a0\u4e00\u4e2a\u5757\u6ce8\u91ca\uff0c\u56e0\u4e3a babel \u8f6c\u8bd1\u7684\u7ed3\u679c\u53ef\u80fd\u8fd8\u8981\u4ea4\u7ed9 terser \u6765\u538b\u7f29\uff0c\u53ef\u4ee5\u901a\u8fc7\u8fd9\u6837\u7684\u65b9\u5f0f\u6765\u6807\u8bc6\u4e00\u4e2a\u51fd\u6570\u662f\u65e0\u526f\u4f5c\u7528\u7684\uff0c\u5982\u679c\u6ca1\u6709\u7528\u5230\u5c31\u53ef\u4ee5\u653e\u5fc3\u7684\u5220\u9664\u3002"),(0,o.kt)("p",null,"babel \u63d2\u4ef6\u548c eslint \u63d2\u4ef6\u7684\u4e0d\u540c\u53ef\u4ee5\u770b\u8fd9\u7bc7\u6587\u7ae0\uff1a",(0,o.kt)("a",{parentName:"p",href:"https://juejin.cn/post/7003204313292128264"},"\u6df1\u5165\u5bf9\u6bd4 eslint \u63d2\u4ef6 \u548c babel \u63d2\u4ef6\u7684\u5f02\u540c\u70b9")),(0,o.kt)("h2",{id:"\u603b\u7ed3"},"\u603b\u7ed3"),(0,o.kt)("p",null,"\u8fd9\u4e00\u8282\uff0c\u6211\u4eec\u4ece lint \u8fd9\u4e2a\u5386\u53f2\u60a0\u4e45\u7684 c \u8bed\u8a00\u7684\u9759\u6001\u68c0\u67e5\u5de5\u5177\u804a\u8d77\uff0c\u4ecb\u7ecd\u4e86 eslint\u3001stylelint\uff0c\u5b83\u4eec\u90fd\u662f\u901a\u8fc7\u9759\u6001\u5206\u6790\u7684\u65b9\u5f0f\u53d1\u73b0\u4ee3\u7801\u4e2d\u7684\u9519\u8bef\uff0c\u5f53\u7136\u8981 lint \u7684\u9664\u4e86\u9519\u8bef\uff0c\u8fd8\u6709\u89c4\u8303\u548c\u683c\u5f0f\u3002"),(0,o.kt)("p",null,"\u540e\u9762\u6211\u4eec\u5206\u522b\u5b9e\u73b0\u4e86\u9519\u8bef\u7684 for \u8fed\u4ee3\u65b9\u5411\u3001\u51fd\u6570\u91cd\u65b0\u8d4b\u503c\u3001\u66ff\u6362 == \u4e3a === \u7b49 lint\uff0c\u5e76\u652f\u6301\u4e86 fix\u3002 \u4e4b\u540e\u5206\u6790\u4e86\u4e3a\u5565 babel \u505a\u4e0d\u5230\u50cf eslint \u4e00\u6837\u7684\u4ee3\u7801\u683c\u5f0f\u7684\u6821\u9a8c\u548c\u4fee\u590d\uff0c\u4e86\u89e3\u4e86 babel parser\uff08babylon\uff09\u548c espree \u7684\u533a\u522b\u3002"),(0,o.kt)("p",null,"\u5b66\u5b8c\u8fd9\u4e00\u8282\uff0c\u6211\u4eec\u5bf9 babel \u63d2\u4ef6\u7684\u4e66\u5199\uff0cbabel \u7684 api \u6709\u66f4\u8fdb\u4e00\u6b65\u7684\u638c\u63e1\u3002\u5e76\u4e14\u7406\u89e3 lint \u662f\u600e\u4e48\u5b9e\u73b0\u7684\uff0c\u4ee5\u540e\u5982\u679c\u53bb\u5199 eslint \u63d2\u4ef6\u5927\u6982\u662f\u4ec0\u4e48\u6837\u7684\u601d\u8def\u3002"),(0,o.kt)("p",null,"\uff08\u4ee3\u7801\u5728",(0,o.kt)("a",{parentName:"p",href:"https://github.com/QuarkGluonPlasma/babel-plugin-exercize"},"\u8fd9\u91cc"),"\uff0c\u5efa\u8bae git clone \u4e0b\u6765\u901a\u8fc7 node \u8dd1\u4e00\u4e0b\uff09"))}d.isMDXComponent=!0}}]);