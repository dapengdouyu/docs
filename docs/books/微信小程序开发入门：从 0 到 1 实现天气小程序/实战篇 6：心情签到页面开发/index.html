<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.7">
<link rel="alternate" type="application/rss+xml" href="/rss.xml" title="Dapeng&#39;s blog RSS Feed">
<script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?7dda2565ba246ecd62878c13153e2941",e.defer=!0;var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script>
<meta name="baidu-site-verification" content="IXU12YQUjF">
<link rel="preconnect" href="https://hmcdn.baidu.com">
<link rel="stylesheet" href="https://cansiny.oss-cn-shanghai.aliyuncs.com/assets/fonts.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/katex.min.css" integrity="sha384-Um5gpz1odJg5Z4HAmzPtgZKdTBHZdw8S29IecapCSB31ligYPhHQZMIlWLYQGVoc" crossorigin="anonymous"><title data-react-helmet="true">å®æˆ˜ç¯‡ 6ï¼šå¿ƒæƒ…ç­¾åˆ°é¡µé¢å¼€å‘ - Dapengçš„åšå®¢</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://dapengdouyu.github.io/docs/books/å¾®ä¿¡å°ç¨‹åºå¼€å‘å…¥é—¨ï¼šä» 0 åˆ° 1 å®ç°å¤©æ°”å°ç¨‹åº/å®æˆ˜ç¯‡ 6ï¼šå¿ƒæƒ…ç­¾åˆ°é¡µé¢å¼€å‘"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="å®æˆ˜ç¯‡ 6ï¼šå¿ƒæƒ…ç­¾åˆ°é¡µé¢å¼€å‘ - Dapengçš„åšå®¢"><meta data-react-helmet="true" name="description" content="ã€Œæ–°é²œå¤©æ°”ã€çš„å¿ƒæƒ…ç­¾åˆ°é¡µé¢ç»“æ„æ¯”è¾ƒç®€å•ï¼Œæœ¬å°èŠ‚ä¸»è¦ä»‹ç»ä¸‰éƒ¨åˆ†å†…å®¹ï¼š"><meta data-react-helmet="true" property="og:description" content="ã€Œæ–°é²œå¤©æ°”ã€çš„å¿ƒæƒ…ç­¾åˆ°é¡µé¢ç»“æ„æ¯”è¾ƒç®€å•ï¼Œæœ¬å°èŠ‚ä¸»è¦ä»‹ç»ä¸‰éƒ¨åˆ†å†…å®¹ï¼š"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://dapengdouyu.github.io/docs/books/å¾®ä¿¡å°ç¨‹åºå¼€å‘å…¥é—¨ï¼šä» 0 åˆ° 1 å®ç°å¤©æ°”å°ç¨‹åº/å®æˆ˜ç¯‡ 6ï¼šå¿ƒæƒ…ç­¾åˆ°é¡µé¢å¼€å‘"><link data-react-helmet="true" rel="alternate" href="https://dapengdouyu.github.io/docs/books/å¾®ä¿¡å°ç¨‹åºå¼€å‘å…¥é—¨ï¼šä» 0 åˆ° 1 å®ç°å¤©æ°”å°ç¨‹åº/å®æˆ˜ç¯‡ 6ï¼šå¿ƒæƒ…ç­¾åˆ°é¡µé¢å¼€å‘" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://dapengdouyu.github.io/docs/books/å¾®ä¿¡å°ç¨‹åºå¼€å‘å…¥é—¨ï¼šä» 0 åˆ° 1 å®ç°å¤©æ°”å°ç¨‹åº/å®æˆ˜ç¯‡ 6ï¼šå¿ƒæƒ…ç­¾åˆ°é¡µé¢å¼€å‘" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.104602c4.css">
<link rel="preload" href="/assets/js/runtime~main.044e1902.js" as="script">
<link rel="preload" href="/assets/js/main.13b64cb7.js" as="script">
</head>
<body>
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,e("light"))}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.jpg" alt="DAPENG" class="themedImage_1VuW themedImage--light_3UqQ"><img src="/img/logo.jpg" alt="DAPENG" class="themedImage_1VuW themedImage--dark_hz6m"></div><b class="navbar__title">DAPENG</b></a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a aria-current="page" class="navbar__link" href="/">åšå®¢</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/tags/java-script">JavaScript</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link">å‰ç«¯</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/program/javascript/index">Javascript</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link">é˜…è¯»</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/books/Babel æ’ä»¶é€šå…³ç§˜ç±/index">Babel æ’ä»¶é€šå…³ç§˜ç±</a></li></ul></div><a href="https://github.com/dapengdouyu" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>github<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_71bT toggle_3Zt9 toggleDisabled_3cF-"><div class="toggleTrack_32Fl" role="button" tabindex="-1"><div class="toggleTrackCheck_3lV7"><span class="toggleIcon_O4iE">ğŸŒœ</span></div><div class="toggleTrackX_S2yS"><span class="toggleIcon_O4iE">ğŸŒ</span></div><div class="toggleTrackThumb_xI_Z"></div></div><input type="checkbox" class="toggleScreenReader_28Tw" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_35hR" type="button"></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Babel æ’ä»¶é€šå…³ç§˜ç±</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">MySQL æ˜¯æ€æ ·è¿è¡Œçš„ï¼šä»æ ¹å„¿ä¸Šç†è§£ MySQL</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">React Hooks ä¸ Immutable æ•°æ®æµå®æˆ˜</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">React ç»„åˆå¼å¼€å‘å®è·µï¼šæ‰“é€ ä¼ä¸šç®¡ç†ç³»ç»Ÿäº”å¤§æ ¸å¿ƒæ¨¡å—</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Reactå®æˆ˜ï¼šè®¾è®¡æ¨¡å¼å’Œæœ€ä½³å®è·µ</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Taro å¤šç«¯å¼€å‘å®ç°åŸç†ä¸é¡¹ç›®å®æˆ˜</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">å‰ç«¯æ€§èƒ½ä¼˜åŒ–åŸç†ä¸å®è·µ</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">å‰ç«¯é¢è¯•ä¹‹é“</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">å¾®ä¿¡å°ç¨‹åºå¼€å‘å…¥é—¨ï¼šä» 0 åˆ° 1 å®ç°å¤©æ°”å°ç¨‹åº</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/books/å¾®ä¿¡å°ç¨‹åºå¼€å‘å…¥é—¨ï¼šä» 0 åˆ° 1 å®ç°å¤©æ°”å°ç¨‹åº/index">index</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/books/å¾®ä¿¡å°ç¨‹åºå¼€å‘å…¥é—¨ï¼šä» 0 åˆ° 1 å®ç°å¤©æ°”å°ç¨‹åº/åŸºç¡€ç¯‡ 1ï¼šå°ç¨‹åºå¼€å‘åŸºç¡€çŸ¥è¯†">åŸºç¡€ç¯‡ 1ï¼šå°ç¨‹åºå¼€å‘åŸºç¡€çŸ¥è¯†</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/books/å¾®ä¿¡å°ç¨‹åºå¼€å‘å…¥é—¨ï¼šä» 0 åˆ° 1 å®ç°å¤©æ°”å°ç¨‹åº/åŸºç¡€ç¯‡ 2ï¼šå°ç¨‹åºäº‘å¼€å‘åŸºç¡€çŸ¥è¯†">åŸºç¡€ç¯‡ 2ï¼šå°ç¨‹åºÂ·äº‘å¼€å‘åŸºç¡€çŸ¥è¯†</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/books/å¾®ä¿¡å°ç¨‹åºå¼€å‘å…¥é—¨ï¼šä» 0 åˆ° 1 å®ç°å¤©æ°”å°ç¨‹åº/åŸºç¡€ç¯‡ 3ï¼šå°ç¨‹åºæ¶æ„åŠå…¶å®ç°æœºåˆ¶">åŸºç¡€ç¯‡ 3ï¼šå°ç¨‹åºæ¶æ„åŠå…¶å®ç°æœºåˆ¶</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/books/å¾®ä¿¡å°ç¨‹åºå¼€å‘å…¥é—¨ï¼šä» 0 åˆ° 1 å®ç°å¤©æ°”å°ç¨‹åº/å®æˆ˜ç¯‡ 1ï¼šå°ç¨‹åºå¼€å‘ç¯å¢ƒæ­å»º">å®æˆ˜ç¯‡ 1ï¼šå°ç¨‹åºå¼€å‘ç¯å¢ƒæ­å»º</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/books/å¾®ä¿¡å°ç¨‹åºå¼€å‘å…¥é—¨ï¼šä» 0 åˆ° 1 å®ç°å¤©æ°”å°ç¨‹åº/å®æˆ˜ç¯‡ 2ï¼šæ–°é²œå¤©æ°”å°ç¨‹åºç®€ä»‹">å®æˆ˜ç¯‡ 2ï¼šæ–°é²œå¤©æ°”å°ç¨‹åºç®€ä»‹</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/books/å¾®ä¿¡å°ç¨‹åºå¼€å‘å…¥é—¨ï¼šä» 0 åˆ° 1 å®ç°å¤©æ°”å°ç¨‹åº/å®æˆ˜ç¯‡ 3ï¼šå¤©æ°”é¡µé¢æ ·å¼å¸ƒå±€å¼€å‘">å®æˆ˜ç¯‡ 3ï¼šå¤©æ°”é¡µé¢æ ·å¼å¸ƒå±€å¼€å‘</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/books/å¾®ä¿¡å°ç¨‹åºå¼€å‘å…¥é—¨ï¼šä» 0 åˆ° 1 å®ç°å¤©æ°”å°ç¨‹åº/å®æˆ˜ç¯‡ 4ï¼šå¤©æ°”é¡µé¢æ•°æ®è·å–å’Œäº¤äº’å®ç°">å®æˆ˜ç¯‡ 4ï¼šå¤©æ°”é¡µé¢æ•°æ®è·å–å’Œäº¤äº’å®ç°</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/books/å¾®ä¿¡å°ç¨‹åºå¼€å‘å…¥é—¨ï¼šä» 0 åˆ° 1 å®ç°å¤©æ°”å°ç¨‹åº/å®æˆ˜ç¯‡ 5ï¼šä¸ºå¤©æ°”é¡µé¢åˆ¶ä½œé›¨é›ªæ•ˆæœçš„ç²’å­ç³»ç»Ÿ">å®æˆ˜ç¯‡ 5ï¼šä¸ºå¤©æ°”é¡µé¢åˆ¶ä½œé›¨é›ªæ•ˆæœçš„ç²’å­ç³»ç»Ÿ</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/books/å¾®ä¿¡å°ç¨‹åºå¼€å‘å…¥é—¨ï¼šä» 0 åˆ° 1 å®ç°å¤©æ°”å°ç¨‹åº/å®æˆ˜ç¯‡ 6ï¼šå¿ƒæƒ…ç­¾åˆ°é¡µé¢å¼€å‘">å®æˆ˜ç¯‡ 6ï¼šå¿ƒæƒ…ç­¾åˆ°é¡µé¢å¼€å‘</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/books/å¾®ä¿¡å°ç¨‹åºå¼€å‘å…¥é—¨ï¼šä» 0 åˆ° 1 å®ç°å¤©æ°”å°ç¨‹åº/å®æˆ˜ç¯‡ 7ï¼šå¯¹å°ç¨‹åºè¿›è¡Œä¼˜åŒ–">å®æˆ˜ç¯‡ 7ï¼šå¯¹å°ç¨‹åºè¿›è¡Œä¼˜åŒ–</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/books/å¾®ä¿¡å°ç¨‹åºå¼€å‘å…¥é—¨ï¼šä» 0 åˆ° 1 å®ç°å¤©æ°”å°ç¨‹åº/å®æˆ˜ç¯‡ 8ï¼šå°ç¨‹åºè°ƒè¯•æŠ€å·§å’Œä¸Šçº¿å‘å¸ƒ">å®æˆ˜ç¯‡ 8ï¼šå°ç¨‹åºè°ƒè¯•æŠ€å·§å’Œä¸Šçº¿å‘å¸ƒ</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/books/å¾®ä¿¡å°ç¨‹åºå¼€å‘å…¥é—¨ï¼šä» 0 åˆ° 1 å®ç°å¤©æ°”å°ç¨‹åº/å¼€ç¯‡ï¼šå¾®ä¿¡å°ç¨‹åºæ¦‚è¿°">å¼€ç¯‡ï¼šå¾®ä¿¡å°ç¨‹åºæ¦‚è¿°</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/books/å¾®ä¿¡å°ç¨‹åºå¼€å‘å…¥é—¨ï¼šä» 0 åˆ° 1 å®ç°å¤©æ°”å°ç¨‹åº/æ€»ç»“ä¸æ‹“å±•">æ€»ç»“ä¸æ‹“å±•</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">æ·±å…¥æµ…å‡ºTypeScriptï¼šä»åŸºç¡€çŸ¥è¯†åˆ°ç±»å‹ç¼–ç¨‹</a></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_1CGd"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_3E-R"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>å®æˆ˜ç¯‡ 6ï¼šå¿ƒæƒ…ç­¾åˆ°é¡µé¢å¼€å‘</h1></header><p>ã€Œæ–°é²œå¤©æ°”ã€çš„å¿ƒæƒ…ç­¾åˆ°é¡µé¢ç»“æ„æ¯”è¾ƒç®€å•ï¼Œæœ¬å°èŠ‚ä¸»è¦ä»‹ç»ä¸‰éƒ¨åˆ†å†…å®¹ï¼š</p><ul><li>ä½¿ç”¨æ—¥å†æ’ä»¶</li><li>ç”¨æˆ·æˆæƒå’Œç™»å½•æµç¨‹</li><li>ä½¿ç”¨å°ç¨‹åºäº‘å¼€å‘çš„æ•°æ®åº“åŠŸèƒ½</li></ul><h2 class="anchor anchorWithStickyNavbar_31ik" id="ä½¿ç”¨æ—¥å†æ’ä»¶">ä½¿ç”¨æ—¥å†æ’ä»¶<a aria-hidden="true" class="hash-link" href="#ä½¿ç”¨æ—¥å†æ’ä»¶" title="Direct link to heading">â€‹</a></h2><p>å¿ƒæƒ…ç­¾åˆ°é¡µé¢æœ€é‡è¦çš„æ¨¡å—å°±æ˜¯æ—¥å†ï¼Œæ—¥å†ä½¿ç”¨äº†ä¸€ä¸ª<a href="https://github.com/czcaiwj/calendar" target="_blank" rel="noopener noreferrer">å¼€æºçš„æ—¥å†æ’ä»¶</a>ï¼Œåœ¨å°ç¨‹åºå†…ä½¿ç”¨æ’ä»¶éœ€è¦ç»è¿‡ä¸‹é¢ä¸‰æ­¥ã€‚</p><h4 class="anchor anchorWithStickyNavbar_31ik" id="1-åœ¨å°ç¨‹åºç®¡ç†åå°æ·»åŠ ä¸‰æ–¹æœåŠ¡æ’ä»¶">1<!-- -->.<!-- --> åœ¨å°ç¨‹åºç®¡ç†åå°æ·»åŠ ä¸‰æ–¹æœåŠ¡æ’ä»¶<a aria-hidden="true" class="hash-link" href="#1-åœ¨å°ç¨‹åºç®¡ç†åå°æ·»åŠ ä¸‰æ–¹æœåŠ¡æ’ä»¶" title="Direct link to heading">â€‹</a></h4><p>ç™»å½•å°ç¨‹åºç®¡ç†åå°ï¼Œä¾æ¬¡è¿›å…¥ã€Œè®¾ç½® -&gt; ç¬¬ä¸‰æ–¹æœåŠ¡ã€æœç´¢æ—¥å†æ’ä»¶çš„ AppIDï¼ˆwx92c68dae5a8bb046ï¼‰å°±å¯ä»¥æœç´¢åˆ°ã€Œæç‚¹æ—¥å†ã€ï¼Œè¿™æ—¶å€™ç”³è¯·æˆæƒå³å¯ã€‚</p><p><img src="https://user-gold-cdn.xitu.io/2018/8/13/1653148e5a1554e6?w=555&amp;h=444&amp;f=jpeg&amp;s=15786"></p><h4 class="anchor anchorWithStickyNavbar_31ik" id="2-åœ¨-appjson-ä¸­å¢åŠ æ’ä»¶é…ç½®">2<!-- -->.<!-- --> åœ¨ app.json ä¸­å¢åŠ æ’ä»¶é…ç½®<a aria-hidden="true" class="hash-link" href="#2-åœ¨-appjson-ä¸­å¢åŠ æ’ä»¶é…ç½®" title="Direct link to heading">â€‹</a></h4><p>ç¬¬äºŒæ­¥æ˜¯åœ¨é¡¹ç›®çš„ app.json ä¸­å¢åŠ  <code>plugins</code> å­—æ®µå†…å®¹ï¼š</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">&quot;plugins&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;calendar&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;version&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;1.1.3&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;provider&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;wx92c68dae5a8bb046&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_31ik" id="3-åœ¨-diary-é¡µé¢å¢åŠ ç»„ä»¶é…ç½®">3<!-- -->.<!-- --> åœ¨ diary é¡µé¢å¢åŠ ç»„ä»¶é…ç½®<a aria-hidden="true" class="hash-link" href="#3-åœ¨-diary-é¡µé¢å¢åŠ ç»„ä»¶é…ç½®" title="Direct link to heading">â€‹</a></h4><p>åœ¨ pages/diary/index.json çš„é¡µé¢é…ç½®ä¸­çš„ <code>usingComponents</code> é‡Œå¢åŠ  <code>calendar</code> çš„æ’ä»¶åœ°å€ï¼š</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;usingComponents&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;calendar&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;plugin://calendar/calendar&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;icon&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;../../components/icon/index&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>ç»è¿‡ä¸Šé¢ä¸‰æ­¥ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨é¡µé¢ä¸­ä½¿ç”¨ <code>&lt;calendar /&gt;</code> æ ‡ç­¾äº†ã€‚å…·ä½“æ—¥å†çš„ç”¨æ³•ï¼Œå¯ä»¥å‚è€ƒå®ƒçš„ <a href="https://github.com/czcaiwj/calendar/wiki" target="_blank" rel="noopener noreferrer">wiki ä¸»é¡µ</a>ã€‚</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="è®¾ç½®æ—¥å†çš„å¿ƒæƒ…é¢œè‰²">è®¾ç½®æ—¥å†çš„å¿ƒæƒ…é¢œè‰²<a aria-hidden="true" class="hash-link" href="#è®¾ç½®æ—¥å†çš„å¿ƒæƒ…é¢œè‰²" title="Direct link to heading">â€‹</a></h3><p>åœ¨å¿ƒæƒ…è®¾ç½®ä¸Šï¼Œç¬”è€…è®¾è®¡äº† 5 ç§å¿ƒæƒ…ï¼Œç”± 5 ç§é¢œè‰²æ¥è¡¨ç¤ºï¼Œå…·ä½“æ•°å€¼å¦‚ä¸‹ï¼š</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// client/pages/diary/index.js Page data</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">emotions</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;serene&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;hehe&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;ecstatic&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;sad&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;terrified&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">colors</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  serene</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;#64d9fe&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  hehe</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;#d3fc1e&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ecstatic</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;#f7dc0e&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  sad</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;#ec238a&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  terrified</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;#ee1aea&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>ç­¾åˆ°ä¸åŒçš„å¿ƒæƒ…ï¼Œæœ€ç»ˆåœ¨æ—¥å†ä¸Šä¼šå±•ç°å‡ºä¸‹é¢çš„æ•ˆæœï¼š</p><p><img src="https://user-gold-cdn.xitu.io/2018/8/17/165469e5ba884ab6?w=345&amp;h=271&amp;f=jpeg&amp;s=22788"></p><p>è¦åœ¨æŸå¤©è®¾ç½®è¯¥å¤©çš„èƒŒæ™¯é¢œè‰²ï¼Œéœ€è¦ä½¿ç”¨æ—¥å†çš„ <code>days-color</code> å±æ€§ï¼Œè¿™é‡Œç¬”è€…å°† <code>days-color</code> ä¸ <code>daysStyle</code> è¿›è¡Œç»‘å®šï¼š</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">&lt;</span><span class="token operator" style="color:#393A34">!</span><span class="token operator" style="color:#393A34">--</span><span class="token plain">diary</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">index</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">wxml</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">calendar days</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">color</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;{{daysStyle}}&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p><code>daysStyle</code> çš„è®¡ç®—å’Œèµ‹å€¼æ˜¯åœ¨ <code>setCalendarColor</code> æ–¹æ³•å†…çš„ï¼š</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// diary/index.js</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">setCalendarColor</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">year</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> month</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  year </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> year </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Date</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getFullYear</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  month </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> month </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Date</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getMonth</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// ä»æ•°æ®åº“è¯»å–æ•°æ®</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">getEmotionByOpenidAndDate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">openid</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> year</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> month</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">then</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">r</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> data </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> r</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">data</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> styles </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> now </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Date</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> today </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">dateFormat</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">now</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> todayEmotion </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> colors </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">colors</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">// éå†æ—¥æœŸï¼Œå­˜åœ¨è¡¨æƒ…çš„æ—¥æœŸåˆ™è®¾ç½®å¯¹åº”çš„é¢œè‰²</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">forEach</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">v</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> ts </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> v</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">tsModified</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> date </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Date</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ts</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> day </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> date</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getDate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">today </span><span class="token operator" style="color:#393A34">===</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">dateFormat</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">date</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          todayEmotion </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> v</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">emotion</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        styles</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">push</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          month</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;current&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          day</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          color</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;black&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          background</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> colors</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">v</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">emotion</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">// è®¾ç½® daysStyle</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">setData</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        lastMonth</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">year</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string string" style="color:#e3116c">-</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation punctuation" style="color:#393A34">(</span><span class="token template-string interpolation string" style="color:#e3116c">&#x27;00&#x27;</span><span class="token template-string interpolation"> </span><span class="token template-string interpolation operator" style="color:#393A34">+</span><span class="token template-string interpolation"> month</span><span class="token template-string interpolation punctuation" style="color:#393A34">)</span><span class="token template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation function" style="color:#d73a49">slice</span><span class="token template-string interpolation punctuation" style="color:#393A34">(</span><span class="token template-string interpolation operator" style="color:#393A34">-</span><span class="token template-string interpolation number" style="color:#36acaa">2</span><span class="token template-string interpolation punctuation" style="color:#393A34">)</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        showPublish</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        todayEmotion</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        daysStyle</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> styles</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword control-flow" style="color:#00009f">catch</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">e</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      wx</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">showToast</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        title</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;åŠ è½½å·²ç­¾æ•°æ®å¤±è´¥ï¼Œè¯·ç¨åå†è¯•&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        icon</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;none&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        duration</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_31ik" id="æ—¥å†äº‹ä»¶ç»‘å®š">æ—¥å†äº‹ä»¶ç»‘å®š<a aria-hidden="true" class="hash-link" href="#æ—¥å†äº‹ä»¶ç»‘å®š" title="Direct link to heading">â€‹</a></h3><p>å½“æ—¥å†åˆ‡æ¢æœˆä»½çš„æ—¶å€™ï¼Œæˆ‘ä»¬åº”è¯¥è·å–å½“å‰åˆ‡æ¢åˆ°çš„æœˆä»½ï¼Œè·å–å½“å‰æœˆä»½çš„å¿ƒæƒ…æ•°æ®ï¼Œæ‰€ä»¥åœ¨ <code>calendar</code> ä¸Šç»‘å®š <code>dateChange</code> äº‹ä»¶ï¼š</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">&lt;</span><span class="token operator" style="color:#393A34">!</span><span class="token operator" style="color:#393A34">--</span><span class="token plain">diary</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">index</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">wxml</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">calendar binddateChange</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;dateChange&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// diary/index.js page</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">dateChange</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">e</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// console.log(e)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">currentYear</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> currentMonth</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> e</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">detail</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">setData</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    daysStyle</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">setCalendarColor</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">currentYear</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> currentMonth</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_31ik" id="å°ç¨‹åºç”¨æˆ·ç™»å½•å’Œæˆæƒæµç¨‹">å°ç¨‹åºç”¨æˆ·ç™»å½•å’Œæˆæƒæµç¨‹<a aria-hidden="true" class="hash-link" href="#å°ç¨‹åºç”¨æˆ·ç™»å½•å’Œæˆæƒæµç¨‹" title="Direct link to heading">â€‹</a></h2><p>åœ¨å¿ƒæƒ…ç­¾åˆ°çš„åŠŸèƒ½å¼€å‘ä¸­ï¼Œéœ€è¦å¾—åˆ°ç”¨æˆ·ä¿¡æ¯ï¼Œè·å–ç”¨æˆ·ä¿¡æ¯éœ€è¦ç”¨æˆ·è´¦å·æˆæƒæ‰å¯ä»¥ã€‚ç”¨æˆ·è´¦å·æˆæƒæ˜¯å°ç¨‹åºå¼€å‘ä¸­ç»å¸¸ç¢°è§çš„æŠ€æœ¯ç‚¹ï¼Œæœ¬èŠ‚é‡ç‚¹ä»‹ç»ä¸‹å°ç¨‹åºçš„ç™»å½•æˆæƒæœºåˆ¶ã€‚</p><p>å°ç¨‹åºå¼€å‘æ–‡æ¡£ä¸­æœ‰ä¸€å¼ å¾ˆå®Œæ•´çš„æµç¨‹å›¾ï¼ˆè§ä¸‹å›¾ï¼‰ï¼Œç¬”è€…ä¼šå›´ç»•è¿™å¼ å›¾æ¥ä»‹ç»ç”¨æˆ·æˆæƒæµç¨‹ï¼Œç„¶åç»“åˆäº‘å‡½æ•°æ¥å®ç°ä¸€ä¸ªè·å–ç”¨æˆ·æˆæƒä¿¡æ¯çš„åŠŸèƒ½ã€‚</p><p><img src="https://user-gold-cdn.xitu.io/2018/8/13/16531493dbf89301?w=710&amp;h=720&amp;f=jpeg&amp;s=61617"></p><p>ä»è¿™å¼ å›¾æ¥çœ‹ï¼Œæ•´ä¸ªæ•°æ®é€šä¿¡è¿‡ç¨‹åŒ…å«äº†å°ç¨‹åºã€å¼€å‘è€…æœåŠ¡å™¨ï¼ˆäº‘å‡½æ•°ï¼‰å’Œå¾®ä¿¡æ¥å£æœåŠ¡ï¼Œè¿™ä¸‰æ–¹æ˜¯éƒ½å‚ä¸å…¶ä¸­çš„ï¼Œæ•´ä¸ªæµç¨‹è·Ÿå…¬ä¼—å·å’Œç¬¬ä¸‰æ–¹ç™»å½•æˆæƒæµç¨‹éƒ½åŸºæœ¬ç±»ä¼¼ã€‚</p><p>æ•´ä¸ªæˆæƒæµç¨‹å¯åˆ†ä¸ºä¸‹é¢äº”ä¸ªæ­¥éª¤ã€‚</p><h4 class="anchor anchorWithStickyNavbar_31ik" id="1-wxlogin-è·å–ä¸´æ—¶ç™»å½•å‡­è¯-code">1<!-- -->.<!-- --> <code>wx.login</code> è·å–ä¸´æ—¶ç™»å½•å‡­è¯ code<a aria-hidden="true" class="hash-link" href="#1-wxlogin-è·å–ä¸´æ—¶ç™»å½•å‡­è¯-code" title="Direct link to heading">â€‹</a></h4><p>ã€Œå°ç¨‹åºã€å†…è°ƒç”¨ <code>wx.login</code> æ–¹æ³•ï¼Œå¦‚æœç”¨æˆ·æ˜¯ç¬¬ä¸€æ¬¡æˆæƒæˆ–è€…æˆæƒè¿‡æœŸï¼Œåˆ™ä¼šå¼¹å‡ºæˆæƒçª—å£ï¼Œæç¤ºç”¨æˆ·ä¸ªäººä¿¡æ¯ä¼šè¢«æˆæƒç»™ç¬¬ä¸‰æ–¹æœåŠ¡ä½¿ç”¨ã€‚è¿™æ—¶å€™å¦‚æœç”¨æˆ·åŒæ„æˆæƒï¼Œåˆ™ä¼šæ‹¿åˆ°<strong>ä¸´æ—¶ç™»å½•å‡­è¯ code</strong>ï¼Œè¿™ä¸ªä¸´æ—¶ç™»å½•å‡­è¯æœ‰æ•ˆæœŸåªæœ‰ <strong>5 åˆ†é’Ÿ</strong>ã€‚æˆ‘ä»¬æ‹¿åˆ°è¿™ä¸ªä¸´æ—¶ç™»å½•å‡­è¯éœ€è¦è°ƒç”¨ã€Œå¼€å‘è€…æœåŠ¡å™¨ï¼ˆäº‘å‡½æ•°ï¼‰ã€çš„æ¥å£ï¼Œå°†ä¸´æ—¶å‡­è¯å‘é€ç»™æœåŠ¡å™¨ï¼Œç„¶åã€Œå¼€å‘è€…æœåŠ¡å™¨ã€è°ƒç”¨ã€Œå¾®ä¿¡æ¥å£æœåŠ¡ã€çš„ <code>jscode2session</code> æ¥å£è·å– <code>openid</code> å’Œ <code>session_key</code>ã€‚</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">wx</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">login</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function-variable function" style="color:#d73a49">success</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">res</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">code</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// example: 081LXytJ1xxxxcdfxxx1FWxdfdsfXyth</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// å°† code å‘é€ç»™å¼€å‘è€…æœåŠ¡å™¨</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_31ik" id="2-è·å–-openid-å’Œ-session_key">2<!-- -->.<!-- --> è·å– <code>openid</code> å’Œ <code>session_key</code><a aria-hidden="true" class="hash-link" href="#2-è·å–-openid-å’Œ-session_key" title="Direct link to heading">â€‹</a></h4><p>å¾®ä¿¡å†…ï¼ŒåŒä¸€ç”¨æˆ·åœ¨ä»»æ„å°ç¨‹åºã€å…¬ä¼—å·æˆ–è€…æœåŠ¡å·ä¸­ï¼Œéƒ½ä¼šæœ‰ä¸€ä¸ªä¸åŒçš„å”¯ä¸€æ ‡è¯† <code>openid</code>ï¼Œæ‰€ä»¥å¯ä»¥è®¤ä¸ºï¼Œæˆ‘ä»¬åœ¨åº”ç”¨ä¸­è·å–çš„ç”¨æˆ· <code>openid</code> æ˜¯å”¯ä¸€çš„ï¼Œå¹¶ä¸”è¯¥ç”¨æˆ·åœ¨å¦å¤–ä¸€ä¸ªåº”ç”¨ä¸­çš„ <code>openid</code> è·Ÿå…¶ä»–åº”ç”¨çš„æ˜¯ä¸åŒçš„ã€‚</p><p><code>session_key</code> æ˜¯å¾®ä¿¡æœåŠ¡æ´¾å‘ç»™æˆ‘ä»¬çš„ä¸€ä¸ªç”¨æˆ·ç™»å½•æœ‰æ•ˆæ€§çš„å‡­è¯ï¼Œé€šè¿‡å®ƒæˆ‘ä»¬å¯ä»¥é—´æ¥ç»´æŠ¤ç”¨æˆ·å¾®ä¿¡çš„ç™»å½•æ€ã€‚</p><p>è·å– <code>openid</code> å’Œ <code>session_key</code> éœ€è¦è°ƒç”¨å¾®ä¿¡çš„æ¥å£ï¼š<br>
<code>https://api.weixin.qq.com/sns/jscode2session?appid=APPID&amp;secret=SECRET&amp;js_code=JSCODE&amp;grant_type=authorization_code</code></p><p>è¿™ä¸ªæ¥å£çš„å‚æ•°ä¸ºï¼š</p><p>å‚æ•°</p><p>å¿…å¡«</p><p>è¯´æ˜</p><p>appid</p><p>æ˜¯</p><p>å°ç¨‹åºå”¯ä¸€æ ‡è¯†</p><p>secret</p><p>æ˜¯</p><p>å°ç¨‹åºçš„ app secret</p><p>js<!-- -->_<!-- -->code</p><p>æ˜¯</p><p>ç™»å½•æ—¶è·å–çš„ code</p><p>grant<!-- -->_<!-- -->type</p><p>æ˜¯</p><p>å¡«å†™ä¸º authorization<!-- -->_<!-- -->code</p><p>å…¶ä¸­ <code>appid</code> å’Œ <code>secret</code> å¯ä»¥åœ¨å°ç¨‹åºç®¡ç†åå°æ‰¾åˆ°ï¼Œå…·ä½“è·¯å¾„ä¸ºã€Œè®¾ç½® -&gt; å¼€å‘è®¾ç½® -&gt; å¼€å‘è€… IDã€ã€‚<code>appid</code> ç›´æ¥å¯è§ï¼Œè€Œ <code>secret</code> éœ€è¦ç‚¹å‡»ã€Œç”Ÿæˆã€é“¾æ¥ï¼Œå¹¶ç”¨å¼€å‘è€…è´¦å·çš„å¾®ä¿¡æ‰«ç æ‰èƒ½ç”Ÿæˆï¼Œç”Ÿæˆä¹‹åéœ€è‡ªè¡Œä¿å­˜ã€‚</p><p><code>secret</code> æ˜¯æˆæƒä¸­ä¿è¯å®‰å…¨æ€§çš„ä¸€ä¸ªé‡è¦ IDï¼Œä¸èƒ½å¤–æ³„ï¼Œå› æ­¤å¿…é¡»æ”¾åœ¨å¼€å‘è€…è‡ªå·±çš„æœåŠ¡å™¨ä¸Šä½¿ç”¨ï¼Œä¸èƒ½ç›´æ¥æ”¾åˆ°å‰ç«¯é¡µé¢è°ƒç”¨å¾®ä¿¡æœåŠ¡æ¥å£ï¼Œå› ä¸ºå¦‚æœè¿™æ ·çš„è¯ <code>secret</code> å°±æš´éœ²äº†ï¼Œè¿™ä¹Ÿæ˜¯æ•´ä¸ªæˆæƒè¿‡ç¨‹éœ€è¦å°ç¨‹åºã€å¼€å‘è€…æœåŠ¡å™¨ã€å¾®ä¿¡æœåŠ¡ä¸‰æ–¹éƒ½ä»‹å…¥çš„åŸå› ã€‚å¦‚æœå¿˜è®°æˆ–æ³„éœ²äº† <code>secret</code>ï¼Œéœ€è¦åœ¨å¾®ä¿¡åå°é‡ç½®ã€‚</p><p><img src="https://user-gold-cdn.xitu.io/2018/8/13/1653149778229d90?w=1298&amp;h=447&amp;f=png&amp;s=39517"></p><p><code>js_code</code> å°±æ˜¯ç¬¬ä¸€æ­¥ä¸­æˆ‘ä»¬é€šè¿‡ <code>wx.login</code> è·å–åˆ°çš„ä¸´æ—¶æˆæƒå‡­è¯ codeã€‚æœ‰äº†<code>appid</code>ã€<code>secret</code>å’Œ<code>js_code</code>ï¼Œæˆ‘ä»¬å¯ä»¥å†™ä¸€ä¸ªäº‘å‡½æ•°æ¥è¯·æ±‚å¾®ä¿¡çš„ <code>jscode2session</code> æ¥å£ï¼š</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// äº‘å‡½æ•°åç§°ï¼šjscode2session</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">API_URL</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;https://api.weixin.qq.com/sns/jscode2session&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> request </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;request&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> querystring </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;querystring&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">/*&lt;jdists import=&quot;../../inline/utils.js&quot; /&gt;*/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">/*&lt;remove&gt;*/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> $ </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;../../inline/utils&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">/*&lt;/remove&gt;*/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">exports</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method-variable function-variable method function property-access" style="color:#d73a49">main</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">event</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">code</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> event</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// è¿™é‡Œå¾®ä¿¡çš„ id å’Œ secret ä»é…ç½®æ–‡ä»¶ä¸­è·å–</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> sk</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getWechatAppConfig</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> data </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    appid</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    secret</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> sk</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    js_code</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> code</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    grant_type</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;authorization_code&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> url </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">API_URL</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;?&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> querystring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">stringify</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Promise</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">resolve</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> reject</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    request</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">url</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">error</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> response</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> body</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">error </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> response</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">statusCode</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">200</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">reject</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">error</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword control-flow" style="color:#00009f">try</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> r </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token known-class-name class-name">JSON</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">parse</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">body</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token function" style="color:#d73a49">resolve</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">r</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">e</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token function" style="color:#d73a49">reject</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">e</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>æœ‰äº† <code>jscode2session</code> è¿™ä¸ªäº‘å‡½æ•°ï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨å°ç¨‹åºä¸­è°ƒç”¨äº‘å‡½æ•°ï¼Œå°† <code>wx.login</code> è·å–çš„ code ä½œä¸ºå‚æ•°ä¼ é€’è¿‡å»ï¼š</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">wx</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">login</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function-variable function" style="color:#d73a49">success</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">res</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">res</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">code</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      wx</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">cloud</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">callFunctions</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        name</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;jscode2session&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        data</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          code</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> res</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">code</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">then</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">res</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">openid </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> session_key </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;&#x27;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> res</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">result</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">openid</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> session_key</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        wx</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">setStorage</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              key</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;openid&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              data</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> openid</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>å…³äºè·å–åˆ°çš„ <code>session_key</code>ï¼Œæˆ‘ä»¬è¿˜éœ€è¦æ³¨æ„ä»¥ä¸‹ä¸¤ç‚¹ã€‚</p><ol><li><code>session_key</code> å’Œ <code>wx.login</code> è·å–çš„ code æ˜¯ä¸€ä¸€å¯¹åº”çš„ï¼ŒåŒä¸€ code åªèƒ½æ¢å–ä¸€æ¬¡ <code>session_key</code>ã€‚æ¯æ¬¡è°ƒç”¨ <code>wx.login</code>ï¼Œéƒ½ä¼šä¸‹å‘ä¸€ä¸ªæ–°çš„ code å’Œå¯¹åº”çš„ <code>session_key</code>ï¼Œä¸ºäº†ä¿è¯ç”¨æˆ·ä½“éªŒå’Œç™»å½•æ€çš„æœ‰æ•ˆæ€§ï¼Œå¼€å‘è€…éœ€è¦æ¸…æ¥šç”¨æˆ·éœ€è¦é‡æ–°ç™»å½•æ—¶æ‰å»è°ƒç”¨ <code>wx.login</code>ã€‚</li><li><code>session_key</code> æ˜¯æœ‰æ—¶æ•ˆæ€§çš„ï¼Œå³ä¾¿æ˜¯ä¸è°ƒç”¨ <code>wx.login</code>ï¼Œ<code>session_key</code> ä¹Ÿä¼šè¿‡æœŸï¼Œè¿‡æœŸæ—¶é—´è·Ÿç”¨æˆ·ä½¿ç”¨å°ç¨‹åºçš„é¢‘ç‡æˆæ­£ç›¸å…³ï¼Œä½†å…·ä½“çš„æ—¶é—´é•¿çŸ­å¼€å‘è€…å’Œç”¨æˆ·éƒ½æ˜¯è·å–ä¸åˆ°çš„ã€‚</li></ol><p>ç”±äº <code>session_key</code> å…·æœ‰å®æ•ˆæ€§ï¼Œå› è€Œæˆ‘ä»¬å¯ä»¥å°† <code>session_key</code> å­˜å…¥æœ¬åœ°ç¼“å­˜ï¼Œæ¯æ¬¡è¿›å…¥å°ç¨‹åºçš„æ—¶å€™åˆ¤æ–­ä¸‹ <code>session_key</code> æ˜¯å¦è¿‡æœŸå³å¯ï¼š</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">wx</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">setStorage</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  key</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;session_key&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  data</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> session_key</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_31ik" id="3-è·å–ç”¨æˆ·æ˜µç§°ç­‰ä¿¡æ¯">3<!-- -->.<!-- --> è·å–ç”¨æˆ·æ˜µç§°ç­‰ä¿¡æ¯<a aria-hidden="true" class="hash-link" href="#3-è·å–ç”¨æˆ·æ˜µç§°ç­‰ä¿¡æ¯" title="Direct link to heading">â€‹</a></h4><p>è·å–ç”¨æˆ·ä¿¡æ¯éœ€è¦ç”¨åˆ° <code>open-type=&quot;getUserInfo&quot;</code> çš„ <code>button</code> ç»„ä»¶ï¼Œå…·ä½“åšæ³•æ˜¯ï¼š</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">button open</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">type</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;getUserInfo&quot;</span><span class="token plain"> bindgetuserinfo</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;getUserInfo&quot;</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">ä½¿ç”¨è¯¥åŠŸèƒ½éœ€è¦æˆæƒç™»å½•</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">button</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>ä¸Šé¢çš„ä»£ç å®šä¹‰äº†ä¸€ä¸ª <code>getUserInfo</code> ç±»å‹çš„æŒ‰é’®ï¼Œå¦‚æœæˆæƒæˆåŠŸï¼Œåˆ™è°ƒç”¨é¡µé¢çš„ <code>getUserInfo</code> æ–¹æ³•ï¼ˆé€šè¿‡ <code>bindgetuserinfo</code> ç»‘å®šçš„ï¼‰ã€‚<code>getUserInfo</code> ä»£ç å¦‚ä¸‹ï¼š</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">getUserInfo</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  wx</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getUserInfo</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function-variable function" style="color:#d73a49">success</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">res</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> rs </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> res</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">userInfo</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">setData</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        nickname</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> rs</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">nickName</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        avatarUrl</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> rs</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">avatarUrl</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>è·å–åˆ°çš„ç”¨æˆ·ä¿¡æ¯ï¼ŒåŒ…æ‹¬ä»¥ä¸‹å‡ éƒ¨åˆ†ï¼š</p><p>å‚æ•°</p><p>ç±»å‹</p><p>è¯´æ˜</p><p>userInfo</p><p>OBJECT</p><p>ç”¨æˆ·ä¿¡æ¯å¯¹è±¡ï¼Œä¸åŒ…å« openid ç­‰æ•æ„Ÿä¿¡æ¯</p><p>rawData</p><p>String</p><p>ä¸åŒ…æ‹¬æ•æ„Ÿä¿¡æ¯çš„åŸå§‹æ•°æ®å­—ç¬¦ä¸²ï¼Œç”¨äºè®¡ç®—ç­¾å</p><p>signature</p><p>String</p><p>ä½¿ç”¨ sha1( rawData + sessionkey ) å¾—åˆ°å­—ç¬¦ä¸²ï¼Œç”¨äºæ ¡éªŒç”¨æˆ·ä¿¡æ¯</p><p>encryptedData</p><p>String</p><p>åŒ…æ‹¬æ•æ„Ÿæ•°æ®åœ¨å†…çš„å®Œæ•´ç”¨æˆ·ä¿¡æ¯çš„åŠ å¯†æ•°æ®</p><p>iv</p><p>String</p><p>åŠ å¯†ç®—æ³•çš„åˆå§‹å‘é‡</p><p>é™¤äº†å®æˆ˜ä¸­ä½¿ç”¨çš„åŒ…å«ç”¨æˆ·æ˜µç§°å’Œå¤´åƒçš„ <code>userInfo</code> å¤–ï¼Œè¿˜æœ‰æ•æ„Ÿä¿¡æ¯çš„ <code>encryptedData</code> å­—æ®µï¼Œå¦‚æœéœ€è¦ä½¿ç”¨è¯¥å­—æ®µï¼Œåˆ™éœ€è¦æŒ‰ç…§<a href="https://developers.weixin.qq.com/miniprogram/dev/api/signature.html#%E5%8A%A0%E5%AF%86%E6%95%B0%E6%8D%AE%E8%A7%A3%E5%AF%86%E7%AE%97%E6%B3%95" target="_blank" rel="noopener noreferrer">åŠ å¯†æ•°æ®è§£å¯†ç®—æ³•</a>çš„æ–‡æ¡£æ¥è§£å¯†ã€‚</p><h4 class="anchor anchorWithStickyNavbar_31ik" id="4-è§£å¯†æ•æ„Ÿæ•°æ®">4<!-- -->.<!-- --> è§£å¯†æ•æ„Ÿæ•°æ®<a aria-hidden="true" class="hash-link" href="#4-è§£å¯†æ•æ„Ÿæ•°æ®" title="Direct link to heading">â€‹</a></h4><p>å°½ç®¡å¿ƒæƒ…ç­¾åˆ°åŠŸèƒ½å¹¶æ²¡æœ‰æ¶‰åŠæ•æ„Ÿä¿¡æ¯çš„è§£å¯†ï¼Œè¿™é‡Œç¬”è€…è¿˜æ˜¯ç®€å•ä»‹ç»ä¸‹å¦‚ä½•è§£å¯†æ•æ„Ÿæ•°æ®ã€‚</p><p>è§£å¯†æ•æ„Ÿä¿¡æ¯éœ€è¦ç”¨åˆ°å°ç¨‹åºçš„ AppID å’Œ <code>session_key</code>ï¼Œåœ¨å¼€å‘è€…æ–‡æ¡£ä¸­æœ‰æä¾› Node.js ç‰ˆæœ¬çš„è§£å¯† demoï¼Œä¸‹é¢æ¥ç®€å•å®ç°ä¸ªäº‘å‡½æ•°ï¼š</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> crypto </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;crypto&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">/*&lt;jdists import=&quot;../../inline/utils.js&quot; /&gt;*/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">/*&lt;remove&gt;*/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> $ </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;../../inline/utils&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">/*&lt;/remove&gt;*/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function maybe-class-name" style="color:#d73a49">WXBizDataCrypt</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">appId</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> sessionKey</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">appId</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> appId</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">sessionKey</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> sessionKey</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token class-name">WXBizDataCrypt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">prototype</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method-variable function-variable method function property-access" style="color:#d73a49">decryptData</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">encryptedData</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> iv</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// base64 decode</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> sessionKey </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Buffer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">sessionKey</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;base64&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  encryptedData </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Buffer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">encryptedData</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;base64&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  iv </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Buffer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">iv</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;base64&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> decoded</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">try</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// è§£å¯†</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> decipher </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> crypto</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">createDecipheriv</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;aes-128-cbc&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> sessionKey</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> iv</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// è®¾ç½®è‡ªåŠ¨ padding ä¸º trueï¼Œåˆ é™¤å¡«å……è¡¥ä½</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    decipher</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">setAutoPadding</span><span class="token punctuation" style="color:#393A34">(</span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    decoded </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> decipher</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">update</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">encryptedData</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;binary&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;utf8&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    decoded </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> decipher</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">final</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;utf8&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    decoded </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token known-class-name class-name">JSON</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">parse</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">decoded</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">err</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">throw</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Error</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;Illegal Buffer&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">decoded</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">watermark</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">appid</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!==</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">appId</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">throw</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Error</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;Illegal Buffer&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> decoded</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">exports</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method-variable function-variable method function property-access" style="color:#d73a49">main</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">event</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">iv</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> data</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> session_key</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> event</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// è¿™é‡Œå¾®ä¿¡çš„ id å’Œ secret ä»é…ç½®æ–‡ä»¶ä¸­è·å–</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> appId </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getWechatAppConfig</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">id</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Promise</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">resolve</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> reject</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> pc </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">WXBizDataCrypt</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">appId</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> session_key</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">resolve</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pc</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">decryptData</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> iv</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_31ik" id="5-æ£€æµ‹-session_key-æ˜¯å¦å¤±æ•ˆ">5<!-- -->.<!-- --> æ£€æµ‹ <code>session_key</code> æ˜¯å¦å¤±æ•ˆ<a aria-hidden="true" class="hash-link" href="#5-æ£€æµ‹-session_key-æ˜¯å¦å¤±æ•ˆ" title="Direct link to heading">â€‹</a></h4><p>å‰é¢æåˆ° <code>session_key</code> éœ€è¦å­˜å…¥æœ¬åœ°ç¼“å­˜ï¼Œä½†æ˜¯å­˜åœ¨å¯èƒ½å¤±æ•ˆçš„æƒ…å†µï¼Œå°ç¨‹åºæä¾›çš„ <code>wx.checkSession</code> æ–¹æ³•å¯ä»¥æ£€æµ‹å½“å‰çš„ <code>session_key</code> æ˜¯å¦å¤±æ•ˆï¼Œå¦‚æœå¤±æ•ˆåˆ™é‡æ–°è°ƒç”¨ <code>wx.login</code> ç™»å½•æˆæƒæµç¨‹ã€‚</p><p><code>wx.checkSession</code> æ–¹æ³•å¹¶ä¸éœ€è¦ä¼ å…¥ä»»ä½•æœ‰å…³ <code>session_key</code> çš„ä¿¡æ¯å‚æ•°ï¼Œè€Œæ˜¯å°ç¨‹åºè‡ªå·±å»è°ƒè‡ªå·±çš„æœåŠ¡æ¥æŸ¥è¯¢ç”¨æˆ·æœ€è¿‘ä¸€æ¬¡ç”Ÿæˆçš„ <code>session_key</code> æ˜¯å¦è¿‡æœŸã€‚å¦‚æœå½“å‰ <code>session_key</code> è¿‡æœŸï¼Œå°±è®©ç”¨æˆ·æ¥é‡æ–°ç™»å½•ï¼Œæ›´æ–° <code>session_key</code>ï¼Œå¹¶å°†æœ€æ–°çš„ <code>session_key</code> å­˜å…¥ç”¨æˆ·æ•°æ®è¡¨ä¸­ã€‚</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="æ•´ä¸ªæˆæƒæµç¨‹å›¾å’Œä»£ç ">æ•´ä¸ªæˆæƒæµç¨‹å›¾å’Œä»£ç <a aria-hidden="true" class="hash-link" href="#æ•´ä¸ªæˆæƒæµç¨‹å›¾å’Œä»£ç " title="Direct link to heading">â€‹</a></h3><p><img src="https://user-gold-cdn.xitu.io/2018/8/13/1653149c0d99db7d?w=1024&amp;h=768&amp;f=jpeg&amp;s=116659"></p><p>ç”¨ä»£ç æ¥è¡¨ç¤ºå¦‚ä¸‹ï¼š</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// æˆ–è€…åœ¨ app.js å†…ä½¿ç”¨ onLaunch</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">onLoad</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> loginFlag </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> wx</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getStorageSync</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;session_key&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">loginFlag</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// æ£€æŸ¥ session_key æ˜¯å¦è¿‡æœŸ</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    wx</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">checkSession</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// session_key æœ‰æ•ˆï¼ˆæœªè¿‡æœŸï¼‰</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function-variable function" style="color:#d73a49">success</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic">// ä¸šåŠ¡é€»è¾‘å¤„ç†</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// session_key è¿‡æœŸ</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function-variable function" style="color:#d73a49">fail</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic">// session_key è¿‡æœŸï¼Œé‡æ–°ç™»å½•</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">doLogin</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// æ—  session_keyï¼Œä½œä¸ºé¦–æ¬¡ç™»å½•</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">doLogin</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_31ik" id="ä½¿ç”¨äº‘å¼€å‘æ•°æ®åº“æ¥å­˜å‚¨å¿ƒæƒ…æ•°æ®">ä½¿ç”¨äº‘å¼€å‘æ•°æ®åº“æ¥å­˜å‚¨å¿ƒæƒ…æ•°æ®<a aria-hidden="true" class="hash-link" href="#ä½¿ç”¨äº‘å¼€å‘æ•°æ®åº“æ¥å­˜å‚¨å¿ƒæƒ…æ•°æ®" title="Direct link to heading">â€‹</a></h2><p>å¯ä»¥åœ¨å°ç¨‹åºä¸­é€šè¿‡ <code>wx.cloud</code> ç›¸å…³çš„æ–¹æ³•ä½¿ç”¨äº‘å¼€å‘çš„æ•°æ®åº“ï¼Œè€Œä¸”å®ƒæ”¯æŒæƒé™è®¾ç½®ï¼Œå¾ˆæ–¹ä¾¿å­˜å‚¨ UGCï¼ˆç”¨æˆ·åŸåˆ›å†…å®¹ï¼‰çš„æ•°æ®ï¼ˆåœ¨<a href="https://juejin.im/book/5b70f101e51d456669381803/section/5b70f2656fb9a009a545f6c7" target="_blank" rel="noopener noreferrer">ç¬¬ 3 èŠ‚</a>ä»‹ç»è¿‡ï¼‰ã€‚åœ¨å¿ƒæƒ…ç­¾åˆ°åŠŸèƒ½ä¸­ï¼Œå°±ä½¿ç”¨äº†å°ç¨‹åºäº‘çš„æ•°æ®åº“ï¼Œç”¨å®ƒæ¥å­˜å‚¨ç”¨æˆ·çš„ç­¾åˆ°å¿ƒæƒ…ã€‚</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="åœ¨äº‘å¼€å‘æ§åˆ¶å°åˆ›å»ºæ•°æ®åº“">åœ¨äº‘å¼€å‘æ§åˆ¶å°åˆ›å»ºæ•°æ®åº“<a aria-hidden="true" class="hash-link" href="#åœ¨äº‘å¼€å‘æ§åˆ¶å°åˆ›å»ºæ•°æ®åº“" title="Direct link to heading">â€‹</a></h3><p>é¦–å…ˆä»å°ç¨‹åºå¼€å‘è€…å·¥å…·ä¸­çš„ã€Œäº‘å¼€å‘ã€è¿›å…¥æ•°æ®åº“ç®¡ç† tabï¼Œç„¶åç‚¹å‡»ã€Œæ·»åŠ é›†åˆã€ï¼Œåˆ›å»ºä¸€ä¸ª <code>diary</code> çš„é›†åˆï¼ˆæ•°æ®åº“ï¼‰ã€‚</p><p><img src="https://user-gold-cdn.xitu.io/2018/8/13/1653149ee77c70b2?w=544&amp;h=176&amp;f=jpeg&amp;s=10801"></p><p>è¿™ä¸ªé›†åˆä¸­çš„æ–‡æ¡£æ•°æ®æ ¼å¼å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p><p><img src="https://user-gold-cdn.xitu.io/2018/9/1/165938bd3dbe91ab?w=311&amp;h=143&amp;f=jpeg&amp;s=13693"></p><p>å…¶ä¸­ï¼Œ<code>_id</code> å’Œ <code>_openid</code> æ˜¯ç³»ç»Ÿè‡ªåŠ¨ç”Ÿæˆçš„ï¼Œæ–‡æ¡£ï¼ˆè¡¨ï¼‰ä¸­å…¶ä»–å­—æ®µçš„æ„æ€è§£é‡Šå¦‚ä¸‹ï¼š</p><ul><li>emotionï¼šå½“å¤©çš„å¿ƒæƒ…ï¼Œä¸€å…±æœ‰ 5 ç§å¿ƒæƒ…</li><li>tsModifiedï¼šç­¾åˆ°çš„æ—¶é—´æˆ³</li><li>openidï¼šæ ¹æ®æˆæƒä¿¡æ¯è·å–çš„ openidï¼Œè·Ÿ <code>_openid</code> ä¸€è‡´</li></ul><p>æœ‰äº†æ•°æ®åº“çš„ä¿¡æ¯ï¼Œéœ€è¦ç¼–å†™å¢åŠ ä¸€æ¡å¿ƒæƒ…æ•°æ®ï¼ˆ<code>addEmotion</code>ï¼‰å’Œè·å–æŸä¸ªæœˆä»½æ‰€æœ‰å¿ƒæƒ…æ•°æ®ï¼ˆ<code>getEmotionByOpenidAndDate</code>ï¼‰ã€‚</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="å¢åŠ å¿ƒæƒ…æ•°æ®">å¢åŠ å¿ƒæƒ…æ•°æ®<a aria-hidden="true" class="hash-link" href="#å¢åŠ å¿ƒæƒ…æ•°æ®" title="Direct link to heading">â€‹</a></h3><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// lib/api.js</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// åˆå§‹åŒ– cloud ç¯å¢ƒ</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wx</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">cloud</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">init</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  env</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;envID&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// è·å–æ•°æ®åº“å®ä¾‹</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> db </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> wx</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">cloud</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">database</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// ç”¨æˆ·å¿ƒæƒ…ç­¾åˆ°</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">addEmotion</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">openid</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> emotion</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> db</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">collection</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;diary&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    data</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      openid</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      emotion</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      tsModified</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token known-class-name class-name">Date</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">now</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_31ik" id="è·å–å¿ƒæƒ…æ•°æ®">è·å–å¿ƒæƒ…æ•°æ®<a aria-hidden="true" class="hash-link" href="#è·å–å¿ƒæƒ…æ•°æ®" title="Direct link to heading">â€‹</a></h3><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// lib/api.js</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// åˆå§‹åŒ– cloud ç¯å¢ƒ</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wx</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">cloud</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">init</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  env</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;envID&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// è·å–æ•°æ®åº“å®ä¾‹</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> db </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> wx</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">cloud</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">database</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// æ ¹æ®ç”¨æˆ· openid å’Œæ—¥æœŸè·å–å¿ƒæƒ…æ•°æ®</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">getEmotionByOpenidAndDate</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">openid</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> year</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> month</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> _ </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> db</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">command</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  year </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">parseInt</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">year</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  month </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">parseInt</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">month</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> start </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Date</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">year</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> month </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getTime</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> end </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Date</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">year</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> month</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getTime</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// console.log(start, end, `${year}-${nextMonth}-01 00:00:00`,`${year}-${month}-01 00:00:00`)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> db</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">collection</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;diary&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">where</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      openid</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      tsModified</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> _</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">gte</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">start</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">and</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">lt</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">end</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>å°ç¨‹åºäº‘å¼€å‘çš„æ•°æ®åº“ä¸ºäº†æå‡æŸ¥è¯¢æ€§èƒ½ï¼Œ<strong>ä¸èƒ½å¤Ÿä¸€æ¬¡æŸ¥è¯¢å‡ºæ¥è¶…è¿‡20æ¡ä»¥ä¸Šçš„æ•°æ®</strong>ã€‚æ‰€ä»¥ä¸Šé¢çš„ä»£ç æœ€å¤šèƒ½å¤ŸæŸ¥è¯¢å‡º20æ¡æ•°æ®ï¼Œå½“ç­¾åˆ°æ•°æ®è¶…è¿‡20å¤©ï¼ˆä¸€ä¸ªæœˆæœ€å¤š31å¤©ï¼‰ï¼Œè¿™æ—¶å€™å°±éœ€è¦åšä¸¤æ¬¡æŸ¥è¯¢ï¼ˆæ ¹æ®<code>tsModified</code> æ­£åºï¼Œååºå„å–ä¸€æ¬¡ï¼‰ï¼Œç„¶ååˆå¹¶æ•°æ®äº†ï¼Œæ‰€ä»¥æœ€åçš„ä»£ç å¦‚ä¸‹ï¼š</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword module" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">getEmotionByOpenidAndDate</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">openid</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> year</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> month</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> _ </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> db</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">command</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  year </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">parseInt</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">year</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  month </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">parseInt</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">month</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> start </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Date</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">year</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> month </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getTime</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> end </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Date</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">year</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> month</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getTime</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// è¿™é‡Œå› ä¸ºé™åˆ¶ limit 20ï¼Œæ‰€ä»¥æŸ¥è¯¢ä¸¤æ¬¡ï¼Œä¸€å…±31æ¡ï¼ˆæœ€å¤š31å¤©ï¼‰è®°å½•</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// æ­£åºååºå„å–ä¸€æ¬¡ï¼Œä½¿ç”¨ orderBy æ’åº</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Promise</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">resolve</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> reject</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token known-class-name class-name">Promise</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">all</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      db</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">collection</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;diary&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">where</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          openid</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          tsModified</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> _</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">gte</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">start</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">and</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">lt</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">end</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">orderBy</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;tsModified&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;desc&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">limit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">15</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      db</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">collection</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;diary&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">where</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          openid</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          tsModified</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> _</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">gte</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">start</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">and</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">lt</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">end</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">orderBy</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;tsModified&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;asc&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">limit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">16</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">then</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">data</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">data1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> data2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> set </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Set</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        data1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> data1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">data</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        data2 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> data2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">data</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        data </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> data1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">concat</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">data2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">filter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">v</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">set</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">has</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">v</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">_id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          set</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">v</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">_id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">resolve</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword control-flow" style="color:#00009f">catch</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">e</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">e</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">reject</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">e</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>å¿ƒæƒ…æ•°æ®æ˜¯æ ¹æ® <code>openid</code> å’Œæœˆä»½è·å–çš„ï¼Œæ—¥æœŸèŒƒå›´ä¸ºï¼šæœˆä»½ 1 æ—¥çš„å‡Œæ™¨ 0 ç‚¹ï¼ˆstartï¼‰åˆ°ä¸‹ä¸€æœˆä»½ 1 æ—¥çš„å‡Œæ™¨ 0 ç‚¹ï¼ˆendï¼‰ï¼Œåœ¨äº‘æ•°æ®åº“ä¸­å¯ä»¥ä½¿ç”¨ <code>_.gte(start).and(_.lt(end))</code>ï¼Œå³å¤§äºç­‰äº <code>start</code> å°äº <code>end</code>ã€‚</p><p>è¿™é‡Œè®¡ç®— <code>start</code> å’Œ <code>end</code> çš„æ—¶å€™ï¼Œé‡è§äº† <code>Date</code> å…¼å®¹æ€§çš„ä¸¤ä¸ªé—®é¢˜ï¼š</p><ol><li><code>localDateString</code> é—®é¢˜</li><li>æ—¶åŒºé—®é¢˜</li></ol><h4 class="anchor anchorWithStickyNavbar_31ik" id="localdatestring-é—®é¢˜"><code>localDateString</code> é—®é¢˜<a aria-hidden="true" class="hash-link" href="#localdatestring-é—®é¢˜" title="Direct link to heading">â€‹</a></h4><p>ç¬”è€…ä¸€å¼€å§‹ä½¿ç”¨å°†æ—¥æœŸè½¬åŒ–æˆç±»ä¼¼ <code>2018-01-01 00:00:00</code> çš„æ ¼å¼ï¼Œç„¶åä½¿ç”¨ <code>new Date(&#x27;2018-01-01 00:00:00&#x27;)</code>ï¼Œå¯ä»¥å¾—åˆ° Date å®ä¾‹ï¼Œè¿™åœ¨å¼€å‘è€…å·¥å…·å’Œ Android æ‰‹æœºä¸Šéƒ½æ²¡æœ‰é—®é¢˜ï¼Œä½†æ˜¯åœ¨ iOS ç³»ç»Ÿä¸‹å´è¯†åˆ«æˆäº† <code>Invalid Date</code>ï¼Œå˜æˆäº† <code>1970-01-01</code>ã€‚è¿™æ˜¯å› ä¸º iOS ä¸Š <code>localDateString</code>ï¼ˆæœ¬åœ°æ—¶é—´ï¼‰çš„<a href="https://stackoverflow.com/questions/13363673/javascript-date-is-invalid-on-ios" target="_blank" rel="noopener noreferrer">é—®é¢˜</a>ï¼Œä½¿ç”¨ <code>new Date().toLocaleDateString()</code> å°±å¯ä»¥çŸ¥é“ï¼ŒiOS ä¸‹è¯†åˆ«çš„æ•°æ®æ˜¯ <code>2018/01/01 00:00:00</code> è¿™æ ·çš„æ ¼å¼çš„ã€‚</p><h4 class="anchor anchorWithStickyNavbar_31ik" id="æ—¶åŒºé—®é¢˜">æ—¶åŒºé—®é¢˜<a aria-hidden="true" class="hash-link" href="#æ—¶åŒºé—®é¢˜" title="Direct link to heading">â€‹</a></h4><p>å°ç¨‹åºäº‘å¼€å‘çš„äº‘å‡½æ•°å’Œæ•°æ®åº“æ˜¯é¢å‘å…¨çƒå¼€å‘è€…çš„ï¼Œå®ƒä»¬ä½¿ç”¨çš„æ—¶åŒºå¹¶ä¸æ˜¯æˆ‘ä»¬çš„ä¸œå…«åŒºï¼ˆåŒ—äº¬æ—¶é—´ï¼‰ï¼Œå› æ­¤æˆ‘ä»¬åœ¨è·å– Date çš„æ—¶å€™å°±è¦å°å¿ƒï¼Œç®€å•æ‹¼æ¥ <code>2018-01-01 00:00:00</code> è·å–çš„æ—¶é—´å¹¶ä¸æ˜¯åŒ—äº¬æ—¶é—´ï¼Œæ•°æ®åº“å­˜å…¥çš„æ•°æ®å¦‚æœä½¿ç”¨åŒ—äº¬æ—¶é—´ï¼ˆæœ¬åœ° JSï¼‰ï¼Œé‚£ä¹ˆè·å–æ•°æ®çš„æ—¶å€™å°±åº”è¯¥ä½¿ç”¨åŒ—äº¬æ—¶é—´ï¼ˆäº‘ç«¯æ‰§è¡Œ JS æ—¶ï¼‰ã€‚</p><p>ä¸ºäº†è§£å†³ Date çš„é—®é¢˜ï¼Œç¬”è€…åœ¨è®¡ç®—æ—¶åŒºçš„æ—¶å€™ï¼Œéƒ½è½¬æ¢æˆäº† UTC æ ‡å‡†æ—¶é—´ï¼Œæ¯”å¦‚åœ¨äº‘å‡½æ•°ä¸­ï¼Œç¬”è€…ä½¿ç”¨äº† <code>new Date().getUTCHours()</code> è¿™æ ·çš„æ—¶é—´ï¼Œè¯¦è§ server/inline/utils.jsã€‚</p><p>è€Œåœ¨è·å–ç‰¹å®šæŸä¸€å¤©çš„ Date å®ä¾‹çš„æ—¶å€™ï¼Œåˆ™ä½¿ç”¨ <code>new Date(year, month, day)</code> çš„æ–¹å¼ï¼Œè¿™æ ·åœ¨æ•°æ®åº“è·å–æŸä¸ªæœˆä»½æ—¶é—´æˆ³æ—¶ï¼Œå°±ä¸ä¼šå‡ºç°ä¸åŒç³»ç»Ÿç¯å¢ƒä¸åŒæ•°å€¼çš„é—®é¢˜ï¼Œè¯¦è§ client/lib/api.js çš„ <code>getEmotionByOpenidAndDate</code> æ–¹æ³•ã€‚</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="ä½¿ç”¨-navigator-å¢åŠ è·³è½¬">ä½¿ç”¨ navigator å¢åŠ è·³è½¬<a aria-hidden="true" class="hash-link" href="#ä½¿ç”¨-navigator-å¢åŠ è·³è½¬" title="Direct link to heading">â€‹</a></h2><p>å¿ƒæƒ…ç­¾åˆ°é¡µé¢åšå®Œä¹‹åï¼Œè¿˜éœ€è¦åœ¨å¤©æ°”é¢„æŠ¥é¡µé¢ç»™å®ƒåšè·³è½¬ã€‚åœ¨å¤©æ°”é¢„æŠ¥é¡µé¢å¢åŠ è·³è½¬çš„ WXML ä»£ç å¦‚ä¸‹ï¼š</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">&lt;</span><span class="token operator" style="color:#393A34">!</span><span class="token operator" style="color:#393A34">--</span><span class="token plain">weather</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">index</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">wxml</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">view </span><span class="token keyword" style="color:#00009f">class</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;navigator&quot;</span><span class="token plain"> bindtap</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;goDiary&quot;</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">icon type</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;edit&quot;</span><span class="token operator" style="color:#393A34">/</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&lt;</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">view</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>é¡µé¢ç»‘å®šäº†äº‹ä»¶ <code>goDiary</code> ä»£ç ï¼š</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// weather/index.js</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function maybe-class-name" style="color:#d73a49">Page</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">goDiary</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> url </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">/pages/diary/index</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    wx</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">navigateTo</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      url</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>åœ¨å¿ƒæƒ…ç­¾åˆ°é¡µé¢ï¼Œé¡¶éƒ¨å¯¼èˆªéœ€è¦å¢åŠ è¿”å›æ“ä½œï¼š</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">&lt;</span><span class="token operator" style="color:#393A34">!</span><span class="token operator" style="color:#393A34">--</span><span class="token plain">diary</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">index</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">wxml</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">view </span><span class="token keyword" style="color:#00009f">class</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;navigator&quot;</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">icon type</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;back&quot;</span><span class="token plain"> bindtap</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;goBack&quot;</span><span class="token operator" style="color:#393A34">/</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&lt;</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">view</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// diary/index.js</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function maybe-class-name" style="color:#d73a49">Page</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">goBack</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    wx</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">navigateBack</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_31ik" id="å¿ƒæƒ…ç­¾åˆ°é¡µé¢æ•´ä½“æµç¨‹å›¾">å¿ƒæƒ…ç­¾åˆ°é¡µé¢æ•´ä½“æµç¨‹å›¾<a aria-hidden="true" class="hash-link" href="#å¿ƒæƒ…ç­¾åˆ°é¡µé¢æ•´ä½“æµç¨‹å›¾" title="Direct link to heading">â€‹</a></h2><p><img src="https://user-gold-cdn.xitu.io/2018/8/13/16531487782ac35b?w=1024&amp;h=768&amp;f=jpeg&amp;s=210592"></p><h2 class="anchor anchorWithStickyNavbar_31ik" id="å°ç»“">å°ç»“<a aria-hidden="true" class="hash-link" href="#å°ç»“" title="Direct link to heading">â€‹</a></h2><p>æœ¬èŠ‚ä»‹ç»äº†æ–°é²œå¤©æ°”æ—¥å†ä½¿ç”¨ã€ç”¨æˆ·æˆæƒæµç¨‹å’Œæ•°æ®åº“æ“ä½œã€‚</p><p>æ—¥å†ä½¿ç”¨éœ€è¦åœ¨å°ç¨‹åºç®¡ç†åå°æœç´¢å¯¹åº”çš„æ’ä»¶ idï¼Œç„¶åç”³è¯·æˆæƒã€‚æ—¥å†çš„æ—¥æœŸèƒŒæ™¯é¢œè‰²æ˜¯è·Ÿå½“æ—¶ç­¾åˆ°å¿ƒæƒ…ç›¸å¯¹åº”çš„ï¼Œå½“åˆ‡æ¢äº†æ—¥å†çš„æœˆä»½ä¹‹åï¼Œåº”è¯¥é‡æ–°è·å–å½“å‰æœˆä»½çš„ç­¾åˆ°æ•°æ®ä¿¡æ¯ã€‚</p><p>ç”¨æˆ·æˆæƒæµç¨‹ç”±å°ç¨‹åºã€å¼€å‘è€…æœåŠ¡å™¨å’Œå¾®ä¿¡æ¥å£æœåŠ¡ä¸‰æ–¹å‚ä¸ï¼Œæ•´ä¸ªæµç¨‹åŒ…æ‹¬è°ƒç”¨ <code>wx.login</code> æˆæƒè·å–ä¸´æ—¶ç™»å½•å‡­è¯ï¼Œä½¿ç”¨ä¸´æ—¶ç™»å½•å‡­è¯è·å– <code>openid</code> å’Œ <code>session_key</code>ï¼Œä»¥åŠè·å–ç”¨æˆ·ä¿¡æ¯ä¸‰ä¸ªæ­¥éª¤ã€‚<code>session_key</code> å¯ä»¥ç”¨äºè§£å¯†æ•æ„Ÿæ•°æ®ï¼Œä½†æ˜¯ <code>session_key</code> å…·æœ‰æ—¶æ•ˆæ€§ï¼Œéœ€è¦è°ƒç”¨ <code>wx.checkSession</code> æ–¹æ³•æ¥æ ¡éªŒå…¶æ˜¯å¦å¤±æ•ˆã€‚</p><p>äº‘å¼€å‘çš„æ•°æ®åº“æ¯æ¡è®°å½•è‡ªå¸¦ <code>_openid</code> å­—æ®µï¼Œå¯ä»¥å•ç‹¬æ¥è®¾ç½®æ•°æ®åº“æƒé™ã€‚ç¬”è€…åœ¨å¿ƒæƒ…ç­¾åˆ°åŠŸèƒ½ä¸­ä¸»åŠ¨é€šè¿‡æˆæƒè·å¾—ç”¨æˆ· <code>openid</code> ç„¶åå¢åŠ è®°å½•ã€‚åœ¨è¿›è¡Œè·Ÿæ—¥æœŸã€æ—¶é—´æˆ³ç›¸å…³çš„æ•°æ®æŸ¥è¯¢æ—¶åº”è¯¥æ³¨æ„äº‘ç¯å¢ƒçš„æ—¶åŒºï¼Œæœ€ä½³å®è·µæ˜¯ä½¿ç”¨æ ¼æ—å°¼æ²»æ—¶é—´ï¼Œä½¿ç”¨ <code>Date</code> å¯¹è±¡çš„æ—¶å€™ä¹Ÿåº”è¯¥æ³¨æ„ç”Ÿäº§ç¯èŠ‚å’Œæœ¬åœ°ç¯å¢ƒ <code>localeDateString</code> çš„å·®å¼‚ã€‚</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/dapengdouyu/docs/tree/master/docs/books/å¾®ä¿¡å°ç¨‹åºå¼€å‘å…¥é—¨ï¼šä» 0 åˆ° 1 å®ç°å¤©æ°”å°ç¨‹åº/å®æˆ˜ç¯‡ 6ï¼šå¿ƒæƒ…ç­¾åˆ°é¡µé¢å¼€å‘.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_13-_"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2021-10-11T06:28:32.000Z">10/11/2021</time></b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/books/å¾®ä¿¡å°ç¨‹åºå¼€å‘å…¥é—¨ï¼šä» 0 åˆ° 1 å®ç°å¤©æ°”å°ç¨‹åº/å®æˆ˜ç¯‡ 5ï¼šä¸ºå¤©æ°”é¡µé¢åˆ¶ä½œé›¨é›ªæ•ˆæœçš„ç²’å­ç³»ç»Ÿ"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« <!-- -->å®æˆ˜ç¯‡ 5ï¼šä¸ºå¤©æ°”é¡µé¢åˆ¶ä½œé›¨é›ªæ•ˆæœçš„ç²’å­ç³»ç»Ÿ</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/books/å¾®ä¿¡å°ç¨‹åºå¼€å‘å…¥é—¨ï¼šä» 0 åˆ° 1 å®ç°å¤©æ°”å°ç¨‹åº/å®æˆ˜ç¯‡ 7ï¼šå¯¹å°ç¨‹åºè¿›è¡Œä¼˜åŒ–"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">å®æˆ˜ç¯‡ 7ï¼šå¯¹å°ç¨‹åºè¿›è¡Œä¼˜åŒ–<!-- --> Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#ä½¿ç”¨æ—¥å†æ’ä»¶" class="table-of-contents__link toc-highlight">ä½¿ç”¨æ—¥å†æ’ä»¶</a><ul><li><a href="#è®¾ç½®æ—¥å†çš„å¿ƒæƒ…é¢œè‰²" class="table-of-contents__link toc-highlight">è®¾ç½®æ—¥å†çš„å¿ƒæƒ…é¢œè‰²</a></li><li><a href="#æ—¥å†äº‹ä»¶ç»‘å®š" class="table-of-contents__link toc-highlight">æ—¥å†äº‹ä»¶ç»‘å®š</a></li></ul></li><li><a href="#å°ç¨‹åºç”¨æˆ·ç™»å½•å’Œæˆæƒæµç¨‹" class="table-of-contents__link toc-highlight">å°ç¨‹åºç”¨æˆ·ç™»å½•å’Œæˆæƒæµç¨‹</a><ul><li><a href="#æ•´ä¸ªæˆæƒæµç¨‹å›¾å’Œä»£ç " class="table-of-contents__link toc-highlight">æ•´ä¸ªæˆæƒæµç¨‹å›¾å’Œä»£ç </a></li></ul></li><li><a href="#ä½¿ç”¨äº‘å¼€å‘æ•°æ®åº“æ¥å­˜å‚¨å¿ƒæƒ…æ•°æ®" class="table-of-contents__link toc-highlight">ä½¿ç”¨äº‘å¼€å‘æ•°æ®åº“æ¥å­˜å‚¨å¿ƒæƒ…æ•°æ®</a><ul><li><a href="#åœ¨äº‘å¼€å‘æ§åˆ¶å°åˆ›å»ºæ•°æ®åº“" class="table-of-contents__link toc-highlight">åœ¨äº‘å¼€å‘æ§åˆ¶å°åˆ›å»ºæ•°æ®åº“</a></li><li><a href="#å¢åŠ å¿ƒæƒ…æ•°æ®" class="table-of-contents__link toc-highlight">å¢åŠ å¿ƒæƒ…æ•°æ®</a></li><li><a href="#è·å–å¿ƒæƒ…æ•°æ®" class="table-of-contents__link toc-highlight">è·å–å¿ƒæƒ…æ•°æ®</a></li></ul></li><li><a href="#ä½¿ç”¨-navigator-å¢åŠ è·³è½¬" class="table-of-contents__link toc-highlight">ä½¿ç”¨ navigator å¢åŠ è·³è½¬</a></li><li><a href="#å¿ƒæƒ…ç­¾åˆ°é¡µé¢æ•´ä½“æµç¨‹å›¾" class="table-of-contents__link toc-highlight">å¿ƒæƒ…ç­¾åˆ°é¡µé¢æ•´ä½“æµç¨‹å›¾</a></li><li><a href="#å°ç»“" class="table-of-contents__link toc-highlight">å°ç»“</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 dapeng (å¼ äºšé¹) Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.044e1902.js"></script>
<script src="/assets/js/main.13b64cb7.js"></script>
</body>
</html>