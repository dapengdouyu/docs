<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.13">
<link rel="alternate" type="application/rss+xml" href="/rss.xml" title="Dapeng&#39;s blog RSS Feed">
<script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?7dda2565ba246ecd62878c13153e2941",e.defer=!0;var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script>
<meta name="baidu-site-verification" content="IXU12YQUjF">
<link rel="preconnect" href="https://hmcdn.baidu.com">
<link rel="stylesheet" href="https://cansiny.oss-cn-shanghai.aliyuncs.com/assets/fonts.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/katex.min.css" integrity="sha384-Um5gpz1odJg5Z4HAmzPtgZKdTBHZdw8S29IecapCSB31ligYPhHQZMIlWLYQGVoc" crossorigin="anonymous"><title data-react-helmet="true">Performance、LightHouse 与性能 API - Dapeng的博客</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://dapengdouyu.github.io/docs/books/前端性能优化原理与实践/性能监测篇：Performance、LightHouse 与性能 API"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Performance、LightHouse 与性能 API - Dapeng的博客"><meta data-react-helmet="true" name="description" content="性能监测是前端性能优化的重要一环。监测的目的是为了确定性能瓶颈，从而有的放矢地开展具体的优化工作。"><meta data-react-helmet="true" property="og:description" content="性能监测是前端性能优化的重要一环。监测的目的是为了确定性能瓶颈，从而有的放矢地开展具体的优化工作。"><link data-react-helmet="true" rel="icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://dapengdouyu.github.io/docs/books/前端性能优化原理与实践/性能监测篇：Performance、LightHouse 与性能 API"><link data-react-helmet="true" rel="alternate" href="https://dapengdouyu.github.io/docs/books/前端性能优化原理与实践/性能监测篇：Performance、LightHouse 与性能 API" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://dapengdouyu.github.io/docs/books/前端性能优化原理与实践/性能监测篇：Performance、LightHouse 与性能 API" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.978f73f5.css">
<link rel="preload" href="/assets/js/runtime~main.e2552c1f.js" as="script">
<link rel="preload" href="/assets/js/main.17bfbe1e.js" as="script">
</head>
<body>
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,e("light"))}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.jpg" alt="DAPENG" class="themedImage_1VuW themedImage--light_3UqQ"><img src="/img/logo.jpg" alt="DAPENG" class="themedImage_1VuW themedImage--dark_hz6m"></div><b class="navbar__title">DAPENG</b></a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a aria-current="page" class="navbar__link" href="/">博客</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/tags/java-script">JavaScript</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__link">前端</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/program/javascript/index">Javascript</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__link">阅读</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/books/Babel 插件通关秘籍/index">Babel 插件通关秘籍</a></li></ul></div><a href="https://github.com/dapengdouyu" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>github<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_71bT toggle_3Zt9 toggleDisabled_3cF-"><div class="toggleTrack_32Fl" role="button" tabindex="-1"><div class="toggleTrackCheck_3lV7"><span class="toggleIcon_O4iE">🌜</span></div><div class="toggleTrackX_S2yS"><span class="toggleIcon_O4iE">🌞</span></div><div class="toggleTrackThumb_xI_Z"></div></div><input type="checkbox" class="toggleScreenReader_28Tw" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_35hR" type="button"></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" href="/docs/books/Babel 插件通关秘籍/">Babel 插件通关秘籍</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" href="/docs/books/MySQL 是怎样运行的：从根儿上理解 MySQL/">MySQL 是怎样运行的：从根儿上理解 MySQL</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" href="/docs/books/React Hooks 与 Immutable 数据流实战/">React Hooks 与 Immutable 数据流实战</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" href="/docs/books/React 组合式开发实践：打造企业管理系统五大核心模块/">React 组合式开发实践：打造企业管理系统五大核心模块</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" href="/docs/books/React实战：设计模式和最佳实践/">React实战：设计模式和最佳实践</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" href="/docs/books/Taro 多端开发实现原理与项目实战/">Taro 多端开发实现原理与项目实战</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active hasHref_2fq0" href="/docs/books/前端性能优化原理与实践/">前端性能优化原理与实践</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/books/前端性能优化原理与实践/">index</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/books/前端性能优化原理与实践/前方的路：希望以此为你的起点">前方的路：希望成为你的起点</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/books/前端性能优化原理与实践/存储篇 1：浏览器缓存机制介绍与缓存策略剖析">浏览器缓存机制介绍与缓存策略剖析</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/books/前端性能优化原理与实践/存储篇 2：本地存储——从 Cookie 到 Web Storage、IndexDB">本地存储——从 Cookie 到 Web Storage、IndexDB</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/books/前端性能优化原理与实践/应用篇 1：优化首屏体验——Lazy-Load 初探">优化首屏体验——Lazy-Load 初探</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/books/前端性能优化原理与实践/应用篇 2：事件的节流（throttle）与防抖（debounce）">事件的节流（throttle）与防抖（debounce）</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/books/前端性能优化原理与实践/开篇：知识体系与小册格局">知识体系与小册格局</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/books/前端性能优化原理与实践/彩蛋篇：CDN 的缓存与回源机制解析">CDN 的缓存与回源机制解析</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/books/前端性能优化原理与实践/性能监测篇：Performance、LightHouse 与性能 API">Performance、LightHouse 与性能 API</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/books/前端性能优化原理与实践/渲染篇 1：服务端渲染的探索与实践">服务端渲染的探索与实践</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/books/前端性能优化原理与实践/渲染篇 2：知己知彼——解锁浏览器背后的运行机制">知己知彼——解锁浏览器背后的运行机制</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/books/前端性能优化原理与实践/渲染篇 3：对症下药——DOM 优化原理与基本实践">对症下药—— DOM 优化原理与基本实践</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/books/前端性能优化原理与实践/渲染篇 4：千方百计——Event Loop 与异步更新策略">千方百计——Event Loop 与异步更新策略</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/books/前端性能优化原理与实践/渲染篇 5：最后一击——回流（Reflow）与重绘（Repaint）">最后一击——回流（Reflow）与重绘（Repaint）</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/books/前端性能优化原理与实践/网络篇 1：webpack 性能调优与 Gzip 原理">webpack 性能调优与 Gzip 原理</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/books/前端性能优化原理与实践/网络篇 2：图片优化——质量与性能的博弈">图片优化——质量与性能的博弈</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" href="/docs/books/前端面试之道/">前端面试之道</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" href="/docs/books/微信小程序开发入门：从 0 到 1 实现天气小程序/">微信小程序开发入门：从 0 到 1 实现天气小程序</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" href="/docs/books/正则表达式/">正则表达式</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" href="/docs/books/深入浅出TypeScript：从基础知识到类型编程/">深入浅出TypeScript：从基础知识到类型编程</a></div></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_1CGd"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_3E-R"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Performance、LightHouse 与性能 API</h1></header><p>性能监测是前端性能优化的重要一环。监测的目的是为了确定性能瓶颈，从而有的放矢地开展具体的优化工作。</p><p>平时我们比较推崇的性能监测方案主要有两种：<strong>可视化方案、可编程方案</strong>。这两种方案下都有非常优秀、且触手可及的相关工具供大家选择，本节我们就一起来研究一下这些工具的用法。</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="可视化监测从-performance-面板说起">可视化监测：从 Performance 面板说起<a aria-hidden="true" class="hash-link" href="#可视化监测从-performance-面板说起" title="Direct link to heading">​</a></h2><p>Performance 是 Chrome 提供给我们的开发者工具，用于记录和分析我们的应用在运行时的所有活动。它呈现的数据具有实时性、多维度的特点，可以帮助我们很好地定位性能问题。</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="开始记录">开始记录<a aria-hidden="true" class="hash-link" href="#开始记录" title="Direct link to heading">​</a></h3><p>右键打开开发者工具，选中我们的 Performance 面板：</p><p><img src="https://user-gold-cdn.xitu.io/2018/10/7/1664d6a13652f0db?w=1870&amp;h=1108&amp;f=png&amp;s=159205"></p><p>当我们选中图中所标示的实心圆按钮，Performance 会开始帮我们记录我们后续的交互操作；当我们选中圆箭头按钮，Performance 会将页面重新加载，计算加载过程中的性能表现。<br>
<!-- -->tips：使用 Performance 工具时，为了规避其它 Chrome 插件对页面的性能影响，我们最好在无痕模式下打开页面：</p><p><img src="https://user-gold-cdn.xitu.io/2018/10/7/1664d6cba417ba48?w=732&amp;h=194&amp;f=png&amp;s=29760"></p><p><img src="https://user-gold-cdn.xitu.io/2018/10/7/1664d6d61365b9fd?w=1258&amp;h=848&amp;f=png&amp;s=134455"></p><h3 class="anchor anchorWithStickyNavbar_31ik" id="简要分析">简要分析<a aria-hidden="true" class="hash-link" href="#简要分析" title="Direct link to heading">​</a></h3><p>这里我打开掘金首页，选中 Performance 面板中的圆箭头，来看一下页面加载过程中的性能表现：</p><p><img src="https://user-gold-cdn.xitu.io/2018/10/7/1664d714642f4dcb?w=1874&amp;h=1220&amp;f=png&amp;s=210945"></p><p>从上到下，依次为概述面板、详情面板。下我们先来观察一下概述面板，了解页面的基本表现：</p><p><img src="https://user-gold-cdn.xitu.io/2018/10/7/1664d75451ddcd18?w=1874&amp;h=210&amp;f=png&amp;s=43009"></p><p>我们看右上角的三个栏目：FPS、CPU 和 NET。</p><p><strong>FPS</strong>：这是一个和动画性能密切相关的指标，它表示每一秒的帧数。图中绿色柱状越高表示帧率越高，体验就越流畅。若出现红色块，则代表长时间帧，很可能会出现卡顿。图中以绿色为主，偶尔出现红块，说明网页性能并不糟糕，但仍有可优化的空间。</p><p><strong>CPU</strong>：表示CPU的使用情况，不同的颜色片段代表着消耗CPU资源的不同事件类型。这部分的图像和下文详情面板中的Summary内容有对应关系，我们可以结合这两者挖掘性能瓶颈。</p><p><strong>NET</strong>：粗略的展示了各请求的耗时与前后顺序。这个指标一般来说帮助不大。</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="挖掘性能瓶颈">挖掘性能瓶颈<a aria-hidden="true" class="hash-link" href="#挖掘性能瓶颈" title="Direct link to heading">​</a></h3><p>详情面板中的内容有很多。但一般来说，我们会主要去看 Main 栏目下的火焰图和 Summary 提供给我们的饼图——这两者和概述面板中的 CPU 一栏结合，可以帮我们迅速定位性能瓶颈（如下图）。</p><p><img src="https://user-gold-cdn.xitu.io/2018/10/7/1664d9d24ee5bd4e?w=1874&amp;h=920&amp;f=png&amp;s=179700"></p><p>先看 CPU 图表和 Summary 饼图。CPU 图表中，我们可以根据颜色填充的饱满程度，确定 CPU 的忙闲，进而了解该页面的总的任务量。而 Summary 饼图则以一种直观的方式告诉了我们，哪个类型的任务最耗时（从本例来看是脚本执行过程）。这样我们在优化的时候，就可以抓到“主要矛盾”，进而有的放矢地开展后续的工作了。</p><p>再看 Main 提供给我们的火焰图。这个火焰图非常关键，它展示了整个运行时主进程所做的每一件事情（包括加载、脚本运行、渲染、布局、绘制等）。x 轴表示随时间的记录。每个长条就代表一个活动。更宽的条形意味着事件需要更长时间。y 轴表示调用堆栈，我们可以看到事件是相互堆叠的，上层的事件触发了下层的事件。</p><p>CPU 图标和 Summary 图都是按照“类型”给我们提供性能信息，而 Main 火焰图则将粒度细化到了每一个函数的调用。到底是从哪个过程开始出问题、是哪个函数拖了后腿、又是哪个事件触发了这个函数，这些具体的、细致的问题都将在 Main 火焰图中得到解答。</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="可视化监测-更加聪明的-lighthouse">可视化监测： 更加聪明的 LightHouse<a aria-hidden="true" class="hash-link" href="#可视化监测-更加聪明的-lighthouse" title="Direct link to heading">​</a></h2><p>Performance 无疑可以为我们提供很多有价值的信息，但它的展示作用大于分析作用。它要求使用者对工具本身及其所展示的信息有充分的理解，能够将晦涩的数据“翻译”成具体的性能问题。</p><p>程序员们许了个愿：如果工具能帮助我们把页面的问题也分析出来就好了！上帝听到了这个愿望，于是给了我们 LightHouse：</p><p><img src="https://user-gold-cdn.xitu.io/2018/10/7/1664db3f31e0b6a6"></p><blockquote><p>Lighthouse 是一个开源的自动化工具，用于改进网络应用的质量。 你可以将其作为一个 Chrome 扩展程序运行，或从命令行运行。 为Lighthouse 提供一个需要审查的网址，它将针对此页面运行一连串的测试，然后生成一个有关页面性能的报告。</p></blockquote><p>敲黑板划重点：它生成的是一个报告！Report！不是干巴巴地数据，而是一个通过测试与分析呈现出来的结果（它甚至会给你的页面跑一个分数出来）。这个东西看起来也真是太赞了，我们这就来体验一下！</p><p>首先在 Chrome 的应用商店里下载一个 LightHouse。这一步 OK 之后，我们浏览器右上角会出现一个小小的灯塔 ICON。打开我们需要测试的那个页面，点击这个 ICON，唤起如下的面板：</p><p><img src="https://user-gold-cdn.xitu.io/2018/10/7/1664db9c661bfee3?w=912&amp;h=634&amp;f=png&amp;s=79733"></p><p>然后点击“Generate report”按钮，只需静候数秒，LightHouse 就会为我们输出一个完美的性能报告。</p><p>这里我拿掘金小册首页“开刀”：</p><p><img src="https://user-gold-cdn.xitu.io/2018/10/7/1664dbdb110cb4ee?w=2674&amp;h=1378&amp;f=png&amp;s=395843"></p><p>稍事片刻，Report 便输出成功了，LightHouse 默认会帮我们打开一个新的标签页来展示报告内容。报告内容非常丰富，首先我们看到的是整体的跑分情况：</p><p><img src="https://user-gold-cdn.xitu.io/2018/10/7/1664dc4798ee8992?w=1932&amp;h=708&amp;f=png&amp;s=212488"></p><p>上述分别是页面性能、PWA（渐进式 Web 应用）、可访问性（无障碍）、最佳实践、SEO 五项指标的跑分。孰强孰弱，我们一看便知。</p><p>向下拉动 Report 页，我们还可以看到每一个指标的细化评估：</p><p><img src="https://user-gold-cdn.xitu.io/2018/10/7/1664dc86aeeda780?w=1668&amp;h=1034&amp;f=png&amp;s=185822"></p><p>在“Opportunities”中，LightHouse 甚至针对我们的性能问题给出了可行的建议、以及每一项优化操作预期会帮我们节省的时间。这份报告的可操作性是很强的——我们只需要对着 LightHouse 给出的建议，一条一条地去尝试，就可以看到自己的页面，在一秒一秒地变快。</p><p>除了直接下载，我们还可以通过命令行使用 LightHouse：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">npm install </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">g lighthouse</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lighthouse https</span><span class="token operator" style="color:#393A34">:</span><span class="token operator" style="color:#393A34">/</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">juejin</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">im</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">books</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>同样可以得到掘金小册的性能报告。</p><p>此外，从 Chrome 60 开始，DevTools 中直接加入了基于 LightHouse 的 Audits 面板：</p><p><img src="https://user-gold-cdn.xitu.io/2018/10/7/1664dd0337d66bfe?w=1788&amp;h=1184&amp;f=png&amp;s=181265"></p><p>LightHouse 因此变得更加触手可及了，这一操作也足以证明 Chrome 团队对 LightHouse 的推崇。</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="可编程的性能上报方案-w3c-性能-api">可编程的性能上报方案： W3C 性能 API<a aria-hidden="true" class="hash-link" href="#可编程的性能上报方案-w3c-性能-api" title="Direct link to heading">​</a></h2><p>W3C 规范为我们提供了 Performance 相关的接口。它允许我们获取到用户访问一个页面的每个阶段的精确时间，从而对性能进行分析。我们可以将其理解为 Performance 面板的进一步细化与可编程化。</p><p>当下的前端世界里，数据可视化的概念已经被炒得非常热了，Performance 面板就是数据可视化的典范。那么为什么要把已经可视化的数据再掏出来处理一遍呢？这是因为，需要这些数据的人不止我们前端——很多情况下，后端也需要我们提供性能信息的上报。此外，Performance 提供的可视化结果并不一定能够满足我们实际的业务需求，只有拿到了真实的数据，我们才可以对它进行二次处理，去做一个更加深层次的可视化。</p><p>在这种需求背景下，我们就不得不祭出 Performance API了。</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="访问-performance-对象">访问 performance 对象<a aria-hidden="true" class="hash-link" href="#访问-performance-对象" title="Direct link to heading">​</a></h3><p>performance 是一个全局对象。我们在控制台里输入 window.performance，就可一窥其全貌：</p><p><img src="https://user-gold-cdn.xitu.io/2018/10/7/1664dd8ec761f69f?w=1868&amp;h=336&amp;f=png&amp;s=141570"></p><h3 class="anchor anchorWithStickyNavbar_31ik" id="关键时间节点">关键时间节点<a aria-hidden="true" class="hash-link" href="#关键时间节点" title="Direct link to heading">​</a></h3><p>在 performance 的 timing 属性中，我们可以查看到如下的时间戳：</p><p><img src="https://user-gold-cdn.xitu.io/2018/10/7/1664dddde131e37a?w=854&amp;h=712&amp;f=png&amp;s=199170"></p><p>这些时间戳与页面整个加载流程中的关键时间节点有着一一对应的关系：</p><p><img src="https://user-gold-cdn.xitu.io/2018/10/7/1664ddd4e3df9a14?w=1473&amp;h=879&amp;f=png&amp;s=62923"></p><p>通过求两个时间点之间的差值，我们可以得出某个过程花费的时间，举个🌰：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> timing </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token dom variable" style="color:#36acaa">window</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">performance</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">timing</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// DNS查询耗时</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">timing</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">domainLookupEnd</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> timing</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">domainLookupStart</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// TCP连接耗时</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">timing</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">connectEnd</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> timing</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">connectStart</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 内容加载耗时</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">timing</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">responseEnd</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> timing</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">requestStart</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">···</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>除了这些常见的耗时情况，我们更应该去关注一些<strong>关键性能指标</strong>：firstbyte、fpt、tti、ready 和 load 时间。这些指标数据与真实的用户体验息息相关，是我们日常业务性能监测中不可或缺的一部分：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// firstbyte：首包时间   </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">timing</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">responseStart</span><span class="token plain"> – timing</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">domainLookupStart</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// fpt：First Paint Time, 首次渲染时间 / 白屏时间</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">timing</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">responseEnd</span><span class="token plain"> – timing</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">fetchStart</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// tti：Time to Interact，首次可交互时间 </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">timing</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">domInteractive</span><span class="token plain"> – timing</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">fetchStart</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// ready：HTML 加载完成时间，即 DOM 就位的时间</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">timing</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">domContentLoaded</span><span class="token plain"> – timing</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">fetchStart</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// load：页面完全加载时间</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">timing</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">loadEventStart</span><span class="token plain"> – timing</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">fetchStart</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>以上这些通过 Performance API 获取到的时间信息都具有较高的准确度。我们可以对此进行一番格式处理之后上报给服务端，也可以基于此去制作相应的统计图表，从而实现更加精准、更加个性化的性能耗时统计。</p><p>此外，通过访问 performance 的 memory 属性，我们还可以获取到内存占用相关的数据；通过对 performance 的其它属性方法的灵活运用，我们还可以把它耦合进业务里，实现更加多样化的性能监测需求——灵活，是可编程化方案最大的优点。</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="小结">小结<a aria-hidden="true" class="hash-link" href="#小结" title="Direct link to heading">​</a></h2><p>本节我们介绍了 Performance 开发者工具、LightHouse 与 Performance API 三种性能监测的方案。只要有 Chrome 浏览器，我们就可以实现上述的所有操作。</p><p>由此可以看出，性能监测本身并不难。它的复杂度是在与业务发生耦合的过程中提升的。我们今天打下了坚实的地基，后续需要大家在业务中去成长、去发掘这些工具的更多的潜力，这样才能建立起属于我们自己的技术金字塔。</p><p>推荐阅读：</p><ul><li><a href="https://developers.google.com/web/tools/chrome-devtools/evaluate-performance/reference" target="_blank" rel="noopener noreferrer">Performance 官方文档</a></li><li><a href="https://developers.google.com/web/tools/lighthouse/?hl=zh-cn" target="_blank" rel="noopener noreferrer">使用 Lighthouse 审查网络应用</a></li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Performance" target="_blank" rel="noopener noreferrer">MDN Performance API 介绍</a></li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/dapengdouyu/docs/tree/master/docs/books/前端性能优化原理与实践/性能监测篇：Performance、LightHouse 与性能 API.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_13-_"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/books/前端性能优化原理与实践/彩蛋篇：CDN 的缓存与回源机制解析"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« <!-- -->CDN 的缓存与回源机制解析</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/books/前端性能优化原理与实践/渲染篇 1：服务端渲染的探索与实践"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">服务端渲染的探索与实践<!-- --> »</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#可视化监测从-performance-面板说起" class="table-of-contents__link toc-highlight">可视化监测：从 Performance 面板说起</a><ul><li><a href="#开始记录" class="table-of-contents__link toc-highlight">开始记录</a></li><li><a href="#简要分析" class="table-of-contents__link toc-highlight">简要分析</a></li><li><a href="#挖掘性能瓶颈" class="table-of-contents__link toc-highlight">挖掘性能瓶颈</a></li></ul></li><li><a href="#可视化监测-更加聪明的-lighthouse" class="table-of-contents__link toc-highlight">可视化监测： 更加聪明的 LightHouse</a></li><li><a href="#可编程的性能上报方案-w3c-性能-api" class="table-of-contents__link toc-highlight">可编程的性能上报方案： W3C 性能 API</a><ul><li><a href="#访问-performance-对象" class="table-of-contents__link toc-highlight">访问 performance 对象</a></li><li><a href="#关键时间节点" class="table-of-contents__link toc-highlight">关键时间节点</a></li></ul></li><li><a href="#小结" class="table-of-contents__link toc-highlight">小结</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2021 dapeng (张亚鹏)  <a href="https://beian.miit.gov.cn/#/Integrated/index">京ICP备20028300号</a></div></div></div></footer></div>
<script src="/assets/js/runtime~main.e2552c1f.js"></script>
<script src="/assets/js/main.17bfbe1e.js"></script>
</body>
</html>