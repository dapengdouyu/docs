<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.7">
<link rel="alternate" type="application/rss+xml" href="/rss.xml" title="Dapeng&#39;s blog RSS Feed">
<script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?7dda2565ba246ecd62878c13153e2941",e.defer=!0;var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script>
<meta name="baidu-site-verification" content="IXU12YQUjF">
<link rel="preconnect" href="https://hmcdn.baidu.com">
<link rel="stylesheet" href="https://cansiny.oss-cn-shanghai.aliyuncs.com/assets/fonts.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/katex.min.css" integrity="sha384-Um5gpz1odJg5Z4HAmzPtgZKdTBHZdw8S29IecapCSB31ligYPhHQZMIlWLYQGVoc" crossorigin="anonymous"><title data-react-helmet="true">CLI 原理及不同端的运行机制 - Dapeng的博客</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://dapengdouyu.github.io/docs/books/Taro 多端开发实现原理与项目实战/8、进阶篇 CLI 原理及不同端的运行机制"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="CLI 原理及不同端的运行机制 - Dapeng的博客"><meta data-react-helmet="true" name="description" content="taro-cli 负责 Taro 脚手架初始化和项目构建的的命令行工具，NPM 包的链接在这里：@tarojs/cli 。"><meta data-react-helmet="true" property="og:description" content="taro-cli 负责 Taro 脚手架初始化和项目构建的的命令行工具，NPM 包的链接在这里：@tarojs/cli 。"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://dapengdouyu.github.io/docs/books/Taro 多端开发实现原理与项目实战/8、进阶篇 CLI 原理及不同端的运行机制"><link data-react-helmet="true" rel="alternate" href="https://dapengdouyu.github.io/docs/books/Taro 多端开发实现原理与项目实战/8、进阶篇 CLI 原理及不同端的运行机制" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://dapengdouyu.github.io/docs/books/Taro 多端开发实现原理与项目实战/8、进阶篇 CLI 原理及不同端的运行机制" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.104602c4.css">
<link rel="preload" href="/assets/js/runtime~main.044e1902.js" as="script">
<link rel="preload" href="/assets/js/main.13b64cb7.js" as="script">
</head>
<body>
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,e("light"))}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.jpg" alt="DAPENG" class="themedImage_1VuW themedImage--light_3UqQ"><img src="/img/logo.jpg" alt="DAPENG" class="themedImage_1VuW themedImage--dark_hz6m"></div><b class="navbar__title">DAPENG</b></a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a aria-current="page" class="navbar__link" href="/">博客</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/tags/java-script">JavaScript</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link">前端</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/program/javascript/index">Javascript</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link">阅读</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/books/Babel 插件通关秘籍/index">Babel 插件通关秘籍</a></li></ul></div><a href="https://github.com/dapengdouyu" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>github<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_71bT toggle_3Zt9 toggleDisabled_3cF-"><div class="toggleTrack_32Fl" role="button" tabindex="-1"><div class="toggleTrackCheck_3lV7"><span class="toggleIcon_O4iE">🌜</span></div><div class="toggleTrackX_S2yS"><span class="toggleIcon_O4iE">🌞</span></div><div class="toggleTrackThumb_xI_Z"></div></div><input type="checkbox" class="toggleScreenReader_28Tw" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_35hR" type="button"></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Babel 插件通关秘籍</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">MySQL 是怎样运行的：从根儿上理解 MySQL</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">React Hooks 与 Immutable 数据流实战</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">React 组合式开发实践：打造企业管理系统五大核心模块</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">React实战：设计模式和最佳实践</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Taro 多端开发实现原理与项目实战</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/books/Taro 多端开发实现原理与项目实战/index">index</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/books/Taro 多端开发实现原理与项目实战/0、开篇 前端多端统一开发背景与趋势介绍">前端多端统一开发背景与趋势介绍</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/books/Taro 多端开发实现原理与项目实战/1、基础篇 React 核心语法初识">React 核心语法初识</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/books/Taro 多端开发实现原理与项目实战/2、基础篇 微信小程序开发入门与技术选型">微信小程序开发入门与技术选型</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/books/Taro 多端开发实现原理与项目实战/3、基础篇 多端统一开发框架 Taro 的安装与使用">多端统一开发框架 Taro 的安装与使用</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/books/Taro 多端开发实现原理与项目实战/4、基础篇 Taro 开发说明与注意事项">Taro 开发说明与注意事项</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/books/Taro 多端开发实现原理与项目实战/5、基础篇 用 Taro 实现一个简单的 Todo 项目">用 Taro 实现一个简单的 Todo 项目</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/books/Taro 多端开发实现原理与项目实战/6、基础篇 在 Taro 中使用 Redux">在 Taro 中使用 Redux</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/books/Taro 多端开发实现原理与项目实战/7、进阶篇 Taro 设计思想及架构">Taro 设计思想及架构</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/books/Taro 多端开发实现原理与项目实战/8、进阶篇 CLI 原理及不同端的运行机制">CLI 原理及不同端的运行机制</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/books/Taro 多端开发实现原理与项目实战/9、进阶篇 组件库及 API 的设计与适配">Taro 组件库及 API 的设计与适配</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/books/Taro 多端开发实现原理与项目实战/10、进阶篇 JSX 转换微信小程序模板的实现（上）">JSX 转换微信小程序模板的实现（上）</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/books/Taro 多端开发实现原理与项目实战/11、进阶篇 JSX 转换微信小程序模板的实现（下）">JSX 转换微信小程序模板的实现（下）</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/books/Taro 多端开发实现原理与项目实战/12、进阶篇 运行时揭秘 - 小程序运行时">运行时揭秘 - 小程序运行时</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/books/Taro 多端开发实现原理与项目实战/13、进阶篇 运行时揭秘 - H5 运行时">运行时揭秘 - H5 运行时</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/books/Taro 多端开发实现原理与项目实战/14、进阶篇 运行时揭秘 - RN 运行时">运行时揭秘 - RN 运行时</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/books/Taro 多端开发实现原理与项目实战/15、实战篇 多端电商平台完整项目概述及开发准备">多端电商平台项目概述及开发准备</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/books/Taro 多端开发实现原理与项目实战/16、实战篇 小程序云的介绍与使用">小程序云的介绍与使用</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/books/Taro 多端开发实现原理与项目实战/17、实战篇 通过小程序云搭建电商后台服务">通过小程序云搭建电商后台服务</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/books/Taro 多端开发实现原理与项目实战/18、实战篇 商品列表页开发及性能优化">商品列表页开发及性能优化</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/books/Taro 多端开发实现原理与项目实战/19、实战篇 商品详情页面开发">商品详情页面开发</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/books/Taro 多端开发实现原理与项目实战/20、实战篇 购物车开发">购物车开发</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/books/Taro 多端开发实现原理与项目实战/21、实战篇 结算页面开发">结算页面开发</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/books/Taro 多端开发实现原理与项目实战/22、实战篇 微信小程序端用户授权处理">微信小程序端用户授权处理</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/books/Taro 多端开发实现原理与项目实战/23、实战篇 微信小程序开发填坑指南">微信小程序开发填坑指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/books/Taro 多端开发实现原理与项目实战/24、实战篇 微信小程序端及 H5 端预览适配与发布">微信小程序及 H5 端预览适配与发布</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/books/Taro 多端开发实现原理与项目实战/25、实战篇 React Native 端打包与发布">React Native 端打包与发布</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/books/Taro 多端开发实现原理与项目实战/26、总结">总结</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">前端性能优化原理与实践</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">前端面试之道</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">微信小程序开发入门：从 0 到 1 实现天气小程序</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">深入浅出TypeScript：从基础知识到类型编程</a></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_1CGd"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_3E-R"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>CLI 原理及不同端的运行机制</h1></header><p>taro-cli 负责 Taro 脚手架初始化和项目构建的的命令行工具，NPM 包的链接在这里：<a href="https://www.npmjs.com/package/@tarojs/cli" target="_blank" rel="noopener noreferrer">@tarojs/cli</a> 。</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="taro-cli-包">taro-cli 包<a aria-hidden="true" class="hash-link" href="#taro-cli-包" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_31ik" id="taro-命令">Taro 命令<a aria-hidden="true" class="hash-link" href="#taro-命令" title="Direct link to heading">​</a></h3><p>taro-cli 包位于 <a href="https://github.com/NervJS/taro" target="_blank" rel="noopener noreferrer">Taro</a> 工程的 Packages 目录下，通过 <code>npm install -g @tarojs/cli</code> 全局安装后，将会生成一个 Taro 命令。主要负责项目初始化、编译、构建等。直接在命令行输入 Taro ，会看到如下提示：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">➜ taro</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">👽 </span><span class="token maybe-class-name">Taro</span><span class="token plain"> v0</span><span class="token punctuation" style="color:#393A34">.</span><span class="token number" style="color:#36acaa">0.63</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token maybe-class-name">Usage</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> taro </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">command</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">options</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token maybe-class-name">Options</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">-</span><span class="token constant" style="color:#36acaa">V</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">--</span><span class="token plain">version       output the version number</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">h</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">--</span><span class="token plain">help          output usage information</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token maybe-class-name">Commands</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    init </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">projectName</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">  </span><span class="token maybe-class-name">Init</span><span class="token plain"> a project </span><span class="token keyword" style="color:#00009f">with</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">default</span><span class="token plain"> templete</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    build               </span><span class="token maybe-class-name">Build</span><span class="token plain"> a project </span><span class="token keyword" style="color:#00009f">with</span><span class="token plain"> options</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    update              </span><span class="token maybe-class-name">Update</span><span class="token plain"> packages </span><span class="token keyword" style="color:#00009f">of</span><span class="token plain"> taro</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    help </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">cmd</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">          display help </span><span class="token keyword control-flow" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">cmd</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>里面包含了 Taro 所有命令用法及作用。</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="包管理与发布">包管理与发布<a aria-hidden="true" class="hash-link" href="#包管理与发布" title="Direct link to heading">​</a></h3><p>首先，我们需要了解 taro-cli 包与 Taro 工程的关系。</p><p>将 Taro 工程 Clone 之后，可以看到工程的目录结构如下，整体结构还是比较清晰的：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token property-access">├──</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">CHANGELOG</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">md</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── </span><span class="token constant" style="color:#36acaa">LICENSE</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── </span><span class="token constant" style="color:#36acaa">README</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">md</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── build</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── docs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── lerna</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">debug</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">log</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── lerna</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">json</span><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// Lerna 配置文件</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── </span><span class="token keyword" style="color:#00009f">package</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">json</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── packages</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── eslint</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">config</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">taro</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── eslint</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">plugin</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">taro</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── postcss</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">plugin</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">constparse</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── postcss</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">pxtransform</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── taro</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── taro</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">async</span><span class="token operator" style="color:#393A34">-</span><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── taro</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">cli</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── taro</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">components</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── taro</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">components</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">rn</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── taro</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">h5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── taro</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">plugin</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">babel</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── taro</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">plugin</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">csso</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── taro</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">plugin</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">sass</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── taro</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">plugin</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">uglifyjs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── taro</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">redux</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── taro</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">redux</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">h5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── taro</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">rn</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── taro</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">rn</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">runner</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── taro</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">router</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── taro</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">transformer</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">wx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── taro</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">weapp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   └── taro</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">webpack</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">runner</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└── yarn</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">lock</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p><a href="https://github.com/NervJS/taro" target="_blank" rel="noopener noreferrer">Taro</a> 项目主要是由一系列 NPM 包组成，位于工程的 Packages 目录下。它的包管理方式和 <a href="https://github.com/babel/babel" target="_blank" rel="noopener noreferrer">Babel</a> 项目一样，将整个项目作为一个 monorepo 来进行管理，并且同样使用了包管理工具 <a href="https://github.com/lerna/lerna" target="_blank" rel="noopener noreferrer">Lerna</a>。</p><blockquote><p>Lerna 是一个用来优化托管在 Git/NPM 上的多 package 代码库的工作流的一个管理工具，可以让你在主项目下管理多个子项目，从而解决了多个包互相依赖，且发布时需要手动维护多个包的问题。</p></blockquote><blockquote><p>关于 Lerna 的更多介绍可以看官方文档 <a href="https://lernajs.io/" target="_blank" rel="noopener noreferrer">Lerna：A tool for managing JavaScript projects with multiple packages</a>。</p></blockquote><p>Packages 目录下十几个包中，最常用的项目初始化与构建的命令行工具 <a href="https://github.com/NervJS/taro/tree/master/packages/taro-cli" target="_blank" rel="noopener noreferrer">Taro CLI</a> 就是其中一个。在 Taro 工程根目录运行 <code>lerna publish</code> 命令之后，<code>lerna.json</code> 里面配置好的所有的包会被发布到 NPM 上。</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="目录结构">目录结构<a aria-hidden="true" class="hash-link" href="#目录结构" title="Direct link to heading">​</a></h3><p>taro-cli 包的目录结构如下：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">.</span><span class="token operator" style="color:#393A34">/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── bin        </span><span class="token comment" style="color:#999988;font-style:italic">// 命令行</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── taro              </span><span class="token comment" style="color:#999988;font-style:italic">// taro 命令</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── taro</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">build        </span><span class="token comment" style="color:#999988;font-style:italic">// taro build 命令</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── taro</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">update       </span><span class="token comment" style="color:#999988;font-style:italic">// taro update 命令</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   └── taro</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">init         </span><span class="token comment" style="color:#999988;font-style:italic">// taro init 命令</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── </span><span class="token keyword" style="color:#00009f">package</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">json</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── node_modules</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── src</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── build</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">js</span><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// taro build 命令调用，根据 type 类型调用不同的脚本</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   │   ├── babel</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">js</span><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// Babel 配置</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   │   ├── babylon</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">js</span><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">// JavaScript 解析器 babylon 配置</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   │   ├── browser_list</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">js</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// autoprefixer browsers 配置</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   │   ├── index</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">js</span><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// 目录名及入口文件名相关配置</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   │   └── uglify</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">js</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── creator</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">js</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── h5</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">js</span><span class="token plain">       </span><span class="token comment" style="color:#999988;font-style:italic">// 构建h5 平台代码</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── project</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">js</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// taro init 命令调用，初始化项目</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── rn</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">js</span><span class="token plain">       </span><span class="token comment" style="color:#999988;font-style:italic">// 构建React Native 平台代码</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── util        </span><span class="token comment" style="color:#999988;font-style:italic">// 一系列工具函数</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   │   ├── index</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">js</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   │   ├── npm</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">js</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   │   └── resolve_npm_files</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">js</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   └── weapp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">js</span><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// 构建小程序代码转换</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── templates           </span><span class="token comment" style="color:#999988;font-style:italic">// 脚手架模版</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   └── </span><span class="token keyword module" style="color:#00009f">default</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│       ├── appjs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│       ├── config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│       │   ├── dev</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│       │   ├── index</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│       │   └── prod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│       ├── editorconfig</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│       ├── eslintrc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│       ├── gitignore</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│       ├── index</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">js</span><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 初始化文件及目录，copy模版等</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│       ├── indexhtml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│       ├── npmrc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│       ├── pagejs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│       ├── pkg</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│       └── scss</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└── yarn</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">error</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">log</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>其中关键文件的作用已添加注释说明，大家可以先大概看看，有个初步印象。</p><p>通过上面的目录树可以发现，taro-cli 工程的文件并不算多，主要目录有：<code>/bin</code>、<code>/src</code>、<code>/template</code>，笔者已经在上面详细标注了主要的目录和文件的作用，至于具体的流程，咱们接下来再分析。</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="用到的核心库">用到的核心库<a aria-hidden="true" class="hash-link" href="#用到的核心库" title="Direct link to heading">​</a></h2><ul><li><a href="https://github.com/tj/commander.js/" target="_blank" rel="noopener noreferrer">tj/commander.js</a> <a href="http://nodejs.org/" target="_blank" rel="noopener noreferrer">Node.js</a> - 命令行接口全面的解决方案，灵感来自于 Ruby&#x27;s <a href="https://github.com/commander-rb/commander" target="_blank" rel="noopener noreferrer">commander</a>。可以自动的解析命令和参数，合并多选项，处理短参等等，功能强大，上手简单。</li><li><a href="https://github.com/jprichardson/node-fs-extra" target="_blank" rel="noopener noreferrer">jprichardson/node-fs-extra</a> - 在 Node.js 的 fs 基础上增加了一些新的方法，更好用，还可以拷贝模板。</li><li><a href="https://github.com/chalk/chalk" target="_blank" rel="noopener noreferrer">chalk/chalk</a> - 可以用于控制终端输出字符串的样式。</li><li><a href="https://github.com/SBoudrias/Inquirer.js/" target="_blank" rel="noopener noreferrer">SBoudrias/Inquirer.js</a> - Node.js 命令行交互工具，通用的命令行用户界面集合，可以和用户进行交互。</li><li><a href="https://github.com/sindresorhus/ora" target="_blank" rel="noopener noreferrer">sindresorhus/ora</a> - 实现加载中的状态是一个 Loading 加前面转起来的小圈圈，成功了是一个 Success 加前面一个小钩钩。</li><li><a href="https://github.com/sboudrias/mem-fs-editor" target="_blank" rel="noopener noreferrer">SBoudrias/mem-fs-editor</a> - 提供一系列 API，方便操作模板文件。</li><li><a href="https://github.com/shelljs/shelljs" target="_blank" rel="noopener noreferrer">shelljs/shelljs</a> - ShellJS 是 Node.js 扩展，用于实现 Unix shell 命令执行。</li><li><a href="https://nodejs.org/api/child_process.html" target="_blank" rel="noopener noreferrer">Node.js child<!-- -->_<!-- -->process</a> - 模块用于新建子进程。子进程的运行结果储存在系统缓存之中（最大 200KB），等到子进程运行结束以后，主进程再用回调函数读取子进程的运行结果。</li></ul><h2 class="anchor anchorWithStickyNavbar_31ik" id="taro-init">Taro Init<a aria-hidden="true" class="hash-link" href="#taro-init" title="Direct link to heading">​</a></h2><p>Taro Init 命令主要的流程如下：</p><p><img src="https://user-gold-cdn.xitu.io/2018/10/8/16651547b6ddebe1?w=1354&amp;h=466&amp;f=png&amp;s=51974" alt="image"></p><h3 class="anchor anchorWithStickyNavbar_31ik" id="taro-命令入口">Taro 命令入口<a aria-hidden="true" class="hash-link" href="#taro-命令入口" title="Direct link to heading">​</a></h3><p>当我们全局安装 taro-cli 包之后，我们的命令行里就有了 Taro 命令。</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">$ npm install </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">g @tarojs</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">cli</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>那么 Taro 命令是怎样添加进去的呢？其原因在于 <code>package.json</code> 里面的 bin 字段：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">&quot;bin&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;taro&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;bin/taro&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>上面代码指定，Taro 命令对应的可执行文件为 bin/taro 。NPM 会寻找这个文件，在 <code>[prefix]/bin</code> 目录下建立符号链接。在上面的例子中，Taro 会建立符号链接 <code>[prefix]/bin/taro</code>。由于 <code>[prefix]/bin</code> 目录会在运行时加入系统的 PATH 变量，因此在运行 NPM 时，就可以不带路径，直接通过命令来调用这些脚本。</p><p>关于<code>prefix</code>，可以通过<code>npm config get prefix</code>获取。</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">$ npm config </span><span class="token keyword" style="color:#00009f">get</span><span class="token plain"> prefix</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">/</span><span class="token plain">usr</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">local</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>通过下列命令可以更加清晰的看到它们之间的符号链接：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">$ ls </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">al </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">which taro</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lrwxr</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">xr</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">x  </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> chengshuai  admin  </span><span class="token number" style="color:#36acaa">40</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">6</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">15</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">51</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token plain">usr</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">local</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">bin</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">taro </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">lib</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">node_modules</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">@tarojs</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">cli</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">bin</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">taro</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_31ik" id="taro-子命令">Taro 子命令<a aria-hidden="true" class="hash-link" href="#taro-子命令" title="Direct link to heading">​</a></h3><p>上面我们已经知道 taro-cli 包安装之后，Taro 命令是怎么和 <code>/bin/taro</code> 文件相关联起来的， 那 Taro Init 和 Taro Build 又是怎样和对应的文件关联起来的呢？</p><h4 class="anchor anchorWithStickyNavbar_31ik" id="命令关联与参数解析">命令关联与参数解析<a aria-hidden="true" class="hash-link" href="#命令关联与参数解析" title="Direct link to heading">​</a></h4><p>这里就不得不提到一个有用的包：<a href="https://github.com/tj/commander.js/" target="_blank" rel="noopener noreferrer">tj/commander.js</a> ，<a href="http://nodejs.org/" target="_blank" rel="noopener noreferrer">Node.js</a> 命令行接口全面的解决方案，灵感来自于 Ruby&#x27;s <a href="https://github.com/commander-rb/commander" target="_blank" rel="noopener noreferrer">commander</a>。可以自动的解析命令和参数，合并多选项，处理短参等等，功能强大，上手简单。具体的使用方法可以参见项目的 <a href="https://github.com/SBoudrias/Inquirer.js" target="_blank" rel="noopener noreferrer">README</a>。</p><p>更主要的，commander 支持 Git 风格的子命令处理，可以根据子命令自动引导到以特定格式命名的命令执行文件，文件名的格式是 <code>[command]-[subcommand]</code>，例如：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">taro </span><span class="token parameter">init</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> taro</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">init</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">taro </span><span class="token parameter">build</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> taro</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">build</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p><code>/bin/taro</code> 文件内容不多，核心代码也就那几行 <code>.command()</code> 命令：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">#</span><span class="token operator" style="color:#393A34">!</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token plain">usr</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">bin</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">env node</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> program </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;commander&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">getPkgVersion</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;../src/util&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">program</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">version</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">getPkgVersion</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">usage</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;&lt;command&gt; [options]&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">command</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;init [projectName]&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;Init a project with default templete&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">command</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;build&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;Build a project with options&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">command</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;update&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;Update packages of taro&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">parse</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">process</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">argv</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>通过上面代码可以发现，<code>init</code>，<code>build</code> ，<code>update</code>等命令都是通过<code>.command(name, description)</code>方法定义的，然后通过 <code>.parse(arg)</code> 方法解析参数。具体可以查看 <a href="http://tj.github.io/commander.js" target="_blank" rel="noopener noreferrer">Commander.js API 文档</a>。</p><blockquote><p>注意第一行<code>#!/usr/bin/env node</code>，有个关键词叫 <a href="https://link.juejin.im/?target=http%3A%2F%2Fsmilejay.com%2F2012%2F03%2Flinux_shebang%2F" target="_blank" rel="noopener noreferrer">Shebang</a>，不了解的可以去搜搜看。</p></blockquote><h3 class="anchor anchorWithStickyNavbar_31ik" id="参数解析及与用户交互">参数解析及与用户交互<a aria-hidden="true" class="hash-link" href="#参数解析及与用户交互" title="Direct link to heading">​</a></h3><p>前面提到过，commander 包可以自动解析命令和参数，在配置好命令之后，还能够自动生成 help（帮助）命令和 version（版本查看） 命令。并且通过<code>program.args</code>便可以获取命令行的参数，然后再根据参数来调用不同的脚本。</p><p>但当我们运行 <code>taro init</code> 命令后，如下所示的命令行交互又是怎么实现的呢？</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">$ taro init taroDemo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token maybe-class-name">Taro</span><span class="token plain"> 即将创建一个新项目</span><span class="token operator" style="color:#393A34">!</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token maybe-class-name">Need</span><span class="token plain"> help</span><span class="token operator" style="color:#393A34">?</span><span class="token plain"> </span><span class="token maybe-class-name">Go</span><span class="token plain"> and open issue</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> https</span><span class="token operator" style="color:#393A34">:</span><span class="token operator" style="color:#393A34">/</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">github</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">com</span><span class="token operator" style="color:#393A34">/</span><span class="token maybe-class-name">NervJS</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">taro</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">issues</span><span class="token operator" style="color:#393A34">/</span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token class-name">Taro</span><span class="token plain"> v0</span><span class="token punctuation" style="color:#393A34">.</span><span class="token number" style="color:#36acaa">0.50</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">?</span><span class="token plain"> 请输入项目介绍！</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">?</span><span class="token plain"> 请选择模板 默认模板</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>这里使用的是 <a href="https://github.com/SBoudrias/Inquirer.js/" target="_blank" rel="noopener noreferrer">SBoudrias/Inquirer.js</a> 来处理命令行交互。</p><p>用法其实很简单：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> inquirer </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;inquirer&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// npm i inquirer -D</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">typeof</span><span class="token plain"> conf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">description</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;string&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      prompts</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">push</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        type</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;input&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        name</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;description&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        message</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;请输入项目介绍！&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p><code>prompt()</code>接受一个问题对象的数据，在用户与终端交互过程中，将用户的输入存放在一个答案对象中，然后返回一个<code>Promise</code>，通过<code>then()</code>获取到这个答案对象。</p><p>借此，新项目的名称、版本号、描述等信息可以直接通过终端交互插入到项目模板中，完善交互流程。</p><p>当然，交互的问题不仅限于此，可以根据自己项目的情况，添加更多的交互问题。<code>inquirer.js</code> 强大的地方在于，支持很多种交互类型，除了简单的<code>input</code>，还有<code>confirm</code>、<code>list</code>、<code>password</code>、<code>checkbox</code>等，具体可以参见项目的工程 <a href="https://github.com/SBoudrias/Inquirer.js" target="_blank" rel="noopener noreferrer">README</a>。</p><p>此外，你在执行异步操作的过程中，还可以使用 <a href="https://github.com/sindresorhus/ora" target="_blank" rel="noopener noreferrer">sindresorhus/ora</a> 来添加一下 Loading 效果。使用 <a href="https://github.com/chalk/chalk" target="_blank" rel="noopener noreferrer">chalk/chalk</a> 给终端的输出添加各种样式。</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="模版文件操作">模版文件操作<a aria-hidden="true" class="hash-link" href="#模版文件操作" title="Direct link to heading">​</a></h3><p>最后就是模版文件操作了，主要分为两大块：</p><ul><li>将输入的内容插入到模板中</li><li>根据命令创建对应目录结构，copy 文件</li><li>更新已存在文件内容</li></ul><p>这些操作基本都是在 <code>/template/index.js</code> 文件里。</p><p>这里还用到了 <a href="https://github.com/shelljs/shelljs" target="_blank" rel="noopener noreferrer">shelljs/shelljs</a> 执行 shell 脚本，如初始化 Git： <code>git init</code>，项目初始化之后安装依赖 <code>npm install</code>等。</p><h4 class="anchor anchorWithStickyNavbar_31ik" id="拷贝模板文件">拷贝模板文件<a aria-hidden="true" class="hash-link" href="#拷贝模板文件" title="Direct link to heading">​</a></h4><p>拷贝模版文件主要是使用 <a href="https://github.com/jprichardson/node-fs-extra" target="_blank" rel="noopener noreferrer">jprichardson/node-fs-extra</a> 的 <code>copyTpl()</code>方法，此方法使用 <code>ejs</code> 模板语法，可以将输入的内容插入到模版的对应位置：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">fs</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">copyTpl</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  project</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  path</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">join</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">projectPath</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;project.config.json&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">description</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> projectName</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_31ik" id="更新已经存在的文件内容">更新已经存在的文件内容<a aria-hidden="true" class="hash-link" href="#更新已经存在的文件内容" title="Direct link to heading">​</a></h4><p>更新已经存在的文件内容是很复杂的工作，最可靠的方法是把文件解析为<code>AST</code>，然后再编辑。一些流行的 <code>AST parser</code> 包括：</p><ul><li><code>Cheerio</code>：解析<code>HTML</code>。</li><li><code>Babylon</code>：解析<code>JavaScript</code>。</li><li>对于<code>JSON</code>文件，使用原生的<code>JSON</code>对象方法。</li></ul><p>使用 <code>Regex</code> 解析一个代码文件是「邪道」，不要这么干，不要心存侥幸。</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="taro-build">Taro Build<a aria-hidden="true" class="hash-link" href="#taro-build" title="Direct link to heading">​</a></h2><p><code>taro build</code> 命令是整个 Taro 项目的灵魂和核心，主要负责<strong>多端代码编译</strong>（H5，小程序，React Native 等）。</p><p>Taro 命令的关联，参数解析等和 <code>taro init</code> 其实是一模一样的，那么最关键的代码转换部分是怎样实现的呢？</p><p>这一部分内容过于庞大，需要单独拉出来一篇讲。不过这里可以先简单提一下。</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="编译工作流与抽象语法树ast">编译工作流与抽象语法树（AST）<a aria-hidden="true" class="hash-link" href="#编译工作流与抽象语法树ast" title="Direct link to heading">​</a></h3><p>Taro 的核心部分就是将代码编译成其他端（H5、小程序、React Native 等）代码。一般来说，将一种结构化语言的代码编译成另一种类似的结构化语言的代码包括以下几个步骤：</p><p><img src="https://user-gold-cdn.xitu.io/2018/10/8/166515483b7fa7c0?w=880&amp;h=228&amp;f=png&amp;s=30011" alt="image"></p><p>首先是 Parse，将代码解析（Parse）成抽象语法树（Abstract Syntex Tree），然后对 AST 进行遍历（traverse）和替换(replace)（这对于前端来说其实并不陌生，可以类比 DOM 树的操作），最后是生成（generate），根据新的 AST 生成编译后的代码。</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="babel-模块">Babel 模块<a aria-hidden="true" class="hash-link" href="#babel-模块" title="Direct link to heading">​</a></h3><p>Babel 是一个通用的多功能的 <code>JavaScript</code>编译器，更确切地说是源码到源码的编译器，通常也叫做转换编译器（transpiler）。 意思是说你为 Babel 提供一些 JavaScript 代码，Babel 更改这些代码，然后返回给你新生成的代码。</p><p>此外它还拥有众多模块可用于不同形式的静态分析。</p><blockquote><p>静态分析是在不需要执行代码的前提下对代码进行分析的处理过程（执行代码的同时进行代码分析即是动态分析）。 静态分析的目的是多种多样的， 它可用于语法检查、编译、代码高亮、代码转换、优化和压缩等等场景。</p></blockquote><p>Babel 实际上是一组模块的集合，拥有庞大的生态。Taro 项目的代码编译部分就是基于 Babel 的以下模块实现的：</p><ul><li><a href="https://github.com/babel/babylon" target="_blank" rel="noopener noreferrer">Babylon</a> - Babel 的解析器。最初是从 Acorn 项目 fork 出来的。Acorn 非常快，易于使用，并且针对非标准特性(以及那些未来的标准特性) 设计了一个基于插件的架构。</li><li><a href="https://github.com/babel/babel/tree/master/packages/babel-traverse" target="_blank" rel="noopener noreferrer">Babel-traverse</a> - 负责维护整棵树的状态，并且负责替换、移除和添加节点。</li><li><a href="https://github.com/babel/babel/tree/master/packages/babel-types" target="_blank" rel="noopener noreferrer">Babel-types</a> - 一个用于 AST 节点的 Lodash 式工具库， 它包含了构造、验证以及变换 AST 节点的方法。 该工具库包含考虑周到的工具方法，对编写处理 AST 逻辑非常有用。</li><li><a href="https://github.com/babel/babel/tree/master/packages/babel-generator" target="_blank" rel="noopener noreferrer">Babel-generator</a> - Babel 的代码生成器，它读取 AST 并将其转换为代码和源码映射（sourcemaps）。</li><li><a href="https://github.com/babel/babel/tree/master/packages/babel-template" target="_blank" rel="noopener noreferrer">Babel-template</a> - 另一个虽然很小但却非常有用的模块。 它能让你编写字符串形式且带有占位符的代码来代替手动编码， 尤其是生成大规模 AST 的时候。 在计算机科学中，这种能力被称为准引用（quasiquotes）。</li></ul><h3 class="anchor anchorWithStickyNavbar_31ik" id="解析页面-config-配置">解析页面 Config 配置<a aria-hidden="true" class="hash-link" href="#解析页面-config-配置" title="Direct link to heading">​</a></h3><p>在业务代码编译成小程序的代码过程中，有一步是将页面入口 JS 的 Config 属性解析出来，并写入 <code>*.json</code> 文件，供小程序使用。那么这一步是怎么实现的呢？这里将这部分功能的关键代码抽取出来：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// 1. babel-traverse方法， 遍历和更新节点</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">traverse</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ast</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function maybe-class-name" style="color:#d73a49">ClassProperty</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">astPath</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 遍历类的属性声明</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> node </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> astPath</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">node</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">node</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">key</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">name</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">===</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;config&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 类的属性名为 config</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      configObj </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">traverseObjectNode</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">node</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      astPath</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">remove</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 将该方法移除掉</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 2. 遍历，解析为 JSON 对象</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">traverseObjectNode</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">node</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> obj</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">node</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">type</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">===</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;ClassProperty&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> node</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">type</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">===</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;ObjectProperty&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> properties </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> node</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">value</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">properties</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      obj </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      properties</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">forEach</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">p</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> index</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        obj</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">p</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">key</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">name</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">traverseObjectNode</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">p</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">value</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> obj</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">node</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">type</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">===</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;ObjectExpression&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> properties </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> node</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">properties</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    obj </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    properties</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">forEach</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">p</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> index</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">// const t = require(&#x27;babel-types&#x27;)  AST 节点的 Lodash 式工具库</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> key </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> t</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">isIdentifier</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">p</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">key</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">?</span><span class="token plain"> p</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">key</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">name</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> p</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">key</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">value</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      obj</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">key</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">traverseObjectNode</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">p</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">value</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> obj</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">node</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">type</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">===</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;ArrayExpression&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> node</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">elements</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">map</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">item</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">traverseObjectNode</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">item</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">node</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">type</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">===</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;NullLiteral&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token keyword null nil" style="color:#00009f">null</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> node</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">value</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 3. 写入对应目录的 *.json 文件</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fs</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">writeFileSync</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">outputPageJSONPath</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token known-class-name class-name">JSON</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">stringify</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">configObj</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword null nil" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>从以上代码的注释中，可以清晰的看到，通过以上三步，就可以将工程里面的 Config 配置转换成小程序对应的 JSON 配置文件。</p><p>但是，哪怕仅仅是这一小块功能点，真正实现起来也没那么简单，你还需要考虑大量的真实业务场景和极端情况：</p><ul><li>应用入口 app.js 和页面入口 index.js 的 Config 是否单独处理？</li><li>TabBar 配置怎样转换且保证功能及交互一致？</li><li>用户的配置信息有误怎么处理？</li></ul><p>想了解更多 Taro 编译的相关实现，可以查阅第 11-12 章《<a href="https://juejin.im/book/5b73a131f265da28065fb1cd/section/5b74ec276fb9a009b16d4933" target="_blank" rel="noopener noreferrer">Taro 实现 JSX 转换小程序模板</a>》。</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="taro-update">Taro Update<a aria-hidden="true" class="hash-link" href="#taro-update" title="Direct link to heading">​</a></h2><p><code>taro update</code> 命令主要是为了方便大家更新 taro-cli 及 Taro 相关的依赖包，在命令行直接输入<code>taro update</code> 的命令，便可以得到如下的提示：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">taro update</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">👽 </span><span class="token maybe-class-name">Taro</span><span class="token plain"> v0</span><span class="token punctuation" style="color:#393A34">.</span><span class="token number" style="color:#36acaa">0.70</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">命令错误</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">taro update self 更新 </span><span class="token maybe-class-name">Taro</span><span class="token plain"> 开发工具 taro</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">cli 到最新版本</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">taro update project 更新项目所有 </span><span class="token maybe-class-name">Taro</span><span class="token plain"> 相关依赖到最新版本</span><span class="token spread operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>通过上面的提示可以看到，<code>taro update</code> 现在仅支持两个子命令，原理和 <code>taro init</code> 类似，第一个命令其实等同于如下命令：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">npm i </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">g @tarojs</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">cli@latest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">或</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">yarn global add @tarojs</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">cli@latest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>第二个命令稍微复杂点，不过代码也十分易懂，无非就是如下三步：</p><ol><li>获取 Taro 的最新版本</li><li>更新项目 package.json 里面的 Taro 依赖信息到最新版本</li><li>运行 <code>npm install</code></li></ol><h2 class="anchor anchorWithStickyNavbar_31ik" id="小结">小结<a aria-hidden="true" class="hash-link" href="#小结" title="Direct link to heading">​</a></h2><p>到此，<code>taro-cli</code> 的主要目录结构、命令调用和项目初始化方式等基本都捋完了，有兴趣的同学可以结合着工程的源代码自己捋一遍，应该不会太费劲。</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/dapengdouyu/docs/tree/master/docs/books/Taro 多端开发实现原理与项目实战/8、进阶篇 CLI 原理及不同端的运行机制.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_13-_"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2021-10-11T06:28:32.000Z">10/11/2021</time></b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/books/Taro 多端开发实现原理与项目实战/7、进阶篇 Taro 设计思想及架构"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« <!-- -->Taro 设计思想及架构</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/books/Taro 多端开发实现原理与项目实战/9、进阶篇 组件库及 API 的设计与适配"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Taro 组件库及 API 的设计与适配<!-- --> »</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#taro-cli-包" class="table-of-contents__link toc-highlight">taro-cli 包</a><ul><li><a href="#taro-命令" class="table-of-contents__link toc-highlight">Taro 命令</a></li><li><a href="#包管理与发布" class="table-of-contents__link toc-highlight">包管理与发布</a></li><li><a href="#目录结构" class="table-of-contents__link toc-highlight">目录结构</a></li></ul></li><li><a href="#用到的核心库" class="table-of-contents__link toc-highlight">用到的核心库</a></li><li><a href="#taro-init" class="table-of-contents__link toc-highlight">Taro Init</a><ul><li><a href="#taro-命令入口" class="table-of-contents__link toc-highlight">Taro 命令入口</a></li><li><a href="#taro-子命令" class="table-of-contents__link toc-highlight">Taro 子命令</a></li><li><a href="#参数解析及与用户交互" class="table-of-contents__link toc-highlight">参数解析及与用户交互</a></li><li><a href="#模版文件操作" class="table-of-contents__link toc-highlight">模版文件操作</a></li></ul></li><li><a href="#taro-build" class="table-of-contents__link toc-highlight">Taro Build</a><ul><li><a href="#编译工作流与抽象语法树ast" class="table-of-contents__link toc-highlight">编译工作流与抽象语法树（AST）</a></li><li><a href="#babel-模块" class="table-of-contents__link toc-highlight">Babel 模块</a></li><li><a href="#解析页面-config-配置" class="table-of-contents__link toc-highlight">解析页面 Config 配置</a></li></ul></li><li><a href="#taro-update" class="table-of-contents__link toc-highlight">Taro Update</a></li><li><a href="#小结" class="table-of-contents__link toc-highlight">小结</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2021 dapeng (张亚鹏) Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.044e1902.js"></script>
<script src="/assets/js/main.13b64cb7.js"></script>
</body>
</html>