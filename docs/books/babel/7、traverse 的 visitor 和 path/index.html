<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.4">
<link rel="alternate" type="application/rss+xml" href="/rss.xml" title="Dapengçš„åšå®¢ Blog RSS Feed">
<script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?7dda2565ba246ecd62878c13153e2941",e.defer=!0;var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script>
<meta name="baidu-site-verification" content="IXU12YQUjF">
<link rel="preconnect" href="https://hmcdn.baidu.com">
<link rel="stylesheet" href="https://cansiny.oss-cn-shanghai.aliyuncs.com/assets/fonts.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/katex.min.css" integrity="sha384-Um5gpz1odJg5Z4HAmzPtgZKdTBHZdw8S29IecapCSB31ligYPhHQZMIlWLYQGVoc" crossorigin="anonymous"><title data-react-helmet="true">7ã€traverse çš„ visitor å’Œ path - Dapengçš„åšå®¢</title><meta data-react-helmet="true" property="og:url" content="https://dapengdouyu.github.io/docs/books/babel/7ã€traverse çš„ visitor å’Œ path"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="7ã€traverse çš„ visitor å’Œ path - Dapengçš„åšå®¢"><meta data-react-helmet="true" name="description" content="æºç  parse æˆ AST ä¹‹åï¼Œéœ€è¦è¿›è¡Œ AST çš„éå†å’Œå¢åˆ æ”¹ï¼ˆtransformï¼‰ã€‚é‚£ä¹ˆ transform çš„æµç¨‹æ˜¯ä»€ä¹ˆæ ·çš„ï¼Ÿ"><meta data-react-helmet="true" property="og:description" content="æºç  parse æˆ AST ä¹‹åï¼Œéœ€è¦è¿›è¡Œ AST çš„éå†å’Œå¢åˆ æ”¹ï¼ˆtransformï¼‰ã€‚é‚£ä¹ˆ transform çš„æµç¨‹æ˜¯ä»€ä¹ˆæ ·çš„ï¼Ÿ"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://dapengdouyu.github.io/docs/books/babel/7ã€traverse çš„ visitor å’Œ path"><link data-react-helmet="true" rel="alternate" href="https://dapengdouyu.github.io/docs/books/babel/7ã€traverse çš„ visitor å’Œ path" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://dapengdouyu.github.io/docs/books/babel/7ã€traverse çš„ visitor å’Œ path" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.5ab70b72.css">
<link rel="preload" href="/assets/js/runtime~main.3c5dc381.js" as="script">
<link rel="preload" href="/assets/js/main.055808b2.js" as="script">
</head>
<body>
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,e("light"))}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/logo.jpg" alt="DAPENG" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo.jpg" alt="DAPENG" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">DAPENG</b></a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/">åšå®¢</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/tags/java-script">JavaScript</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__item navbar__link">å‰ç«¯</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/program/javascript/index">Javascript</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__item navbar__link">é˜…è¯»</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/books/babel/index">babel</a></li></ul></div><a href="https://github.com/dapengdouyu" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>gitee<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">ğŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ğŸŒ</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_31aa"><button class="clean-btn backToTopButton_35hR" type="button" title="Scroll to top"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><main class="docMainContainer_3ufF docMainContainerEnhanced_3NYZ"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="markdown"><header><h1 class="h1Heading_27L5">7ã€traverse çš„ visitor å’Œ path</h1></header><p>æºç  parse æˆ AST ä¹‹åï¼Œéœ€è¦è¿›è¡Œ AST çš„éå†å’Œå¢åˆ æ”¹ï¼ˆtransformï¼‰ã€‚é‚£ä¹ˆ transform çš„æµç¨‹æ˜¯ä»€ä¹ˆæ ·çš„ï¼Ÿ</p><p>babel ä¼šé€’å½’éå† ASTï¼Œéå†è¿‡ç¨‹ä¸­å¤„ç†åˆ°ä¸åŒçš„ AST ä¼šè°ƒç”¨ä¸åŒçš„ visitor å‡½æ•°æ¥å®ç° transformã€‚è¿™æ˜¯ visitor æ¨¡å¼çš„åº”ç”¨ã€‚</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="visitoræ¨¡å¼"></a>visitoræ¨¡å¼<a class="hash-link" href="#visitoræ¨¡å¼" title="Direct link to heading">#</a></h2><p>visitor æ¨¡å¼ï¼ˆè®¿é—®è€…æ¨¡å¼ï¼‰æ˜¯ 23 ç§ç»å…¸è®¾è®¡æ¨¡å¼ä¸­çš„ä¸€ç§ã€‚å½“è¢«æ“ä½œçš„å¯¹è±¡ç»“æ„æ¯”è¾ƒç¨³å®šï¼Œè€Œæ“ä½œå¯¹è±¡çš„é€»è¾‘ç»å¸¸å˜åŒ–çš„æ—¶å€™ï¼Œé€šè¿‡åˆ†ç¦»é€»è¾‘å’Œå¯¹è±¡ç»“æ„ï¼Œä½¿å¾—ä»–ä»¬èƒ½ç‹¬ç«‹æ‰©å±•ã€‚è¿™å°±æ˜¯ visitor æ¨¡å¼çš„æ€æƒ³ã€‚</p><p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3a89899432b549d198a98f404e791a97~tplv-k3u1fbpfcp-watermark.image" alt="image.png"></p><p>å¦‚å›¾ï¼ŒElement å’Œ Visitor åˆ†åˆ«ä»£è¡¨å¯¹è±¡ç»“æ„å’Œæ“ä½œé€»è¾‘ï¼Œä¸¤è€…å¯ä»¥ç‹¬ç«‹æ‰©å±•ï¼Œåœ¨ Client é‡Œé¢æ¥ç»„åˆä¸¤è€…ï¼Œä½¿ç”¨ visitor æ“ä½œ elementã€‚è¿™å°±æ˜¯ visitor æ¨¡å¼ã€‚</p><p>å¯¹åº”åˆ° babel traverse çš„å®ç°ï¼Œå°±æ˜¯ AST å’Œ visitor åˆ†ç¦»ï¼Œåœ¨ traverseï¼ˆéå†ï¼‰AST çš„æ—¶å€™ï¼Œè°ƒç”¨æ³¨å†Œçš„ visitor æ¥å¯¹å…¶è¿›è¡Œå¤„ç†ã€‚</p><p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c592dedef6ff429ebbcb350e0afa404d~tplv-k3u1fbpfcp-watermark.image" alt="image.png"></p><p>è¿™æ ·ä½¿å¾— AST çš„ç»“æ„å’Œéå†ç®—æ³•å›ºå®šï¼Œvisitor å¯ä»¥é€šè¿‡æ’ä»¶ç‹¬ç«‹æ‰©å±•ã€‚</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="è·¯å¾„å’Œä½œç”¨åŸŸ"></a>è·¯å¾„å’Œä½œç”¨åŸŸ<a class="hash-link" href="#è·¯å¾„å’Œä½œç”¨åŸŸ" title="Direct link to heading">#</a></h2><p>babel AST ä¸­åªåŒ…å«æºç çš„ä¸€äº›ä¿¡æ¯ï¼Œä½†æ˜¯æ“ä½œ AST æ—¶è¦æ‹¿åˆ°çˆ¶èŠ‚ç‚¹çš„ä¿¡æ¯ï¼Œå¹¶ä¸”ä¹Ÿéœ€è¦å¯¹ AST å¢åˆ æ”¹çš„æ–¹æ³•ï¼Œè¿™äº›éƒ½åœ¨ path å¯¹è±¡é‡Œã€‚</p><p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/293327a616cc4c90b7fa40c7e28761a0~tplv-k3u1fbpfcp-watermark.image" alt="image.png"></p><p>babel ä¼šåœ¨ traverse çš„è¿‡ç¨‹ä¸­åœ¨ path é‡Œç»´æŠ¤èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹å¼•ç”¨ï¼Œåœ¨å…¶ä¸­ä¿å­˜ scopeï¼ˆä½œç”¨åŸŸï¼‰çš„ä¿¡æ¯ï¼ŒåŒæ—¶ä¹Ÿä¼šæä¾›å¢åˆ æ”¹ AST çš„æ–¹æ³•ã€‚</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="path-çš„å±æ€§"></a>path çš„å±æ€§<a class="hash-link" href="#path-çš„å±æ€§" title="Direct link to heading">#</a></h3><p>path å¤§æ¦‚æœ‰è¿™äº›å±æ€§å’Œæ–¹æ³•</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">path </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// å±æ€§ï¼š</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    node </span></span><span class="token-line" style="color:#393A34"><span class="token plain">    parent</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    parentPath</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    scope</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    hub</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    container</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    key</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    listKey</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// æ–¹æ³•</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">key</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">set</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">key</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> node</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">inList</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">getSibling</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">key</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">getNextSibling</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">getPrevSibling</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">getAllPrevSiblings</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">getAllNextSiblings</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">isXxx</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">opts</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">assertXxx</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">opts</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">find</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">callback</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">findParent</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">callback</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">insertBefore</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">nodes</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">insertAfter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">nodes</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">replaceWith</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">replacement</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">replaceWithMultiple</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">nodes</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">replaceWithSourceString</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">replacement</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">remove</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">traverse</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">visitor</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">skip</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">stop</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>å®ƒä»¬å„è‡ªçš„å«ä¹‰ï¼š</p><ul><li>path.node å½“å‰ AST èŠ‚ç‚¹</li><li>path.parent çˆ¶ AST èŠ‚ç‚¹</li><li>path.parentPath çˆ¶ AST èŠ‚ç‚¹çš„ path</li><li>path.scope ä½œç”¨åŸŸï¼Œè§ä¸‹æ–‡è¯¦è§£</li><li>path.hub å¯ä»¥é€šè¿‡ path.hub.file æ‹¿åˆ°æœ€å¤–å±‚ File å¯¹è±¡ï¼Œ path.hub.getScope æ‹¿åˆ°æœ€å¤–å±‚ä½œç”¨åŸŸï¼Œpath.hub.getCode æ‹¿åˆ°æºç å­—ç¬¦ä¸²</li><li>path.container å½“å‰ AST èŠ‚ç‚¹æ‰€åœ¨çš„çˆ¶èŠ‚ç‚¹å±æ€§çš„å±æ€§å€¼</li><li>path.key å½“å‰ AST èŠ‚ç‚¹æ‰€åœ¨çˆ¶èŠ‚ç‚¹å±æ€§çš„å±æ€§åæˆ–æ‰€åœ¨æ•°ç»„çš„ä¸‹æ ‡</li><li>path.listkey å½“å‰ AST èŠ‚ç‚¹æ‰€åœ¨çˆ¶èŠ‚ç‚¹å±æ€§çš„å±æ€§å€¼ä¸ºæ•°ç»„æ—¶ listkey ä¸ºè¯¥å±æ€§åï¼Œå¦åˆ™ä¸º undefined</li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="containerã€listkeyã€keyï¼ˆä¸å¸¸ç”¨ï¼Œå¯ç•¥è¿‡ï¼‰"></a>containerã€listkeyã€keyï¼ˆä¸å¸¸ç”¨ï¼Œå¯ç•¥è¿‡ï¼‰<a class="hash-link" href="#containerã€listkeyã€keyï¼ˆä¸å¸¸ç”¨ï¼Œå¯ç•¥è¿‡ï¼‰" title="Direct link to heading">#</a></h4><p>containerã€listkeyã€key è¿™ä¸‰ä¸ªå±æ€§æœ‰ç‚¹ç»•ï¼ˆä¹Ÿä¸å¤ªå¸¸ç”¨ï¼Œå¯ä»¥è·³è¿‡ï¼Œåé¢å®ç°æ‰‹å†™ babel çš„æ—¶å€™æ‰ä¼šç”¨åˆ°ï¼‰ï¼Œè§£é‡Šä¸€ä¸‹ï¼š</p><p>å› ä¸º AST èŠ‚ç‚¹è¦æŒ‚åœ¨çˆ¶ AST èŠ‚ç‚¹çš„æŸä¸ªå±æ€§ä¸Šï¼Œé‚£ä¸ªå±æ€§çš„å±æ€§å€¼å°±æ˜¯è¿™ä¸ª AST èŠ‚ç‚¹çš„ containerã€‚</p><p>æ¯”å¦‚ CallExpression æœ‰ callee å’Œ arguments å±æ€§ï¼Œé‚£ä¹ˆå¯¹äº callee çš„ AST èŠ‚ç‚¹æ¥è¯´ï¼Œcallee çš„å±æ€§å€¼å°±æ˜¯å®ƒçš„ containerï¼Œè€Œ callee å°±æ˜¯å®ƒçš„ keyã€‚</p><p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4ce55f6c749d4e35ad6460de6f5be71a~tplv-k3u1fbpfcp-watermark.image"></p><p>è€Œ BlockStatement æœ‰ body å±æ€§ï¼Œæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œå¯¹äºæ•°ç»„ä¸­çš„æ¯ä¸€ä¸ª AST æ¥è¯´ï¼Œè¿™ä¸ªæ•°ç»„å°±æ˜¯å®ƒä»¬çš„ containerï¼Œè€Œ listKey æ˜¯ bodyï¼Œkey åˆ™æ˜¯ä¸‹æ ‡ã€‚</p><p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b48a0cdddb4344d1b9343e04818460ad~tplv-k3u1fbpfcp-watermark.image"></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="path-çš„æ–¹æ³•"></a>path çš„æ–¹æ³•<a class="hash-link" href="#path-çš„æ–¹æ³•" title="Direct link to heading">#</a></h3><p>path æœ‰å¦‚ä¸‹æ–¹æ³•</p><ul><li>inList() åˆ¤æ–­èŠ‚ç‚¹æ˜¯å¦åœ¨æ•°ç»„ä¸­ï¼Œå¦‚æœ container ä¸ºæ•°ç»„ï¼Œä¹Ÿå°±æ˜¯æœ‰ listkey çš„æ—¶å€™ï¼Œè¿”å› true</li><li>get(key) è·å–æŸä¸ªå±æ€§çš„ path</li><li>set(key, node) è®¾ç½®æŸä¸ªå±æ€§çš„å€¼</li><li>getSibling(key) è·å–æŸä¸ªä¸‹æ ‡çš„å…„å¼ŸèŠ‚ç‚¹</li><li>getNextSibling() è·å–ä¸‹ä¸€ä¸ªå…„å¼ŸèŠ‚ç‚¹</li><li>getPrevSibling() è·å–ä¸Šä¸€ä¸ªå…„å¼ŸèŠ‚ç‚¹</li><li>getAllPrevSiblings() è·å–ä¹‹å‰çš„æ‰€æœ‰å…„å¼ŸèŠ‚ç‚¹</li><li>getAllNextSiblings() è·å–ä¹‹åçš„æ‰€æœ‰å…„å¼ŸèŠ‚ç‚¹</li><li>find(callback) ä»å½“å‰èŠ‚ç‚¹åˆ°æ ¹èŠ‚ç‚¹æ¥æŸ¥æ‰¾èŠ‚ç‚¹ï¼ˆåŒ…æ‹¬å½“å‰èŠ‚ç‚¹ï¼‰ï¼Œè°ƒç”¨ callbackï¼ˆä¼ å…¥ pathï¼‰æ¥å†³å®šæ˜¯å¦ç»ˆæ­¢æŸ¥æ‰¾</li><li>findParent(callback) ä»å½“å‰èŠ‚ç‚¹åˆ°æ ¹èŠ‚ç‚¹æ¥æŸ¥æ‰¾èŠ‚ç‚¹ï¼ˆä¸åŒ…æ‹¬å½“å‰èŠ‚ç‚¹ï¼‰ï¼Œè°ƒç”¨ callbackï¼ˆä¼ å…¥ pathï¼‰æ¥å†³å®šæ˜¯å¦ç»ˆæ­¢æŸ¥æ‰¾</li><li>isXxx(opts) åˆ¤æ–­å½“å‰èŠ‚ç‚¹æ˜¯å¦æ˜¯æŸä¸ªç±»å‹ï¼Œå¯ä»¥ä¼ å…¥å±æ€§å’Œå±æ€§å€¼è¿›ä¸€æ­¥åˆ¤æ–­ï¼Œæ¯”å¦‚path.isIdentifier({name: &#x27;a&#x27;})</li><li>assertXxx(opts) åŒ isXxxï¼Œä½†æ˜¯ä¸è¿”å›å¸ƒå°”å€¼ï¼Œè€Œæ˜¯æŠ›å‡ºå¼‚å¸¸</li><li>insertBefore(nodes) åœ¨ä¹‹å‰æ’å…¥èŠ‚ç‚¹ï¼Œå¯ä»¥æ˜¯å•ä¸ªèŠ‚ç‚¹æˆ–è€…èŠ‚ç‚¹æ•°ç»„</li><li>insertAfter(nodes) åœ¨ä¹‹åæ’å…¥èŠ‚ç‚¹ï¼Œå¯ä»¥æ˜¯å•ä¸ªèŠ‚ç‚¹æˆ–è€…èŠ‚ç‚¹æ•°ç»„</li><li>replaceWith(replacement) ç”¨æŸä¸ªèŠ‚ç‚¹æ›¿æ¢å½“å‰èŠ‚ç‚¹</li><li>replaceWithMultiple(nodes) ç”¨å¤šä¸ªèŠ‚ç‚¹æ›¿æ¢å½“å‰èŠ‚ç‚¹</li><li>replaceWithSourceString(replacement) è§£ææºç æˆ ASTï¼Œç„¶åæ›¿æ¢å½“å‰èŠ‚ç‚¹</li><li>remove() åˆ é™¤å½“å‰èŠ‚ç‚¹</li><li>traverse(visitor, state) éå†å½“å‰èŠ‚ç‚¹çš„å­èŠ‚ç‚¹ï¼Œä¼ å…¥ visitor å’Œ stateï¼ˆstate æ˜¯ä¸åŒèŠ‚ç‚¹é—´ä¼ é€’æ•°æ®çš„æ–¹å¼ï¼‰</li><li>skip() è·³è¿‡å½“å‰èŠ‚ç‚¹çš„å­èŠ‚ç‚¹çš„éå†</li><li>stop() ç»“æŸæ‰€æœ‰éå†</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="ä½œç”¨åŸŸ-pathscope"></a>ä½œç”¨åŸŸ path.scope<a class="hash-link" href="#ä½œç”¨åŸŸ-pathscope" title="Direct link to heading">#</a></h3><p>scope æ˜¯ä½œç”¨åŸŸä¿¡æ¯ï¼Œjavascript ä¸­èƒ½ç”Ÿæˆä½œç”¨åŸŸçš„å°±æ˜¯æ¨¡å—ã€å‡½æ•°ã€å—ç­‰ï¼Œè€Œä¸”ä½œç”¨åŸŸä¹‹é—´ä¼šå½¢æˆåµŒå¥—å…³ç³»ï¼Œä¹Ÿå°±æ˜¯ä½œç”¨åŸŸé“¾ã€‚babel åœ¨éå†çš„è¿‡ç¨‹ä¸­ä¼šç”Ÿæˆä½œç”¨åŸŸé“¾ä¿å­˜åœ¨ path.scope ä¸­ã€‚</p><p>å±æ€§å’Œæ–¹æ³•å¤§æ¦‚æœ‰è¿™äº›</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">path</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">scope</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    bindings</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    block</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    parent</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    parentBlock</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    path</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    references</span></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">dump</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">parentBlock</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">getAllBindings</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">getBinding</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">name</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">hasBinding</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">name</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">getOwnBinding</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">name</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">parentHasBinding</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">name</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">removeBinding</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">name</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">moveBindingTo</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> scope</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">generateUid</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">name</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>å„è‡ªçš„å«ä¹‰ï¼š</p><ul><li>scope.bindings å½“å‰ä½œç”¨åŸŸå†…å£°æ˜çš„æ‰€æœ‰å˜é‡</li><li>scope.block ç”Ÿæˆä½œç”¨åŸŸçš„ blockï¼Œè¯¦è§ä¸‹æ–‡</li><li>scope.path ç”Ÿæˆä½œç”¨åŸŸçš„èŠ‚ç‚¹å¯¹åº”çš„ path</li><li>scope.references æ‰€æœ‰ binding çš„å¼•ç”¨å¯¹åº”çš„ pathï¼Œè¯¦è§ä¸‹æ–‡</li><li>scope.dump() æ‰“å°ä½œç”¨åŸŸé“¾çš„æ‰€æœ‰ binding åˆ°æ§åˆ¶å°</li><li>scope.parentBlock() çˆ¶çº§ä½œç”¨åŸŸçš„ block</li><li>getAllBindings() ä»å½“å‰ä½œç”¨åŸŸåˆ°æ ¹ä½œç”¨åŸŸçš„æ‰€æœ‰ binding çš„åˆå¹¶</li><li>getBinding(name) æŸ¥æ‰¾æŸä¸ª bindingï¼Œä»å½“å‰ä½œç”¨åŸŸä¸€ç›´æŸ¥æ‰¾åˆ°æ ¹ä½œç”¨åŸŸ</li><li>getOwnBinding(name) ä»å½“å‰ä½œç”¨åŸŸæŸ¥æ‰¾ binding</li><li>parentHasBinding(name, noGlobals) æŸ¥æ‰¾æŸä¸ª bindingï¼Œä»çˆ¶ä½œç”¨åŸŸæŸ¥åˆ°æ ¹ä½œç”¨åŸŸï¼Œä¸åŒ…æ‹¬å½“å‰ä½œç”¨åŸŸã€‚å¯ä»¥é€šè¿‡ noGlobals å‚æ•°æŒ‡å®šæ˜¯å¦ç®—ä¸Šå…¨å±€å˜é‡ï¼ˆæ¯”å¦‚consoleï¼Œä¸éœ€è¦å£°æ˜å°±å¯ç”¨ï¼‰ï¼Œé»˜è®¤æ˜¯ false</li><li>removeBinding(name) åˆ é™¤æŸä¸ª binding</li><li>hasBinding(name, noGlobals) ä»å½“å‰ä½œç”¨åŸŸæŸ¥æ‰¾ bindingï¼Œå¯ä»¥æŒ‡å®šæ˜¯å¦ç®—ä¸Šå…¨å±€å˜é‡ï¼Œé»˜è®¤æ˜¯ false</li><li>moveBindingTo(name, scope) æŠŠå½“å‰ä½œç”¨åŸŸä¸­çš„æŸä¸ª binding ç§»åŠ¨åˆ°å…¶ä»–ä½œç”¨åŸŸ</li><li>generateUid(name) ç”Ÿæˆä½œç”¨åŸŸå†…å”¯ä¸€çš„åå­—ï¼Œæ ¹æ® name æ·»åŠ ä¸‹åˆ’çº¿ï¼Œæ¯”å¦‚ name ä¸º aï¼Œä¼šå°è¯•ç”Ÿæˆ _aï¼Œå¦‚æœè¢«å ç”¨å°±ä¼šç”Ÿæˆ __aï¼Œç›´åˆ°ç”Ÿæˆæ²¡æœ‰è¢«ä½¿ç”¨çš„åå­—ã€‚</li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="scopeblock"></a>scope.block<a class="hash-link" href="#scopeblock" title="Direct link to heading">#</a></h4><p>èƒ½å½¢æˆ scope çš„æœ‰è¿™äº›èŠ‚ç‚¹ï¼Œè¿™äº›èŠ‚ç‚¹ä¹Ÿå« block èŠ‚ç‚¹ã€‚</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword module" style="color:#00009f">export</span><span class="token plain"> type </span><span class="token maybe-class-name">Scopable</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token maybe-class-name">BlockStatement</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token maybe-class-name">CatchClause</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token maybe-class-name">DoWhileStatement</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token maybe-class-name">ForInStatement</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token maybe-class-name">ForStatement</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token maybe-class-name">FunctionDeclaration</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token maybe-class-name">FunctionExpression</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token maybe-class-name">Program</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token maybe-class-name">ObjectMethod</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token maybe-class-name">SwitchStatement</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token maybe-class-name">WhileStatement</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token maybe-class-name">ArrowFunctionExpression</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token maybe-class-name">ClassExpression</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token maybe-class-name">ClassDeclaration</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token maybe-class-name">ForOfStatement</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token maybe-class-name">ClassMethod</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token maybe-class-name">ClassPrivateMethod</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token maybe-class-name">StaticBlock</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token maybe-class-name">TSModuleBlock</span><span class="token punctuation" style="color:#393A34">;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ path.scope.block æ¥æ‹¿åˆ°æ‰€åœ¨çš„å—å¯¹åº”çš„èŠ‚ç‚¹ï¼Œé€šè¿‡ path.scope.parentBlock æ‹¿åˆ°çˆ¶ä½œç”¨åŸŸå¯¹åº”çš„å—èŠ‚ç‚¹ã€‚</p><p>ä¸€èˆ¬æƒ…å†µä¸‹æˆ‘ä»¬ä¸éœ€è¦æ‹¿åˆ°ç”Ÿæˆä½œç”¨åŸŸçš„å—èŠ‚ç‚¹ï¼Œåªéœ€è¦é€šè¿‡ path.scope æ‹¿åˆ°ä½œç”¨åŸŸçš„ä¿¡æ¯ï¼Œé€šè¿‡ patsh.scope.parent æ‹¿åˆ°çˆ¶ä½œç”¨åŸŸçš„ä¿¡æ¯ã€‚</p><p>åé¢æ‰‹å†™ babel çš„æ¡ˆä¾‹ä¼šç”¨åˆ°ï¼Œè¿™é‡Œç®€å•äº†è§£å³å¯ã€‚</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="scopebindingsã€scopereferencesï¼ˆé‡ç‚¹ï¼‰"></a>scope.bindingsã€scope.referencesï¼ˆé‡ç‚¹ï¼‰<a class="hash-link" href="#scopebindingsã€scopereferencesï¼ˆé‡ç‚¹ï¼‰" title="Direct link to heading">#</a></h4><p>ä½œç”¨åŸŸä¸­ä¿å­˜çš„æ˜¯å£°æ˜çš„å˜é‡å’Œå¯¹åº”çš„å€¼ï¼Œæ¯ä¸€ä¸ªå£°æ˜å«åšä¸€ä¸ªbindingï¼ˆç»‘å®šï¼‰ã€‚</p><p>æ¯”å¦‚è¿™æ ·ä¸€æ®µä»£ç </p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> a </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>å®ƒçš„ path.scope.bindings æ˜¯è¿™æ ·çš„</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">bindings</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    a</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        constant</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        constantViolations</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        identifier</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">type</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;Identifier&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token spread operator" style="color:#393A34">...</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        kind</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">&#x27;const&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        path</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">node</span><span class="token punctuation" style="color:#393A34">,</span><span class="token spread operator" style="color:#393A34">...</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        referenced</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        referencePaths</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        references</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        scope</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token spread operator" style="color:#393A34">...</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>å› ä¸ºæˆ‘ä»¬åœ¨å½“å‰ scope ä¸­å£°æ˜äº† a è¿™ä¸ªå˜é‡ï¼Œæ‰€ä»¥ bindings ä¸­æœ‰ a çš„ bindingï¼Œæ¯ä¸€ä¸ª binding éƒ½æœ‰ kindï¼Œè¿™ä»£è¡¨ç»‘å®šçš„ç±»å‹ï¼š</p><ul><li>varã€letã€const åˆ†åˆ«ä»£è¡¨ varã€letã€const å½¢å¼å£°æ˜çš„å˜é‡</li><li>param ä»£è¡¨å‚æ•°çš„å£°æ˜</li><li>module ä»£è¡¨ import çš„å˜é‡çš„å£°æ˜</li></ul><p>binding æœ‰å¤šç§ kindï¼Œä»£è¡¨ä¸åŒçš„å£°æ˜æ–¹å¼ã€‚</p><p>binding.identifier å’Œ binding.pathï¼Œåˆ†åˆ«ä»£è¡¨æ ‡è¯†ç¬¦çš„ ASTã€æ•´ä¸ªå£°æ˜è¯­å¥çš„ ASTã€‚</p><p>å£°æ˜ä¹‹åçš„å˜é‡ä¼šè¢«å¼•ç”¨å’Œä¿®æ”¹ï¼Œbinding.referenced ä»£è¡¨å£°æ˜çš„å˜é‡æ˜¯å¦è¢«å¼•ç”¨ï¼Œbinding.constant ä»£è¡¨å˜é‡æ˜¯å¦è¢«ä¿®æ”¹è¿‡ã€‚å¦‚æœè¢«å¼•ç”¨äº†ï¼Œå°±å¯ä»¥é€šè¿‡ binding.referencePaths æ‹¿åˆ°æ‰€æœ‰å¼•ç”¨çš„è¯­å¥çš„ pathã€‚å¦‚æœè¢«ä¿®æ”¹äº†ï¼Œå¯ä»¥é€šè¿‡ binding.constViolations æ‹¿åˆ°æ‰€æœ‰ä¿®æ”¹çš„è¯­å¥çš„ pathã€‚</p><p>path çš„ api è¿˜æ˜¯æ¯”è¾ƒå¤šçš„ï¼Œè¿™ä¹Ÿæ˜¯ babel æœ€å¼ºå¤§çš„åœ°æ–¹ã€‚ä¸»è¦æ˜¯æ“ä½œå½“å‰èŠ‚ç‚¹ã€å½“å‰èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹ã€å…„å¼ŸèŠ‚ç‚¹ï¼Œä½œç”¨åŸŸï¼Œä»¥åŠå¢åˆ æ”¹çš„æ–¹æ³•ã€‚</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="node-é“¾ã€block-é“¾ã€scope-é“¾"></a>node é“¾ã€block é“¾ã€scope é“¾<a class="hash-link" href="#node-é“¾ã€block-é“¾ã€scope-é“¾" title="Direct link to heading">#</a></h3><p>ä»æŸä¸€ä¸ªèŠ‚ç‚¹å‡ºå‘æœ‰ 3 æ¡é“¾ï¼Œpath å’Œ path.parent ä¸²è”èµ·æ¥çš„ AST node é“¾ï¼Œpath.scope å’Œ path.scope.parent ä¸²è”èµ·æ¥çš„ä½œç”¨åŸŸ scope é“¾ï¼Œpath.scope.block å’Œ path.scope.parentBlock ä¸²è”èµ·æ¥çš„å— AST block é“¾ã€‚</p><p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e0c2bddf922742fe98d0928e98d020df~tplv-k3u1fbpfcp-watermark.image"></p><p>æ³¨æ„ï¼Œè¿™ä¸‰æ¡é“¾åªæ˜¯ä»æŸä¸ªèŠ‚ç‚¹å‡ºå‘åˆ°çˆ¶èŠ‚ç‚¹çš„è·¯å¾„ï¼Œæ•´ä¸ª AST ä¸­çš„è·¯å¾„ä¸æ­¢ä¸€æ¡ï¼Œæ•´ä½“æ¥çœ‹å°±æ˜¯ ast æ ‘ã€scope æ ‘ã€block æ ‘ï¼Œä¸è¿‡æˆ‘ä»¬å†™æ’ä»¶ä¸€èˆ¬åªç”¨åˆ°æŸä¸€æ¡è·¯å¾„ã€‚</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="state"></a>state<a class="hash-link" href="#state" title="Direct link to heading">#</a></h2><p>state æ˜¯éå†è¿‡ç¨‹ä¸­ AST èŠ‚ç‚¹ä¹‹é—´ä¼ é€’æ•°æ®çš„æ–¹å¼ï¼Œæ’ä»¶çš„ visitor ä¸­ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ pathï¼Œç¬¬äºŒä¸ªå‚æ•°å°±æ˜¯ stateã€‚æ’ä»¶å¯ä»¥ä» state ä¸­æ‹¿åˆ° optsï¼Œä¹Ÿå°±æ˜¯æ’ä»¶çš„é…ç½®é¡¹ï¼Œä¹Ÿå¯ä»¥æ‹¿åˆ° file å¯¹è±¡ï¼Œfile ä¸­æœ‰ä¸€äº›æ–‡ä»¶çº§åˆ«çš„ä¿¡æ¯ï¼Œè¿™ä¸ªä¹Ÿå¯ä»¥ä» path.hub.file ä¸­æ‹¿ã€‚</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">state </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    file</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    opts</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>å¯ä»¥åœ¨éå†çš„è¿‡ç¨‹ä¸­åœ¨ state ä¸­å­˜ä¸€äº›çŠ¶æ€ä¿¡æ¯ï¼Œç”¨äºåç»­çš„ AST å¤„ç†ã€‚ä¸æ˜¯éå†è¿‡ç¨‹ä¸­çš„æ•°æ®ï¼Œå¯ä»¥é€šè¿‡ file.setã€file.get æ¥ä¿å­˜ã€‚</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="ast-çš„åˆ«å"></a>AST çš„åˆ«å<a class="hash-link" href="#ast-çš„åˆ«å" title="Direct link to heading">#</a></h2><p>éå†çš„æ—¶å€™è¦æŒ‡å®š visitor å¤„ç†çš„ ASTï¼Œæœ‰çš„æ—¶å€™éœ€è¦å¯¹å¤šä¸ªèŠ‚ç‚¹åšåŒæ ·çš„å¤„ç†ï¼Œbabel æ”¯æŒæŒ‡å®šå¤šä¸ª AST ç±»å‹ï¼Œä¹Ÿå¯ä»¥é€šè¿‡åˆ«åæŒ‡å®šä¸€ç³»åˆ—ç±»å‹ã€‚</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// å•ä¸ª AST ç±»å‹</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function maybe-class-name" style="color:#d73a49">FunctionDeclaration</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">path</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> state</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// å¤šä¸ª AST ç±»å‹</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&#x27;FunctionDeclaration|VariableDeclaration&#x27;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">path</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// AST ç±»å‹åˆ«å</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function maybe-class-name" style="color:#d73a49">Declaration</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>å¯ä»¥åœ¨<a href="https://babeljs.io/docs/en/babel-types" target="_blank" rel="noopener noreferrer">æ–‡æ¡£ä¸­</a>æŸ¥åˆ°æŸä¸ª AST ç±»å‹çš„åˆ«åæ˜¯å•¥ï¼ŒæŸä¸ªåˆ«åéƒ½åŒ…å«å“ªäº› AST ç±»å‹å¯ä»¥åœ¨<a href="https://github.com/babel/babel/blob/main/packages/babel-types/src/ast-types/generated/index.ts#L2489-L2535" target="_blank" rel="noopener noreferrer">babel-typesçš„ç±»å‹å®šä¹‰</a>å¤„æŸ¥ã€‚</p><p>å»ºè®®æŠŠ \@babel/types æºç ä¸‹è½½ä¸‹æ¥çœ‹ï¼Œç±»å‹å®šä¹‰åœ¨ src/ast-types/generated ç›®å½•ä¸‹ï¼Œè¿™æ ·å¯ä»¥åˆ©ç”¨ ide çš„åŠŸèƒ½æ–¹ä¾¿çš„æŸ¥çœ‹æ¯ç§ alias çš„å…·ä½“ AST ç±»å‹ã€‚</p><p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b7ce124c18bd4e5c95760212e5e16078~tplv-k3u1fbpfcp-watermark.image"></p><p>æ‰€æœ‰çš„ AST ç›¸å…³çš„ä¿¡æ¯éƒ½å¯ä»¥åœ¨<a href="https://github.com/babel/babel/blob/main/packages/babel-types/src/definitions/core.ts" target="_blank" rel="noopener noreferrer">babel-types</a>é‡ŒæŸ¥çœ‹ï¼Œæ¯ä¸€ä¸ª AST èŠ‚ç‚¹æ€ä¹ˆåˆ›å»ºã€æ€ä¹ˆæ ¡éªŒã€æ€ä¹ˆéå†ï¼Œå…¶å®éƒ½ä¸ AST çš„ç»“æ„æœ‰å…³ç³»ï¼Œè¿™äº›éƒ½åœ¨ babel-types é‡Œé¢å®šä¹‰ã€‚</p><p>æ¯”å¦‚ifå°±å®šä¹‰äº†æœ‰å“ªäº›å±æ€§å¯ä»¥éå†ã€åˆ«åæ˜¯ä»€ä¹ˆï¼Œæ¯ä¸€ä¸ªå±æ€§æ€ä¹ˆæ ¡éªŒï¼Œç„¶åä¼šæ ¹æ®è¿™äº›è§„åˆ™ç”Ÿæˆxxxï¼ŒisXxxï¼ŒassertXxxç­‰apiç”¨äºåˆ›å»ºã€åˆ¤æ–­ASTèŠ‚ç‚¹ã€‚</p><p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/004cb659aeaa4c749cfff6b2187383a4~tplv-k3u1fbpfcp-watermark.image" alt="image.png"></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="æ€»ç»“"></a>æ€»ç»“<a class="hash-link" href="#æ€»ç»“" title="Direct link to heading">#</a></h2><p>è¿™ä¸€èŠ‚æˆ‘ä»¬å­¦ä¹ äº† visitor æ¨¡å¼ï¼Œé€šè¿‡å¯¹è±¡å’Œæ“ä½œåˆ†ç¦»çš„æ–¹å¼ä½¿å¾— visitor å¯ä»¥ç‹¬ç«‹æ‰©å±•ï¼Œç„¶åå­¦ä¹ äº†babel å¼ºå¤§çš„ pathï¼ŒåŒ…æ‹¬å®ƒçš„å±æ€§å’Œæ“ä½œ AST çš„ apiï¼Œä»¥åŠä½œç”¨åŸŸ scope çš„ä¸€äº›æ¦‚å¿µå’Œ apiã€‚å­¦ä¹ äº† 3 æ¡é“¾ï¼ŒAST é“¾ã€ä½œç”¨åŸŸé“¾ã€block é“¾ã€‚ä¹‹åäº†è§£äº† AST çš„åˆ«åï¼Œå¯ä»¥é€šè¿‡ babel-types çš„ç±»å‹å®šä¹‰æ¥æŸ¥çœ‹æ‰€æœ‰çš„ AST çš„åˆ«åç­‰ä¿¡æ¯ã€‚</p><p>å­¦å®Œè¿™ä¸€èŠ‚ï¼Œæˆ‘ä»¬æŒæ¡äº†å¼ºå¤§çš„ path apiï¼Œå¯¹ babel æ’ä»¶çš„æŒæ¡å°±ç®—å®Œæˆäº†ä¸€å¤§åŠäº†ã€‚</p><p>api æ¯”è¾ƒå¤šï¼Œé©¬ä¸Šæ¶ˆåŒ–ä¸å¤ªç°å®ï¼Œä¸ç”¨ç€æ€¥ï¼Œåé¢å®æˆ˜ä¼šå¤§é‡ç”¨åˆ°ã€‚</p></div><footer class="row docusaurus-mt-lg"><div class="col"><a href="https://github.com/dapengdouyu/docs/tree/master/docs/books/babel/7ã€traverse çš„ visitor å’Œ path.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_3DPF">Last updated on <b><time datetime="2021-10-09T09:56:52.000Z">10/9/2021</time></b></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#visitoræ¨¡å¼" class="table-of-contents__link">visitoræ¨¡å¼</a></li><li><a href="#è·¯å¾„å’Œä½œç”¨åŸŸ" class="table-of-contents__link">è·¯å¾„å’Œä½œç”¨åŸŸ</a><ul><li><a href="#path-çš„å±æ€§" class="table-of-contents__link">path çš„å±æ€§</a></li><li><a href="#path-çš„æ–¹æ³•" class="table-of-contents__link">path çš„æ–¹æ³•</a></li><li><a href="#ä½œç”¨åŸŸ-pathscope" class="table-of-contents__link">ä½œç”¨åŸŸ path.scope</a></li><li><a href="#node-é“¾ã€block-é“¾ã€scope-é“¾" class="table-of-contents__link">node é“¾ã€block é“¾ã€scope é“¾</a></li></ul></li><li><a href="#state" class="table-of-contents__link">state</a></li><li><a href="#ast-çš„åˆ«å" class="table-of-contents__link">AST çš„åˆ«å</a></li><li><a href="#æ€»ç»“" class="table-of-contents__link">æ€»ç»“</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 dapeng (å¼ äºšé¹) Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.3c5dc381.js"></script>
<script src="/assets/js/main.055808b2.js"></script>
</body>
</html>