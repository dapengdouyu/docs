<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.7">
<link rel="alternate" type="application/rss+xml" href="/rss.xml" title="Dapeng&#39;s blog RSS Feed">
<script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?7dda2565ba246ecd62878c13153e2941",e.defer=!0;var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script>
<meta name="baidu-site-verification" content="IXU12YQUjF">
<link rel="preconnect" href="https://hmcdn.baidu.com">
<link rel="stylesheet" href="https://cansiny.oss-cn-shanghai.aliyuncs.com/assets/fonts.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/katex.min.css" integrity="sha384-Um5gpz1odJg5Z4HAmzPtgZKdTBHZdw8S29IecapCSB31ligYPhHQZMIlWLYQGVoc" crossorigin="anonymous"><title data-react-helmet="true">JSBridge - Dapeng的博客</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://dapengdouyu.github.io/docs/program/跨平台/JSBridge"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="JSBridge - Dapeng的博客"><meta data-react-helmet="true" name="description" content="什么是 JSBridge"><meta data-react-helmet="true" property="og:description" content="什么是 JSBridge"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://dapengdouyu.github.io/docs/program/跨平台/JSBridge"><link data-react-helmet="true" rel="alternate" href="https://dapengdouyu.github.io/docs/program/跨平台/JSBridge" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://dapengdouyu.github.io/docs/program/跨平台/JSBridge" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.104602c4.css">
<link rel="preload" href="/assets/js/runtime~main.044e1902.js" as="script">
<link rel="preload" href="/assets/js/main.13b64cb7.js" as="script">
</head>
<body>
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,e("light"))}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.jpg" alt="DAPENG" class="themedImage_1VuW themedImage--light_3UqQ"><img src="/img/logo.jpg" alt="DAPENG" class="themedImage_1VuW themedImage--dark_hz6m"></div><b class="navbar__title">DAPENG</b></a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a aria-current="page" class="navbar__link" href="/">博客</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/tags/java-script">JavaScript</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link">前端</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/program/javascript/index">Javascript</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link">阅读</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/books/Babel 插件通关秘籍/index">Babel 插件通关秘籍</a></li></ul></div><a href="https://github.com/dapengdouyu" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>github<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_71bT toggle_3Zt9 toggleDisabled_3cF-"><div class="toggleTrack_32Fl" role="button" tabindex="-1"><div class="toggleTrackCheck_3lV7"><span class="toggleIcon_O4iE">🌜</span></div><div class="toggleTrackX_S2yS"><span class="toggleIcon_O4iE">🌞</span></div><div class="toggleTrackThumb_xI_Z"></div></div><input type="checkbox" class="toggleScreenReader_28Tw" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_35hR" type="button"></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">HTML和CSS</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">javascript</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">linux</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">react</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">算法</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">跨平台</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/program/跨平台/index">index</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/program/跨平台/JSBridge">JSBridge</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">面试</a></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_1CGd"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_3E-R"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>JSBridge</h1></header><h2 class="anchor anchorWithStickyNavbar_31ik" id="什么是-jsbridge">什么是 JSBridge<a aria-hidden="true" class="hash-link" href="#什么是-jsbridge" title="Direct link to heading">​</a></h2><p>从名字我们就可以看出，<code>Bridge</code>是一个桥梁，连接起<code>JS</code>和<code>Native</code>，使得两个本来互相隔离的“孤岛”能够通信。<code>H5</code>可以通过<code>Bridge</code>调用<code>Native</code>的能力，<code>Native</code>也可以调用<code>JS</code>执行。
常见的跨平台框架<code>ReactNative</code>、<code>Cordova</code>都是使用<code>JSBridge</code>处理<code>js</code>和<code>native</code>之间的通信的</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="webview">WebView<a aria-hidden="true" class="hash-link" href="#webview" title="Direct link to heading">​</a></h2><p>首先了解下<code>webView</code>，<code>webView</code>是移动端提供的运行<code>JavaScript</code>的环境，是系统渲染 Web 网页的一个控件，可与页面<code>JavaScript</code>交互，实现混合开发，其中<code>Android</code>和<code>iOS</code>又有些不同：</p><ul><li><code>Android</code>的<code>WebView</code>采用的是低版本和高版本使用了不同的<code>webkit内核</code>，<code>4.4</code>后直接使用了<code>Chrome</code>。</li><li><code>iOS</code>中<code>UIWebView</code>算是自 IOS2 就有，但性能较差，特性支持较差，<code>WKWebView</code>是<code>iOS8</code>之后的升级版，性能更强特性支持也较好。</li></ul><p>WebView控件除了能<code>加载指定的url</code>外，还可以对<code>URL请求</code>、<code>JavaScript的对话框</code>、<code>加载进度</code>、<code>页面交互</code>进行强大的处理，之后会提到<code>拦截请求</code>、<code>执行JS脚本</code>都依赖于此。</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="jsbridge-的原理">JSBridge 的原理<a aria-hidden="true" class="hash-link" href="#jsbridge-的原理" title="Direct link to heading">​</a></h2><blockquote><p>常用的实现<code>JSBridge</code>方式有两种：</p></blockquote><ul><li>拦截<code>URL请求</code></li><li><code>MessageHandler</code>(执行 JS 脚本)</li></ul><h2 class="anchor anchorWithStickyNavbar_31ik" id="实现jsbridge">实现JSBridge<a aria-hidden="true" class="hash-link" href="#实现jsbridge" title="Direct link to heading">​</a></h2><p>Web端和Native可以类比于<code>Client/Server</code>模式，Web端调用原生接口时就如同<code>Client</code>向<code>Server</code>端发送一个请求类似，<code>JSB</code>在此充当类似于HTTP协议的角色，实现JSBridge主要是两点：</p><ol><li>将Native端原生接口封装成<code>JavaScript接口</code></li><li>将Web端JavaScript接口封装成原生接口</li></ol><h3 class="anchor anchorWithStickyNavbar_31ik" id="1-native-web">1. Native-&gt;Web<a aria-hidden="true" class="hash-link" href="#1-native-web" title="Direct link to heading">​</a></h3><p>首先来说Native端调用Web端，这个比较简单，JavaScript作为解释性语言，最大的一个特性就是可以随时随地地通过解释器执行一段JS代码，所以可以将拼接的JavaScript代码字符串，传入JS解析器执行就可以，JS解析器在这里就是webView。</p><p>Android 4.4之前只能用<code>loadUrl</code>来实现，并且无法执行回调：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">String jsCode = String.format(&quot;window.showWebDialog(&#x27;%s&#x27;)&quot;, text);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">webView.loadUrl(&quot;javascript: &quot; + jsCode);</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Android 4.4之后提供了<code>evaluateJavascript</code>来执行JS代码，并且可以获取返回值执行回调：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">String jsCode = String.format(&quot;window.showWebDialog(&#x27;%s&#x27;)&quot;, text);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">webView.evaluateJavascript(jsCode, new ValueCallback&lt;String&gt;() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  public void onReceiveValue(String value) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">});</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>iOS的<code>UIWebView</code>使用<code>stringByEvaluatingJavaScriptFromString：</code></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly c"><pre tabindex="0" class="prism-code language-c codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">NSString </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">jsStr </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> @</span><span class="token string" style="color:#e3116c">&quot;执行的JS代码&quot;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">webView stringByEvaluatingJavaScriptFromString</span><span class="token operator" style="color:#393A34">:</span><span class="token plain">jsStr</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>iOS的WKWebView使用<code>evaluateJavaScript</code>：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly c"><pre tabindex="0" class="prism-code language-c codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">webView evaluateJavaScript</span><span class="token operator" style="color:#393A34">:</span><span class="token plain">@</span><span class="token string" style="color:#e3116c">&quot;执行的JS代码&quot;</span><span class="token plain"> completionHandler</span><span class="token operator" style="color:#393A34">:</span><span class="token operator" style="color:#393A34">^</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">id _Nullable response</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> NSError </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> _Nullable error</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_31ik" id="2-web-native">2. Web-&gt;Native<a aria-hidden="true" class="hash-link" href="#2-web-native" title="Direct link to heading">​</a></h3><p><code>Web</code>调用<code>Native</code>端主要有两种方式:</p><h4 class="anchor anchorWithStickyNavbar_31ik" id="21-拦截webview请求的url-schema">2.1 拦截Webview请求的URL Schema<a aria-hidden="true" class="hash-link" href="#21-拦截webview请求的url-schema" title="Direct link to heading">​</a></h4><p><code>URL Schema</code>是<code>类URL</code>的一种请求格式，格式如下：</p><blockquote><p><code>&lt;protocol&gt;://&lt;host&gt;/&lt;path&gt;?&lt;qeury&gt;#fragment</code>
我们可以自定义<code>JSBridge</code>通信的<code>URL Schema</code>，比如：<code>jsbridge://showToast?text=hello</code></p></blockquote><p><code>Native</code>加载<code>WebView</code>之后，Web发送的<code>所有请求</code>都会经过<code>WebView</code>组件，所以<code>Native</code>可以重写<code>WebView里的方法</code>，从来<code>拦截Web发起的请求</code>，我们对请求的格式进行判断：</p><ul><li>如果符合我们自定义的<code>URL Schema</code>，对URL进行解析，拿到相关操作、操作，进而调用<code>原生Native的方法</code></li><li>如果不符合我们自定义的<code>URL Schema</code>，我们直接转发，请求真正的服务</li></ul><p><img alt="1.png" src="/assets/images/1-a4df48611b5f6242ca675da3d517213c.png"></p><h4 class="anchor anchorWithStickyNavbar_31ik" id="22-web发送url请求的方法有这么几种">2.2 Web发送URL请求的方法有这么几种：<a aria-hidden="true" class="hash-link" href="#22-web发送url请求的方法有这么几种" title="Direct link to heading">​</a></h4><ul><li><code>a</code>标签</li><li><code>location.href</code></li><li>使用<code>iframe.src</code></li><li>发送<code>ajax</code>请求</li></ul><p>这些方法，<code>a标签</code>需要用户操作，<code>location.href</code>可能会引起页面的跳转丢失调用，<code>发送ajax</code>请求Android没有相应的拦截方法，所以使用<code>iframe.src</code>是经常会使用的方案：</p><ul><li>安卓提供了<code>shouldOverrideUrlLoading</code>方法拦截</li><li>UIWebView使用<code>shouldStartLoadWithRequest</code>，WKWebView则使用<code>decidePolicyForNavigationAction</code></li></ul><p>这种方式从早期就存在，兼容性很好，但是由于是基于URL的方式，长度受到限制而且不太直观，数据格式有限制，而且建立请求有时间耗时。</p><h4 class="anchor anchorWithStickyNavbar_31ik" id="23-向webview中注入js-api">2.3 向Webview中注入JS API<a aria-hidden="true" class="hash-link" href="#23-向webview中注入js-api" title="Direct link to heading">​</a></h4><p>这个方法会通过<code>webView</code>提供的接口，<code>App</code>将<code>Native的相关接口</code>注入到JS的<code>Context（window）</code>的对象中，一般来说这个对象内的方法名与Native相关方法名是相同的，Web端就可以直接在全局window下使用这个暴露的全局JS对象，进而调用原生端的方法。</p><p>这个过程会更加简单直观，不过有兼容性问题，<code>大多数情况下</code>都会使用这种方式:</p><p>Android（4.2+）提供了<code>addJavascriptInterface</code>注入：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">// 注入全局JS对象</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">webView.addJavascriptInterface(new NativeBridge(this), &quot;NativeBridge&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class NativeBridge {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  private Context ctx;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  NativeBridge(Context ctx) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    this.ctx = ctx;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // 增加JS调用接口</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  @JavascriptInterface</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  public void showNativeDialog(String text) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    new AlertDialog.Builder(ctx).setMessage(text).create().show();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>在Web端直接调用这个方法即可：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token dom variable" style="color:#36acaa">window</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access maybe-class-name">NativeBridge</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">showNativeDialog</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;hello&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><ul><li><p>iOS的UIWebView提供了<code>JavaSciptCore</code></p></li><li><p>iOS的WKWebView提供了<code>WKScriptMessageHandler</code></p></li></ul><h4 class="anchor anchorWithStickyNavbar_31ik" id="24-带回调的调用">2.4 带回调的调用<a aria-hidden="true" class="hash-link" href="#24-带回调的调用" title="Direct link to heading">​</a></h4><p>上面已经说到了Native、Web间双向通信的两种方法，但站在一端而言还是一个单向通信的过程 ，比如站在Web的角度：Web调用Native的方法，Native直接相关操作但无法将结果返回给Web，但实际使用中会经常需要将操作的结果返回，也就是JS回调。</p><p>所以在对端操作并返回结果，有输入有输出才是完整的调用，那如何实现呢？</p><p>其实基于之前的单向通信就可以实现，我们在一端调用的时候在参数中加一个<code>callbackId</code>标记对应的回调，对端接收到调用请求后，进行实际操作，如果带有<code>callbackId</code>，对端再进行一次调用，将结果、callbackId回传回来，这端根据callbackId匹配相应的回调，将结果传入执行就可以了。</p><p><img alt="2.png" src="/assets/images/2-f9d56b8120b4d8af7b5e767a361037ad.png"></p><p>可以看到实际上还是通过两次单项通信实现的。</p><p>以<code>Android</code>，在Web端实现带有回调的JSB调用为例：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly html"><pre tabindex="0" class="prism-code language-html codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">// Web端代码：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">body</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">div</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">button</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">id</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">showBtn</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">获取Native输入，以Web弹窗展现</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">button</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">div</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">body</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">script</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">  </span><span class="token script language-javascript keyword" style="color:#00009f">let</span><span class="token script language-javascript"> id </span><span class="token script language-javascript operator" style="color:#393A34">=</span><span class="token script language-javascript"> </span><span class="token script language-javascript number" style="color:#36acaa">1</span><span class="token script language-javascript punctuation" style="color:#393A34">;</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">  </span><span class="token script language-javascript comment" style="color:#999988;font-style:italic">// 根据id保存callback</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">  </span><span class="token script language-javascript keyword" style="color:#00009f">const</span><span class="token script language-javascript"> callbackMap </span><span class="token script language-javascript operator" style="color:#393A34">=</span><span class="token script language-javascript"> </span><span class="token script language-javascript punctuation" style="color:#393A34">{</span><span class="token script language-javascript punctuation" style="color:#393A34">}</span><span class="token script language-javascript punctuation" style="color:#393A34">;</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">  </span><span class="token script language-javascript comment" style="color:#999988;font-style:italic">// 使用JSSDK封装调用与Native通信的事件，避免过多的污染全局环境</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">  </span><span class="token script language-javascript dom variable" style="color:#36acaa">window</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript constant" style="color:#36acaa">JSSDK</span><span class="token script language-javascript"> </span><span class="token script language-javascript operator" style="color:#393A34">=</span><span class="token script language-javascript"> </span><span class="token script language-javascript punctuation" style="color:#393A34">{</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">    </span><span class="token script language-javascript comment" style="color:#999988;font-style:italic">// 获取Native端输入框value，带有回调</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">    </span><span class="token script language-javascript function" style="color:#d73a49">getNativeEditTextValue</span><span class="token script language-javascript punctuation" style="color:#393A34">(</span><span class="token script language-javascript parameter">callback</span><span class="token script language-javascript punctuation" style="color:#393A34">)</span><span class="token script language-javascript"> </span><span class="token script language-javascript punctuation" style="color:#393A34">{</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">      </span><span class="token script language-javascript keyword" style="color:#00009f">const</span><span class="token script language-javascript"> callbackId </span><span class="token script language-javascript operator" style="color:#393A34">=</span><span class="token script language-javascript"> id</span><span class="token script language-javascript operator" style="color:#393A34">++</span><span class="token script language-javascript punctuation" style="color:#393A34">;</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">      callbackMap</span><span class="token script language-javascript punctuation" style="color:#393A34">[</span><span class="token script language-javascript">callbackId</span><span class="token script language-javascript punctuation" style="color:#393A34">]</span><span class="token script language-javascript"> </span><span class="token script language-javascript operator" style="color:#393A34">=</span><span class="token script language-javascript"> callback</span><span class="token script language-javascript punctuation" style="color:#393A34">;</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">      </span><span class="token script language-javascript comment" style="color:#999988;font-style:italic">// 调用JSB方法，并将callbackId传入</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">      </span><span class="token script language-javascript dom variable" style="color:#36acaa">window</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript property-access maybe-class-name">NativeBridge</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript method function property-access" style="color:#d73a49">getNativeEditTextValue</span><span class="token script language-javascript punctuation" style="color:#393A34">(</span><span class="token script language-javascript">callbackId</span><span class="token script language-javascript punctuation" style="color:#393A34">)</span><span class="token script language-javascript punctuation" style="color:#393A34">;</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">    </span><span class="token script language-javascript punctuation" style="color:#393A34">}</span><span class="token script language-javascript punctuation" style="color:#393A34">,</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">    </span><span class="token script language-javascript comment" style="color:#999988;font-style:italic">// 接收Native端传来的callbackId</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">    </span><span class="token script language-javascript function" style="color:#d73a49">receiveMessage</span><span class="token script language-javascript punctuation" style="color:#393A34">(</span><span class="token script language-javascript parameter">callbackId</span><span class="token script language-javascript parameter punctuation" style="color:#393A34">,</span><span class="token script language-javascript parameter"> value</span><span class="token script language-javascript punctuation" style="color:#393A34">)</span><span class="token script language-javascript"> </span><span class="token script language-javascript punctuation" style="color:#393A34">{</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">      </span><span class="token script language-javascript keyword control-flow" style="color:#00009f">if</span><span class="token script language-javascript"> </span><span class="token script language-javascript punctuation" style="color:#393A34">(</span><span class="token script language-javascript">callbackMap</span><span class="token script language-javascript punctuation" style="color:#393A34">[</span><span class="token script language-javascript">callbackId</span><span class="token script language-javascript punctuation" style="color:#393A34">]</span><span class="token script language-javascript punctuation" style="color:#393A34">)</span><span class="token script language-javascript"> </span><span class="token script language-javascript punctuation" style="color:#393A34">{</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">        </span><span class="token script language-javascript comment" style="color:#999988;font-style:italic">// 根据ID匹配callback，并执行</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">        callbackMap</span><span class="token script language-javascript punctuation" style="color:#393A34">[</span><span class="token script language-javascript">callbackId</span><span class="token script language-javascript punctuation" style="color:#393A34">]</span><span class="token script language-javascript punctuation" style="color:#393A34">(</span><span class="token script language-javascript">value</span><span class="token script language-javascript punctuation" style="color:#393A34">)</span><span class="token script language-javascript punctuation" style="color:#393A34">;</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">      </span><span class="token script language-javascript punctuation" style="color:#393A34">}</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">    </span><span class="token script language-javascript punctuation" style="color:#393A34">}</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">  </span><span class="token script language-javascript punctuation" style="color:#393A34">}</span><span class="token script language-javascript punctuation" style="color:#393A34">;</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">    </span><span class="token script language-javascript keyword" style="color:#00009f">const</span><span class="token script language-javascript"> showBtn </span><span class="token script language-javascript operator" style="color:#393A34">=</span><span class="token script language-javascript"> </span><span class="token script language-javascript dom variable" style="color:#36acaa">document</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript method function property-access" style="color:#d73a49">querySelector</span><span class="token script language-javascript punctuation" style="color:#393A34">(</span><span class="token script language-javascript string" style="color:#e3116c">&#x27;#showBtn&#x27;</span><span class="token script language-javascript punctuation" style="color:#393A34">)</span><span class="token script language-javascript punctuation" style="color:#393A34">;</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">  </span><span class="token script language-javascript comment" style="color:#999988;font-style:italic">// 绑定按钮事件</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">  showBtn</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript method function property-access" style="color:#d73a49">addEventListener</span><span class="token script language-javascript punctuation" style="color:#393A34">(</span><span class="token script language-javascript string" style="color:#e3116c">&#x27;click&#x27;</span><span class="token script language-javascript punctuation" style="color:#393A34">,</span><span class="token script language-javascript"> </span><span class="token script language-javascript parameter">e</span><span class="token script language-javascript"> </span><span class="token script language-javascript arrow operator" style="color:#393A34">=&gt;</span><span class="token script language-javascript"> </span><span class="token script language-javascript punctuation" style="color:#393A34">{</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">    </span><span class="token script language-javascript comment" style="color:#999988;font-style:italic">// 通过JSSDK调用，将回调函数传入</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">    </span><span class="token script language-javascript dom variable" style="color:#36acaa">window</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript constant" style="color:#36acaa">JSSDK</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript method function property-access" style="color:#d73a49">getNativeEditTextValue</span><span class="token script language-javascript punctuation" style="color:#393A34">(</span><span class="token script language-javascript parameter">value</span><span class="token script language-javascript"> </span><span class="token script language-javascript arrow operator" style="color:#393A34">=&gt;</span><span class="token script language-javascript"> </span><span class="token script language-javascript dom variable" style="color:#36acaa">window</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript method function property-access" style="color:#d73a49">alert</span><span class="token script language-javascript punctuation" style="color:#393A34">(</span><span class="token script language-javascript string" style="color:#e3116c">&#x27;Natvie输入值：&#x27;</span><span class="token script language-javascript"> </span><span class="token script language-javascript operator" style="color:#393A34">+</span><span class="token script language-javascript"> value</span><span class="token script language-javascript punctuation" style="color:#393A34">)</span><span class="token script language-javascript punctuation" style="color:#393A34">)</span><span class="token script language-javascript punctuation" style="color:#393A34">;</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">  </span><span class="token script language-javascript punctuation" style="color:#393A34">}</span><span class="token script language-javascript punctuation" style="color:#393A34">)</span><span class="token script language-javascript punctuation" style="color:#393A34">;</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">script</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">// Android端代码</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">webView.addJavascriptInterface(new NativeBridge(this), &quot;NativeBridge&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class NativeBridge {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  private Context ctx;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  NativeBridge(Context ctx) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    this.ctx = ctx;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // 获取Native端输入值</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  @JavascriptInterface</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  public void getNativeEditTextValue(int callbackId) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    MainActivity mainActivity = (MainActivity)ctx;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 获取Native端输入框的value</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    String value = mainActivity.editText.getText().toString();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 需要注入在Web执行的JS代码</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    String jsCode = String.format(&quot;window.JSSDK.receiveMessage(%s, &#x27;%s&#x27;)&quot;, callbackId, value);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 在UI线程中执行</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mainActivity.runOnUiThread(new Runnable() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      public void run() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        mainActivity.webView.evaluateJavascript(jsCode, null);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>以上代码简单实现了一个demo，在Web端点击按钮，会获取Native端输入框的值，并将值以Web端弹窗展现，这样就实现了Web-&gt;Native带有回调的JSB调用，同理Native-&gt;Web也是同样的逻辑，不同的只是将<code>callback</code>保存在<code>Native端</code>罢了，在此就不详细论述了。</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="开源的jsbridge">开源的JSBridge<a aria-hidden="true" class="hash-link" href="#开源的jsbridge" title="Direct link to heading">​</a></h2><p>可以看到，实现一个完整的<code>JSBridge</code>还是挺麻烦的，还需要考虑低端机型的兼容问题、同步异步调用问题，好在已经有开源的JSBridge供我们直接使用了：</p><ul><li><code>DSBridge</code>，主要通过注入API的形式，<a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fwendux%2FDSBridge-Android" target="_blank" rel="noopener noreferrer">DSBridge for Android</a>、<a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fwendux%2FDSBridge-IOS" target="_blank" rel="noopener noreferrer">DSBridge for IOS</a></li><li><code>JsBridge</code>，主要通过拦截URL Schema，<a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Flzyzsd%2FJsBridge" target="_blank" rel="noopener noreferrer">JsBridge</a></li></ul><p>以<code>DSBridge-Android</code>为例：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly html"><pre tabindex="0" class="prism-code language-html codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">// Web端代码</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">body</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">div</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">button</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">id</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">showBtn</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">获取Native输入，以Web弹窗展现</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">button</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">div</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">body</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 引入SDK</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">script</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">src</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">https://unpkg.com/dsbridge@3.1.3/dist/dsbridge.js</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token script"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">script</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">script</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">  </span><span class="token script language-javascript keyword" style="color:#00009f">const</span><span class="token script language-javascript"> showBtn </span><span class="token script language-javascript operator" style="color:#393A34">=</span><span class="token script language-javascript"> </span><span class="token script language-javascript dom variable" style="color:#36acaa">document</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript method function property-access" style="color:#d73a49">querySelector</span><span class="token script language-javascript punctuation" style="color:#393A34">(</span><span class="token script language-javascript string" style="color:#e3116c">&#x27;#showBtn&#x27;</span><span class="token script language-javascript punctuation" style="color:#393A34">)</span><span class="token script language-javascript punctuation" style="color:#393A34">;</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">  showBtn</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript method function property-access" style="color:#d73a49">addEventListener</span><span class="token script language-javascript punctuation" style="color:#393A34">(</span><span class="token script language-javascript string" style="color:#e3116c">&#x27;click&#x27;</span><span class="token script language-javascript punctuation" style="color:#393A34">,</span><span class="token script language-javascript"> </span><span class="token script language-javascript parameter">e</span><span class="token script language-javascript"> </span><span class="token script language-javascript arrow operator" style="color:#393A34">=&gt;</span><span class="token script language-javascript"> </span><span class="token script language-javascript punctuation" style="color:#393A34">{</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">    </span><span class="token script language-javascript comment" style="color:#999988;font-style:italic">// 注意，这里代码不同：SDK在全局注册了dsBridge，通过call调用Native方法</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">    dsBridge</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript method function property-access" style="color:#d73a49">call</span><span class="token script language-javascript punctuation" style="color:#393A34">(</span><span class="token script language-javascript string" style="color:#e3116c">&#x27;getNativeEditTextValue&#x27;</span><span class="token script language-javascript punctuation" style="color:#393A34">,</span><span class="token script language-javascript"> </span><span class="token script language-javascript string" style="color:#e3116c">&#x27;&#x27;</span><span class="token script language-javascript punctuation" style="color:#393A34">,</span><span class="token script language-javascript"> </span><span class="token script language-javascript parameter">value</span><span class="token script language-javascript"> </span><span class="token script language-javascript arrow operator" style="color:#393A34">=&gt;</span><span class="token script language-javascript"> </span><span class="token script language-javascript punctuation" style="color:#393A34">{</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">      </span><span class="token script language-javascript dom variable" style="color:#36acaa">window</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript method function property-access" style="color:#d73a49">alert</span><span class="token script language-javascript punctuation" style="color:#393A34">(</span><span class="token script language-javascript string" style="color:#e3116c">&#x27;Native输入值&#x27;</span><span class="token script language-javascript"> </span><span class="token script language-javascript operator" style="color:#393A34">+</span><span class="token script language-javascript"> value</span><span class="token script language-javascript punctuation" style="color:#393A34">)</span><span class="token script language-javascript punctuation" style="color:#393A34">;</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">    </span><span class="token script language-javascript punctuation" style="color:#393A34">}</span><span class="token script language-javascript punctuation" style="color:#393A34">)</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">  </span><span class="token script language-javascript punctuation" style="color:#393A34">}</span><span class="token script language-javascript punctuation" style="color:#393A34">)</span><span class="token script language-javascript punctuation" style="color:#393A34">;</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">script</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">// Android代码</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 使用dwebView替换原生webView</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dwebView.addJavascriptObject(new JsApi(), null);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class JSApi {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  private Context ctx;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  public JSApi (Context ctx) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    this.ctx = ctx;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  @JavascriptInterface</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  public void getNativeEditTextValue(Object msg, CompletionHandler&lt;String&gt; handler) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    String value = ((MainActivity)ctx).editText.getText().toString();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 通过handler将value传给Web端，实现回调的JSB调用</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    handler.completed(value);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>可以看到，代码被精简了很多，其它更多使用直接看文档就可以</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="参考">参考<a aria-hidden="true" class="hash-link" href="#参考" title="Direct link to heading">​</a></h2><p><a href="https://juejin.cn/post/6847902218763534349" target="_blank" rel="noopener noreferrer">万字长文 写给前端工程师的 JSBridge 原理</a></p><p><a href="https://juejin.cn/post/6936814903021797389" target="_blank" rel="noopener noreferrer">深入浅出 JSBridge：从原理到使用</a></p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/dapengdouyu/docs/tree/master/docs/program/跨平台/JSBridge.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_13-_"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2021-10-11T09:53:00.000Z">10/11/2021</time></b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/program/跨平台/index"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« <!-- -->index</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/program/面试/index"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Promise 的优点<!-- --> »</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#什么是-jsbridge" class="table-of-contents__link toc-highlight">什么是 JSBridge</a></li><li><a href="#webview" class="table-of-contents__link toc-highlight">WebView</a></li><li><a href="#jsbridge-的原理" class="table-of-contents__link toc-highlight">JSBridge 的原理</a></li><li><a href="#实现jsbridge" class="table-of-contents__link toc-highlight">实现JSBridge</a><ul><li><a href="#1-native-web" class="table-of-contents__link toc-highlight">1. Native-&gt;Web</a></li><li><a href="#2-web-native" class="table-of-contents__link toc-highlight">2. Web-&gt;Native</a></li></ul></li><li><a href="#开源的jsbridge" class="table-of-contents__link toc-highlight">开源的JSBridge</a></li><li><a href="#参考" class="table-of-contents__link toc-highlight">参考</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2021 dapeng (张亚鹏) Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.044e1902.js"></script>
<script src="/assets/js/main.13b64cb7.js"></script>
</body>
</html>